<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--=========================================================== 신규개발 ===========================================================-->
<mapper namespace="organization.conf.manage">
    <select id="selectAllDeptList" parameterType="cmap" resultType="cmap">
    	SELECT	GR.GroupID                     	AS "GroupID"
			,	GR.GroupCode                   	AS "GroupCode"
			,	GR.CompanyCode                 	AS "CompanyCode"
			,	GR.GroupType                   	AS "GroupType"
			,	GR.MemberOf                    	AS "MemberOf"
			,	GR.GroupPath                   	AS "GroupPath"
			,	GR.RegionCode                  	AS "RegionCode"
			,	GR.DisplayName                 	AS "DisplayName"
			,	GR.MultiDisplayName            	AS "MultiDisplayName"
			,	GR.ShortName                   	AS "ShortName"
			,	GR.MultiShortName              	AS "MultiShortName"
			,	GR.OUName                      	AS "OUName"
			,	GR.OUPath                      	AS "OUPath"
			,	GR.SortKey                     	AS "SortKey"
			,	GR.SortPath                    	AS "SortPath"
			,	GR.IsUse                       	AS "IsUse"
			,	GR.IsDisplay                   	AS "IsDisplay"
			,	GR.IsMail                      	AS "IsMail"
			,	GR.IsHR                        	AS "IsHR"
			,	GR.PrimaryMail                 	AS "PrimaryMail"
			,	GR.SecondaryMail               	AS "SecondaryMail"
			,	GR.ManagerCode                 	AS "ManagerCode"
			,	GR.Description                 	AS "Description"
			,	GR.ReceiptUnitCode             	AS "ReceiptUnitCode"
			,	GR.ApprovalUnitCode            	AS "ApprovalUnitCode"
			,	GR.Receivable                  	AS "Receivable"
			,	GR.Approvable                  	AS "Approvable"
			,	GR.RegistDate                  	AS "RegistDate"
			,	GR.ModifyDate                  	AS "ModifyDate"
			,	GR.Reserved1                   	AS "Reserved1"
			,	GR.Reserved2                   	AS "Reserved2"
			,	GR.Reserved3                   	AS "Reserved3"
			,	GR.Reserved4                   	AS "Reserved4"
			,	GR.Reserved5                   	AS "Reserved5"
			,	GR.Reserved6                   	AS "Reserved6"
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(GR.MultiDisplayName,''),GR.DisplayName)) AS "LANG_DISPLAYNAME"
			,	fn_basegetdictionary_s(#{lang}, NVL(MANAGER.MULTIDISPLAYNAME,'')) AS "MANAGERNAME"
			,	NVL(UR_CNT.CNT,0)			AS "MEMBER_CNT"
			
			,	GR_UPPER.GroupCode              AS "UPPER_GroupCode"
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(GR.MultiShortName,''),GR.ShortName)) AS "LANG_SHORTNAME"
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(GR_UPPER.MultiDisplayName,''),GR_UPPER.DisplayName)) AS "UPPER_LANG_DISPLAYNAME"
		FROM 	sys_object_domain DOMAIN
		JOIN	sys_object_group GR
		ON		DOMAIN.DOMAINCODE 	= GR.COMPANYCODE
		LEFT
		JOIN	sys_object_group GR_UPPER
		ON		GR_UPPER.GROUPCODE 	= GR.MEMBEROF
		AND		GR_UPPER.GROUPTYPE IN ('Dept','Company')	
		LEFT 
		JOIN 	sys_object_user MANAGER
		ON 		GR.MANAGERCODE 		= MANAGER.USERCODE 
		LEFT
		JOIN	(
					SELECT	GM.GROUPCODE AS GROUPCODE
						,	COUNT(*) AS CNT
					FROM sys_object_group_member  GM
					GROUP BY GM.GROUPCODE
				)UR_CNT
		ON 		GR.GROUPCODE = UR_CNT.GROUPCODE
		WHERE 	GR.GROUPTYPE IN ('Dept','Company')
		<if test="domainId != null and domainId != ''">
			AND DOMAIN.domainId = #{domainId}    
		</if>
		<if test="searchType == 'NAME' and searchText != null">
			AND GR.MultiDisplayName like ('%'|| #{searchText}|| '%') 
		</if>
		<if test="searchType == 'CODE' and searchText != null">
			AND GR.GroupCode = #{searchText} 
		</if>
		ORDER BY GR.SortPath ASC 
    </select>
    
	<select id="selectAllDeptListCnt" parameterType="cmap" resultType="java.lang.Long">
    	SELECT 	COUNT(DOMAIN.domainId)
  		FROM 	sys_object_domain DOMAIN
		JOIN	sys_object_group GR
		ON		DOMAIN.DOMAINCODE 	= GR.COMPANYCODE
		LEFT 
		JOIN 	sys_object_user MANAGER
		ON 		GR.MANAGERCODE 		= MANAGER.USERCODE 
		WHERE 	GR.GROUPTYPE IN ('Dept','Company')
		<if test="domainId != null and domainId != ''">
			AND DOMAIN.domainId = #{domainId}    
		</if>
		<if test="searchType == 'NAME' and searchText != null">
			AND GR.MultiDisplayName like ('%'|| #{searchText}|| '%') 
		</if>
		<if test="searchType == 'CODE' and searchText != null">
			AND GR.GroupCode = #{searchText} 
		</if>
    </select>
    
    
    <select id="selectGroupInfoWithSubList" parameterType="cmap" resultType="cmap">
        <![CDATA[
		SELECT
			A.GroupID	AS"GroupID"
		,	A.GroupCode AS"GroupCode"
		,	A.GroupType AS"GroupType"
		,	A.MemberOf  AS"MemberOf"
		,	(SELECT NVL(NULLIF(MultiDisplayName,''),DisplayName) FROM sys_object_group WHERE GroupCode=A.MemberOf) As"ParentName"
		,	A.GroupPath	AS"GroupPath"
		,	NVL(NULLIF(A.MultiDisplayName,''),A.DisplayName)AS "MultiDisplayName"
		,	NVL(NULLIF(a.MultiShortName,''),A.ShortName)AS "MultiShortName"
		,	A.DisplayName			AS"DisplayName"
		,	A.SortKey               AS"SortKey"
		,	A.SortPath              AS"SortPath"
		,	A.OUName                AS"OUName"
		,	A.OUPath                AS"OUPath"
		,	A.IsUse                 AS"IsUse"
		,	A.IsDisplay             AS"IsDisplay"
		,	A.IsMail                AS"IsMail"
		,	A.IsHR                  AS"IsHR"
		,	A.PrimaryMail           AS"PrimaryMail"
		,	A.SecondaryMail         AS"SecondaryMail"
		,	A.Description           AS"Description"
		,	A.ReceiptUnitCode       AS"ReceiptUnitCode"
		,	A.ApprovalUnitCode      AS"ApprovalUnitCode"
		,	A.Receivable            AS"Receivable"
		,	A.Approvable            AS"Approvable"
		,	A.RegistDate            AS"RegistDate"
		,	A.ModifyDate            AS"ModifyDate"
		,	A.ManagerCode           AS"ManagerCode"
		,	NVL((A.ManagerCode|| '|'|| (SELECT DisplayName FROM sys_object_user WHERE UserCode = A.ManagerCode)), '') AS "Manager"
		,	NVL(NULLIF(B.MultiDisplayName,''),B.DisplayName)  AS "CompanyName"
		,	A.CompanyCode AS "CompanyCode"
		FROM sys_object_group  A
		INNER JOIN sys_object_domain  B ON A.CompanyCode = B.DomainCode
		WHERE A.GroupCode IN
		]]>
		<foreach collection="TargetID" item="item"  separator="," open="(" close=")">
		    #{item}
		</foreach>
   		<foreach item="item" index="index" collection="TargetID">
         	OR CONCAT(';',GroupPath) LIKE ('%;'||#{item}||';%')   
   		</foreach>
		
		ORDER BY CASE WHEN GroupCode LIKE 'ORGROOT%' THEN 0 ELSE 1 END
			,	COMPANYCODE
			,	CASE WHEN A.MEMBEROF LIKE '[A-ZA-Z]%' THEN 0 ELSE 1 END
			,	A.MEMBEROF
			,	A.GroupCode
    </select> 
    
    
    <select id="selectAllGroupList" parameterType="cmap" resultType="cmap">
		SELECT 	GR.GroupID                     	AS "GroupID"
			,	GR.GroupCode                   	AS "GroupCode"
			,	GR.CompanyCode                 	AS "CompanyCode"
			,	GR.GroupType                   	AS "GroupType"
			,	GR.MemberOf                    	AS "MemberOf"
			,	GR.GroupPath                   	AS "GroupPath"
			,	GR.RegionCode                  	AS "RegionCode"
			,	GR.DisplayName                 	AS "DisplayName"
			,	GR.MultiDisplayName            	AS "MultiDisplayName"
			,	GR.ShortName                   	AS "ShortName"
			,	GR.MultiShortName              	AS "MultiShortName"
			,	GR.OUName                      	AS "OUName"
			,	GR.OUPath                      	AS "OUPath"
			,	GR.SortKey                     	AS "SortKey"
			,	GR.SortPath                    	AS "SortPath"
			,	GR.IsUse                       	AS "IsUse"
			,	GR.IsDisplay                   	AS "IsDisplay"
			,	GR.IsMail                      	AS "IsMail"
			,	GR.IsHR                        	AS "IsHR"
			,	GR.PrimaryMail                 	AS "PrimaryMail"
			,	GR.SecondaryMail               	AS "SecondaryMail"
			,	GR.ManagerCode                 	AS "ManagerCode"
			,	GR.Description                 	AS "Description"
			,	GR.ReceiptUnitCode             	AS "ReceiptUnitCode"
			,	GR.ApprovalUnitCode            	AS "ApprovalUnitCode"
			,	GR.Receivable                  	AS "Receivable"
			,	GR.Approvable                  	AS "Approvable"
			,	GR.RegistDate                  	AS "RegistDate"
			,	GR.ModifyDate                  	AS "ModifyDate"
			,	GR.Reserved1                   	AS "Reserved1"
			,	GR.Reserved2                   	AS "Reserved2"
			,	GR.Reserved3                   	AS "Reserved3"
			,	GR.Reserved4                   	AS "Reserved4"
			,	GR.Reserved5                   	AS "Reserved5"
			,	GR.Reserved6                   	AS "Reserved6"
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(GR.MultiDisplayName,''),GR.DisplayName)) AS "LANG_DISPLAYNAME"
			,	(NVL(UR_CNT.CNT,0)||'/'||NVL(GR_CNT.CNT,0)) AS "MEMBER_CNT"
  		FROM 	sys_object_domain DOMAIN
		JOIN	sys_object_group GR
		ON		DOMAIN.DOMAINCODE 	= GR.COMPANYCODE
		LEFT
		JOIN	(
					SELECT	GM.GROUPCODE AS GROUPCODE
						,	COUNT(*) AS CNT
					FROM sys_object_group_member  GM
					GROUP BY GM.GROUPCODE
				)UR_CNT
		ON 		GR.GROUPCODE = UR_CNT.GROUPCODE
		LEFT
		JOIN	(
					SELECT	GM.GROUPCODE AS GROUPCODE
						,	COUNT(*) AS CNT
					FROM sys_object_group_membergroup  GM
					GROUP BY GM.GROUPCODE
				)GR_CNT
		ON 		GR.GROUPCODE = GR_CNT.GROUPCODE
		WHERE	1=1
		<if test="domainId != null and domainId != ''">
		AND 	DOMAIN.domainId = #{domainId}    
		</if>
		AND 	GR.GroupType NOT IN ('Dept','Authority','Community')
		AND 	GR.GroupCode NOT LIKE CONCAT('%','Community')
		AND 	GR.GroupCode NOT LIKE CONCAT('%','Authority')
		ORDER BY GR.SortPath ASC 
    </select>
    
	<select id="selectAllGroupListCnt" parameterType="cmap" resultType="java.lang.Long">  
    	SELECT 	COUNT(*)
  		FROM 	sys_object_domain DOMAIN
		JOIN	sys_object_group GR
		ON		DOMAIN.DOMAINCODE 	= GR.COMPANYCODE
		WHERE	1=1
		<if test="domainId != null and domainId != ''">
		AND 	DOMAIN.domainId = #{domainId}    
		</if>
		AND 	GR.GroupType NOT IN ('Dept','Authority','Community')
		AND 	GR.GroupCode NOT LIKE CONCAT('%','Community')
		AND 	GR.GroupCode NOT LIKE CONCAT('%','Authority')
    </select>
    
    <!-- 그룹 우선순위변경 -->
	<update id="updateGroupSort" parameterType="cmap" >
 		UPDATE 	sys_object_group
 		SET		SortPath 	= #{SortPath}
			<if test="SortKey != null">
			,	SortKey 	= #{SortKey} 
			</if>
			
 		WHERE 	1=1
 		AND 	GroupCode 	= #{GroupCode}
 	</update> 
	<!-- 미사용 -->
    <update id="updateArbitraryGroupSortKeyByGroupPath" parameterType="cmap" >
 		UPDATE 	sys_object_group
 		SET		SortKey 	= 	CASE 	WHEN GroupCode = #{OriginCode} 
										THEN #{TargetSortKey} 
										ELSE SortKey
								END
			,	SortPath 	= (#{TargetSortPath}||substr(SortPath||instr(SortPath, #{OriginSortPath})+LENGTH(#{OriginSortPath})||LENGTH(SortPath)))
 		WHERE 	1=1
 		AND 	GroupPath LIKE CONCAT(#{OriginGroupPath},'%')  
 	</update>
 	
 	
 	
    <select id="selectGroupInfoList" parameterType="cmap" resultType="cmap">
        <![CDATA[
		SELECT
			A.GroupID				AS"GroupID"
		,	A.GroupCode 			AS"GroupCode"
		,	A.GroupType 			AS"GroupType"
		,	A.MemberOf  			AS"MemberOf"
		,	(SELECT NVL(NULLIF(MultiDisplayName,''),DisplayName) FROM sys_object_group WHERE GroupCode=A.MemberOf) As"ParentName"
		,	A.GroupPath				AS"GroupPath"
		,	NVL(NULLIF(A.MultiDisplayName,''),A.DisplayName)AS "MultiDisplayName"
		,	NVL(NULLIF(a.MultiShortName,''),A.ShortName)AS "MultiShortName"
		,	A.DisplayName			AS"DisplayName"
		,	A.SortKey               AS"SortKey"
		,	A.SortPath              AS"SortPath"
		,	A.OUName                AS"OUName"
		,	A.OUPath                AS"OUPath"
		,	A.IsUse                 AS"IsUse"
		,	A.IsDisplay             AS"IsDisplay"
		,	A.IsMail                AS"IsMail"
		,	A.IsHR                  AS"IsHR"
		,	A.PrimaryMail           AS"PrimaryMail"
		,	A.SecondaryMail         AS"SecondaryMail"
		,	A.Description           AS"Description"
		,	A.ReceiptUnitCode       AS"ReceiptUnitCode"
		,	A.ApprovalUnitCode      AS"ApprovalUnitCode"
		,	A.Receivable            AS"Receivable"
		,	A.Approvable            AS"Approvable"
		,	A.RegistDate            AS"RegistDate"
		,	A.ModifyDate            AS"ModifyDate"
		,	A.ManagerCode           AS"ManagerCode"
		,	NVL((A.ManagerCode|| '|'|| (SELECT DisplayName FROM sys_object_user WHERE UserCode = A.ManagerCode)), '') AS "Manager"
		,	NVL(NULLIF(B.MultiDisplayName,''),B.DisplayName)  AS "CompanyName"
		,	A.CompanyCode AS "CompanyCode"
		FROM sys_object_group  A
		INNER JOIN sys_object_group  B ON A.CompanyCode = B.GroupCode
		WHERE A.GroupCode IN
		]]>
		<foreach collection="TargetID" item="item"  separator="," open="(" close=")">
		    #{item}
		</foreach>
    </select> 
    
    
	<select id="selectDefaultSetInfoGroupByDomainId" parameterType="cmap" resultType="cmap">
        SELECT	A.DisplayName 	AS "GroupName"
        	,	B.DisplayName 	AS "CompanyName"
        	,	B.CompanyCode 	AS "CompanyCode"
        	,	C.MailDomain	AS "MailDomain"
			,	C.DomainID      AS "DomainID"
		FROM 	sys_object_group  A
		JOIN 	sys_object_group  B ON A.CompanyCode = B.GroupCode AND B.GroupType = 'Company'
		JOIN 	sys_object_domain C
		ON		A.CompanyCode = C.DOMAINCODE
		<if test="groupType = 'Company'.toString()">
		    <if test="gr_code != null  and gr_code != ''">
		WHERE  A.GroupCode = #{gr_code} 
		  </if>
		</if>
		<if test="groupType != 'Company'.toString()">
    		<if test="domainId != null  and domainId != ''">
		WHERE C.DomainId = #{domainId} 
			</if>
	        <if test="gr_code != null  and gr_code != ''">
		AND A.GroupCode = #{gr_code} 
		  </if>
		</if>

    </select>
    
    <!-- 그룹 멤버 목록 select -->
    <select id="selectGroupMemberList" parameterType="cmap" resultType="cmap">
	<include refid="oracle.include.pagingHeader" />
		SELECT * 
		FROM 
		(
			SELECT 'USER' AS TYPE
					, GM.USERCODE AS CODE
					, NVL(UR.DISPLAYNAME, '') AS CODENAME
					, NVL(UR.MAILADDRESS, '') AS MAILADDRESS
					, GM.GROUPMEMBERID AS MEMBERID
			FROM sys_object_group_member  GM
					LEFT JOIN sys_object_user  UR ON GM.USERCODE = UR.USERCODE
			<trim prefix="WHERE" prefixOverrides="AND |OR ">
			    GM.GROUPCODE = #{GroupCode} 
			</trim>
			
			UNION 
			
			SELECT 'DEPT' AS TYPE
					, GM.MEMBERGROUPCODE AS CODE
					, NVL(GR.DISPLAYNAME, '') AS CODENAME
					, NVL(GR.PRIMARYMAIL, '') AS MAILADDRESS
					, GM.MEMBERGROUPID AS MEMBERID
			FROM sys_object_group_memberGROUP  GM
					LEFT JOIN sys_object_group  GR ON GM.MEMBERGROUPCODE = GR.GROUPCODE
			<trim prefix="WHERE" prefixOverrides="AND |OR ">
			    GM.GROUPCODE = #{GroupCode} 
			</trim>
		)  A
	<include refid="oracle.include.pagingFooter" />
	</select>
	
    <!-- 그룹 멤버 목록 select -->
    <select id="selectGroupMemberListCnt" parameterType="cmap"  resultType="java.lang.Long">
		SELECT COUNT(*) FROM 
		(
			SELECT 'USER' AS TYPE
					, GM.USERCODE AS CODE
					, NVL(UR.DISPLAYNAME, '') AS CODENAME
					, NVL(UR.MAILADDRESS, '') AS MAILADDRESS
					, GM.GROUPMEMBERID AS MEMBERID
			FROM sys_object_group_member  GM
					LEFT JOIN sys_object_user  UR ON GM.USERCODE = UR.USERCODE
			<trim prefix="WHERE" prefixOverrides="AND |OR ">
			    GM.GROUPCODE = #{GroupCode} 
			</trim>
			
			UNION 
			
			SELECT 'DEPT' AS TYPE
					, GM.MEMBERGROUPCODE AS CODE
					, NVL(GR.DISPLAYNAME, '') AS CODENAME
					, NVL(GR.PRIMARYMAIL, '') AS MAILADDRESS
					, GM.MEMBERGROUPID AS MEMBERID  
			FROM sys_object_group_memberGROUP  GM
					LEFT JOIN sys_object_group  GR ON GM.MEMBERGROUPCODE = GR.GROUPCODE
			<trim prefix="WHERE" prefixOverrides="AND |OR ">
			    GM.GROUPCODE = #{GroupCode} 
			</trim>
		)  A
	</select>
	
	<select id="selectGroupInfo" resultType="cmap">
      	SELECT	A.GroupID                     	AS "GroupID"
			,	A.GroupCode                   	AS "GroupCode"
			,	A.CompanyCode                 	AS "CompanyCode"
			,	A.GroupType                   	AS "GroupType"
			,	A.MemberOf                    	AS "MemberOf"
			,	A.GroupPath                   	AS "GroupPath"
			,	A.RegionCode                  	AS "RegionCode"
			,	A.DisplayName                 	AS "DisplayName"
			,	A.MultiDisplayName            	AS "MultiDisplayName"
			,	A.ShortName                   	AS "ShortName"
			,	A.MultiShortName              	AS "MultiShortName"
			,	A.OUName                      	AS "OUName"
			,	A.OUPath                      	AS "OUPath"
			,	A.SortKey                     	AS "SortKey"
			,	A.SortPath                    	AS "SortPath"
			,	A.IsUse                       	AS "IsUse"
			,	A.IsDisplay                   	AS "IsDisplay"
			,	A.IsMail                      	AS "IsMail"
			,	A.IsHR                        	AS "IsHR"
			,	A.PrimaryMail                 	AS "PrimaryMail"
			,	A.SecondaryMail               	AS "SecondaryMail"
			,	A.ManagerCode                 	AS "ManagerCode"
			,	A.Description                 	AS "Description"
			,	A.ReceiptUnitCode             	AS "ReceiptUnitCode"
			,	A.ApprovalUnitCode            	AS "ApprovalUnitCode"
			,	A.Receivable                  	AS "Receivable"
			,	A.Approvable                  	AS "Approvable"
			,	A.RegistDate                  	AS "RegistDate"
			,	A.ModifyDate                  	AS "ModifyDate"
			,	A.Reserved1                   	AS "Reserved1"
			,	A.Reserved2                   	AS "Reserved2"
			,	A.Reserved3                   	AS "Reserved3"
			,	A.Reserved4                   	AS "Reserved4"
			,	A.Reserved5                   	AS "Reserved5"
			,	A.Reserved6                   	AS "Reserved6"
			,	B.MultiDisplayName 				AS "CompanyName"
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(B.MultiDisplayName,''),B.DisplayName)) AS "LANG_COMPANYNAME"
			,	(SELECT MultiDisplayName FROM sys_object_group WHERE GroupCode=A.MemberOf) As "ParentName"
			,	NVL((A.ManagerCode|| '|'|| (SELECT DisplayName FROM sys_object_user WHERE UserCode = A.ManagerCode)), '') AS "Manager"
			,	B.MailDomain					AS "MailDomain"
			,	B.DomainID                      AS "DomainID"
		FROM 	sys_object_group  A
		JOIN 	sys_object_domain  B 
		ON 		A.CompanyCode = B.DomainCode
		WHERE 	A.GroupCode	=	#{GroupCode}
	</select>
	
	
	
	<select id="selectGroupSortKey" parameterType="cmap" resultType="cmap">
 	    SELECT 	SortKey		AS "SortKey"
			,	SortPath    AS "SortPath"
			,	GroupPath   AS "GroupPath"
 	    FROM 	sys_object_group
 	    WHERE 	GroupCode  = #{GroupCode}
 	</select>
 	
 	
    
    <select id="selectGroupListByGroupType" parameterType="cmap" resultType="cmap">
	<include refid="oracle.include.pagingHeader" />
		SELECT 	GR.GroupID                     	AS "GroupID"
			,	GR.GroupCode                   	AS "GroupCode"
			,	GR.CompanyCode                 	AS "CompanyCode"
			,	GR.GroupType                   	AS "GroupType"
			,	GR.MemberOf                    	AS "MemberOf"
			,	GR.GroupPath                   	AS "GroupPath"
			,	GR.RegionCode                  	AS "RegionCode"
			,	GR.DisplayName                 	AS "DisplayName"
			,	GR.MultiDisplayName            	AS "MultiDisplayName"
			,	GR.ShortName                   	AS "ShortName"
			,	GR.MultiShortName              	AS "MultiShortName"
			,	GR.OUName                      	AS "OUName"
			,	GR.OUPath                      	AS "OUPath"
			,	GR.SortKey                     	AS "SortKey"
			,	GR.SortPath                    	AS "SortPath"
			,	GR.IsUse                       	AS "IsUse"
			,	GR.IsDisplay                   	AS "IsDisplay"
			,	GR.IsMail                      	AS "IsMail"
			,	GR.IsHR                        	AS "IsHR"
			,	GR.PrimaryMail                 	AS "PrimaryMail"
			,	GR.SecondaryMail               	AS "SecondaryMail"
			,	GR.ManagerCode                 	AS "ManagerCode"
			,	GR.Description                 	AS "Description"
			,	GR.ReceiptUnitCode             	AS "ReceiptUnitCode"
			,	GR.ApprovalUnitCode            	AS "ApprovalUnitCode"
			,	GR.Receivable                  	AS "Receivable"
			,	GR.Approvable                  	AS "Approvable"
			,	GR.RegistDate                  	AS "RegistDate"
			,	GR.ModifyDate                  	AS "ModifyDate"
			,	GR.Reserved1                   	AS "Reserved1"
			,	GR.Reserved2                   	AS "Reserved2"
			,	GR.Reserved3                   	AS "Reserved3"
			,	GR.Reserved4                   	AS "Reserved4"
			,	GR.Reserved5                   	AS "Reserved5"
			,	GR.Reserved6                   	AS "Reserved6"
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(GR.MultiDisplayName,''),GR.DisplayName)) AS "LANG_DISPLAYNAME"
			,	(NVL(UR_CNT.CNT,0)||'/'||NVL(GR_CNT.CNT,0)) AS "MEMBER_CNT"
  		FROM 	sys_object_domain DOMAIN
		JOIN	sys_object_group GR
		ON		DOMAIN.DOMAINCODE 	= GR.COMPANYCODE
		LEFT
		JOIN	(
					SELECT	GM.GROUPCODE AS GROUPCODE
						,	COUNT(*) AS CNT
					FROM sys_object_group_member  GM
					GROUP BY GM.GROUPCODE
				)UR_CNT
		ON 		GR.GROUPCODE = UR_CNT.GROUPCODE
		LEFT
		JOIN	(
					SELECT	GM.GROUPCODE AS GROUPCODE
						,	COUNT(*) AS CNT
					FROM sys_object_group_membergroup  GM
					GROUP BY GM.GROUPCODE
				)GR_CNT
		ON 		GR.GROUPCODE = GR_CNT.GROUPCODE
		WHERE	1=1
		AND 	DOMAIN.domainId = #{domainId}    
		AND 	GR.GroupType =#{groupType}    
		<if test="searchType == 'NAME' and searchText != null">
			AND GR.MultiDisplayName like ('%'|| #{searchText}|| '%') 
		</if>
		<if test="searchType == 'CODE' and searchText != null">
			AND GR.GROUPCODE like ('%'|| #{searchText}|| '%') 
		</if>
		<if test="searchIsUse != null and searchIsUse != ''">
			AND GR.IsUse =#{searchIsUse}
		</if>
		ORDER BY GR.SortKey ASC  
	<include refid="oracle.include.pagingFooter" />
    </select>
    
	<select id="selectGroupListByGroupTypeCnt" parameterType="cmap" resultType="java.lang.Long">  
    	SELECT 	COUNT(*)
  		FROM 	sys_object_domain DOMAIN
		JOIN	sys_object_group GR
		ON		DOMAIN.DOMAINCODE 	= GR.COMPANYCODE
		WHERE	1=1
		AND 	DOMAIN.domainId = #{domainId}    
		AND 	GR.GroupType =#{groupType}    
		<if test="searchType == 'NAME' and searchText != null">
			AND GR.MultiDisplayName like ('%'|| #{searchText}|| '%') 
		</if>
		<if test="searchType == 'CODE' and searchText != null">
			AND GR.GROUPCODE like ('%'|| #{searchText}|| '%') 
		</if>
		<if test="searchIsUse != null and searchIsUse != ''">
			AND GR.IsUse =#{searchIsUse}
		</if>
    </select>
	
	
    <!-- 겸직 리스트 가져오기(list) -->
    <select id="selectAddJobList" parameterType="cmap" resultType="cmap">
	<include refid="oracle.include.pagingHeader" />
		SELECT	*
		FROM	(
					SELECT 		
							BG.SEQ AS NO
						, 	BG.USERCODE
						, 	BG.COMPANYCODE
						,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTICOMPANYNAME,''),BG.COMPANYNAME)) 		AS LANG_COMPANYNAME
						, 	BG.DEPTCODE	
						,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTIDEPTNAME,''),BG.DEPTNAME)) 				AS LANG_DEPTNAME
						, 	BG.JOBTITLECODE	
						,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTIJOBTITLENAME,''),BG.JOBTITLENAME)) 		AS LANG_JOBTITLENAME
						, 	BG.JOBPOSITIONCODE
						,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTIJOBPOSITIONNAME,''),BG.JOBPOSITIONNAME)) AS LANG_JOBPOSITIONNAME
						, 	BG.JOBLEVELCODE
						, 	BG.JOBTYPE
						,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTIJOBLEVELNAME,''),BG.JOBLEVELNAME))	 	AS LANG_JOBLEVELNAME
						, 	BG.ISHR
						, 	UR.SORTKEY
						,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(UR.MULTIDISPLAYNAME,''),UR.DISPLAYNAME)) 	AS LANG_USERNAME
					FROM 	sys_object_user_basegroup  BG
					JOIN 	sys_object_user  UR 
					ON 		BG.USERCODE	 	= UR.USERCODE
					AND 	BG.JOBTYPE 		= 'AddJob' 
					JOIN	sys_object_user_basegroup  ORI_BG
					ON 		ORI_BG.USERCODE	= UR.USERCODE
					AND 	ORI_BG.JOBTYPE 	= 'Origin' 
					JOIN 	sys_object_domain  DOMAIN
					ON 		ORI_BG.COMPANYCODE 	= DOMAIN.DOMAINCODE
					WHERE	1=1
					<if test="domainId != null and domainId != ''">
						AND DOMAIN.domainId = #{domainId}  
					</if>  
					<if test="searchType != null and searchText != null">
						<choose>
							<when test="searchType == 'NAME'.toString()">
								AND UR.MultiDisplayName  like ('%'||#{searchText}||'%')
							</when>
							<when test="searchType == 'Company'.toString()">
								AND BG.MultiCompanyName  like ('%'||#{searchText}||'%')
							</when>
							<when test="searchType == 'Dept'.toString()">
								AND BG.MultiDeptName  like ('%'||#{searchText}||'%')
							</when>
							<when test="searchType == 'JobTitle'.toString()">
								AND BG.MultiJobTitleName  like ('%'||#{searchText}||'%')
							</when>
							<when test="searchType == 'JobPosition'.toString()">
								AND BG.MultiJobPositionName  like ('%'||#{searchText}||'%')
							</when>
							<when test="searchType == 'JobLevel'.toString()">
								AND BG.MultiJobLevelName  like ('%'||#{searchText}||'%')
							</when>
						</choose>
					</if>
				)Z
		ORDER BY LANG_USERNAME
	<include refid="oracle.include.pagingFooter" />
	</select>
	<select id="selectAddJobListCnt" parameterType="cmap" resultType="java.lang.Long">
		SELECT 	COUNT(*)
		FROM 	sys_object_user_basegroup  BG
		JOIN 	sys_object_user  UR 
		ON 		BG.USERCODE	 	= UR.USERCODE
		AND 	BG.JOBTYPE 		= 'AddJob' 
		JOIN	sys_object_user_basegroup  ORI_BG
		ON 		ORI_BG.USERCODE	= UR.USERCODE
		AND 	ORI_BG.JOBTYPE 	= 'Origin' 
		JOIN 	sys_object_domain  DOMAIN
		ON 		ORI_BG.COMPANYCODE 	= DOMAIN.DOMAINCODE
		WHERE	1=1
		<if test="domainId != null and domainId != ''">
			AND DOMAIN.domainId = #{domainId}  
		</if>  
		<if test="searchType != null and searchText != null">
			<choose>
				<when test="searchType == 'NAME'.toString()">
					AND UR.MultiDisplayName  like ('%'||#{searchText}||'%')
				</when>
				<when test="searchType == 'Company'.toString()">
					AND BG.MultiCompanyName  like ('%'||#{searchText}||'%')
				</when>
				<when test="searchType == 'Dept'.toString()">
					AND BG.MultiDeptName  like ('%'||#{searchText}||'%')
				</when>
				<when test="searchType == 'JobTitle'.toString()">
					AND BG.MultiJobTitleName  like ('%'||#{searchText}||'%')
				</when>
				<when test="searchType == 'JobPosition'.toString()">
					AND BG.MultiJobPositionName  like ('%'||#{searchText}||'%')
				</when>
				<when test="searchType == 'JobLevel'.toString()">
					AND BG.MultiJobLevelName  like ('%'||#{searchText}||'%')
				</when>
			</choose>
		</if>
    </select>
	
    <!-- 겸직 개별 정보 가져오기 -->
    <select id="selectAddJobInfo" parameterType="cmap" resultType="cmap">
		SELECT 
				BG.SEQ AS NO
				, BG.USERCODE
				, BG.JOBTYPE
				, UR.DISPLAYNAME AS USERNAME
				, UR.MULTIDISPLAYNAME AS MULTIUSERNAME
				, BG.COMPANYCODE
				, BG.COMPANYNAME
				, BG.MULTICOMPANYNAME
				, BG.DEPTCODE
				, BG.DEPTNAME
				, BG.MULTIDEPTNAME
				, BG.JOBTITLECODE
				, BG.JOBTITLENAME
				, BG.MULTIJOBTITLENAME
				, BG.JOBPOSITIONCODE
				, BG.JOBPOSITIONNAME
				, BG.MULTIJOBPOSITIONNAME
				, BG.JOBLEVELCODE
				, BG.JOBTYPE
				, BG.JOBLEVELNAME
				, BG.MULTIJOBLEVELNAME
				, UR.ISHR
		FROM 	sys_object_user_basegroup  BG
		JOIN 	sys_object_user  UR ON BG.USERCODE = UR.USERCODE
		WHERE	BG.JobType = 'AddJob' 
		<if test="id != null ">
			AND BG.SEQ = #{id}
		</if>
	</select>
	
    <select id="selectUserInfo" parameterType="cmap" resultType="cmap">
		<![CDATA[
			SELECT 
					ur.UserID						AS "UserID"
				,	ur.UserCode                     AS "UserCode"
				,	ur.LogonID                      AS "LogonID"
				,	ur.EmpNo                        AS "EmpNo"
				,	ur.DisplayName                  AS "DisplayName"
				,	ur.MultiDisplayName             AS "MultiDisplayName"
				,	ur.NickName                     AS "NickName"
				,	ur.MultiAddress                 AS "MultiAddress"
				,	ur.HomePage                     AS "HomePage"
				,	ur.PhoneNumber                  AS "PhoneNumber"
				,	ur.Mobile                       AS "Mobile"
				,	ur.FAX                          AS "FAX"
				,	ur.IPPhone                      AS "IPPhone"
				,	ur.UseMessengerConnect          AS "UseMessengerConnect"
				,	ur.SortKey                      AS "SortKey"
				,	ur.SecurityLevel                AS "SecurityLevel"
				,	ur.Description                  AS "Description"
				,	ur.IsUse                        AS "IsUse"
				,	ur.IsHR                         AS "IsHR"
				,	ur.IsDisplay                    AS "IsDisplay"
				,	ur.EnterDate                    AS "EnterDate"
				,	ur.RetireDate                   AS "RetireDate"
				,	ur.PhotoPath                    AS "PhotoPath"
				,	ur.BirthDiv                     AS "BirthDiv"
				,	ur.BirthDate                    AS "BirthDate"
				,	ur.UseMailConnect               AS "UseMailConnect"
				,	ur.MailAddress                  AS "MailAddress"
				,	ur.ExternalMailAddress          AS "ExternalMailAddress"
				,	ur.ChargeBusiness               AS "ChargeBusiness"
				,	ur.PhoneNumberInter             AS "PhoneNumberInter"
				,	ur.Reserved1                    AS "Reserved1"
				,	ur.Reserved2                    AS "Reserved2"
				,	ur.Reserved3                    AS "Reserved3"
				,	ur.Reserved4                    AS "Reserved4"
				,	ur.Reserved5                    AS "Reserved5"
				,	ur.LicSeq                       AS "LicSeq"
				,	bg.CompanyCode                  AS "CompanyCode"
				,	bg.MultiCompanyName             AS "MultiCompanyName"
				,	bg.DeptCode                     AS "DeptCode"
				,	bg.DeptName                     AS "DeptName"
				,	bg.MultiDeptName                AS "MultiDeptName"
				,	bg.RegionCode                   AS "RegionCode"
				,	bg.MultiRegionName				AS "MultiRegionName"
				,	bg.JobPositionCode              AS "JobPositionCode"
				,	bg.JobPositionName              AS "JobPositionName"
				,	bg.JobTitleCode                 AS "JobTitleCode"
				,	bg.JobTitleName                 AS "JobTitleName"
				,	bg.JobLevelCode                 AS "JobLevelCode"
				,	bg.JobLevelName                 AS "JobLevelName"
				,	apv.DeputyOption                AS "DeputyOption"
				,	apv.UseDeputy                   AS "UseDeputy"
				,	apv.DeputyCode                  AS "DeputyCode"
				,	apv.DeputyName                  AS "DeputyName"
				,	apv.DeputyFromDate              AS "DeputyFromDate"
				,	apv.DeputyToDate                AS "DeputyToDate"
				,	apv.AlertConfig                 AS "AlertConfig"
				,	apv.ApprovalUnitCode			AS "ApprovalUnitCode"
				,	(SELECT MultiDisplayName FROM sys_object_group WHERE GroupCode = apv.ApprovalUnitCode) AS "ApprovalUnitName"
				,	apv.ReceiptUnitCode				AS "ReceiptUnitCode"
				,	(SELECT MultiDisplayName FROM sys_object_group WHERE GroupCode = apv.ReceiptUnitCode) AS "ReceiptUnitName"
				,	apv.UseApprovalMessageBoxView	AS "UseApprovalMessageBoxView"
				,	apv.UseMobile                   AS "UseMobile"
				,	dn.DomainID                     AS "DomainID"
				,	ur.AD_ISUSE                     AS "AD_ISUSE"
				,	ur.EX_ISUSE                     AS "EX_ISUSE"
				,	ur.MSN_ISUSE                    AS "MSN_ISUSE"
				,	(SELECT MultiDisplayName FROM sys_object_user WHERE UserCode = AD.AD_MANAGERCODE) AS "ManagerName"		
				,	NVL(urif.CheckUserIP, 'N')	AS "CheckUserIP"
				,	NVL(urif.StartIP, '') 		AS "StartIP"
				,	NVL(urif.EndIP, '') 			AS "EndIP"
				,	AD.SEQ						AS "SEQ"
				,	AD.USERID                   AS "USERID"
				,	AD.AD_DISPLAYNAME           AS "AD_DISPLAYNAME"
				,	AD.AD_FIRSTNAME             AS "AD_FIRSTNAME"
				,	AD.AD_LASTNAME              AS "AD_LASTNAME"
				,	AD.AD_INITIALS              AS "AD_INITIALS"
				,	AD.AD_OFFICE                AS "AD_OFFICE"
				,	AD.AD_HOMEPAGE              AS "AD_HOMEPAGE"
				,	AD.AD_COUNTRY               AS "AD_COUNTRY"
				,	AD.AD_COUNTRYID             AS "AD_COUNTRYID"
				,	AD.AD_COUNTRYCODE           AS "AD_COUNTRYCODE"
				,	AD.AD_STATE                 AS "AD_STATE"
				,	AD.AD_CITY                  AS "AD_CITY"
				,	AD.AD_STREETADDRESS         AS "AD_STREETADDRESS"
				,	AD.AD_POSTOFFICEBOX         AS "AD_POSTOFFICEBOX"
				,	AD.AD_POSTALCODE            AS "AD_POSTALCODE"
				,	AD.AD_USERACCOUNTCONTROL    AS "AD_USERACCOUNTCONTROL"
				,	AD.AD_ACCOUNTEXPIRES        AS "AD_ACCOUNTEXPIRES"
				,	AD.AD_PHONENUMBER           AS "AD_PHONENUMBER"
				,	AD.AD_HOMEPHONE             AS "AD_HOMEPHONE"
				,	AD.AD_PAGER                 AS "AD_PAGER"
				,	AD.AD_MOBILE                AS "AD_MOBILE"
				,	AD.AD_FAX                   AS "AD_FAX"
				,	AD.AD_IPPHONE               AS "AD_IPPHONE"
				,	AD.AD_INFO                  AS "AD_INFO"
				,	AD.AD_TITLE                 AS "AD_TITLE"
				,	AD.AD_DEPARTMENT            AS "AD_DEPARTMENT"
				,	AD.AD_COMPANY               AS "AD_COMPANY"
				,	AD.AD_MANAGERCODE           AS "AD_MANAGERCODE"
				,	AD.AD_CN                    AS "AD_CN"
				,	AD.AD_SamAccountName        AS "AD_SamAccountName"
				,	AD.AD_UserPrincipalName     AS "AD_UserPrincipalName"
			 
		 
				,	EXCH.SEQ						AS "SEQ"
				,	EXCH.USERID                   	AS "USERID"
				,	EXCH.EX_PRIMARYMAIL           	AS "EX_PRIMARYMAIL"
				,	EXCH.EX_SECONDARYMAIL         	AS "EX_SECONDARYMAIL"
				,	EXCH.EX_STORAGESERVER         	AS "EX_STORAGESERVER"
				,	EXCH.EX_STORAGEGROUP          	AS "EX_STORAGEGROUP"
				,	EXCH.EX_STORAGESTORE          	AS "EX_STORAGESTORE"
				,	EXCH.EX_CUSTOMATTRIBUTE01     	AS "EX_CUSTOMATTRIBUTE01"
				,	EXCH.EX_CUSTOMATTRIBUTE02     	AS "EX_CUSTOMATTRIBUTE02"
				,	EXCH.EX_CUSTOMATTRIBUTE03     	AS "EX_CUSTOMATTRIBUTE03"
				,	EXCH.EX_CUSTOMATTRIBUTE04     	AS "EX_CUSTOMATTRIBUTE04"
				,	EXCH.EX_CUSTOMATTRIBUTE05     	AS "EX_CUSTOMATTRIBUTE05"
				,	EXCH.EX_CUSTOMATTRIBUTE06     	AS "EX_CUSTOMATTRIBUTE06"
				,	EXCH.EX_CUSTOMATTRIBUTE07     	AS "EX_CUSTOMATTRIBUTE07"
				,	EXCH.EX_CUSTOMATTRIBUTE08     	AS "EX_CUSTOMATTRIBUTE08"
				,	EXCH.EX_CUSTOMATTRIBUTE09     	AS "EX_CUSTOMATTRIBUTE09"
				,	EXCH.EX_CUSTOMATTRIBUTE10     	AS "EX_CUSTOMATTRIBUTE10"
				,	EXCH.EX_CUSTOMATTRIBUTE11     	AS "EX_CUSTOMATTRIBUTE11"
				,	EXCH.EX_CUSTOMATTRIBUTE12     	AS "EX_CUSTOMATTRIBUTE12"
				,	EXCH.EX_CUSTOMATTRIBUTE13     	AS "EX_CUSTOMATTRIBUTE13"
				,	EXCH.EX_CUSTOMATTRIBUTE14     	AS "EX_CUSTOMATTRIBUTE14"
				,	EXCH.EX_CUSTOMATTRIBUTE15     	AS "EX_CUSTOMATTRIBUTE15"
			 
				,	MSN.SEQ								AS "SEQ"
				,	MSN.USERID                          AS "USERID"
				,	MSN.MSN_POOLSERVERNAME              AS "MSN_POOLSERVERNAME"
				,	MSN.MSN_POOLSERVERDN                AS "MSN_POOLSERVERDN"
				,	MSN.MSN_SIPADDRESS                  AS "MSN_SIPADDRESS"
				,	MSN.MSN_ANONMY                      AS "MSN_ANONMY"
				,	MSN.MSN_MEETINGPOLICYNAME           AS "MSN_MEETINGPOLICYNAME"
				,	MSN.MSN_MEETINGPOLICYDN             AS "MSN_MEETINGPOLICYDN"
				,	MSN.MSN_PHONECOMMUNICATION          AS "MSN_PHONECOMMUNICATION"
				,	MSN.MSN_PBX                         AS "MSN_PBX"
				,	MSN.MSN_LINEPOLICYNAME              AS "MSN_LINEPOLICYNAME"
				,	MSN.MSN_LINEPOLICYDN                AS "MSN_LINEPOLICYDN"
				,	MSN.MSN_LINEURI                     AS "MSN_LINEURI"
				,	MSN.MSN_LINESERVERURI               AS "MSN_LINESERVERURI"
				,	MSN.MSN_FEDERATION                  AS "MSN_FEDERATION"
				,	MSN.MSN_REMOTEACCESS                AS "MSN_REMOTEACCESS"
				,	MSN.MSN_PUBLICIMCONNECTIVITY        AS "MSN_PUBLICIMCONNECTIVITY"
				,	MSN.MSN_INTERNALIMCONVERSATION      AS "MSN_INTERNALIMCONVERSATION"
				,	MSN.MSN_FEDERATEDIMCONVERSATION     AS "MSN_FEDERATEDIMCONVERSATION"
			 
				,	BG.MultiJobTitleName		AS "MultiJobTitleName"
				,	BG.MultiJobPositionName     AS "MultiJobPositionName"
				,	BG.MultiJobLevelName        AS "MultiJobLevelName"
			
				FROM sys_object_user  ur
				LEFT JOIN sys_object_user_basegroup  bg ON ur.UserCode = bg.UserCode AND bg.JobType = 'Origin'
				LEFT JOIN sys_object_user_info  urif ON ur.UserCode = urif.UserCode				                                                       
				LEFT JOIN sys_object_domain  dn ON bg.CompanyCode = dn.DomainCode
				LEFT JOIN sys_object_user_approval  apv ON ur.UserCode = apv.UserCode
				LEFT JOIN sys_object_user_ad AD ON ur.UserCode = AD.UserId
            	LEFT JOIN sys_object_user_exchange EXCH ON ur.UserCode = EXCH.UserId
            	LEFT JOIN sys_object_user_messenger MSN ON ur.UserCode = MSN.UserId
				WHERE ur.UserCode = #{UserCode}
		]]>
	</select>
    <!-- 임의그룹 드롭다운 리스트 가져오기 -->
    <select id="selectArbitraryGroupDropdownlist" parameterType="cmap" resultType="cmap">
		SELECT
				GR.GROUPTYPE
			, 	GR.GROUPCODE
			, 	GR.DISPLAYNAME AS GROUPNAME
	    FROM 	sys_object_group  gr
    	WHERE 	GR.ISUSE = 'Y' 
		AND 	GR.GROUPTYPE IN ('JobTitle', 'JobPosition', 'JobLevel') 
		AND 	GR.CompanyCode = #{CompanyCode}
    	ORDER BY GR.GroupType, (GR.SortKey+0) asc
	</select>
	
	
	
   
    <select id="selectCompanyInfoGroupByDomainId" parameterType="cmap" resultType="cmap">
		SELECT	DomainID					AS "DomainID"
			,	DomainCode                  AS "DomainCode"
			,	DomainURL                   AS "DomainURL"
			,	DomainType                  AS "DomainType"
			,	DisplayName                 AS "DisplayName"
			,	MultiDisplayName            AS "MultiDisplayName"
			,	ShortName                   AS "ShortName"
			,	MultiShortName              AS "MultiShortName"
			,	MemberOf                    AS "MemberOf"
			,	DomainPath                  AS "DomainPath"
			,	SortKey                     AS "SortKey"
			,	SortPath                    AS "SortPath"
			,	IsUse                       AS "IsUse"
			,	ServiceUser                 AS "ServiceUser"
			,	ServiceStart                AS "ServiceStart"
			,	ServiceEnd                  AS "ServiceEnd"
			,	Description                 AS "Description"
			,	RegistDate                  AS "RegistDate"
			,	DeleteDate                  AS "DeleteDate"
			,	MenuSyncTime                AS "MenuSyncTime"
			,	SubDomain                   AS "SubDomain"
			,	OrgSyncType                 AS "OrgSyncType"
			,	DomainRepName               AS "DomainRepName"
			,	DomainRepTel                AS "DomainRepTel"
			,	DomainCorpTel               AS "DomainCorpTel"
			,	DomainImagePath             AS "DomainImagePath"
			,	DomainZipcode               AS "DomainZipcode"
			,	DomainAddress               AS "DomainAddress"
			,	Memo                        AS "Memo"
			,	DomainBannerPath            AS "DomainBannerPath"
			,	DomainBannerLink            AS "DomainBannerLink"
			,	DomainThemeCode             AS "DomainThemeCode"
			,	ChargerName                 AS "ChargerName"
			,	ChargerTel                  AS "ChargerTel"
			,	ChargerID                   AS "ChargerID"
			,	ChargerEmail                AS "ChargerEmail"
			,	IsUseGoogleSchedule         AS "IsUseGoogleSchedule"
			,	MailDomain                  AS "MailDomain"
			,	IsCPMail                    AS "IsCPMail"
			,	LicDomain                   AS "LicDomain"
			,	LicUserCount                AS "LicUserCount"
			,	LicExpireDate               AS "LicExpireDate"
			,	LieExUserCount              AS "LieExUserCount"
			,	LicEx1Date                  AS "LicEx1Date"
			,	EntireMailID                AS "EntireMailID"
	    FROM 	sys_object_domain  DOMAIN
		WHERE 	DOMAIN.DomainID = #{domainId}
	</select>
	
	<select id="selectHasGroupMember" parameterType="cmap" resultType="java.lang.Long">
		SELECT	(
					SELECT 	COUNT(*)
					FROM 	sys_object_group_member GR
					WHERE	GROUPCODE	=	#{GroupCode} 
					AND		IsUse = 'Y'
				)
				+
				(
					SELECT 	COUNT(*)
					FROM 	sys_object_group_memberGROUP GR
					WHERE	GROUPCODE	=	#{GroupCode} 
					AND		IsUse = 'Y'
				)AS "HasMember"
		FROM 	DUAL
    </select>
	
	
    <select id="selectUserList" parameterType="cmap" resultType="cmap">
	<include refid="oracle.include.pagingHeader" />
		SELECT 
				UR.USERCODE
			,	UR.SORTKEY
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(UR.MULTIDISPLAYNAME		,''),UR.DISPLAYNAME		)) AS LANG_DISPLAYNAME
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTIJOBTITLENAME		,''),BG.JOBTITLENAME	)) AS LANG_JOBTITLENAME
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTIJOBPOSITIONNAME	,''),BG.JOBPOSITIONNAME	)) AS LANG_JOBPOSITIONNAME
			,	fn_basegetdictionary_s(#{lang}, NVL(NULLIF(BG.MULTIJOBLEVELNAME		,''),BG.JOBLEVELNAME	)) AS LANG_JOBLEVELNAME
			,	UR.ISUSE
			,	UR.ISHR
			,	UR.MAILADDRESS
			,	UR.ISDISPLAY
		FROM 	sys_object_user  UR
		JOIN	sys_object_user_basegroup  BG 
		ON 		UR.USERCODE 	= 	BG.USERCODE 
		JOIN	sys_object_domain  DN
		ON		BG.COMPANYCODE	=	DN.DOMAINCODE
		WHERE	NVL(BG.JOBTYPE,'Origin') = 'Origin'
		AND 	DN.DOMAINID = #{domainId}    
		<choose>
			<when test="groupCode != null and groupCode != ''">
				AND BG.DEPTCODE = #{groupCode}
			</when>
		</choose>
		<if test="IsUse != null">
			AND UR.ISUSE = #{IsUse}
		</if>
		<if test="searchType != null and searchText != null">
			<choose>
				<when test="searchType == 'USER_NAME'.toString()">
					AND UR.MULTIDISPLAYNAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'USER_CODE'.toString()">
					AND UR.USERCODE like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'DEPT_NAME'.toString()">
					AND BG.MULTIDEPTNAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'JOBPOSITION_NAME'.toString()">
					AND BG.MULTIJOBPOSITIONNAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'JOBTITLE_NAME'.toString()">
					AND BG.MULTIJOBTITLENAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'JOBLEVEL_NAME'.toString()">
					AND BG.MULTIJOBLEVELNAME like ('%'|| #{searchText}|| '%') 
				</when>
			</choose>
		</if>
	<include refid="oracle.include.pagingFooter" />
	</select>
	
	
	<select id="selectUserListCnt" parameterType="cmap" resultType="java.lang.Long">
		SELECT 	COUNT(*)
		FROM 	sys_object_user  UR
		JOIN	sys_object_user_basegroup  BG 
		ON 		UR.USERCODE 	= 	BG.USERCODE 
		JOIN	sys_object_domain  DN
		ON		BG.COMPANYCODE	=	DN.DOMAINCODE
		WHERE	NVL(BG.JOBTYPE,'Origin') = 'Origin'
		AND 	DN.DOMAINID = #{domainId}    
		<choose>
			<when test="groupCode != null and groupCode != ''">
				AND BG.DEPTCODE = #{groupCode}
			</when>
		</choose>
		<if test="IsUse != null">
			AND UR.ISUSE = #{IsUse}
		</if>
		<if test="searchType != null and searchText != null">
			<choose>
				<when test="searchType == 'USER_NAME'.toString()">
					AND UR.MULTIDISPLAYNAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'USER_CODE'.toString()">
					AND UR.USERCODE like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'DEPT_NAME'.toString()">
					AND BG.MULTIDEPTNAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'JOBPOSITION_NAME'.toString()">
					AND BG.MULTIJOBPOSITIONNAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'JOBTITLE_NAME'.toString()">
					AND BG.MULTIJOBTITLENAME like ('%'|| #{searchText}|| '%') 
				</when>
				<when test="searchType == 'JOBLEVEL_NAME'.toString()">
					AND BG.MULTIJOBLEVELNAME like ('%'|| #{searchText}|| '%') 
				</when>
			</choose>
		</if>
	</select>
    
	
    <update id="updateIsDisplayUser" parameterType="cmap">
	    <![CDATA[
		UPDATE sys_object_user
		SET
			IsDisplay = #{IsDisplay},
			ModifyDate = #{ModifyDate}
		WHERE UserCode = #{UserCode}
		]]>
	</update>
	
	<select id="selectUserGroupMailInfo" resultType="cmap">
      	SELECT  	UR.USERCODE AS "USERCODE"
			,		UR.DISPLAYNAME AS "DISPLAYNAME"
			,		NVL(UR.MAILADDRESS	,'') AS "MailAddress"
													
			,		NVL(GR.GROUPCODE     ,'') AS "DeptCode"
			,		NVL(GR.DISPLAYNAME   ,'') AS "DeptName"
			,		NVL(GR.PRIMARYMAIL   ,'') AS "DeptMailAddress"
			,		NVL(GR.OUPATH  	 	,'') AS "OUPath"
													
			,		NVL(JP.GROUPCODE     ,'') AS "JobPositionCode"
			,		NVL(JP.DISPLAYNAME   ,'') AS "JobPositionName"
			,		NVL(JP.PRIMARYMAIL   ,'') AS "JobPositionMailAddress"
			,		NVL(JT.GROUPCODE     ,'') AS "JobTitleCode"
			,		NVL(JT.DISPLAYNAME   ,'') AS "JobTitleName"
			,		NVL(JT.PRIMARYMAIL   ,'') AS "JobTitleMailAddress"
			,		NVL(JL.GROUPCODE     ,'') AS "JobLevelCode"
			,		NVL(JL.DISPLAYNAME   ,'') AS "JobLevelName"
			,		NVL(JL.PRIMARYMAIL	,'') AS "JobLevelMailAddress"
		FROM 		sys_object_user UR 
		JOIN		sys_object_user_basegroup BG
		ON			UR.USERCODE 		= 	BG.USERCODE
		AND			BG.JOBTYPE 			= 	'Origin'
		AND			UR.USERCODE 		=  	#{UserCode}
		LEFT
		JOIN		sys_object_group GR
		ON			GR.GROUPTYPE 		= 	'Dept'
		AND			BG.DEPTCODE			=	GR.GROUPCODE
		LEFT
		JOIN		sys_object_group JP
		ON			JP.GROUPTYPE 		= 	'JobPosition'
		AND			BG.JOBPOSITIONCODE	=	JP.GROUPCODE
		LEFT
		JOIN		sys_object_group JT
		ON			JT.GROUPTYPE 		= 	'JobTitle'
		AND			BG.JOBTITLECODE	=	JT.GROUPCODE
		LEFT
		JOIN		sys_object_group JL
		ON			JL.GROUPTYPE 		= 	'JobLevel'
		AND			BG.JOBLEVELCODE	=	JL.GROUPCODE

	</select>
	
	<select id="selectIsDuplicateUserInfo" parameterType="cmap" resultType="cmap">
		SELECT COUNT(0) AS "isDuplicate"
		FROM sys_object_user
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
	    	<if test="Type == 'UserCode'">
		  		AND UserCode = #{Code}    
		  	</if>
		  	<if test="Type == 'UserEmpNo'">
		  		AND EmpNo = #{Code}
		  	</if>
		  	<if test="Type == 'LogonID'">
		  		AND LogonID = #{Code}
		  	</if>
		</trim> 
    </select> 
	<update id="resetUserPassword" parameterType="cmap">
        UPDATE sys_object_user
        SET 
        	LogonPassword =   CRYPTO.ENC_AES128(#{sNewPassword},#{aeskey}),
        	ModifyDate = TO_DATE(#{ModDate}, 'YYYY-MM-DD HH24:MI:SS')
        WHERE usercode = #{UserCode}
    </update>

	<update id="resetUserPasswordLock" parameterType="cmap">
        UPDATE sys_object_user
		SET
			  ACCOUT_LOCK = 'N'
			, PASSWORD_CHANGE_DATE = TO_DATE(#{ModDate}, 'YYYY-MM-DD HH24:MI:SS')
			, LOGIN_FAIL_COUNT = 0
			, TEMPORARY_PASSWORD_ISUSE  = 'Y'
		WHERE usercode = #{UserCode}
    </update>
    <select id="selectLicenseInfo" parameterType="cmap" resultType="cmap">
    	SELECT 	M.LicSeq	AS "LicSeq"
			,	M.LicName   AS "LicName"
			,	(CASE WHEN B.LicSeq IS NULL THEN 'N' ELSE 'Y' END)AS "LicMail"
		FROM 	sys_license M
		JOIN 	sys_object_domain_license A
		ON		M.LicSeq = A.LicSeq
		<choose>
			<when test="searchGUBUN == 'DOMAINCODE'.toString()">
				AND 	A.domainId 		= (SELECT DOMAINID FROM sys_object_domain WHERE domaincode =#{domainCode})
			</when>
			<when test="searchGUBUN == 'DOMAINID'.toString()">
				AND 	A.domainId 		= #{domainId}  
			</when>
		</choose> 
		AND 	M.IsUse			=	'Y'
		AND		M.IsOpt			=	'N'
		LEFT
		JOIN 	sys_license_bizsection B
		ON		M.LicSeq = B.LicSeq
		AND		B.BizSection	=	'Mail'
		WHERE	#{licSection}	=	'Y'
    </select>

	<update id="updateUserDefaultInfo" parameterType="cmap">
		UPDATE sys_object_user 
		SET
			LogonID = #{LogonID},
			EmpNo = #{EmpNo},
			NickName = #{NickName},
			DisplayName = #{DisplayName},
			MultiDisplayName = #{MultiDisplayName},
			Address = #{Address},
			MultiAddress = #{MultiAddress},
			HomePage = #{HomePage},
			PhoneNumber = #{PhoneNumber},
			Mobile = #{Mobile},
			Fax = #{Fax},
			IPPhone = #{IPPhone},
			UseMessengerConnect = #{UseMessengerConnect},
			SortKey = #{SortKey},
			SecurityLevel = #{SecurityLevel},
			Description = #{Description},
			IsUse = #{IsUse},
			IsHR = #{IsHR},
			IsDisplay = #{IsDisplay},
			EnterDate = #{EnterDate},
			RetireDate = #{RetireDate},
			BirthDiv = #{BirthDiv},
			BirthDate = #{BirthDate},
			UseMailConnect = #{UseMailConnect},
			MailAddress = #{MailAddress},
			ExternalMailAddress = #{ExternalMailAddress},
			ChargeBusiness = #{ChargeBusiness},
			PhoneNumberInter = #{PhoneNumberInter},
			LanguageCode = #{LanguageCode},
			MobileThemeCode = #{MobileThemeCode},
			TimeZoneCode = #{TimeZoneCode},
			ModifyDate = sysdate,
			Reserved1 = #{Reserved1},
			Reserved2 = #{Reserved2},
			Reserved3 = #{Reserved3},
			Reserved4 = #{Reserved4},
			Reserved5 = #{Reserved5},
			LicSeq = #{LicSeq}
			<if test="InitPortal != null">
			    , InitPortal=#{InitPortal}
		    </if>
			<if test="AD_IsUse != null">
				, AD_ISUSE = #{AD_IsUse}
			</if>
			<if test="EX_IsUse != null">
				, EX_ISUSE = #{EX_IsUse}
			</if>
			<if test="MSN_IsUse != null">
				, MSN_ISUSE = #{MSN_IsUse}
			</if>
			<if test='InitPW == "Y"'>
				, TEMPORARY_PASSWORD_ISUSE  = 'Y'
			</if>
		WHERE UserCode=#{UserCode}
	</update>	
	<insert id="insertUserDefaultInfo" parameterType="cmap">
        INSERT INTO sys_object_user (
			UserCode,
			LogonID,
			LogonPassword,
			EmpNo,
			NickName,
			DisplayName,
			MultiDisplayName,
			Address,
			MultiAddress,
			HomePage,
			PhoneNumber,
			Mobile,
			Fax,
			IPPhone,
			UseMessengerConnect,
			SortKey,
			SecurityLevel,
			Description,
			IsUse,
			IsHR,
			IsDisplay,
			EnterDate,
			RetireDate,
			PhotoPath,
			BirthDiv,
			BirthDate,
			UseMailConnect,
			MailAddress,
			ExternalMailAddress,
			ChargeBusiness,
			PhoneNumberInter,
			LanguageCode,
			InitPortal,
			MobileThemeCode,
			TimeZoneCode,
			RegistDate,
			ModifyDate,
			Reserved1,
			Reserved2,
			Reserved3,
			Reserved4,
			Reserved5,
			AD_ISUSE,
			EX_ISUSE,
			MSN_ISUSE,
			LicSeq
		  	<if test='isSaaS != null and isSaaS=="Y"'>
		  	,	TEMPORARY_PASSWORD_ISUSE
		  	</if>
        ) 
        VALUES (
        	#{UserCode},
			#{LogonID},
			HEX(AES_ENCRYPT(#{aeskey}, SHA2(#{LogonPassword},512))) ,
			#{EmpNo},
			#{NickName},
			#{DisplayName},
			#{MultiDisplayName},
			#{Address},
			#{MultiAddress},
			#{HomePage},
			#{PhoneNumber},
			#{Mobile},
			#{Fax},
			#{IPPhone},
			#{UseMessengerConnect},
			#{SortKey},
			#{SecurityLevel},
			#{Description},
			#{IsUse},
			#{IsHR},
			#{IsDisplay},
			#{EnterDate},
			#{RetireDate},
			#{PhotoPath},
			#{BirthDiv},
			#{BirthDate},
			#{UseMailConnect},
			#{MailAddress},
			#{ExternalMailAddress},
			#{ChargeBusiness},
			#{PhoneNumberInter},
			#{LanguageCode},
			#{InitPortal},
			#{MobileThemeCode},
			#{TimeZoneCode},
			sysdate,
			sysdate,
			#{Reserved1},
			#{Reserved2},
			#{Reserved3},
			#{Reserved4},
			#{Reserved5},  	
			#{AD_IsUse},
			#{EX_IsUse},
			#{MSN_IsUse} ,
			#{LicSeq}  	
			
		  	<if test='isSaaS != null and isSaaS=="Y"'>
		  	,	'Y'
		  	</if>	
        )
	</insert>
	<select id="selectUserGroupList" resultType="cmap">
      	SELECT	DISTINCT
				gr.groupCode as "groupCode"
		FROM	sys_object_user ur
		JOIN	sys_object_group_member gm 
		ON		ur.UserCode			=	#{UserCode}
		AND		ur.UserCode			=	gm.UserCode
		JOIN	sys_object_group gr
		ON		gm.groupCode		=	gr.GroupCode
		AND		gr.IsMail			=	'Y'
		AND		gr.PrimaryMail		!=	''
		AND		gr.PrimaryMail		IS NOT NULL 

	</select>
</mapper>