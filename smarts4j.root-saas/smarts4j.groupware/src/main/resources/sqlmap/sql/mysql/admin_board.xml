<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="admin.board">
    <select id="selectAdmin_LeftBoardMenu" parameterType="cmap" resultType="cmap">
    <!-- 관리자 게시판 관련 Left Menu 조회 : MenuID, DomainID, DisplayName, SortKey, URL(?boardType=구분자), Description-->
	    SELECT 
	    	MenuID, 	
	    	DomainID, 
	    	DisplayName, 
	    	SortKey, 
	    	HasFolder,
	    	URL, 
	    	Description
	    FROM sys_object_menu
	    WHERE 1=1
	    AND IsUse = 'Y'
	    AND IsDisplay = 'Y'
	    AND IsAdmin = 'Y'
	    AND MenuType = 'Left'
	    AND BizSection = 'Board'
	    ORDER BY SortKey ASC
	<!-- ProgramType(메뉴타입) IN ('System', 'Mirror') AND ProgramAlias(메뉴타입) = 'Board' AND DomainID(도메인ID)= -->
    </select>
    
    <!-- 회사목록 조회 : 요청받은 DomainID를 최상위로 위치하도록 조회 -->
    <select id="selectDomainList" parameterType="cmap" resultType="cmap">
        SELECT dn.DomainID as optionValue
        	, Fn_BaseGetDictionary_S(#{lang}, dn.MultiDisplayName) as optionText
		FROM sys_object_group AS gr
		INNER JOIN sys_object_domain AS dn on gr.CompanyCode = dn.DomainCode
		WHERE gr.GroupType = 'Company' 
		<if test="assignedDomain.size() > 0" >
            AND DomainID IN 
            <foreach item="item" index="index" collection="assignedDomain" open="(" close=")" separator=",">
            	#{item}
    		</foreach>
        </if> 
		ORDER BY
		<if test="domainID != null and domainID != ''">
		 	 dn.DomainID = #{domainID} DESC,
		</if>
		gr.SortKey ASC
    </select>
    
    <select id="selectMenuList" parameterType="cmap" resultType="cmap">
        SELECT MenuID AS optionValue, 
		Fn_BaseGetDictionary_S(#{lang}, MultiDisplayName) AS optionText
		FROM sys_object_menu
		WHERE IsUse = 'Y' 
		AND DeleteDate IS NULL
		AND MenuID IN 
		<foreach item="item" index="index" collection="menuID" open="(" close=")" separator=",">
            #{item}
    	</foreach>
    	<if test='menuAclDataArr != null and menuAclDataArr.length != 0'>
			AND MenuID IN  
			<foreach collection="menuAclDataArr" item="item" open="(" close=")" separator=",">
				#{item}
			</foreach>
		</if>
    </select>
    
    <!-- 메뉴조회: 업무담당자의 MenuID를 조회이전까지 사용 -->
    <select id="selectMenuByDomainID" parameterType="cmap" resultType="cmap">
        SELECT MenuID AS menuID
        FROM sys_object_menu 
        WHERE DomainID = #{domainID}
        AND BizSection = #{bizSection}
        AND IsAdmin = 'N'
        AND MenuType = 'TopSub'
    </select>

	<!-- Folder Tree Menu 조회 -->
	<select id="selectTreeFolderMenu" parameterType="cmap" resultType="cmap">
		/* queryId : admin.board.selectTreeFolderMenu */
		SELECT       
			  SOF.FolderID AS FolderID
			, SOF.MemberOf AS MemberOf
			, SOF.FolderType AS itemType
		    , SOF.FolderType
		    , SOF.FolderPath
			, SOF.MenuID
			, CONCAT('board_', SOF.FolderType) AS type
			, IFNULL(Fn_BaseGetDictionary_S(#{lang}, SOF.MultiDisplayName), SOF.DisplayName) AS FolderName
			, SOF.MemberOf
			, SOF.DisplayName AS DisplayName
			, SOF.SortKey
			, SOF.SortPath
			, SOF.IsUse
			, SOF.IsDisplay
			, SOF.DeleteDate
			, SOF.RegistDate
			, Fn_BaseGetDictionary_S(#{lang}, SOU.MultiDisplayName) AS RegisterName
			, (SELECT t.DisplayName FROM sys_object_folder_type t WHERE FolderType = SOF.FolderType AND BizSection IN (SOF.ObjectType, 'Common')) AS FolderTypeName
			, (SELECT COUNT(0) FROM sys_object_folder AS self WHERE self.MemberOf = sof.FolderID AND self.IsUse = 'Y' AND self.DeleteDate IS NULL) AS hasChild 
			, SOF.RegisterCode
			, SOF.Description
			, SOD.DomainCode
			, IFNULL(SOF.IsMobileSupport, 'N') AS IsMobileSupport
			, IFNULL(SOF.Reserved4,'N') IsContents
		FROM sys_object_folder AS SOF 
		LEFT JOIN sys_object_domain AS SOD ON SOF.DomainID = SOD.DomainID
		LEFT OUTER JOIN sys_object_user SOU ON SOF.RegisterCode = SOU.UserCode
		WHERE SOF.DomainID = #{domainID}
		<choose>
		    <when test="communityID != null and communityID != ''">
				AND SOF.ObjectType = 'Community'
			</when>
			<otherwise>
				AND SOF.ObjectType = #{bizSection}
			</otherwise>
		</choose>
		AND SOF.MenuID IN
		<foreach item="item" index="index" collection="menuID" open="(" close=")" separator=",">
            #{item}
    	</foreach>
    	<if test="folderType != null and folderType != ''">
				AND SOF.FolderType = #{folderType}
		</if>
    	<if test="memberOf != null and memberOf != ''">
				AND SOF.MemberOf = #{memberOf}  AND (foldertype IN ('Root','Folder') OR sof.Reserved4='Y' )
		</if>
		<if test='isContents == "Y"'>
			 AND (SOF.foldertype IN ('Root','Folder') OR SOF.reserved4='Y' )
		</if>
    	<if test='onlyFolder == "Y"'>
				AND SOF.FolderType IN ('Root','Folder')
		</if>
		
		<choose>
			<when test='useEasyAdmin != null and useEasyAdmin.equalsIgnoreCase("Y")'>
				<if test='isAll == "N"'>
		AND SOF.IsUse = 'Y'
		AND SOF.IsDisplay = 'Y'
		AND SOF.DeleteDate IS NULL
				</if>
			</when>
			<otherwise>
		AND SOF.DeleteDate IS NULL
			</otherwise>
		</choose>
		
		<!-- AND SOF.FolderPath NOT REGEXP (
			SELECT IFNULL(GROUP_CONCAT(CONCAT(FolderPath, FolderID, ';') SEPARATOR '|'),'0;') FROM sys_object_folder
			WHERE (IsUse = 'N' OR IsDisplay = 'N')
		) -->
		ORDER BY SOF.FolderPath, SOF.SortKey ASC
	</select>
	
	<!-- 폴더 목록 Count -->
	<select id="selectFolderGridCount" resultType="java.lang.Long">
	SELECT COUNT(*) FROM (
		SELECT SOF.FolderID
			, SOF.RegisterCode
			, SOF.MenuID
			, SOF.FolderType
			, SOF.DisplayName 
			, SOF.MultiDisplayName
			, SOF.MemberOf
			, SOF.SortKey
			, SOF.IsUse
			, SOF.IsDisplay
			, SOF.DeleteDate
			, SOF.RegistDate
		FROM sys_object_folder AS SOF 
		LEFT OUTER JOIN sys_object_user SOU ON SOF.RegisterCode = SOU.UserCode
<!-- 		INNER JOIN sys_object_folder_type SOFt ON SOF.FolderType = SOFt.FolderType AND SOFt.BizSection IN (#{bizSection} AND SOFt.IsUse = 'Y' -->
		WHERE 1=1
		<choose>
		    <when test="communityID != null and communityID !=''">
				AND SOF.ObjectType = 'Community'
			</when>
			<otherwise>
				AND SOF.ObjectType = #{bizSection}
			</otherwise>
		</choose>
		<choose>
		    <when test="menuID != null and menuID !=''">
		        AND SOF.DomainID = #{domainID}
				AND SOF.MenuID = #{menuID}
				AND SOF.MemberOf = #{folderID}
				AND SOF.FolderType != 'Root'
		    </when>
		    <otherwise>
				AND SOF.DomainID = #{domainID}
				AND SOF.MenuID IN ( 
					SELECT MenuID 
					FROM sys_object_menu 
					WHERE DeleteDate IS NULL
					AND IsUse = 'Y'
					AND BizSection = #{bizSection}		<!-- sys_object_menu.BizSection='Board' -->
					AND DomainID = #{domainID} )
				AND SOF.FolderType = 'Root'
		    </otherwise>
	    </choose>
	    ) AS RESULT
	</select>
	
	<!-- 폴더 목록 Grid 데이터  -->
 	<select id="selectFolderGridList" parameterType="cmap" resultType="cmap">
	SELECT * FROM (
		SELECT SOF.FolderID
			, SOF.RegisterCode
			, SOF.DomainID
			, SOF.MenuID
			, SOF.FolderType
			, SOF.FolderPath
			, SOF.DisplayName 
			, SOF.MultiDisplayName
			, SOF.MemberOf
			, SOF.SortKey
			, SOF.IsUse
			, SOF.IsDisplay
			, SOF.DeleteDate
			, SOF.RegistDate
		FROM sys_object_folder AS SOF 
		LEFT OUTER JOIN sys_object_user SOU ON SOF.RegisterCode = SOU.UserCode
<!-- 		INNER JOIN sys_object_folder_type SOFt ON SOF.FolderType = SOFt.FolderType AND SOFt.BizSection IN (#{bizSection} AND SOFt.IsUse = 'Y' -->
		WHERE 1=1
		<choose>
		    <when test="communityID != null and communityID !=''">
				AND SOF.ObjectType = 'Community'
			</when>
			<otherwise>
				AND SOF.ObjectType = #{bizSection}
			</otherwise>
		</choose>
		<choose>
		    <when test="menuID != null and menuID !=''">
		        AND SOF.DomainID = #{domainID}
				AND SOF.MenuID = #{menuID}
				AND SOF.MemberOf = #{folderID}
				AND SOF.FolderType != 'Root'
		    </when>
		    <otherwise>
				AND SOF.DomainID = #{domainID}
				AND SOF.MenuID IN ( 
					SELECT MenuID 
					FROM sys_object_menu 
					WHERE DeleteDate IS NULL
					AND IsUse = 'Y'
					AND BizSection = #{bizSection}		<!-- sys_object_menu.BizSection='Board' -->
					AND DomainID = #{domainID} )
				AND SOF.FolderType IN ('Root', 'DocRoot') 
		    </otherwise>		  
	    </choose>
	    ) AS RESULT
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<choose>
			    <when test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			        <choose>
						<when test='sortColumn.equalsIgnoreCase("FolderID")'>FolderID</when>
						<when test='sortColumn.equalsIgnoreCase("DisplayName")'>DisplayName</when>
						<when test='sortColumn.equalsIgnoreCase("DeleteDate")'>DeleteDate</when>
						<when test='sortColumn.equalsIgnoreCase("RegisterCode")'>RegisterCode</when>
						<when test='sortColumn.equalsIgnoreCase("IsDisplay")'>IsDisplay</when>
						<when test='sortColumn.equalsIgnoreCase("IsUse")'>IsUse</when>
						<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
						<otherwise>SortKey</otherwise>
					</choose>
					<choose>
						<when test='sortDirection.equalsIgnoreCase("DESC")'> DESC</when>
						<otherwise> ASC</otherwise>
					</choose>
			    </when>
			    <otherwise>
					SortKey ASC
			    </otherwise>		  
		    </choose>
		</trim>
		<!-- paging query LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지} -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>
 	
 	<select id="selectNextSortKey" parameterType="cmap" resultType="java.lang.Long">
		SELECT IFNULL(MAX(SOF.SortKey), 1)	<!-- SortKey 최대값 조회, 새로생성하는 경우 1부터 시작 -->
		FROM sys_object_folder AS SOF 
		LEFT OUTER JOIN sys_object_user SOU ON SOF.RegisterCode = SOU.UserCode
		INNER JOIN sys_object_folder_type SOFt ON SOF.FolderType = SOFt.FolderType AND SOFt.IsUse = 'Y'
		WHERE 1=1
		<choose>
		    <when test="folderType != 'Root'">
		        AND SOF.DomainID = #{domainID}
				AND SOF.MenuID = #{menuID}
				AND SOF.MemberOf = #{memberOf}
				AND SOF.FolderType != 'Root'
		    </when>
		    <otherwise>
				AND SOF.DomainID = #{domainID}
				AND SOF.MenuID IN ( 
					SELECT MenuID 
					FROM sys_object_menu 
					WHERE DeleteDate IS NULL
					AND IsUse = 'Y'
					AND BizSection = #{bizSection}		<!-- sys_object_menu.BizSection='Board' -->
					AND DomainID = #{domainID} )
				AND SOF.FolderType = 'Root'
		    </otherwise>		  
	    </choose>
 	</select>
 	
 	<!-- 추가/수정 팝업에 표시되는 폴더 타입 목록 -->
 	<select id="selectFolderTypeList" parameterType="cmap" resultType="cmap">
 	    SELECT 
 	    	DisplayName AS optionText
 	    	,FolderType AS optionValue
		FROM sys_object_folder_type 
		WHERE 1=1
		AND IsUse = 'Y'
		AND BizSection in (#{bizSection}, 'Common')
		ORDER BY SortKey ASC
 	</select>
 	
 	<!-- base_code 테이블 데이터 조회 항목 -->
 	<!-- 추가/수정 팝업에 표시되는 폴더 타입 목록 -->
 	<select id="selectSecurityLevelList" parameterType="cmap" resultType="cmap">
 	    SELECT
			CodeName AS optionText
			,MultiCodeName AS multiOptionText
		 	,Code AS optionValue
		FROM sys_base_code sbc WHERE codegroup LIKE 'SecurityLevel'
		AND SortKey != 0
		AND DomainID = (SELECT DomainID FROM covi_smart4j.sys_base_code WHERE codegroup LIKE 'SecurityLevel' AND Code = sbc.Code ORDER BY IF(DomainID = #{domainID}, 0, 1) LIMIT 1 )
		ORDER BY SortKey DESC
 	</select>
 	
 	<!-- 추가/수정 팝업에 표시되는 폴더 타입 목록 -->
 	<select id="selectRequestStatusList" parameterType="cmap" resultType="cmap">
		SELECT
			CodeName AS optionText
			,Code AS optionValue
		FROM sys_base_code sbc WHERE codegroup LIKE 'RequestStatus'
		AND SortKey != 0
		AND DomainID = (SELECT DomainID FROM covi_smart4j.sys_base_code WHERE codegroup LIKE 'RequestStatus' AND Code = sbc.Code ORDER BY IF(DomainID = #{domainID}, 0, 1) LIMIT 1 )
		ORDER BY SortKey ASC
 	</select>
 	
 	<select id="selectPathInfo" parameterType="cmap" resultType="cmap">
 	    SELECT
 	    	SortPath, FolderPath
 	    FROM sys_object_folder
 	    WHERE 1=1
 	    AND FolderID = #{memberOf}
 	</select>
 	
 	
 	<!-- 확장옵선:카테고리 체크박스 선택시 나오는 대분류 조회항목 -->
 	<select id="selectLargeCategory" parameterType="cmap" resultType="cmap">
 	   SELECT BC.CategoryID AS CategoryID
			,BC.FolderID AS FolderID
			,BC.MemberOf AS	MemberOF
			,BC.CategoryPath AS CategoryPath 
			,BC.DisplayName AS DisplayName
			,BC.ManagerCode AS ManageCode
			,BC.SortKey AS SortKey
			,BC.SortPath AS SortPath
			,SOU.MultiDisplayName AS ManagerName
		FROM board_category AS BC
		LEFT OUTER JOIN sys_object_user AS SOU ON (BC.ManagerCode = SOU.UserCode)
		WHERE 1=1
		AND BC.MemberOf IS NULL
		AND BC.FolderID = #{folderID}
		ORDER BY BC.SortPath
 	</select>
 	
 	<select id="selectSmallCategory" parameterType="cmap" resultType="cmap">
 	    SELECT BC.CategoryID AS CategoryID
			,BC.FolderID AS FolderID
			,BC.MemberOf AS	MemberOF
			,BC.CategoryPath AS CategoryPath 
			,BC.DisplayName AS DisplayName
			,BC.ManagerCode AS ManageCode
			,BC.SortKey AS SortKey
			,BC.SortPath AS SortPath
			,SOU.MultiDisplayName AS ManagerName
 	    FROM board_category AS BC
 	    LEFT OUTER JOIN sys_object_user AS SOU ON (BC.ManageCode = SOU.UserCode)
 	    WHERE 1=1
 	    AND BC.FolderID = #{folderID}
 	    AND BC.MemberOf = #{categoryID}
 	    ORDER BY BC.SortPath
 	</select>
 	
 	<!-- 폴더 타입의 기본설정 조회 -->
 	<select id="selectDefaultConfig" parameterType="cmap" resultType="cmap">
 	    SELECT
			UseFile 
			,UseImage 
			,UseVideo
			,UsePopNotice 
			,UseTopNotice 
			,UseExpiredDate 
			,UseAnony 
			,UseReply 
			,UseComment 
			,UseInterest 
			,UseFavorite 
			,UseRecommend 
			,UseSecret 
			,UseTag
			,UseLink 
			,UsePrint 
			,LimitFileSize 
			,LimitFileCnt 
			,LimitCommentCnt 
			,LimitLinkCnt 
			,RecentlyDay 
			,ExpireDay 
			,DefaultContents 
			,UseScrap 
			,UseCopy
			,UseMessageAuth
			,UseReport
			,UseEvalPoint
			,UseCommentRecommend 
			,UseLogWrite
			,UseReadCnt 
			,UseTrackback 
			,UseRSS
			,UseReaderView 
			,UseDefaultSecret 
			,UseSatisfaction
			,UseSatisfactionOrigin
			,UseSatisfactionReply
			,UseIncludeMaximumRead
			,UseIncludeRecentReg
			,UseLinkedMessage
			,UseModificationRequest
			,UseIncludeOverallSearch
			,UseEmail 
			,UseSendMailInBody
			,UseMigrationToDoc
			,UseCheckOut
			,UseReservation
			,UseBoardDescription
			,UseRecommendDisp
			,UseSubscription
			,UseCategory
			,UseBodyForm
			,UseUserForm
			,UseOwnerProcess
			,UseUserProcess
			,UseProgressState
			,BoardTotalLimitFileSize
			,CurrentTotalFileSize
			,UsePubDeptName
			,UseMessageReadAuth
			,UseMessageSecurityLevel
		FROM board_config_default
		WHERE FolderType = #{folderType}
 	</select>
 	
 	<!-- 폴더/게시판 속성 조회: 조회시 사용하는 컬럼명과 JSP에서 Element ID와 맵핑-->
 	<select id="selectBoardConfig" parameterType="cmap" resultType="cmap">
 	/* admin.board.selectBoardConfig */
	SELECT RESULT.*, DATE_FORMAT(RESULT.RegistDate,'%Y.%m.%d %H:%i:%s') AS RegistDate
			 ,Fn_FolderPathByLangGet_S(#{lang}, FolderPath) FolderPathName
	FROM (
	 	    SELECT 
	 	    	 SOF.MenuID
	 	    	,SOF.FolderType
	 	    	,SOF.DisplayName ,SOF.MultiDisplayName
	 	    	,SOF.MemberOf
	 	    	,SOF.FolderPath
	 	    	,SOF.SortKey ,SOF.SortPath
	 	    	,IFNULL(SOF.IsInherited, 'N') AS IsInherited
	 	    	,SOF.IsShared
	 	    	,SOF.IsUse ,SOF.IsDisplay
	 	    	,SOF.IsURL
	 	    	,SOF.URL
	 	    	,SOF.SecurityLevel
	 	    	,SOF.IsMobileSupport
	 	    	,SOF.IsMsgSecurity
	 	    	,SOF.IsAdminNotice
	 	    	,SOF.Reserved4 IsContents
	 	    	,IFNULL(SOF.Description, '') AS Description
	 	    	,IFNULL(SOF.OwnerCode, '') AS OwnerCode
	 	    	,IF((SELECT COUNT(0) FROM sys_favorite WHERE TargetObjectType ='FD' AND TargetServiceType = 'Board' AND TargetID = #{folderID} AND UserCode = #{userCode} > 0), 'Y', 'N') AS IsFavorite
	 	    	,IF((SELECT COUNT(0) FROM sys_subscription WHERE TargetServiceType = 'Board' AND TargetID = #{folderID} AND RegisterCode = #{userCode} > 0), 'Y', 'N' ) AS IsSubscribe
	 	    	,(SELECT MultiDisplayName FROM sys_object_user WHERE UserCode = SOF.RegisterCode) AS RegisterName
	 	    	,DATE_FORMAT(SOF.RegistDate,'%Y.%m.%d %H:%i:%s') AS CreateDate
	 	    	,DATE_FORMAT(IFNULL(BC.RegistDate, BCD.RegistDate),'%Y.%m.%d %H:%i:%s') AS RegistDate2
	 	    	,IFNULL(BC.UseFile, BCD.UseFile) AS UseFile
	 	    	,IFNULL(BC.UseImage, BCD.UseImage) AS UseImage
	 	    	,IFNULL(BC.UseVideo, BCD.UseVideo) AS UseVideo
	 	    	,IFNULL(BC.UsePopNotice, BCD.UsePopNotice) AS UsePopNotice
	 	    	,IFNULL(BC.UseTopNotice, BCD.UseTopNotice) AS UseTopNotice
				,IFNULL(BC.UseExpiredDate, BCD.UseExpiredDate) AS UseExpiredDate
				,IFNULL(BC.UseAnony, BCD.UseAnony) AS UseAnony
				,IFNULL(BC.UseReply, BCD.UseReply) AS UseReply
				,IFNULL(BC.UseComment, BCD.UseComment) AS UseComment
				,IFNULL(BC.UseInterest, BCD.UseInterest) AS UseInterest
				,IFNULL(BC.UseFavorite, BCD.UseFavorite) AS UseFavorite
				,IFNULL(BC.UseRecommend, BCD.UseRecommend) AS UseRecommend
				,IFNULL(BC.UseSecret, BCD.UseSecret) AS UseSecret
				,IFNULL(BC.UseTag, BCD.UseTag) AS UseTag
				,IFNULL(BC.UseLink, BCD.UseLink) AS UseLink
				,IFNULL(BC.UsePrint, BCD.UsePrint) AS UsePrint
				,IFNULL(BC.TotalFileSize, 0) AS TotalFileSize
				,IFNULL(BC.LimitFileSize, 0) AS LimitFileSize
				,IFNULL(BC.LimitFileCnt, BCD.LimitFileCnt) AS LimitFileCnt
				,IFNULL(BC.LimitCommentCnt, BCD.LimitCommentCnt) AS LimitCommentCnt
				,IFNULL(BC.LimitLinkCnt, BCD.LimitLinkCnt) AS LimitLinkCnt
				,IFNULL(BC.RecentlyDay, BCD.RecentlyDay) AS RecentlyDay
				,IFNULL(BC.ExpireDay, BCD.ExpireDay) AS ExpireDay
				,IFNULL(BC.DefaultContents, IFNULL(BCD.DefaultContents, '')) AS DefaultContents
				,IFNULL(BC.UseScrap, BCD.UseScrap) AS UseScrap
				,IFNULL(BC.UseCopy, BCD.UseCopy) AS UseCopy
				,IFNULL(BC.UseMessageAuth, BCD.UseMessageAuth) AS UseMessageAuth
				,IFNULL(BC.UseReport, BCD.UseReport) AS UseReport
				,IFNULL(BC.UseEvalPoint, BCD.UseEvalPoint) AS UseEvalPoint
				,IFNULL(BC.UseCommentRecommend, BCD.UseCommentRecommend) AS UseCommentRecommend
				,IFNULL(BC.UseLogWrite, BCD.UseLogWrite) AS UseLogWrite
				,IFNULL(BC.UseReadCnt, BCD.UseReadCnt) AS UseReadCnt
				,IFNULL(BC.UseTrackback, BCD.UseTrackback) AS UseTrackback
				,IFNULL(BC.UseRSS, BCD.UseRSS) AS UseRSS
				,IFNULL(BC.UseReaderView, BCD.UseReaderView) AS UseReaderView
				,IFNULL(BC.UseDefaultSecret, BCD.UseDefaultSecret) AS UseDefaultSecret
				,IFNULL(BC.UseSatisfaction, BCD.UseSatisfaction) AS UseSatisfaction
				,IFNULL(BC.UseSatisfactionOrigin, BCD.UseSatisfactionOrigin) AS UseSatisfactionOrigin
				,IFNULL(BC.UseSatisfactionReply, BCD.UseSatisfactionReply) AS UseSatisfactionReply
				,IFNULL(BC.UseIncludeMaximumRead, BCD.UseIncludeMaximumRead) AS UseIncludeMaximumRead
				,IFNULL(BC.UseIncludeRecentReg, BCD.UseIncludeRecentReg) AS UseIncludeRecentReg
				,IFNULL(BC.UseLinkedMessage, BCD.UseLinkedMessage) AS UseLinkedMessage
				,IFNULL(BC.UseModificationRequest, BCD.UseModificationRequest) AS UseModificationRequest
				,IFNULL(BC.UseIncludeOverallSearch, BCD.UseIncludeOverallSearch) AS UseIncludeOverallSearch
				,IFNULL(BC.UseEmail, BCD.UseEmail) AS UseEmail
				,IFNULL(BC.UseCategory, BCD.UseCategory) AS UseCategory
				,IFNULL(BC.UseBodyForm, BCD.UseBodyForm) AS UseBodyForm
				,IFNULL(BC.UseUserForm, BCD.UseUserForm) AS UseUserForm
				,IFNULL(BC.UseProgressState, BCD.UseProgressState) AS UseProgressState
				,IFNULL(BC.UseOwnerProcess, BCD.UseOwnerProcess) AS UseOwnerProcess
				,IFNULL(BC.UseUserProcess, BCD.UseUserProcess) AS UseUserProcess
				,IFNULL(BC.UseReplyProcess, BCD.UseReplyProcess) AS UseReplyProcess
				,IFNULL(BC.TopColor, IFNULL(BCD.TopColor, '')) AS TopColor
				,IFNULL(BC.RecentlyColor, IFNULL(BCD.RecentlyColor, '')) AS RecentlyColor
				,IFNULL(BC.RegisterCode, BCD.RegisterCode) AS RegisterCode
				,DATE_FORMAT(IFNULL(BC.RegistDate, BCD.RegistDate),'%Y.%m.%d %H:%i:%s') AS RegistDate
				,IFNULL(BC.UseSendMailInBody, BCD.UseSendMailInBody) AS UseSendMailInBody
				,IFNULL(BC.UseMigrationToDoc, BCD.UseMigrationToDoc) AS UseMigrationToDoc
				,IFNULL(BC.BoardTotalLimitFileSize, BCD.BoardTotalLimitFileSize) AS BoardTotalLimitFileSize
				,IFNULL(BC.CurrentTotalFileSize, BCD.CurrentTotalFileSize) AS CurrentTotalFileSize
				,IFNULL(BC.UseCheckOut, BCD.UseCheckOut) AS UseCheckOut 
				,IFNULL(BC.UseBoardDescription, BCD.UseBoardDescription) AS UseBoardDescription
				,IFNULL(BC.UseRecommendDisp, BCD.UseRecommendDisp) AS UseRecommendDisp
				,IFNULL(BC.UseReservation, BCD.UseReservation) AS UseReservation
				,IFNULL(BC.UseSubscription, BCD.UseSubscription) AS UseSubscription
				,IFNULL(BC.UsePubDeptName, BCD.UsePubDeptName) AS UsePubDeptName
				,IFNULL(BC.UseMessageReadAuth, IFNULL(BCD.UseMessageReadAuth, '')) AS UseMessageReadAuth
				,IFNULL(BC.UseMessageSecurityLevel, BCD.UseMessageSecurityLevel) AS UseMessageSecurityLevel
				,IFNULL(BC.UseAutoDocNumber, BCD.UseAutoDocNumber) AS UseAutoDocNumber
				,IFNULL(BC.MessageTarget, '{"Receivers":{"code":"","name":""},"Excepters":{"code":"","name":""}}') AS MessageTarget
				,IFNULL(BC.EnableFileExtention, '') AS EnableFileExtention
				,IFNULL(BC.UseIcon, '') AS UseIcon
				,IFNULL(BC.UseBody, 'Y') AS UseBody
				,BC.SortCols
				,(SELECT CASE WHEN COUNT(0) > 0 THEN 'Y' ELSE 'N' END FROM sys_object_folder AS self WHERE self.MemberOf = SOF.FolderID AND self.IsUse = 'Y' AND self.DeleteDate IS NULL) AS hasChild
	 	    FROM sys_object_folder AS SOF
	 	    LEFT OUTER JOIN board_config AS BC ON (BC.FolderID = SOF.FolderID)
	 	    LEFT OUTER JOIN board_config_default AS BCD ON (BCD.FolderType = SOF.FolderType)
	 	    WHERE 1=1
	 	    AND SOF.FolderID = #{folderID}
 	    ) AS RESULT
 	</select>
 	
 	<!-- 담당자 이름 조회 -->
 	<select id="selectBoardOwnerName" parameterType="cmap" resultType="cmap">
 	    SELECT MultiDisplayName
 	    FROM sys_object_user
 	    WHERE UserCode IN 
 	    <foreach item="item" index="index" collection="ownerCodes" open="(" close=")" separator=",">
            #{item}
    	</foreach>
 	</select>
 	
 	<!-- 순서변경용 sortkey 조회 -->
    <select id="selectTargetBoardSortKey" parameterType="cmap" resultType="cmap">
        SELECT
        	FolderID
        	,SortKey
        	,MemberOf
        FROM sys_object_folder
        WHERE 1=1
        <if test="folderType == 'Root'" >
            AND MenuID IN 
            <foreach item="item" index="index" collection="menuID" open="(" close=")" separator=",">
            	#{item}
    		</foreach>
        </if>
        AND DomainID = #{domainID}
		AND FolderPath = #{folderPath}
		AND DeleteDate IS NULL
        <choose>
		    <when test="mode == 'up'">
				AND SortKey &lt; #{orgSortKey} 
				ORDER BY SortKey DESC
		    </when>
		    <otherwise>
				AND SortKey &gt; #{orgSortKey} 
				ORDER BY SortKey ASC
		    </otherwise>		  
	    </choose>
	    LIMIT 1
    </select>
 	
 	<!-- 게시판 기본정보 등록 -->
 	<insert id="createBoard" parameterType="cmap">
 	    INSERT INTO sys_object_folder (
			 DomainID
			,MenuID
			,ObjectType
			,FolderType
			,DisplayName
			,MultiDisplayName
			,MemberOf
			,FolderPath
			,SortKey
			,SortPath
			,IsInherited
			,IsShared
			,IsUse
			,IsDisplay
			,IsURL
			,URL
			,SecurityLevel
			,IsMobileSupport
			,IsMsgSecurity
			,IsAdminNotice
			,Description
			,OwnerCode
			,RegisterCode
			,RegistDate
			,Reserved4
		) 
		VALUES (
			 #{domainID}
			,#{menuID}
			,#{bizSection}
			,#{folderType}
			,#{displayName}
			,#{multiDisplayName}
			,#{memberOf}
			,#{folderPath}
			,#{sortKey}
			,#{sortPath}
			,'Y'
			,#{isShared}
			,#{isUse}
			,#{isDisplay}
			,#{isURL}
			,#{url}
			,#{securityLevel}
			,#{isMobileSupport}
			,#{isMsgSecurity}
			,#{isAdminNotice}
			,#{description}
			,#{ownerCode}
			,#{userCode}
			,now(3)
			,#{isContens}
		 )
		<selectKey keyProperty="folderID" resultType="long" order="AFTER">
			SELECT LAST_INSERT_ID();
        </selectKey>
 	</insert>
 	
 	<!-- 폴더 추가시 최상위폴더/폴더 이외의 게시판들은 board_config_default 테이블의 데이터로 추가 -->
 	<insert id="createBoardConfig" parameterType="cmap">
 	    INSERT INTO board_config (
			 FolderID
			,UseBasicConfig
			,UseFile 
			,UseImage 
			,UseVideo
			,UsePopNotice 
			,UseTopNotice 
			,UseExpiredDate 
			,UseAnony 
			,UseReply 
			,UseComment 
			,UseInterest 
			,UseFavorite 
			,UseRecommend 
			,UseSecret 
			,UseTag
			,UseLink 
			,UsePrint 
			,LimitFileSize 
			,LimitFileCnt 
			,LimitCommentCnt 
			,LimitLinkCnt 
			,RecentlyDay 
			,ExpireDay 
			,DefaultContents 
			,UseScrap 
			,UseCopy 
			,UseCommentRecommend 
			,UseLogWrite
			,UseReadCnt 
			,UseTrackback 
			,UseRSS
			,UseReaderView 
			,UseDefaultSecret 
			,UseEmail 
			,UseCategory
			,UseBodyForm
			,UseUserForm
			,UseOwnerProcess
			,UseUserProcess
			,RegisterCode 
			,RegistDate
			,BoardTotalLimitFileSize
			,CurrentTotalFileSize
			,UseReservation
			,UsePubDeptName
			<if test='MessageTarget != null and MessageTarget != ""'>
				,MessageTarget
			</if>
			<if test='useIcon != null and useIcon != ""'>
				, UseIcon
			</if>
		 )	
		SELECT 
			 #{folderID} 
			,'Y' 
			,UseFile 
			,UseImage 
			,UseVideo
			,UsePopNotice 
			,UseTopNotice 
			,UseExpiredDate 
			,UseAnony 
			,UseReply 
			,UseComment 
			,UseInterest 
			,UseFavorite 
			,UseRecommend 
			,UseSecret 
			,UseTag 
			,UseLink 
			,UsePrint 
			,LimitFileSize 
			,LimitFileCnt 
			,LimitCommentCnt 
			,LimitLinkCnt 
			,RecentlyDay 
			,ExpireDay 
			,DefaultContents 
			,UseScrap 
			,UseCopy 
			,UseCommentRecommend 
			,UseLogWrite
			,UseReadCnt 
			,UseTrackback 
			,UseRSS
			,UseReaderView 
			,UseDefaultSecret 
			,UseEmail 
			,UseCategory
			,UseBodyForm
			,ifnull(#{useUserForm},UseUserForm)
			,UseOwnerProcess
			,UseUserProcess
			,#{userCode}
			,now(3)
			,BoardTotalLimitFileSize
			,CurrentTotalFileSize
			,UseReservation
			,UsePubDeptName
			<if test='MessageTarget != null and MessageTarget != ""'>
				,#{MessageTarget}
			</if>
			<if test='useIcon != null and useIcon != ""'>
				,#{useIcon}
			</if>
		FROM board_config_default
		WHERE FolderType=#{folderType}
 	</insert>
	
 	<update id="updateBoard" parameterType="cmap">
 	    UPDATE sys_object_folder 
		SET  FolderType = #{folderType}
			<!-- ,SortKey = #{sortKey}  -->
			,LinkFolderID = #{linkFolderID}
			,DisplayName = #{displayName}
			,MultiDisplayName = #{multiDisplayName}
			,IsUse = #{isUse}
			,IsDisplay = #{isDisplay}
			,IsInherited = #{isInherited}
		<if test='useEasyAdmin == null or useEasyAdmin ==""'>
			,IsShared = #{isShared}
			,IsURL = #{isURL}
			,URL = #{url}
			,SecurityLevel = #{securityLevel}
			,IsMobileSupport = #{isMobileSupport}
			,IsMsgSecurity = #{isMsgSecurity}
			,IsAdminNotice = #{isAdminNotice}
			,Description=#{description}
		</if>
			,OwnerCode=#{ownerCode}
			,ModifierCode=#{userCode}
			,ModifyDate=now(3)
		WHERE FolderID=#{folderID}
 	</update>
 	
 	<update id="updateBoardIsInherited" parameterType="cmap">
 	    UPDATE sys_object_folder 
		   SET IsInherited = #{isInherited}
		 WHERE FolderID = #{folderID}
 	</update>
 	
 	<!-- 게시판 순서 수정 -->
    <update id="updateBoardSortKey" parameterType="cmap">
        UPDATE sys_object_folder
        SET
        	SortKey = #{sortKey}
        WHERE FolderID = #{folderID}
    </update>
    
    <select id="selectBoardConfigCnt" parameterType="cmap" resultType="java.lang.Long">
		SELECT COUNT(*)
		FROM covi_smart4j.board_config
		WHERE FolderID = #{folderID}
	</select>
 	
 	<update id="updateBoardConfig" parameterType="cmap">
 	    UPDATE board_config
 	    SET 
			 UseBasicConfig = #{useBaseConfig}
			,UseFile = #{useFile}
			,UseImage = #{useImage}
			,UseVideo = #{useVideo}
			,UsePopNotice = #{usePopNotice}
			,UseTopNotice = #{useTopNotice}
			,UseExpiredDate = #{useExpiredDate}
			,UseAnony = #{useAnony}
			,UseReply = #{useReply}
			,UseComment = #{useComment}
			,UseInterest = #{useInterest}
			,UseFavorite = #{useFavorite}
			,UseRecommend = #{useRecommend}
			,UseSecret = #{useSecret}
			,UsePrint = #{usePrint}
			,UseScrap = #{useScrap}
			,UseCopy = #{useCopy}
			,UseCommentRecommend = #{useCommentRecommend}
			,UseEvalPoint = #{useEvalPoint}
			,UseRecommendDisp = #{useRecommendDisp}
			,UseIncludeMaximumRead = #{useIncludeMaximumRead}
			,UseIncludeRecentReg = #{useIncludeRecentReg}
			,UseCheckOut = #{useCheckOut}
			,UseIncludeOverallSearch = #{useIncludeOverallSearch}
			,UseSubscription = #{useSubscription}
			,UseSendMailInBody = #{useSendMailInBody}
			,UseMigrationToDoc = #{useMigrationToDoc}
			,UseSatisfaction = #{useSatisfaction}
			,UseSatisfactionOrigin = #{useSatisfactionOrigin}
			,UseLogWrite = #{useLogWrite}
			,UseReadCnt = #{useReadCnt}
			,UseReaderView = #{useReaderView}
			,UseDefaultSecret = #{useDefaultSecret}
			,UseAutoDocNumber = #{useAutoDocNumber}
			,UsePubDeptName = #{usePubDeptName}
			,UseOwnerProcess = #{useOwnerProcess}
			,UseUserProcess = #{useUserProcess}
			,UseReplyProcess = #{useReplyProcess}
			
		<if test='MessageTarget != null and MessageTarget != ""'>
			,MessageTarget = #{MessageTarget}
		</if>		
		<if test='useBody != null and useBody != ""'>
			,UseBody = #{useBody}
		</if>
				
		<if test='useEasyAdmin == null or useEasyAdmin ==""'>
			,UseReservation = #{useReservation}
			,UseLinkedMessage = #{useLinkedMessage}
			,UseTag = #{useTag}
			,UseLink = #{useLink}
			,BoardTotalLimitFileSize = #{boardTotalLimitFileSize}
			,TotalFileSize = #{totalFileSize}
			,LimitFileSize = #{limitFileSize}
			,LimitFileCnt = #{limitFileCnt}
			,LimitCommentCnt = #{limitCommentCnt}
			,LimitLinkCnt = #{limitLinkCnt}
			,RecentlyDay = #{recentlyDay}
			,ExpireDay = #{expireDay}
			,DefaultContents = #{defaultContents}
			,UseMessageAuth = #{useMessageAuth}
			,UseReport = #{useReport}
			,UseModificationRequest = #{useModificationRequest}
			,UseMessageSecurityLevel = #{useMessageSecurityLevel} 
			,UseCategory = #{useCategory}
			,UseBodyForm = #{useBodyForm}
			,UseUserForm = #{useUserForm}
			,UseMessageReadAuth = #{useMessageReadAuth}
			,UseBoardDescription = #{useBoardDescription}
			,UseProgressState = #{useProgressState}
			,EnableFileExtention = #{enableFileExtention}
		</if>
			,ModifierCode = #{userCode}
			,ModifyDate = now(3)
 	    WHERE FolderID = #{folderID}
 	</update>
 	
 	<!-- 하위 폴더 조회 -->
 	<select id="selectLowerFolderID" parameterType="cmap" resultType="cmap">
 	    SELECT GROUP_CONCAT(FolderID SEPARATOR ',') AS folderIDs
 	    FROM sys_object_folder,
		        (SELECT @pv := #{folderID}) initialisation
		WHERE  FIND_IN_SET(MemberOf, @pv) > 0
		AND     @pv := concat(@pv, ',', FolderID)
 	</select>
 	
 	<!-- 잘라내기한 폴더의 하위폴더 조회 -->
 	<select id="selectLowerFolderData" parameterType="cmap" resultType="cmap">
 	    SELECT FolderID, SortKey, SortPath, FolderPath, MemberOf
 	    FROM sys_object_folder,
		        (SELECT @pv := #{orgFolderID}) initialisation
		WHERE  FIND_IN_SET(MemberOf, @pv) > 0
		AND     @pv := concat(@pv, ',', FolderID)
		ORDER BY MemberOf, FolderID
 	</select>
 	
 	<!-- 상위 폴더 Path 조회 -->
 	<select id="selectParentPath" parameterType="cmap" resultType="cmap">
 	    SELECT FolderID, SortPath, FolderPath FROM sys_object_folder
		WHERE 1=1
		AND FolderID = #{memberOf}
 	</select>
 	
 	<update id="deleteLowerBoard" parameterType="cmap">
 	    UPDATE sys_object_folder
 	    SET
 	    	DeleteDate = now(3)
 	    	,ModifierCode = #{userCode}
 	    	
 	    WHERE 1=1
 	   <if test='folderIDArr != null and folderIDArr.length != 0'>
			AND FolderID IN  
			<foreach collection="folderIDArr" item="item" open="(" close=")" separator=",">
				#{item}
			</foreach>
		</if>
 	</update>
 	
 	<update id="deleteBoard" parameterType="cmap">
 	    UPDATE sys_object_folder
 	    SET
 	    	DeleteDate = now(3)
 	    	,ModifierCode = #{userCode}
 	    	
 	    WHERE 1=1
 	    AND FolderID = #{folderID}
 	</update>
 	
 	<!-- 표시, 사용 여부 업데이트 -->
 	<update id="updateFlag" parameterType="cmap">
 	    UPDATE sys_object_folder 
		SET <if test='flagKey.equalsIgnoreCase("IsUse")'>IsUse = #{flagValue},</if>
			<if test='flagKey.equalsIgnoreCase("IsDisplay")'>IsDisplay = #{flagValue},</if>
			ModifierCode = #{userCode},
			ModifyDate = now(3)
		WHERE FolderID=#{folderID}
 	</update>
 	
 	<!-- 폴더 복원 -->
 	<update id="restoreFolder" parameterType="cmap">
 	    UPDATE sys_object_folder
		SET DeleteDate = NULL,
			ModifierCode = #{userCode},
			ModifyDate = now(3)
		WHERE FolderID=#{folderID}
		
		<!-- 기존 프로시져 내부 쿼리 참고 -->
<!-- 		UPDATE BASE_DICTIONARY  -->
<!-- 		SET IsUse = 'Y', -->
<!-- 		ModifierCode = #{userCode}, -->
<!-- 		ModifyDate = now(3) -->
<!-- 		WHERE DicSection = 'FD'  -->
<!-- 		AND ObjectID = #{folderID} -->
 	</update>
 
 	<!-- 게시판 설명 조회 -->
 	<select id="selectBoardDescription" parameterType="cmap" resultType="cmap">
 	    SELECT 
 	    	ContentsID
 	    	,Body
 	    FROM sys_contents
 	    WHERE 1=1
 	    AND ObjectID = #{folderID}
 	    AND ObjectType = 'FD_EV'
 	    AND MessageID = #{folderID}
 	</select>
 	
 	<insert id="createBoardDescription" parameterType="cmap" >
 	    INSERT INTO sys_contents(Body, ObjectID, ObjectType, MessageID, BodySize)
 	    VALUES (#{boardDescription}, #{folderID}, 'FD_EV', #{folderID}, #{bodySize})
 	</insert>
 	
 	<update id="updateBoardDescription" parameterType="cmap">
 	    UPDATE sys_contents
 	    SET
 	    	Body = #{boardDescription}
 	    	,BodySize = #{bodySize}
 	    WHERE 1=1
 	    AND ObjectID = #{folderID}
 	    AND ObjectType = 'FD_EV'
 	    AND MessageID = #{folderID}
 	</update>
 	
 	<delete id="deleteBoardDescription" parameterType="cmap">
 	    DELETE FROM sys_contents
 	    WHERE 1=1
 	    AND ObjectID = #{folderID}
 	    AND ObjectType = 'FD_EV'
 	    AND MessageID = #{folderID}
 	</delete>
 	
 	<!-- 확장 옵션 설정 탭: 대분류/소분류 조회 -->
    <select id="selectCategoryList" parameterType="cmap" resultType="cmap">
        SELECT CONCAT(CategoryID,'|',DisplayName,'|',IFNULL(ManagerCode,''),'|',SortPath) as optionValue, 
        	Fn_BaseGetDictionary_S(#{lang}, DisplayName) as optionText
		FROM board_category
		WHERE 1=1
		AND FolderID = #{folderID}
		<choose>
		    <when test="memberOf != null and memberOf != ''">
		        AND MemberOf = #{memberOf}
		    </when>
		    <otherwise>
		        AND MemberOf IS NULL
		    </otherwise>		  
	    </choose>
		ORDER BY SortKey ASC
    </select>
    
    <!-- 확장옵션 설정 탭: 대분류/소분류 추가 -->
    <insert id="createCategory" parameterType="cmap">
 	    INSERT INTO board_category (
			FolderID
			<if test="memberOf != null and memberOf != ''">
		 	 	,MemberOf
			</if>
			 ,DisplayName
			 ,SortKey
		) 
		VALUES 
		(
			#{folderID}
			<if test="memberOf != null and memberOf != ''">
		 	 	,#{memberOf}
			</if>
			,#{displayName}
			,#{sortKey}
		 )
		<selectKey keyProperty="categoryID" resultType="long" order="AFTER">
			SELECT LAST_INSERT_ID();
        </selectKey>
 	</insert>
 	
    <update id="updateCategoryPath" parameterType="cmap">
        UPDATE board_category
		SET CategoryPath = #{categoryPath}
			,SortPAth = #{sortPath}
		WHERE CategoryID=#{categoryID}
    </update>
    
    <update id="updateCategory" parameterType="cmap">
        UPDATE board_category
		SET DisplayName = #{displayName}
		WHERE CategoryID=#{categoryID}
    </update>
    
    <!-- 카테고리 삭제 및 게시글에 할당된 카테고리 값 초기화 -->
    <update id="initMessageCategoryID" parameterType="cmap">
        UPDATE board_message
        SET
        	CategoryID = NULL
        WHERE 1=1
        AND CategoryID IN (
        	SELECT CategoryID
        	FROM board_category
        	WHERE ((CategoryID = #{categoryID} ) OR (MemberOf = #{categoryID}) )
        )
    </update> 
    
    <delete id="deleteCategory" parameterType="cmap">
        DELETE FROM board_category
        WHERE 1=1
        AND ((CategoryID = #{categoryID} ) OR (MemberOf = #{categoryID}) )
    </delete>
    
    
    <!-- 확장옵션 탭: 사용자 정의 컬럼 Grid 조회 -->
    <select id="selectUserDefFormGridList" parameterType="cmap" resultType="cmap">
        SELECT * FROM (
	        SELECT BU.UserFormID 
	        	, BU.FolderID 
	        	, BU.SortKey 
	        	, BU.FieldType 
	        	, BU.FieldSize 
	        	, BU.FieldLimitCnt 
	        	, BU.FieldAlign
	        	, BU.IsList
	        	, BU.IsOption
	        	, IFNULL(BU.IsCheckVal, 'N') AS IsCheckVal 
	        	, BU.IsSearchItem
				, BU.FieldName
				, Fn_BaseGetDictionary_S(#{lang}, FieldName) AS DisplayName
				, BU.IsLabel
				, BU.Description
				, BU.IsTooltip
				, BU.IsDup
				, BU.DefVal
				, BU.FieldLimitMin
				, BU.FieldLimitMax
				, BU.FieldWidth
				, BU.FieldWidthUnit
				, BU.FieldHeight
				, BU.FieldHeightUnit
				, BU.FieldRow
				, BU.GotoLink
				, (SELECT COUNT(*) 
					FROM board_userform_option 
					WHERE UserFormID=BU.UserFormID
						AND FolderID=#{folderID}
				) AS OptionCnt 
				, (SELECT GROUP_CONCAT(CONCAT(bup.OptionID,'^',	Fn_BaseGetDictionary_S(#{lang}, bup.OptionName),'^',bup.OptionValue,'^',bup.OptionCheck ) SEPARATOR '|')
					FROM board_userform_option bup
					WHERE UserFormID=BU.UserFormID
						AND FolderID=#{folderID}
					ORDER BY bup.SortKey
				) AS OptionList
		FROM board_userform AS BU
		WHERE 1=1
		AND BU.FolderID=#{folderID}
		AND BU.DeleteDate IS NULL 
		) AS RESULT
		ORDER BY SortKey ASC
    </select>
    
     <select id="selectUserDefFormGridCount" resultType="java.lang.Long">
        SELECT COUNT(*) FROM (
	        SELECT  BU.UserFormID
				FROM board_userform AS BU
				WHERE 1=1
			AND BU.FolderID=#{folderID}
			AND BU.DeleteDate IS NULL 
		) AS RESULT
    </select>
    
     <!-- 사용자 정의 필드 옵션 -->
     <select id="selectUserDefFieldOptionList" parameterType="cmap" resultType="cmap">
        SELECT
        	OptionID
        	,UserFormID
        	,FolderID
        	,SortKey
        	,OptionName
        	,OptionValue
        FROM board_userform_option
        WHERE 1=1
        AND UserFormID = #{userFormID}
        AND FolderID = #{folderID}
    </select>
    
    <!-- 순서변경용 sortkey 조회 -->
    <select id="selectTargetUserDefFieldSortKey" parameterType="cmap" resultType="cmap">
        SELECT
        	UserFormID
        	,SortKey
        FROM board_userform
        WHERE 1=1
        <choose>
		    <when test="mode == 'up'">
				AND FolderID = #{folderID}
				AND SortKey &lt; #{orgSortKey} 
				AND DeleteDate IS NULL
				ORDER BY SortKey DESC
		    </when>
		    <otherwise>
		       AND FolderID = #{folderID}
				AND SortKey &gt; #{orgSortKey} 
				AND DeleteDate IS NULL
				ORDER BY SortKey ASC
		    </otherwise>		  
	    </choose>
	    LIMIT 1
    </select>
    
    <!-- 사용자 정의 필드 추가 -->
    <insert id="createUserDefField" parameterType="cmap">
        INSERT INTO board_userform
		(FolderID, SortKey, FieldName, FieldType, FieldSize, FieldLimitCnt, IsList, IsOption, IsCheckVal, IsSearchItem)
			VALUES
		(#{folderID}, #{sortKey}, #{fieldName}, #{fieldType}, #{fieldSize}, #{fieldLimitCnt}, #{isList}, #{isOption}, #{isCheckVal}, #{isSearchItem})
		<selectKey keyProperty="userFormID" resultType="long" order="AFTER">
			SELECT LAST_INSERT_ID();
        </selectKey>
    </insert>
     
    <!-- 사용자 정의 필드 옵션 추가 -->
    <insert id="createUserDefFieldOption" parameterType="cmap">
		INSERT INTO board_userform_option (UserFormID, FolderID, SortKey, OptionName, OptionValue, OptionCheck)
		VALUES 
		(#{userFormID}, #{folderID}, #{sortKey}, #{optionName}, #{optionValue}, #{optionCheck})
    </insert>
    
    <!-- 사용자 정의 필드 수정 -->
    <update id="updateUserDefField" parameterType="cmap">
        UPDATE board_userform
        SET
        	FieldName = #{fieldName}
        	,FieldType = #{fieldType}
        	,FieldSize = #{fieldSize}
        	,FieldLimitCnt = #{fieldLimitCnt}
        	,IsList = #{isList}
        	,IsOption = #{isOption}
        	,IsCheckVal = #{isCheckVal}
        	,isSearchItem = #{isSearchItem}
        WHERE 1=1
        AND UserFormID = #{userFormID}
    </update>
    
    <!-- 사용자 정의 필드 순서 수정 -->
    <update id="updateUserDefFieldSortKey" parameterType="cmap">
        UPDATE board_userform
        SET
        	SortKey = #{sortKey}
        WHERE UserFormID = #{userFormID}
    </update>
    
    <!-- 사용자 정의 필드 리스트 여부 저장 -->
    <update id="updateUserDefFieldIsList" parameterType="cmap">
        UPDATE board_userform
        SET
        	IsList = #{isList}
        WHERE UserFormID = #{userFormID}
    </update>

    <!-- 사용자 정의 필드 정보 삭제 -->
     <update id="deleteUserDefField" parameterType="cmap">
        UPDATE board_userform 
        SET
        	DeleteDate = now(3)
        WHERE UserFormID IN
        <foreach item="item" index="index" collection="userFormIDs" open="(" close=")" separator=",">
            #{item}
    	</foreach>
    </update>
    
     <!-- 사용자 정의 필드 옵션 삭제 -->
    <delete id="deleteUserDefFieldOption" parameterType="cmap">
        DELETE FROM board_userform_option
        WHERE 1=1
        <choose>
		    <when test="optionID != null and optionID != ''">
		        AND OptionID = #{optionID}
		    </when>
		    <when test="userFormIDs != null and userFormIDs != ''">
		        AND UserFormID IN
		        <foreach item="item" index="index" collection="userFormIDs" open="(" close=")" separator=",">
		            #{item}
		    	</foreach>
		    </when>
		    <otherwise>
		        AND UserFormID = #{userFormID}
		        AND FolderID = #{folderID}
		    </otherwise>		  
	    </choose>
    </delete>
    
    <!-- 삭제되는 필드는 게시글에서 설정한 필드의 value도 삭제  -->
    <delete id="deleteBoardMessageUserFormValue" parameterType="cmap">
		DELETE FROM board_message_userform_value 
		WHERE FolderID = #{folderID}
    </delete>
    
    <!-- 진행 상태 조회 -->
    <select id="selectProgressStateList" parameterType="cmap" resultType="cmap">
        SELECT	CONCAT( StateID, '|', DisplayName ) AS optionValue
			,Fn_BaseGetDictionary_S(#{lang}, DisplayName) AS optionText
		FROM board_progressstate
		WHERE FolderID = #{folderID}
		ORDER BY SortKey ASC
    </select>
    
    <!-- 진행상태 추가 -->
    <insert id="createProgressState" parameterType="cmap">
        INSERT INTO board_progressstate(FolderID, DisplayName, SortKey)
        VALUE (#{folderID}, #{displayName}, #{sortKey})
    </insert>
    
    <!-- 진행상태 수정 -->
    <update id="updateProgressState" parameterType="cmap">
        UPDATE board_progressstate
        SET
        	DisplayName = #{displayName}
        WHERE 1=1
        AND StateID = #{stateID}
    </update>
    
    <delete id="deleteProgressState" parameterType="cmap">
        DELETE FROM board_progressstate 
        WHERE 1=1
        AND FolderID = #{folderID} 
        AND StateID = #{stateID}
    </delete>
    <!-- CHECK: 진행상태 삭제시 이전의 진행상태의 ID를 사용중인 게시물이 존재한다면 다른 stateID값으로 치환해주는 작업 필요한지 확인 -->
    
    <select id="selectBodyForm" parameterType="cmap" resultType="cmap">
        SELECT BodyFormID
        	,FormPath
        	,FormName
        	,IsInit
        FROM board_bodyform
        WHERE 1=1
        AND FolderID = #{folderID}
    </select>
    
    <insert id="createBodyForm" parameterType="cmap">
        INSERT INTO board_bodyform(FolderID, FormPath, FormName, IsInit, FileID)
        VALUES(#{folderID}, #{formPath}, #{formName}, 'N', #{fileId})
    </insert>
    
    <delete id="deleteBodyForm" parameterType="cmap">
        DELETE FROM board_bodyform
        WHERE 1=1
        AND BodyFormID = #{bodyFormID}
    </delete>
    
    <!-- Param으로 들어온 BodyFormID의 IsInit을 Y -->
    <update id="updateBodyFormInit" parameterType="cmap">
        UPDATE board_bodyform
        SET
        	IsInit = 'Y'
        WHERE 1=1
        AND BodyFormID = #{bodyFormID}
        AND folderID = #{folderID}
    </update>
     <!-- Param으로 들어온 BodyFormID외의 양식정보를 N -->
    <update id="updateBodyFormInitN" parameterType="cmap">
        UPDATE board_bodyform
        SET
        	IsInit = 'N'
        WHERE 1=1
        AND BodyFormID != #{bodyFormID}
        AND folderID = #{folderID}
    </update>
    
	<!-- 폴더 붙여넣기 -->
	<!-- 붙여넣을 폴더의 SortKey 정보 조회 -->
	<select id="selectTargetFolderSortKey" parameterType="cmap" resultType="cmap">
		SELECT IFNULL(MAX(SortKey), 0) + 1 AS SortKey
		FROM sys_object_folder
		WHERE MemberOf = #{targetFolderID}
	</select>
	
	<update id="updateOrginalFolder" parameterType="cmap">
		UPDATE sys_object_folder
		SET	  MenuID = #{targetMenuID}
			, MemberOf = #{targetFolderID}
			, sortKey = #{sortKey}
			, sortPath = #{sortPath}
			, folderPath = #{folderPath}
		WHERE FolderID = #{orgFolderID}
	</update>
	
	<!-- 하위폴더 경로정보 업데이트 -->
	<update id="updateLowerFolder" parameterType="cmap">
		UPDATE sys_object_folder 
		SET	  MenuID = #{targetMenuID}
			, SortKey = (SELECT * FROM (SELECT IFNULL(MAX(SortKey), 0) + 1 FROM covi_smart4j.sys_object_folder WHERE MemberOf = FolderID) A)
			, SortPath = Fn_ComSortPathCreate_S(FolderID, '', 'FD')
			, FolderPath = Fn_ComObjectPathCreate_S(FolderID, '', 'FD')
		WHERE FolderID IN
		<foreach collection="folderIDArr" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</update>
 	
    <!-- 폴더 삭제시 현재 사용중인 파일 용량 수정 -->
    <update id="updateCurrentFileSizeByFolder" parameterType="cmap">
        UPDATE board_config 
			SET 
			CurrentTotalFileSize = IFNULL(CurrentTotalFileSize, 0) - ( 
				SELECT 
					SUM(Size) 
				FROM sys_file AS CF
				INNER JOIN board_message AS BM ON (CF.MessageID = BM.MessageID)
				WHERE BM.FolderID = board_config.FolderID 
			) 
		WHERE FolderID = #{folderID}
    </update>
    
    <!-- 승인 프로세스 CRUD -->
    <select id="selectProcessTarget" parameterType="cmap" resultType="cmap">
        SELECT ProcessID
        FROM sys_process_target
        WHERE 1=1
        AND ObjectType = 'FD'
        AND ObjectID = #{folderID}
    </select>
    
    <!-- 승인 프로세스 행위 정의 데이터 표시 -->
    <select id="selectProcessPerformerList" parameterType="cmap" resultType="cmap">
        SELECT PerformerID, 
        	ProcessID, 
        	ActorCode, 
        	ActorRole, 
        	ActivityType, 
        	Step, 
        	SubStep 
        	,(SELECT Fn_BaseGetDictionary_S(#{lang},MultiDisplayName) FROM sys_object_user WHERE UserCode = A.ActorCode) AS DisplayName
        	,(SELECT GROUP_CONCAT(Fn_BaseGetDictionary_S(#{lang},MultiDeptName) SEPARATOR ',') FROM sys_object_user_basegroup WHERE UserCode = A.ActorCode) AS DeptName
        FROM sys_process_performer AS A
		WHERE 1=1
		AND ProcessID = #{processID}
	 	ORDER BY Step, SubStep ASC	<!-- 결재선 순서대로  -->
<!-- 		AND ProcessID = (SELECT ProcessID  -->
<!-- 			FROM com_process_def  -->
<!-- 			WHERE objecttype='FD'  -->
<!-- 			AND objectid = #{folderID} -->
<!-- 		) -->
    </select>
    
    <insert id="createProcessDef" parameterType="cmap" >
        INSERT INTO sys_process_target(ObjectID, ObjectType, ActivityCnt, IsUse, DisplayName, Description, RegisterCode)
        VALUES(#{objectID}, #{objectType}, #{activityCnt}, 'Y', #{displayName}, #{displayName}, #{userCode})
        <selectKey keyProperty="processID" resultType="long" order="AFTER">
			SELECT LAST_INSERT_ID();
        </selectKey>
    </insert>
    
    <update id="updateProcessDef" parameterType="cmap" >
        UPDATE sys_process_target 
        SET
        	ActivityCnt = #{activityCnt}
        	,ModifierCode = #{userCode}
     	WHERE ProcessID = #{processID} 
    </update>
    
    <delete id="deleteProcessDef" parameterType="cmap">
        DELETE FROM sys_process_target
        WHERE ProcessID = #{processID}
    </delete>
    
    <!-- 승인 프로세스 행위 정의 테이블 추가/삭제 -->
    <insert id="createProcessActivityDef" parameterType="cmap">
        INSERT INTO sys_process_performer(ProcessID, ActorCode, ActorRole,ActivityType, Step, SubStep, DisplayName, RegisterCode)
        VALUES(#{processID}, #{actorCode}, #{actorRole}, #{activityType}, #{step}, #{subStep}, (SELECT MultiDisplayName FROM sys_object_user WHERE UserCode = #{actorCode}), #{userCode})
    </insert>
    
    <delete id="deleteProcessActivityDef" parameterType="cmap">
        DELETE FROM sys_process_performer
        WHERE ProcessID = #{processID}
    </delete>
    
    <!-- 소유자, 담당부서 변경 -->
    <update id="changeDocInfo" parameterType="cmap">
        UPDATE board_message SET
        	<choose>
        	    <when test="ownerCode != null and ownerCode != '' and registDept != null and registDept != ''">
        	        OwnerCode = #{ownerCode}
        			,RegistDept = #{registDept}
        	    </when>
        	    <otherwise>
        	        <if test="ownerCode != null and ownerCode != ''">
					 	 OwnerCode = #{ownerCode}
					</if>
					<if test="registDept != null and registDept != ''">
					 	 RegistDept = #{registDept}
					</if>
        	    </otherwise>
        	</choose>
        WHERE 1=1
  		AND MessageID IN 
		<foreach item="item" index="index" collection="messageID" open="(" close=")" separator=",">
			#{item}
		</foreach>
    </update>
    
    <!-- 문서번호 표시, 사용 여부 업데이트 -->
 	<update id="updateDocNumberFlag" parameterType="cmap">
 	    UPDATE doc_number_mgr 
		SET IsUse = #{flagValue}
		WHERE ManagerID=#{managerID}
 	</update>
 	
 	<insert id="createDocNumber" parameterType="cmap">
 	    <selectKey keyProperty="NextSeq" resultType="String" order="BEFORE">
			SELECT IFNULL(MAX(Seq), 0) + 1 AS NextSeq FROM covi_smart4j.doc_number_mgr WHERE DomainID = #{domainID}
		</selectKey>
 	    INSERT INTO covi_smart4j.doc_number_mgr
 	    	(DomainID, Seq, FieldType, FieldLength, LanguageCode, `Separator`, IsUse)
 	    VALUES 
 	    	(#{domainID}, #{NextSeq}, #{fieldType}, #{fieldLength}, #{languageCode}, #{separator}, #{isUse})
 	</insert>
 	
 	<update id="updateDocNumber" parameterType="cmap">
 	    UPDATE doc_number_mgr SET
 	    	DomainID = #{domainID}
 	    	,Seq = #{seq}
 	    	,FieldType = #{fieldType}
 	    	,FieldLength = #{fieldLength}
 	    	,LanguageCode = #{languageCode}
 	    	,`Separator` = #{separator}
 	    	,IsUse = #{isUse}
 	    WHERE 1=1
 	    AND ManagerID = #{managerID}
 	</update>
 	
 	<delete id="deleteDocNumber" parameterType="cmap">
 	    DELETE FROM doc_number_mgr 
 	    WHERE ManagerID IN
 	    <foreach item="item" index="index" collection="managerID" open="(" close=")" separator=",">
            #{item}
    	</foreach>
 	</delete>
 	
 	<!-- base code 목록 조회 -->
 	<select id="selectBaseCodeList"  parameterType="cmap" resultType="cmap">
		SELECT    Code AS optionValue
			 	, Codename AS optionText
		FROM sys_base_code sbc
		WHERE 1=1
		AND CodeGroup = #{codeGroup}
		AND Code !=  #{codeGroup}
		AND IsUse = 'Y'
		AND DomainID = (SELECT DomainID FROM covi_smart4j.sys_base_code WHERE CodeGroup = #{codeGroup} AND Code = sbc.Code ORDER BY IF(DomainID = #{domainID}, 0, 1) LIMIT 1 )
		ORDER BY SortKey ASC
   </select>
   
 	<select id="selectDocNumberInfo" parameterType="cmap" resultType="cmap">
        SELECT ManagerID, DomainID, Seq, FieldType, FieldLength, LanguageCode, `Separator`, IsUse, CreateDate, DeleteDate
        FROM doc_number_mgr
        WHERE 1=1
        AND ManagerID = #{managerID}
    </select>
    
 	<select id="selectCommunityList" parameterType="cmap" resultType="cmap">
 	    SELECT   CommunityName AS optionText
			   , CU_ID AS optionValue 
		FROM community 
		WHERE 1=1 
 	    AND CU_ID = #{communityID}
 	</select>
 	
 	<select id="selectCommunityFolderTypeList" parameterType="cmap" resultType="cmap">
		SELECT DISTINCT optionText, optionValue
		FROM (
		    	SELECT 
		 	    	   DisplayName AS optionText
		 	    	 , FolderType AS optionValue
		 	    	 , '0' AS Sort
					 , SortKey 
				FROM sys_object_folder_type 
				WHERE 1=1
				AND IsUse = 'Y'
				AND BizSection IN ('Board', 'Common')
				AND FolderType IN ('Root','Folder')
			
				UNION ALL 
				
				SELECT  soft.DisplayName AS optionText 
					   , cbd.FolderType As optionValue
					   , '1' AS Sort
					   , cbd.SortKey 
				FROM community_board_default AS cbd 
				INNER JOIN community AS c ON c.DefaultBoardType = cbd.CommunityType AND (cbd.DN_ID = 0 OR cbd.DN_ID = c.DN_ID)  
				INNER JOIN sys_object_folder_type AS soft ON cbd.FolderType =  soft.FolderType AND BizSection = 'Community'
				WHERE 1=1
				AND c.CU_ID = #{communityID}   
				AND cbd.FolderType != 'Schedule'
		)A
		ORDER BY Sort ASC, SortKey ASC  
 	</select>
 	<select id="selectCommunityNotRootFolderTypeList" parameterType="cmap" resultType="cmap">
		SELECT DISTINCT optionText, optionValue
		FROM (
		     	SELECT  DisplayName AS optionText
		 	    	 , FolderType AS optionValue
		 	    	 , '0' AS Sort
					 , SortKey 
				FROM sys_object_folder_type 
				WHERE 1=1
				AND IsUse = 'Y'
				AND BizSection IN ('Board', 'Common')
				AND FolderType = 'Folder'
			
				UNION ALL 
				
				SELECT  soft.DisplayName AS optionText 
					   , cbd.FolderType As optionValue
					   , '1' AS Sort
					   , cbd.SortKey 
				FROM community_board_default AS cbd 
				INNER JOIN community AS c ON c.DefaultBoardType = cbd.CommunityType AND (cbd.DN_ID = 0 OR cbd.DN_ID = c.DN_ID)  
				INNER JOIN sys_object_folder_type AS soft ON cbd.FolderType =  soft.FolderType AND BizSection = 'Community'
				WHERE 1=1
				AND c.CU_ID = #{communityID}   
				AND cbd.FolderType != 'Schedule'
		)A
		ORDER BY Sort ASC, SortKey ASC  
 	</select>
 	
 	<select id="selectCommunityMenuTopCount"  parameterType="cmap" resultType="java.lang.Long">
	    SELECT COUNT(*) 
	    FROM community_menu_top
	    WHERE 1=1
	    AND CU_ID = #{communityID}
	    AND FD_ID = #{folderID}
	    AND SortKey = 0
	</select>
	
	<insert id="createCommunityMenuTop" parameterType="cmap">
		INSERT INTO community_menu_top(CU_ID, FD_ID, SortKey)
		SELECT	  #{communityID}
				, #{folderID}
				, IFNULL(MAX(SortKey), -1) + 1
		FROM community_menu_top
		WHERE CU_ID = #{CU_ID}
	</insert>
	
	<select id="selectFieldLangInfos" parameterType="cmap" resultType="cmap">
        /* queryID = admin.board.selectFieldLangInfos */
        SELECT  IFNULL( Fn_BaseGetDictionary_S(#{compLang}, T3.MultiDisplayName), T3.DisplayName) AS compNm
                , IFNULL( Fn_BaseGetDictionary_S(#{compSnmLang}, T3.MultiShortName), T3.ShortName) AS compSnm
                , IFNULL( Fn_BaseGetDictionary_S(#{deptNmLang}, T2.MultiDisplayName), T2.DisplayName ) AS deptNm
                , IFNULL(Fn_BaseGetDictionary_S(#{deptSnmLang}, T2.MultiShortName), T2.ShortName) AS deptSnm 
                , ( SELECT  MAX(IFNULL(FN_BASEGETDICTIONARY_S(#{cateNmLang}, MultiDisplayName), DisplayName ))
                    FROM    SYS_OBJECT_FOLDER
                    WHERE   DomainID = #{DN_ID}
                    AND ObjectType = 'Doc' AND IsUse = 'Y' AND DeleteDate IS NULL AND FolderType = 'Root') AS folderNm
        FROM    SYS_OBJECT_USER_BASEGROUP T1
                INNER JOIN SYS_OBJECT_GROUP T2 ON T2.GROUPCODE = #{DEPTID} AND T2.COMPANYCODE = #{DN_Code}
                INNER JOIN SYS_OBJECT_DOMAIN T3 ON T3.DOMAINCODE = #{DN_Code}
        WHERE   1=1
        AND     T1.USERCODE = #{USERID}
        AND     T1.DEPTCODE = #{DEPTID}
    </select>
    
    <update id="updateExpiredDay" parameterType="cmap">
        UPDATE board_message
        <choose>
		    <when test="expireDay != null and expireDay != '' and expireDay != 0 ">
				SET ExpiredDate = DATE_ADD(RegistDate, INTERVAL #{expireDay} DAY)
		    </when>
		    <otherwise>
				SET ExpiredDate = DEFAULT
		    </otherwise>		  
	    </choose>
		WHERE FolderID = #{folderID}
		AND ExpiredDate <![CDATA[>]]> now()
    </update>
    
    <update id="updateFieldSeq" parameterType="cmap">
        /* queryID = admin.board.updateFieldSeq */
        UPDATE  DOC_NUMBER_MGR
        SET     SEQ = #{Seq}
        WHERE   MANAGERID = #{ManagerID}
        AND     DOMAINID = #{DomainID}
        AND     FIELDTYPE = #{FieldType}
    </update>
    
    <select id="selectPrevNextField" parameterType="cmap" resultType="cmap">
        /* queryID = admin.board.selectPrevNextField */
        SELECT  *
		FROM 	doc_number_mgr
		WHERE   DomainID = #{DomainID}
		<choose>
			<when test="Status == 'DOWN'">AND Seq <![CDATA[>]]> #{Seq}</when>
			<when test="Status == 'UP'">AND Seq <![CDATA[<]]> #{Seq}</when>
		</choose>
        ORDER BY Seq <if test="Status == 'UP'"> DESC</if>
        LIMIT 1
    </select>
	
	<select id="selectInheritedACLList" parameterType="cmap" resultType="cmap">
		SELECT *
		FROM (
			SELECT	  FolderID AS objectID
					, FolderID AS folderID
					, MemberOf AS memberOf
					, CONCAT(';', FolderPath) AS FolderPath
			FROM sys_object_folder
			WHERE DomainID = #{domainID}
		) A
		WHERE FolderPath LIKE CONCAT('%;', #{folderID}, ';%')
	</select>
	
	<update id="updateCategoryManager" parameterType="cmap">
 	    UPDATE board_category 
		   SET ManagerCode = #{categoryManagerCode}
		 WHERE CategoryID = #{categoryID}
 	</update>
</mapper>
