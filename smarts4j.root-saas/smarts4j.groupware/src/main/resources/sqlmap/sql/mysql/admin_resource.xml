<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="admin.resource">
    <!--장비 목록 조회  -->
    <select id="selectEquipmentList" parameterType="cmap" resultType="cmap">
			<![CDATA[
					SELECT a.EquipmentID
							, a.MultiEquipmentName
							, a.IconPath
							, a.IsUse
							, a.SortKey
							, b.MultiDisplayName AS MultiRegisterName 
							, DATE_FORMAT(a.RegistDate,'%Y-%m-%d %H:%i:%s') AS RegistDate
							, c.DomainCode AS CompanyCode
					FROM covi_smart4j.resource_equipment AS a
					LEFT JOIN covi_smart4j.sys_object_user AS b ON a.RegisterCode = b.UserCode 
					LEFT JOIN covi_smart4j.sys_object_domain AS c ON a.DN_ID = c.DomainID
			]]>
			<trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
					<choose>
					    <when test="searchType == 'MultiEquipmentName'">
					      AND a.MultiEquipmentName LIKE CONCAT('%',#{searchWord},'%')
					    </when>
					    <when test="searchType == 'MultiRegisterName'">
					     AND  b.MultiDisplayName LIKE CONCAT('%',#{searchWord},'%')
					    </when>
				    </choose>
				</if>
				<if test="domainID != null and domainID !=''">
				    AND a.DN_ID = #{domainID}
				</if>
			</trim>
		    <!-- Order by 절 -->
		    <trim prefix="ORDER BY"  prefixOverrides =",">
				<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
					a.SortKey ASC
				 </if>
				<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
					<choose>
						<when test='sortColumn.equalsIgnoreCase("IconPath")'>IconPath</when>
						<when test='sortColumn.equalsIgnoreCase("MultiEquipmentName")'>MultiEquipmentName</when>
						<when test='sortColumn.equalsIgnoreCase("SortKey")'>SortKey</when>
						<when test='sortColumn.equalsIgnoreCase("IsUse")'>IsUse</when>
						<when test='sortColumn.equalsIgnoreCase("MultiRegisterName")'>MultiRegisterName</when>
						<otherwise>RegistDate</otherwise>
					</choose>
					<choose>
						<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
						<otherwise> DESC</otherwise>
					</choose>
				</if>
			</trim>
		    <if test="pageSize != null and pageOffset != null ">
		   		LIMIT #{pageSize} OFFSET #{pageOffset}
		   	</if>
	</select>
	
    
     <!--장비 목록 개수 조회  -->
    <select id="selectEquipmentListCnt" parameterType="cmap" resultType="java.lang.Long">
		   <![CDATA[
					SELECT COUNT(*)
					FROM covi_smart4j.resource_equipment AS a
					LEFT JOIN covi_smart4j.sys_object_user AS b ON a.RegisterCode = b.UserCode 
			]]>
			<trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
					<choose>
					    <when test="searchType == 'MultiEquipmentName'">
					      AND a.MultiEquipmentName LIKE CONCAT('%',#{searchWord},'%')
					    </when>
					    <when test="searchType == 'MultiRegisterName'">
					     AND  b.MultiDisplayName LIKE CONCAT('%',#{searchWord},'%')
					    </when>
				    </choose>
				</if>
				<if test="domainID != null and domainID !=''">
				    AND a.DN_ID = #{domainID}
				</if>
			</trim>
	</select>
	
    <!-- 장비 사용여부 변경  -->
    <update id="updateEquipmentIsUse"  parameterType="cmap">
        UPDATE covi_smart4j.resource_equipment AS b
		SET b.IsUse = (SELECT * FROM (SELECT (CASE a.IsUse WHEN 'Y' THEN 'N'
								WHEN 'N' THEN 'Y' END)
								FROM covi_smart4j.resource_equipment AS a
								WHERE a.EquipmentID =  #{equipmentID}) AS temp )
		WHERE b.EquipmentID = #{equipmentID}
    </update>
    
    
    <!-- 장비 삭제  -->
    <delete id="deleteEquipmentData" parameterType="cmap">
	    	DELETE FROM covi_smart4j.resource_equipment_def
			WHERE EquipmentID IN 
			<foreach collection="equipmentIDArr" item="item" index="index" separator="," open="(" close=");">
				#{item}
		   </foreach>
				
			DELETE FROM covi_smart4j.resource_equipment
			WHERE EquipmentID IN
			<foreach item="item" index="index" collection="equipmentIDArr" open="(" close=");" separator=",">
           		#{item}
    		</foreach>
    </delete>
    
    <!-- 장비 추가 -->
    <insert id="insertEquipmentData" parameterType="cmap">
        INSERT INTO resource_equipment(DN_ID, MultiEquipmentName,IconPath, IsUse, SortKey, RegisterCode, RegistDate)
		VALUES(#{domainID}, #{equipmentName},#{equipmentThumbnail},#{isUse},#{sortKey},#{userID},now(3));
    </insert>
    
    <!-- 장비 정보 수정-->
    <update id="updateEquipmentData" parameterType="cmap">
        UPDATE resource_equipment
        SET	DN_ID = #{domainID}
       	  , MultiEquipmentName = #{equipmentName}
		  , SortKey = #{sortKey}
		  , IsUse = #{isUse}
       	<if test="equipmentThumbnail != null">
			, IconPath = #{equipmentThumbnail}
		</if>
        WHERE EquipmentID = #{equipmentID}
    </update>
    
     <!-- 특정 장비 정보 조회-->
    <select id = "selectEquipmentData" parameterType="cmap" resultType ="cmap">
		SELECT a.DN_ID, a.MultiEquipmentName, a.IconPath, a.IsUse, a.SortKey, b.DomainCode AS CompanyCode
		FROM covi_smart4j.resource_equipment AS a
		LEFT JOIN covi_smart4j.sys_object_domain AS b ON a.DN_ID = b.DomainID
		WHERE EquipmentID = #{equipmentID}
    </select>
    
     <!-- 메인 화면 자원 관리 목록 조회-->
    <select id = "selectMainResourceData" parameterType="cmap" resultType ="cmap">
		SELECT a.FolderID, c.MultiDisplayName, b.MultiDisplayName, b.FolderPath, a.SortKey, a.RegisterCode, d.MultiDisplayName
		FROM resource_front AS a
		INNER JOIN sys_object_folder AS b ON a.FolderID = b.FolderID
		INNER JOIN sys_object_domain AS c ON b.DomainID = c.DomainID
		LEFT JOIN sys_object_user AS d ON a.RegisterCode = d.UserCode
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			 	AND a.IsDefault = 'Y'
			<if test="domainID != null and domainID !=''">
				 AND c.DomainID = #{domainID}
			</if>
		</trim>
    </select>
    
     <!-- 메인 화면 자원 관리 목록 조회-->
    <select id = "selectMainResourceList" parameterType="cmap" resultType ="cmap">
		<![CDATA[
	          SELECT a.FolderID
					, c.MultiDisplayName AS DomainName
					, IFNULL(b.MultiDisplayName, b.DisplayName) AS ResourceName
					, Fn_FolderPathByLangGet_S(#{lang},LEFT(b.FolderPath,LENGTH(b.FolderPath)-1)) AS FolderPath
					, a.SortKey
					, d.MultiDisplayName AS RegisterName
					, DATE_FORMAT(a.RegistDate,'%Y-%m-%d %H:%i:%s') AS RegistDate
			FROM resource_front AS a
			INNER JOIN sys_object_folder AS b ON a.FolderID = b.FolderID
			INNER JOIN sys_object_domain AS c ON b.DomainID = c.DomainID
			LEFT JOIN sys_object_user AS d ON a.RegisterCode = d.UserCode
		]]>
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			 	AND a.IsDefault = 'Y'
			<if test="domainID != null and domainID !=''">
				 AND c.DomainID = #{domainID}
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				a.SortKey ASC
			 </if>
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("DomainName")'>DomainName</when>
					<when test='sortColumn.equalsIgnoreCase("ResourceName")'>ResourceName</when>
					<when test='sortColumn.equalsIgnoreCase("FolderPath")'>FolderPath</when>
					<when test='sortColumn.equalsIgnoreCase("SortKey")'>SortKey</when>
					<when test='sortColumn.equalsIgnoreCase("RegisterName")'>RegisterName</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
					<otherwise>FolderID</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
    </select>
    
    
     <!-- 메인 화면 자원 관리 목록 조회-->
    <select id = "selectMainResourceListCnt" parameterType="cmap" resultType ="java.lang.Long">
		<![CDATA[
	        SELECT COUNT(*)
			FROM resource_front AS a
			INNER JOIN sys_object_folder AS b ON a.FolderID = b.FolderID
			INNER JOIN sys_object_domain AS c ON b.DomainID = c.DomainID
			LEFT JOIN sys_object_user AS d ON a.RegisterCode = d.UserCode
		]]>
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			 	AND a.IsDefault = 'Y'
			<if test="domainID != null and domainID !=''">
				 AND c.DomainID = #{domainID}
			</if>
		</trim>
    </select>
    
    
     <!--  자원 목록 조회-->
    <select id = "selectResourceList" parameterType="cmap" resultType="cmap">
		/* queryID : admin.resource.selectResourceList */
		<![CDATA[
			SELECT	  a.FolderID
					, a.FolderType
					, a.DomainID
					, ( CASE WHEN (a.LinkFolderID IS NULL) THEN (IFNULL(a.MultiDisplayName, a.DisplayName))
						ELSE (CONCAT('[',Fn_GetSelDictionary(#{lang}, 'lbl_sharing', 0),'] ', Fn_BaseGetDictionary_S(#{lang},IFNULL(a.MultiDisplayName, a.DisplayName))))
						END ) AS MultiDisplayName
					, REPLACE(Fn_FolderPathByLangGet_S(#{lang}, CONCAT(a.FolderPath, a.FolderID)), ';', ' > ') AS FolderPath
					, a.MemberOf
					, a.SortKey
					, a.SortPath
					, IFNULL(b.IconCode, '') AS IconCode
					, IFNULL((SELECT MAX(FolderID) FROM sys_object_folder as sof WHERE sof.DomainID = a.DomainID AND sof.MenuID = a.MenuID AND sof.FolderType ='Root' AND sof.ObjectType IS NULL), '0') AS maxFolderID
					, (CASE WHEN (a.LinkFolderID IS NULL) THEN Fn_BaseGetDictionary_S(#{lang}, IFNULL(a.MultiDisplayName, a.DisplayName)) 
						ELSE (CONCAT('[',Fn_GetSelDictionary(#{lang}, 'lbl_sharing', 0),'] ', Fn_BaseGetDictionary_S(#{lang},IFNULL(a.MultiDisplayName, a.DisplayName))))
                        END
                    ) AS FolderName
					, Fn_GetBaseCodeName(0, 'BookingType', CASE A.Reserved2 WHEN 'Y' THEN 'Inherited' ELSE b.BookingType END) AS BookingType
					, Fn_GetBaseCodeName(0, 'ReturnType', CASE A.Reserved2 WHEN 'Y' THEN 'Inherited' ELSE b.ReturnType END) AS ReturnType
					, a.IsDisplay
					, a.IsUse
					, Fn_BaseGetDictionary_S(#{lang}, f.MultiDisplayName) AS RegisterName
					, DATE_FORMAT(a.RegistDate, '%Y-%m-%d %H:%i:%s') AS RegistDate
					, A.Reserved1 AS PlaceOfBusiness
			FROM covi_smart4j.sys_object_folder AS a 
			LEFT JOIN covi_smart4j.resource AS b ON a.FolderID = b.FolderID
			LEFT JOIN sys_object_user AS f ON a.RegisterCode = f.UserCode
			WHERE a.DeleteDate IS NULL
			AND ObjectType = 'Resource'
		]]>
		<if test="domainID != null and domainID !='' ">
		    AND a.DomainID = #{domainID}
		</if>
		<if test="selectType == 'Folder'">
		     AND a.FolderType IN ('Root', 'Folder')
		</if>
		<if test='isAll == "N"'>
    		AND a.IsUse = 'Y'
			AND a.IsDisplay = 'Y'
		</if>
		ORDER BY a.SortPath ASC, a.SortKey ASC
    </select>
    
    <delete id="deleteOldMainResource" parameterType="cmap">
		DELETE FROM covi_smart4j.resource_front
		WHERE IsDefault = 'Y'
		AND FolderID in (
			SELECT FolderID FROM covi_smart4j.sys_object_folder WHERE objectType = 'Resource' and DomainID = #{domainID}
		)
    </delete>
    
    <insert id="insertNewMainResource" parameterType="cmap">
        INSERT INTO covi_smart4j.resource_front(FolderID,SortKey,IsDefault,RegisterCode,RegistDate)
        <trim prefix="VALUES" prefixOverrides=",">
            <foreach collection="resourceIDArr" item="item" index="index">
				, (#{item}, #{index}, 'Y', #{userID}, now(3) )
		   </foreach>
        </trim>
    </insert>
    
    <update id="updateResourceSortKey" parameterType="cmap">
		UPDATE covi_smart4j.resource_front
		SET SortKey = #{sortKey2}
		WHERE IsDefault = 'Y' AND FolderID = #{folderID1};
		
		UPDATE covi_smart4j.resource_front
		SET SortKey = #{sortKey1}
		WHERE IsDefault = 'Y' AND FolderID = #{folderID2};
    </update>
    
    <select id="selectFolderInfo" parameterType="cmap" resultType="cmap">
    	/* queryID : admin.resource.selectFolderInfo */
        SELECT FolderType
      			, REPLACE( Fn_FolderPathByLangGet_S(#{lang},CONCAT(FolderPath, FolderID)), ';' ,  ' > ') AS FolderPath 
      			, Fn_BaseGetDictionary_S(#{lang},IFNULL(MultiDisplayName,DisplayName)) AS FolderName 
		FROM sys_object_folder where folderID = #{folderID}
    </select>
    
    <select id="selectResourceOfFolderList"  parameterType="cmap" resultType="cmap">
        /* queryID : admin.resource.selectResourceOfFolderList */
        SELECT a.FolderID
				, a.FolderType
				, a.Reserved1 AS PlaceOfBusiness
				, b.IconPath
				, CASE WHEN (a.LinkFolderID IS NOT NULL AND a.LinkFolderID != '') THEN CONCAT('[', Fn_GetSelDictionary(#{lang}, 'lbl_sharing', 0), '] ', Fn_BaseGetDictionary_S(#{lang},IFNULL(a.MultiDisplayName,a.DisplayName)))
                  ELSE Fn_BaseGetDictionary_S(#{lang},IFNULL(a.MultiDisplayName,a.DisplayName))
                  END AS FolderName
				, CASE A.Reserved2 WHEN 'Y' THEN 'Inherited' ELSE b.BookingType END AS BookingType
				, CASE A.Reserved2 WHEN 'Y' THEN 'Inherited' ELSE b.ReturnType END AS ReturnType
				, a.SortKey
				, a.IsDisplay
				, a.IsUse
				, Fn_BaseGetDictionary_S(#{lang},f.MultiDisplayName) AS RegisterName
				, DATE_FORMAT(a.RegistDate,'%Y-%m-%d %H:%i:%s') AS RegistDate
				, a.LinkFolderID
		FROM sys_object_folder as a 
		LEFT JOIN resource AS b ON a.FolderID = b.FolderID
		LEFT JOIN sys_object_user AS f ON a.RegisterCode = f.UserCode
		WHERE (a.MemberOf IS NOT NULL) AND a.MemberOf != 0 AND  a.MemberOf = #{folderID} AND a.DeleteDate IS NULL
        <!-- Order by 절 -->
        <trim prefix="ORDER BY"  prefixOverrides =",">
			<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				a.SortKey ASC
			</if>
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("FolderType")'>FolderType</when>
					<when test='sortColumn.equalsIgnoreCase("PlaceOfBusiness")'>PlaceOfBusiness</when>
					<when test='sortColumn.equalsIgnoreCase("FolderName")'>FolderName</when>
					<when test='sortColumn.equalsIgnoreCase("BookingType")'>BookingType</when>
					<when test='sortColumn.equalsIgnoreCase("ReturnType")'>ReturnType</when>
					<when test='sortColumn.equalsIgnoreCase("SortKey")'>SortKey</when>
					<when test='sortColumn.equalsIgnoreCase("IsDisplay")'>IsDisplay</when>
					<when test='sortColumn.equalsIgnoreCase("IsUse")'>IsUse</when>
					<when test='sortColumn.equalsIgnoreCase("RegisterName")'>RegisterName</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
					<otherwise>FolderID</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
    </select>
    
    <select id="selectResourceOfFolderListCnt"  parameterType="cmap" resultType="java.lang.Long">
        SELECT COUNT(*)
		FROM sys_object_folder as a 
		WHERE (a.MemberOf IS NOT NULL) AND a.MemberOf != 0 AND a.MemberOf = #{folderID} AND a.DeleteDate IS NULL
    </select>
    
    <select id="selectBookingOfResourceList" parameterType="cmap" resultType = "cmap">
        <![CDATA[
        SELECT a.EventID
					  ,a.DateID
					  ,a.FolderID
					  ,a.RepeatID
					  ,a.Subject
					  ,a.StartDateTime
					  ,a.EndDateTime
					  ,a.RegisterCode
					  ,Fn_BaseGetDictionary_S(#{lang},a.MultiDisplayName) AS RegisterName
					  ,a.RegistDate
					  ,IF(a.ReturnType = 'AutoReturn' AND a.EndDateTime < #{localCurrentDate} AND a.ApprovalState = 'Approval', 'ReturnComplete' , a.ApprovalState)   AS ApprovalState 
					  ,IF(a.ReturnType = 'AutoReturn' AND a.EndDateTime < #{localCurrentDate} AND a.ApprovalState = 'Approval', 'ReturnComplete' , a.ApprovalState)   AS ApprovalStateCode 
          FROM ( 
		        SELECT a.EventID
						  ,b.DateID
						  ,e.FolderID
						  ,b.RepeatID
						  ,a.Subject
						  ,b.StartDateTime
						  ,c.RealEndDateTime AS EndDateTime
						  ,a.RegisterCode
						  ,a.RegistDate
						  ,c.ApprovalState
						  ,g.MultiDisplayName
						  ,(SELECT ReturnType from covi_smart4j.resource AS f where f.FolderID = Fn_ResourceParentIDGet_S(IFNULL(e.LinkFolderID,e.FolderID))) ReturnType
				  FROM covi_smart4j.event AS a 
				  INNER JOIN covi_smart4j.event_date AS b ON a.EventID = b.EventID
				  LEFT JOIN covi_smart4j.event_resource_booking AS c ON b.DateID = c.DateID
				  LEFT JOIN covi_smart4j.event_relation AS d ON c.ResourceID = d.ResourceID AND a.EventID = d.ScheduleID
				  INNER JOIN covi_smart4j.sys_object_folder AS e ON c.ResourceID = e.FolderID
				  LEFT JOIN covi_smart4j.sys_object_user AS g ON a.RegisterCode = g.UserCode
				  WHERE ( (a.FolderType LIKE 'Resource%') OR (a.FolderType LIKE 'Schedule%' AND d.ResourceID IS NOT NULL) )
				  AND a.DeleteDate IS NULL
				  AND c.DeleteDate IS NULL
				  AND e.DeleteDate IS NULL
				  AND c.ResourceID = #{folderID}
	        ]]>
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    AND  (  (DATE_FORMAT(b.StartDateTime, '%Y%m%d') BETWEEN REPLACE(#{startDate},'-','') AND REPLACE(#{endDate},'-','') ) OR  (DATE_FORMAT(c.RealEndDateTime, '%Y%m%d') BETWEEN REPLACE(#{startDate},'-','') AND REPLACE(#{endDate},'-','') )  )
		  	 </if>
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose>
				    <when test="searchType == 'Description'">
				        AND a.Subject LIKE CONCAT('%',#{searchWord},'%')
				    </when>
				    <when test="searchType == 'RegisterName'">
				        AND Fn_BaseGetDictionary_S(#{lang},g.MultiDisplayName) LIKE CONCAT('%',#{searchWord},'%')
				    </when>
			    </choose>
			</if>
			) a
		<trim prefix="WHERE"  prefixOverrides ="AND |OR ">
		<if test="bookingState != null and bookingState !='' and !bookingState.equalsIgnoreCase('All')">
			<![CDATA[ IF(a.ReturnType = 'AutoReturn' AND a.EndDateTime < #{localCurrentDate} AND a.ApprovalState = 'Approval', 'ReturnComplete' , a.ApprovalState)  = #{bookingState} ]]>
		</if>
		</trim>
	    <!-- Order by 절 -->
	    <trim prefix="ORDER BY"  prefixOverrides =",">
			<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				a.RegistDate Desc
			</if>
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("DateID")'>DateID</when>
					<when test='sortColumn.equalsIgnoreCase("Subject")'>Subject</when>
					<when test='sortColumn.equalsIgnoreCase("StartDateTime")'>StartDateTime</when>
					<when test='sortColumn.equalsIgnoreCase("EndDateTime")'>EndDateTime</when>
					<when test='sortColumn.equalsIgnoreCase("ApprovalState")'>ApprovalState</when>
					<when test='sortColumn.equalsIgnoreCase("RegisterName")'>RegisterName</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
					<otherwise>EventID</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
    </select>
    
    <select id="selectBookingOfResourceListCnt" parameterType="cmap" resultType = "java.lang.Long">
     	   <![CDATA[
     	   SELECT COUNT(EventID)
     	    FROM (
		        SELECT a.EventID,c.RealEndDateTime AS EndDateTime, c.ApprovalState
		        		,(SELECT ReturnType from covi_smart4j.resource AS f where f.FolderID = Fn_ResourceParentIDGet_S(IFNULL(e.LinkFolderID,e.FolderID))) ReturnType
				  FROM covi_smart4j.event AS a 
				  INNER JOIN covi_smart4j.event_date AS b ON a.EventID = b.EventID
				  LEFT JOIN covi_smart4j.event_resource_booking AS c ON b.DateID = c.DateID
				  LEFT JOIN covi_smart4j.event_relation AS d ON c.ResourceID = d.ResourceID AND a.EventID = d.ScheduleID
				  INNER JOIN covi_smart4j.sys_object_folder AS e ON c.ResourceID = e.FolderID
				  LEFT JOIN covi_smart4j.resource AS f ON f.FolderID = Fn_ResourceParentIDGet_S(IFNULL(e.LinkFolderID,e.FolderID))
				  LEFT JOIN covi_smart4j.sys_object_user AS g ON a.RegisterCode = g.UserCode
				  WHERE ( (a.FolderType LIKE 'Resource%') OR (a.FolderType LIKE 'Schedule%' AND d.ResourceID IS NOT NULL) )
				  AND a.DeleteDate IS NULL
				  AND c.DeleteDate IS NULL
				  AND e.DeleteDate IS NULL
				  AND c.ResourceID = #{folderID}
		        ]]>
			  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
			  	    AND  (  (DATE_FORMAT(b.StartDateTime, '%Y%m%d') BETWEEN REPLACE(#{startDate},'-','') AND REPLACE(#{endDate},'-','') ) OR  (DATE_FORMAT(c.RealEndDateTime, '%Y%m%d') BETWEEN REPLACE(#{startDate},'-','') AND REPLACE(#{endDate},'-','') )  )
			  	 </if>
				<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
					<choose>
					    <when test="searchType == 'Description'">
					        AND a.Subject LIKE CONCAT('%',#{searchWord},'%')
					    </when>
					    <when test="searchType == 'RegisterName'">
					        AND Fn_BaseGetDictionary_S(#{lang},g.MultiDisplayName) LIKE CONCAT('%',#{searchWord},'%')
					    </when>
				    </choose>
				</if>) a
		<trim prefix="WHERE"  prefixOverrides ="AND |OR ">
			<if test="bookingState != null and bookingState !='' and !bookingState.equalsIgnoreCase('All')">
				<![CDATA[ IF(a.ReturnType = 'AutoReturn' AND a.EndDateTime < #{localCurrentDate} AND a.ApprovalState = 'Approval', 'ReturnComplete' , a.ApprovalState)  = #{bookingState} ]]>
			</if>
		</trim>	
    </select>
    
    <update id="updateIsSwitch" parameterType="cmap" >
        UPDATE covi_smart4j.sys_object_folder AS b
        <if test="columnName == 'IsUse'">
            SET b.IsUse = (SELECT * FROM (SELECT (CASE a.IsUse WHEN 'Y' THEN 'N'
								WHEN 'N' THEN 'Y' END)
								FROM covi_smart4j.sys_object_folder AS a
								WHERE a.FolderID =  #{folderID}) AS temp )
        </if>
        <if test="columnName == 'IsDisplay'">
			SET b.IsDisplay = (SELECT * FROM (SELECT (CASE a.IsDisplay WHEN 'Y' THEN 'N'
									WHEN 'N' THEN 'Y' END)
									FROM sys_object_folder AS a
									WHERE a.FolderID =  #{folderID}) AS temp )
        </if>
		WHERE b.FolderID = #{folderID}
    </update>
    
    <delete id="deleteFolderData" parameterType="cmap">
        	UPDATE covi_smart4j.sys_object_folder 
			SET DeleteDate = now(3), 
			    IsUse = 'N'
			WHERE ObjectType = #{bizSection}
			AND (
				FolderID  IN
				<foreach item="item" index="index" collection="folderIDArr" open="(" close=")" separator=",">
	           		#{item}
	    		</foreach>
	    		<foreach item="item" index="index" collection="folderIDArr">
	           		OR CONCAT(';',FolderPath) LIKE CONCAT('%;',#{item},';%')   
	    		</foreach>
			)
    </delete>
    
    <delete id="deleteACLList" parameterType="cmap">
	    DELETE FROM covi_smart4j.sys_object_acl
		WHERE ObjectType = #{objectType}  AND ObjectID  IN
		(
			SELECT FolderID FROM covi_smart4j.sys_object_folder
			WHERE ObjectType = #{bizSection}
			AND (
				FolderID  IN
				<foreach item="item" index="index" collection="folderIDArr" open="(" close=")" separator=",">
	           		#{item}
	    		</foreach>
	    		<foreach item="item" index="index" collection="folderIDArr">
	           		OR CONCAT(';',FolderPath) LIKE CONCAT('%;',#{item},';%')   
	    		</foreach>
			)
		)
    </delete>
    
     <select id="selectFolderSortPath" parameterType="cmap" resultType="cmap">
         SELECT FolderID
        	,SortKey
        	,MemberOf
        	,SortPath 
        FROM covi_smart4j.sys_object_folder 
        WHERE DomainID = #{domainID}
			AND DeleteDate IS NULL
			AND MemberOf = #{memberOf}
		<choose>
		    <when test="mode == 'up'">
				AND SortKey &lt; #{orgSortKey} 
				ORDER BY SortKey DESC
		    </when>
		    <otherwise>
				AND SortKey &gt; #{orgSortKey} 
				ORDER BY SortKey ASC
		    </otherwise>		  
	    </choose>
	    LIMIT 1
     </select>
     
     <update id="updateFolderSortKey" parameterType="cmap">
        UPDATE covi_smart4j.sys_object_folder AS a
		SET a.SortKey = #{sortKey2}
		WHERE a.FolderID = #{folderID1};
		
		UPDATE covi_smart4j.sys_object_folder AS a
		SET a.SortKey = #{sortKey1}
		WHERE a.FolderID = #{folderID2};
    </update>
    
    <update id="updateFolderSortPath" parameterType="cmap"> 
    	# Folder 정렬 경로 수정
    	UPDATE covi_smart4j.sys_object_folder
    	SET SortPath = Fn_ComSortPathCreate_S(FolderID, '', 'FDD')
		WHERE ObjectType = 'Resource'
		AND ( FolderID = #{folderID1} 
			OR FolderID = #{folderID2} 
			OR CONCAT(';',FolderPath) LIKE CONCAT('%;',#{folderID1},';%')
			OR CONCAT(';',FolderPath) LIKE CONCAT('%;',#{folderID2},';%') )
	</update> 
     
      
    <!-- 확장옵션 탭: 사용자 정의 컬럼 Grid 조회 -->
    <select id="selectUserDefFormGridList" parameterType="cmap" resultType="cmap">
        SELECT * FROM (
	        SELECT  BU.UserFormID, 
	        	BU.FolderID, 
	        	BU.SortKey, 
	        	BU.FieldType, 
	        	BU.FieldInputLimit, 
	        	BU.IsList, 
	        	BU.IsOption, 
	        	IFNULL(BU.IsCheckVal, 'N') AS IsCheckVal, 
				Fn_BaseGetDictionary_S(#{lang},BU.MultiFieldName) AS DisplayName,
				BU.MultiFieldName AS FieldName,
				(SELECT COUNT(*) 
					FROM resource_userform_option 
					WHERE UserFormID=BU.UserFormID
				) AS OptionCnt 
			FROM resource_userform AS BU
		WHERE BU.FolderID=#{folderID}
		) AS RESULT
		ORDER BY SortKey ASC
    </select>
    
     <select id="selectUserDefFormGridCount" resultType="java.lang.Long">
        SELECT COUNT(*) FROM (
	        SELECT  BU.UserFormID
				FROM resource_userform AS BU
				WHERE BU.FolderID=#{folderID}
		) AS RESULT
    </select>
    
     <!-- 사용자 정의 필드 옵션 -->
     <select id="selectUserDefFieldOptionList" parameterType="cmap" resultType="cmap">
          SELECT
        	OptionID
        	,UserFormID
        	,SortKey
        	,Fn_BaseGetDictionary_S(#{lang}, MultiOptionName) AS OptionName
        	,OptionValue
        FROM resource_userform_option
        WHERE UserFormID = #{userFormID}
        ORDER BY SortKey
    </select>
    
    <!-- 순서변경용 sortkey 조회 -->
    <select id="selectTargetUserDefFieldSortKey" parameterType="cmap" resultType="cmap">
       	SELECT UserFormID
        		 ,SortKey
        FROM resource_userform
        WHERE 1=1
        <choose>
		    <when test="mode == 'up'">
				AND FolderID = #{folderID}
				AND SortKey &lt; #{orgSortKey} 
				AND DeleteDate IS NULL
				ORDER BY SortKey DESC
		    </when>
		    <otherwise>
		       AND FolderID = #{folderID}
				AND SortKey &gt; #{orgSortKey} 
				AND DeleteDate IS NULL
				ORDER BY SortKey ASC
		    </otherwise>		  
	    </choose>
	    LIMIT 1
    </select>
    
    <!-- 사용자 정의 필드 추가 -->
    <insert id="createUserDefField" parameterType="cmap">
        INSERT INTO resource_userform
		(FolderID, SortKey, MultiFieldName, FieldType, FieldInputLimit, IsList, IsOption, IsCheckVal)
			VALUES
		(#{folderID}, #{sortKey}, #{fieldName}, #{fieldType}, #{fieldLimitCnt}, #{isList}, #{isOption}, #{isCheckVal})
		<selectKey keyProperty="userFormID" resultType="long" order="AFTER">
			SELECT LAST_INSERT_ID();
      </selectKey>
    </insert>
     
    <!-- 사용자 정의 필드 옵션 추가 -->
    <insert id="createUserDefFieldOption" parameterType="cmap">
        INSERT INTO resource_userform_option (UserFormID, FolderID, SortKey, MultiOptionName, OptionValue)
		VALUES 
		(#{userFormID}, #{folderID}, #{sortKey}, #{optionName}, #{optionValue})
    </insert>
    
    <!-- 사용자 정의 필드 수정 -->
    <update id="updateUserDefField" parameterType="cmap">
        UPDATE resource_userform
        SET
        	MultiFieldName = #{fieldName}
        	,FieldType = #{fieldType}
        	,FieldInputLimit = #{fieldLimitCnt}
        	,IsList = #{isList}
        	,IsOption = #{isOption}
        	,IsCheckVal = #{isCheckVal}
        WHERE  UserFormID = #{userFormID}
    </update>
    
    <!-- 사용자 정의 필드 순서 수정 -->
    <update id="updateUserDefFieldSortKey" parameterType="cmap">
        UPDATE resource_userform
        SET
        	SortKey = #{sortKey}
        WHERE UserFormID = #{userFormID}
    </update>
    
    <!-- 사용자 정의 필드 정보 삭제 -->
     <update id="deleteUserDefField" parameterType="cmap">
         DELETE FROM  resource_userform WHERE UserFormID IN
        <foreach item="item" index="index" collection="userFormIDs" open="(" close=")" separator=",">
            #{item}
    	</foreach>
    </update>
    
     <!-- 사용자 정의 필드 옵션 삭제 -->
    <delete id="deleteUserDefFieldOption" parameterType="cmap">
        DELETE FROM resource_userform_option
        WHERE 1=1
        <choose>
		    <when test="optionID != null and optionID != ''">
		        AND OptionID = #{optionID}
		    </when>
		    <when test="userFormIDs != null and userFormIDs != ''">
		        AND UserFormID IN
		        <foreach item="item" index="index" collection="userFormIDs" open="(" close=")" separator=",">
		            #{item}
		    	</foreach>
		    </when>
		    <otherwise>
		        AND UserFormID = #{userFormID}
		        AND FolderID = #{folderID}
		    </otherwise>		  
	    </choose>
    </delete>
    
    <insert id="insertFolderData" parameterType="cmap">
        INSERT INTO covi_smart4j.sys_object_folder 
        	(
				  DomainID
				, MenuID
				, ObjectType
				, FolderType
				, ParentObjectID
				, ParentObjectType		
				, LinkFolderID
				, DisplayName
				, MultiDisplayName
				, MemberOf
				, SortPath
				, SortKey
				, FolderPath
				, IsInherited
				, IsShared
				, IsUse
				, IsDisplay
				, IsURL
				, URL
				, Description
				, OwnerCode
				, RegisterCode
				, RegistDate
				, Reserved1
				, Reserved2
				, Reserved3
				, Reserved4
				, Reserved5
				, SecurityLevel
			) VALUES(
				  #{domainID}
				, #{menuID}
				, #{objectType}
				, #{folderType}
				, #{parentObjectID}
				, #{parentObjectType}
				, #{linkFolderID}
				, #{displayName}
				, #{multiDisplayName}
				, #{memberOf}
				, ''
				, IFNULL((SELECT MAX(B.SortKey)
			        		FROM covi_smart4j.SYS_OBJECT_FOLDER AS B
			        		WHERE B.MemberOf = #{memberOf}
			        		AND B.ObjectType = #{objectType}
			        		AND B.DomainID = #{domainID}
			        		AND B.DeleteDate IS NULL) + 1, 0)
				, ''
				, #{isInherited}
				, #{isShared}
				, #{isUse}
				, #{isDisplay}
				, #{isURL}
				, #{url}
				, #{description}
				, #{ownerCode}
				, #{registerCode}
				, now(3)
				, #{placeOfBusiness}
				, #{isInheritedSetting}
				, ''
				, ''
				, ''
				, #{securityLevel}
			);
		<selectKey keyProperty="folderID" resultType="long" order="AFTER">
			SELECT LAST_INSERT_ID();
        </selectKey>
    </insert>
    
    <update id="updateFolderData"  parameterType="cmap">
		UPDATE covi_smart4j.sys_object_folder SET
			DomainID = #{domainID}
			, MenuID = #{menuID}
			, FolderType = #{folderType}
			, ParentObjectID = #{parentObjectID}
			, ParentObjectType = #{parentObjectType}
			, LinkFolderID = #{linkFolderID}
			, DisplayName = #{displayName}
			, MultiDisplayName = #{multiDisplayName}
			, MemberOf = #{memberOf}
			<!-- , SortPath = ''
			, SortKey = #{sortKey}
			, FolderPath = '' -->
			, IsInherited = #{isInherited}
			, IsShared = #{isShared}
			, IsUse = #{isUse}
			, IsDisplay = #{isDisplay}
			, Description = #{description}
			, ModifierCode = #{modifierCode}
			, ModifyDate = now(3)
		<if test='isEasyAdmin == null or isEasyAdmin ==""'>
			, IsURL = #{isURL}
			, URL = #{url}
			, Reserved1 = #{placeOfBusiness}
			, Reserved2 = #{isInheritedSetting}
			, SecurityLevel = #{securityLevel}
		</if>
		WHERE FolderID = #{folderID}
    </update>
    
   <select id="selectResourceData" parameterType="cmap" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM covi_smart4j.resource
        WHERE FolderID = #{folderID}
    </select>
    	
    <insert id="insertResourceData" parameterType="cmap">
        INSERT INTO covi_smart4j.resource(FolderID,IconCode,IconPath,BookingType,ReturnType,NotificationState,NotificationKind,LeastRentalTime,LeastPartRentalTime,DescriptionURL,RegisterCode,RegistDate)
		VALUES(#{folderID},#{iconCode},#{iconPath},#{bookingType},#{returnType},#{notificationState},#{notificationKind},#{leastRentalTime},#{leastPartRentalTime},#{descriptionURL},#{registerCode},now(3));
    </insert> 
    
    <update id="updateResourceData" parameterType ="cmap">
        UPDATE covi_smart4j.resource SET
					IconCode = #{iconCode}
					,IconPath = #{iconPath}
					,BookingType = #{bookingType}
					,ReturnType = #{returnType}
					,NotificationState = #{notificationState}
					,NotificationKind = #{notificationKind}
					,LeastRentalTime = #{leastRentalTime}
					,LeastPartRentalTime = #{leastPartRentalTime}
					,DescriptionURL = #{descriptionURL}
		WHERE FolderID = #{folderID};
    </update>
    
    <select id="selectComSortPathCreateS" parameterType="cmap" resultType="java.lang.String">
         SELECT FN_COMSORTPATHCREATE_S(#{folderID},'','FDD') AS SortPath
    </select>
    
    <select id="selectComObjectPathCreateS" parameterType="cmap" resultType="java.lang.String">
        SELECT FN_COMOBJECTPATHCREATE_S(#{folderID},'','FD') AS FolderPath
    </select>
    
    <update id="updatePathData" parameterType="cmap">
        UPDATE sys_object_folder 
        SET SortPath = #{SortPath}
        , FolderPath = #{FolderPath}
        WHERE FolderID = #{folderID};
    </update>
    
     <select id="selectShareResourceList" parameterType="cmap" resultType = "cmap">
         /* queryID : admin.resource.selectShareResourceList */
         SELECT a.FolderID
				 , Fn_BaseGetDictionary_S(#{lang},b.MultiDisplayName) AS DomainName
				 , Fn_BaseGetDictionary_S(#{lang},a.MultiDisplayName ) AS ResourceName 
				 , Fn_BaseGetDictionary_S(#{lang},c.MultiDisplayName ) AS RegisterName
				 , DATE_FORMAT(a.RegistDate,'%Y-%m-%d %H:%i:%s') AS RegistDate
				 , a.MultiDisplayName AS MultiDisplayName
		 FROM sys_object_folder AS a 
		 LEFT JOIN sys_object_domain AS b ON a.DomainID = b.DomainID 
		 LEFT JOIN sys_object_user AS c ON a.RegisterCode = c.UserCode
		 WHERE FolderType LIKE 'Resource%'
		 AND a.IsUse = 'Y' AND a.IsShared = 'Y'
		<if test="searchWord != null and searchWord != '' and searchWord.length() gt 0">
			AND a.MultiDisplayName LIKE CONCAT('%',#{searchWord},'%')
		</if> 
		<if test="domainID != null and domainID !=''">
				 AND a.DomainID = #{domainID}
		</if>
	    <!-- Order by 절 -->
	    <trim prefix="ORDER BY" prefixOverrides =",">
			<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				a.RegistDate Desc
			</if>
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("DomainName")'>DomainName</when>
					<when test='sortColumn.equalsIgnoreCase("ResourceName")'>ResourceName</when>
					<when test='sortColumn.equalsIgnoreCase("RegisterName")'>RegisterName</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
					<otherwise>FolderID</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
    </select>
    
     <select id="selectShareResourceListCnt" parameterType="cmap" resultType = "java.lang.Long">
         SELECT COUNT(*)
		 FROM sys_object_folder AS a 
		 LEFT JOIN sys_object_domain AS b ON a.DomainID = b.DomainID 
		 LEFT JOIN sys_object_user AS c ON a.RegisterCode = c.UserCode
		 WHERE FolderType LIKE 'Resource%'
		 AND a.IsUse = 'Y' AND a.IsShared = 'Y'
		<if test="searchWord != null and searchWord != '' and searchWord.length() gt 0">
			AND a.MultiDisplayName LIKE CONCAT('%',#{searchWord},'%')
		</if>
		<if test="domainID != null and domainID !=''">
				 AND a.DomainID = #{domainID}
		</if>
    </select>
    
     <insert id="insertAttributeData" parameterType="clist">
        INSERT INTO covi_smart4j.resource_attribute(FolderID, SortKey, AttributeName, MultiAttributeName, AttributeValue, MultiAttributeValue)
		VALUES
		<foreach collection="list" item="attributeData" index="index" separator=",">
            (
	        	#{attributeData.folderID}
	        	, #{index}
				, #{attributeData.attributeName}
				, #{attributeData.multiAttributeName}
				, #{attributeData.attributeValue}
				, #{attributeData.multiAttributeValue}
	        )
        </foreach>
        ;
    </insert>
    
     <insert id="insertAddEquipmentData" parameterType="cmap">
		INSERT INTO resource_equipment_def(FolderID, EquipmentID, RegistDate)
		<trim prefix="VALUES" prefixOverrides=",">
            <foreach collection="equipmentIDArr" item="item" index="index">
				, (#{folderID}, #{item}, now(3) )
		   </foreach>
        </trim>
     </insert> 
    
     <!-- 메뉴조회: 업무담당자의 MenuID를 조회이전까지 사용 -->
    <select id="selectMenuByDomainID" parameterType="cmap" resultType="java.lang.Long">
        SELECT MenuID
        FROM sys_object_menu 
        WHERE DomainID = #{domainID} 
        AND BizSection = 'Resource'	<!-- FIXED -->
        AND  (MemberOf IS NULL OR MemberOf = 0)
    </select>
    
    <select id="selectTopFolderByMenuID" parameterType="cmap" resultType="java.lang.Long">
        SELECT FolderID
        FROM sys_object_folder 
        WHERE menuID = #{menuID} 
        AND  (MemberOf IS NULL OR MemberOf = 0)
    </select>
    
    <select id="selectFolderData" parameterType="cmap" resultType="cmap">
        SELECT a.FolderID
        ,a.DomainID
        ,a.MenuID
        ,a.ObjectType
        ,a.FolderType
        ,a.ParentObjectID
        ,a.ParentObjectType
        ,a.LinkFolderID
        ,(SELECT MultiDisplayName FROM sys_object_folder l WHERE l.FolderID = a.LinkFolderID) LinkFolderName
        ,a.DisplayName
        ,a.MultiDisplayName
        ,a.MemberOf
        ,a.FolderPath
        ,a.SortKey
        ,a.SecurityLevel
        ,a.SortPath
        ,a.IsInherited
        ,a.IsShared
        ,a.IsUse
        ,a.IsDisplay
        ,a.IsURL
        ,a.URL
        ,a.ManageCompany
        ,a.Description
        ,a.OwnerCode
        ,a.Reserved1
        ,IFNULL(a.Reserved1,'') AS PlaceOfBusiness
        ,a.Reserved2
        ,IFNULL(a.Reserved3,'') AS Reserved3
        ,b.BookingType
        ,b.ReturnType
        ,b.BookingType AS BookingTypeCode
        ,b.ReturnType AS ReturnTypeCode
        ,b.NotificationState
        ,b.NotificationKind
        ,b.LeastRentalTime
        ,b.LeastPartRentalTime
        ,b.DescriptionURL
        , (SELECT IFNULL(MultiDisplayName,DisplayName) FROM sys_object_folder WHERE FolderID = a.MemberOf) AS ParentFolderName FROM sys_object_folder AS a
		LEFT JOIN resource AS b ON a.FolderID = b.FolderID
		WHERE a.folderID = #{folderID}
    </select>
    
      <select id = "selectAddEquipmentData" parameterType="cmap" resultType ="cmap">
		SELECT a.EquipmentID, b.MultiEquipmentName, b.IconPath, c.DomainCode AS CompanyCode
		FROM resource_equipment_def AS a 
		INNER JOIN resource_equipment AS b ON a.EquipmentID = b.EquipmentID
		INNER JOIN sys_object_domain AS c ON b.DN_ID = c.DomainID
		WHERE a.FolderID = #{folderID}
    </select>
    
     <select id = "selectAttributeData" parameterType="cmap" resultType ="cmap">
		SELECT AttributeName AS Title, MultiAttributeName AS ExTitle, AttributeValue AS Value, MultiAttributeValue AS ExValue
		FROM resource_attribute AS a 
		WHERE a.FolderID = #{folderID}
		ORDER BY SortKey ASC
    </select>
    
     <select id="selectManagementData" parameterType="cmap" resultType ="cmap">
		SELECT A.AclID, A.ObjectID, A.ObjectType, A.SubjectCode, 'UR' AS SubjectType, A.AclList, U.DisplayName AS SubjectName, U.MultiDisplayName AS MultiSubjectName
		FROM covi_smart4j.sys_object_acl A 
			INNER JOIN covi_smart4j.sys_object_user U 
				ON A.SubjectCode = U.UserCode 
		WHERE A.ObjectType = #{objectType} AND A.ObjectID = #{objectID} AND A.SubjectType = 'RM' 
		UNION
		SELECT A.AclID, A.ObjectID, A.ObjectType, A.SubjectCode,(CASE G.GroupType WHEN 'Company' THEN 'CM' ELSE 'GR' END) AS  SubjectType, A.AclList, G.DisplayName AS SubjectName, G.MultiDisplayName AS MultiSubjectName
		FROM covi_smart4j.sys_object_acl A 
			INNER JOIN covi_smart4j.sys_object_group G 
				ON A.SubjectCode = G.GroupCode 
		WHERE A.ObjectType = #{objectType} AND A.ObjectID = #{objectID} AND A.SubjectType = 'RM'
     </select>
    
     <delete id="deleteResourceData" parameterType="cmap">
        DELETE FROM resource
		WHERE FolderID = #{folderID};
     </delete>
     
     <delete id="deleteAddOptionData" parameterType="cmap">
        DELETE FROM resource_attribute
		WHERE FolderID = #{folderID};
		
		DELETE FROM resource_equipment_def
		WHERE FolderID = #{folderID};
		
		DELETE FROM sys_object_acl
		WHERE ObjectID = #{folderID} AND ObjectType = 'FD';
     </delete>

	 <select id="selectACLList" parameterType="cmap" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM covi_smart4j.sys_object_acl
		WHERE ObjectID = #{objectId} AND ObjectType = 'FD' AND SubjectCode = #{subjectCode} AND SubjectType = 'RM'
	 </select>
     
     <select id="seleteDeletedBookingInfo" parameterType="cmap" resultType="cmap">
           SELECT  a.EventID
					, a.FolderType
					, IFNULL(b.RepeatID,0) AS RepeatID
					, (SELECT COUNT(*) FROM covi_smart4j.event_date AS c WHERE c.EventID = b.EventID AND c.DateID != b.DateID) AS RepeatCnt
					, IFNULL(d.ResourceID, a.FolderID) AS ResourceID
		FROM covi_smart4j.`event` AS a
		INNER JOIN covi_smart4j.event_date AS b ON  a.EventID = b.EventID
		LEFT JOIN covi_smart4j.event_relation AS d ON a.EventID = d.ScheduleID 
		WHERE b.DateID = #{DateID}
     </select>
     
     <select id="selectResourceEquipmentDomainInfo" parameterType="cmap" resultType="cmap">
         SELECT DomainCode
         FROM covi_smart4j.sys_object_domain
         WHERE DomainID = #{domainID}
     </select>
     
     <delete id="deleteRelationData" parameterType="cmap" >
        DELETE FROM covi_smart4j.event_relation
		WHERE ScheduleID = #{EventID} AND ResourceID = #{ResourceID}
     </delete>

     <update id="deleteResourceBookingData" parameterType="cmap" >
       UPDATE covi_smart4j.event_resource_booking
	   SET DeleteDate = now(3)
	   WHERE DateID = #{DateID}
     </update>

     <!--if문으로 나눠놓을 경우 둘다 null 일 때 전체 삭제를 방지  -->
     <delete id="deleteDateDataByDateID" parameterType="cmap" >
       DELETE FROM covi_smart4j.event_date
	   WHERE DateID = #{DateID}
     </delete>
     
     <!--if문으로 나눠놓을 경우 둘다 null 일 때 전체 삭제를 방지  -->
     <delete id="deleteDateDataByEventID" parameterType="cmap">
       DELETE FROM covi_smart4j.event_date
	   WHERE EventID = #{EventID}
     </delete>
     
     <update id="deleteEventData" parameterType = "cmap">
        UPDATE covi_smart4j.event
		SET DeleteDate = now(3)
		WHERE EventID = #{EventID}
     </update>
     
     <update id="updateImagePath">
        UPDATE covi_smart4j.sys_object_folder
		SET Reserved3 = #{FileID}
		WHERE FolderID = #{FolderID}
     </update>
     
     <select id="selectDuplicateShareResource" parameterType="cmap" resultType="java.lang.Long">
     	/* queryID : admin.resource.selectDuplicateShareResource */
     	SELECT 	COUNT(1)
		FROM  	sys_object_folder
		WHERE 	1=1
		AND 	LinkFolderID = #{folderID}
		AND 	DomainID = #{domainID}
		AND 	ObjectType = 'Resource'
     </select>
     
</mapper>
