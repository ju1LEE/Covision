<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="user.message">
    <resultMap type="cmap" id="bodyResult">
 	    <result property="Body" column="Body" jdbcType="CLOB" javaType="java.lang.String" />
 	    <result property="BodyText" column="BodyText" jdbcType="CLOB" javaType="java.lang.String" />
 	</resultMap>
    
    <sql id="chooseBoardType">
        <if test="boardType != 'MyBooking' and boardType != 'Approval'">
            AND (ReservationDate IS NULL OR ReservationDate &lt; TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))
        </if>
        <choose>
		     <when test="boardType == 'Total' or boardType == 'DocTotal'">
		        AND ( (H.FolderType = 'OneToOne') AND (A.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = H.FolderID) LIKE '%' || #{userCode} || ';%' ) OR (H.FolderType != 'OneToOne') )
				AND MsgState IN ('C', 'A')
				AND MsgType != 'S'
				<!-- UseSecurity가 Y일때 게시일 경우에는 작성자만 조회할 수 있음 -->
				AND (
					UseSecurity != 'Y'
					OR (
						UseSecurity = 'Y'
						AND (
							#{bizSection} = 'Board' AND CreatorCode = #{userCode}
							OR #{bizSection} = 'Doc'
						)
					)
				)
				AND (ExpiredDate IS NULL OR  ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
				AND A.DeleteDate IS NULL
	    	</when>
	    	<when test="boardType == 'MyInterest'">	
	    	    AND ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS')
				AND (MsgState IN ('C', 'A')) AND (MsgType IN ('O', 'C', 'M'))
	    	</when>
	    	<when test="boardType == 'MyOwnWrite'">
	    	    AND CreatorCode = #{userCode}
				AND MsgState != 'T' AND MsgType != 'S' 
	    	</when>
	    	<when test="boardType == 'RequestModify'">
	    	    AND M.RequestorCode = #{userCode}
	    	</when>
	    	<when test="boardType == 'Scrap'">
	    	    AND CreatorCode = #{userCode}
				AND (MsgState IN ('C')) AND (MsgType IN ('S'))	
	    	</when>
	    	<when test="boardType == 'OnWriting'">
	    	    AND CreatorCode = #{userCode}
	    	    AND A.DeleteDate IS NULL
				AND MsgState IN ('T')							
	    	</when>
	    	<when test="boardType == 'MyBooking'">
	    	    AND CreatorCode = #{userCode}
	    	    AND (ReservationDate IS NOT NULL AND ReservationDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))
	    	</when>
	    	<when test="boardType == 'CheckIn'">
	    	 	 AND IsCheckOut = 'N' 
	    	 	 AND A.DeleteDate IS NULL
				 AND (ExpiredDate IS NULL OR  ExpiredDate >=  TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
				 AND (
				 			( DIH.CO_Code = #{userCode} AND  DIH.ActType IN ('In', 'Revision') ) 
				 			OR ( DIH.HistoryID IS NULL AND A.OwnerCode = #{userCode} )  
				 		)
	    	 	<!--  AND DIH.CO_Code = #{userCode}
	    	 	 AND DIH.ActType IN ('IN', 'Revision')  -->
	    	</when>
	    	<when test="boardType == 'CheckOut'">
	    	 	AND IsCheckOut = 'Y' 
	    	 	AND CheckOuterCode = #{userCode} 
	    	 	AND A.DeleteDate IS NULL
				AND (ExpiredDate IS NULL OR  ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
	    	 	AND DIH.ActType = 'Out'
	    	</when> 	
	    	<when test="boardType == 'DocOwner'">
	    	    AND MsgState IN ('C', 'A') 
				AND MsgType != 'B' 
				AND (ExpiredDate IS NULL OR  ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
				AND A.DeleteDate IS NULL 
				AND A.OwnerCode = #{userCode}  
	    	</when>
			<when test="boardType == 'Approval'">
				AND (ExpiredDate IS NULL OR ExpiredDate >= TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS'))
				AND A.DeleteDate IS NULL
			</when>
    	</choose>
    </sql>
    
	<!-- 폴더/게시판 게시글 목록 조회 -->
    <select id="selectNormalMessageGridCount" resultType="java.lang.Long">
    /* user.message.selectNormalMessageGridCount */
        SELECT COUNT(*) 
        FROM (
	        SELECT DISTINCT
	        	BM.MessageID 
	        FROM BOARD_MESSAGE BM
	        LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = BM.MessageID AND BMA.Version = BM.Version
			<if test="categoryID != null and categoryID != ''">
			    LEFT OUTER JOIN BOARD_CATEGORY BC ON BM.CategoryID = BC.CategoryID AND BC.FolderID = #{folderID}
			</if>
			LEFT OUTER JOIN BOARD_PROGRESSSTATE BP ON BM.progressstate = BP.StateID 
			LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version)
			<if test="grCode != null and grCode != ''">
			    LEFT OUTER JOIN sys_object_folder SOF ON BM.FolderID = SOF.FolderID
			</if>
			<if test="multiCategory != null and multiCategory != ''">
				INNER JOIN (
					SELECT * FROM (
					    SELECT MessageID, Version
					    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
					    FROM board_userform_value
					    GROUP BY MessageID, Version
					) A
					WHERE 1=1
					<foreach collection="multiCategoryList" item="multiCategory" index="index">
						AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
					</foreach>
				) UFV ON UFV.MessageID = BM.MessageID AND UFV.Version = BM.Version
			</if>
			<!-- 보안등급 및 열람권한 체크 -->
			<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
			LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
							 FROM (
								SELECT SRA.ObjectID, SRA.MessageID
								FROM sys_read_acl AS SRA
								WHERE SRA.ObjectType = 'FD'
								AND SRA.TargetType = 'UR'
								AND SRA.TargetCode = #{userCode}
								UNION
								SELECT SRA.ObjectID, SRA.MessageID
								FROM sys_read_acl AS SRA
								WHERE SRA.ObjectType = 'FD'
								AND SRA.TargetType != 'UR'
								AND SRA.TargetCode IN
								<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
						            #{item}
							    </foreach>
							) AS SRA) SRA ON BM.FolderID = SRA.ObjectID AND BM.MessageID = SRA.MessageID
			</if>			
			WHERE 1=1
			AND BM.MsgState IN ('C', 'A') 
			AND MsgType != 'S' 
			<!-- UseSecurity가 Y일때 게시일 경우에는 작성자만 조회할 수 있음 -->
			AND (
				UseSecurity != 'Y'
				OR (
					UseSecurity = 'Y'
					AND (
						#{bizSection} = 'Board' AND CreatorCode = #{userCode}
						OR #{bizSection} = 'Doc'
					)
				)
			)
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
			AND BM.DeleteDate IS NULL
			AND (BM.ReservationDate IS NULL OR BM.ReservationDate &lt; TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))
			AND BM.IsCurrent = 'Y'
			<if test="folderType != null and folderType == 'OneToOne'">
			    AND (BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = #{folderID}) LIKE '%' || #{userCode} || ';%' )
			</if>
			<if test="categoryID != null and categoryID != ''">
		        <choose>
			    	<when test="categoryGubun == 'Y'">
			    	    AND (BC.MemberOf = #{categoryID} OR BC.CategoryID = #{categoryID})
			        </when>
			        <otherwise>
			            AND BM.CategoryID = #{categoryID}
			        </otherwise>
			    </choose>
		    </if>
		    <if test="readSearchType != null and readSearchType != ''">
		       AND BM.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
		    </if>
		    <!-- 보안등급 및 열람권한 체크 -->
			<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
		       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
		                 ELSE CASE WHEN (BM.SecurityLevel = '256' OR BM.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
		                	  ELSE 'N' END
		                 END) = 'Y'
		              		                		  
		       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
		                 ELSE CASE WHEN NVL(BM.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
					     		   WHEN NVL(BM.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
					     		   ELSE 'N' END
					     END) = 'Y'
		    </if>		    
		    <!-- 검색어 항목 -->
			<if test="searchText != null and searchText != ''">
				<choose>
		        <when test="searchType == 'Total'">
		            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
		       	</when>
		       	<when test="searchType == 'Mobile'">
		            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
		       	</when>
				<when test="searchType == 'UserForm'">
					AND 
					<choose>
						<when test='ufColumn.equalsIgnoreCase("UF_Value1")'>BMUV.UF_Value1 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value2")'>BMUV.UF_Value2 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value3")'>BMUV.UF_Value3 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value4")'>BMUV.UF_Value4 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value5")'>BMUV.UF_Value5 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value6")'>BMUV.UF_Value6 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value7")'>BMUV.UF_Value7 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value8")'>BMUV.UF_Value8 </when>
						<when test='ufColumn.equalsIgnoreCase("UF_Value9")'>BMUV.UF_Value9 </when>
						<otherwise>BMUV.UF_Value0 </otherwise>
					</choose>
					LIKE '%'|| #{searchText} ||'%'    
				</when>
	       		<when test="searchType == 'Number'">
					AND BM.Number_ LIKE '%'|| #{searchText} ||'%'  
				</when>
				<when test="searchType == 'Tag'">
		            AND  ( SELECT LISTAGG(Tag, ',') WITHIN GROUP (ORDER BY MessageID) FROM board_message_tag WHERE MessageID = BM.MessageID AND Version = BM.Version ) 
		            		LIKE '%' || #{searchText} || '%'  
		       	</when>
		       	<otherwise>
					AND 
					<choose>
						<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
						<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
						<otherwise>BM.Subject </otherwise>
					</choose>
					LIKE '%'|| #{searchText} ||'%'
		       	</otherwise>
			</choose>
			</if>
			<if test="startDate != '' or endDate != ''">
				AND BM.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
			</if>
			<choose>
				<when test="bizSection == 'Doc' and grCode != null and grCode != ''">
				    AND SOF.FolderType = #{bizSection}
					AND BM.RegistDept = #{grCode}
				</when>
				<otherwise>
					AND BM.FolderID = #{folderID}
				</otherwise>
			</choose>
			
			<if test="bizSection == 'Doc' and (grCode == null or grCode == '')">
			    UNION ALL
			    
			    SELECT DISTINCT
		        	BM.MessageID 
		        FROM BOARD_MESSAGE BM
		        LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = BM.MessageID AND BMA.Version = BM.Version
				LEFT OUTER JOIN board_message_folder BMF ON BMF.MessageID = BM.MessageID AND BMF.Version = BM.Version
				<if test="categoryID != null and categoryID != ''">
				    LEFT OUTER JOIN BOARD_CATEGORY BC ON BM.CategoryID = BC.CategoryID AND BC.FolderID = #{folderID}
				</if>
				LEFT OUTER JOIN BOARD_PROGRESSSTATE BP ON BM.progressstate = BP.StateID 
				LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version)
				<if test="multiCategory != null and multiCategory != ''">
					INNER JOIN (
						SELECT * FROM (
						    SELECT MessageID, Version
						    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
						    FROM board_userform_value
						    GROUP BY MessageID, Version
						) A
						WHERE 1=1
						<foreach collection="multiCategoryList" item="multiCategory" index="index">
							AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
						</foreach>
					) UFV ON UFV.MessageID = BM.MessageID AND UFV.Version = BM.Version
				</if>
				<!-- 보안등급 및 열람권한 체크 -->
				<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
				LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
								 FROM (
									SELECT SRA.ObjectID, SRA.MessageID
									FROM sys_read_acl AS SRA
									WHERE SRA.ObjectType = 'FD'
									AND SRA.TargetType = 'UR'
									AND SRA.TargetCode = #{userCode}
									UNION
									SELECT SRA.ObjectID, SRA.MessageID
									FROM sys_read_acl AS SRA
									WHERE SRA.ObjectType = 'FD'
									AND SRA.TargetType != 'UR'
									AND SRA.TargetCode IN
									<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
							            #{item}
								    </foreach>
								) AS SRA) SRA ON BM.FolderID = SRA.ObjectID AND BM.MessageID = SRA.MessageID
				</if>				
				WHERE BMF.FolderID = #{folderID}
				AND BM.MsgState IN ('C', 'A') 
				AND MsgType != 'S' 
				AND BMF.FolderID = #{folderID}
				<!-- UseSecurity가 Y일때 게시일 경우에는 작성자만 조회할 수 있음 -->
				AND (
					UseSecurity != 'Y'
					OR (
						UseSecurity = 'Y'
						AND (
							#{bizSection} = 'Board' AND CreatorCode = #{userCode}
							OR #{bizSection} = 'Doc'
						)
					)
				)
				AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
				AND BM.DeleteDate IS NULL
				AND (BM.ReservationDate IS NULL OR BM.ReservationDate &lt; TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))
				AND BM.IsCurrent = 'Y'
				<if test="folderType != null and folderType == 'OneToOne'">
				    AND (BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = #{folderID}) LIKE '%' || #{userCode} || ';%' )
				</if>
				<if test="categoryID != null and categoryID != ''">
			        <choose>
				    	<when test="categoryGubun == 'Y'">
				    	    AND (BC.MemberOf = #{categoryID} OR BC.CategoryID = #{categoryID})
				        </when>
				        <otherwise>
				            AND BM.CategoryID = #{categoryID}
				        </otherwise>
				    </choose>
			    </if>
			    <if test="readSearchType != null and readSearchType != ''">
			       AND BM.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
			    </if>
			    <!-- 보안등급 및 열람권한 체크 -->
				<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
			       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
			                 ELSE CASE WHEN (BM.SecurityLevel = '256' OR BM.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
			                	  ELSE 'N' END
			                 END) = 'Y'
			              		                		  
			       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
			                 ELSE CASE WHEN NVL(BM.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
						     		   WHEN NVL(BM.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
						     		   ELSE 'N' END
						     END) = 'Y'
			    </if>
			    <!-- 검색어 항목 -->
				<if test="searchText != null and searchText != ''">
					<choose>
			        <when test="searchType == 'Total'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
			       	</when>
			       	<when test="searchType == 'Mobile'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
			       	</when>
					<when test="searchType == 'UserForm'">
						AND 
						<choose>
							<when test='ufColumn.equalsIgnoreCase("UF_Value1")'>BMUV.UF_Value1 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value2")'>BMUV.UF_Value2 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value3")'>BMUV.UF_Value3 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value4")'>BMUV.UF_Value4 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value5")'>BMUV.UF_Value5 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value6")'>BMUV.UF_Value6 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value7")'>BMUV.UF_Value7 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value8")'>BMUV.UF_Value8 </when>
							<when test='ufColumn.equalsIgnoreCase("UF_Value9")'>BMUV.UF_Value9 </when>
							<otherwise>BMUV.UF_Value0 </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'    
					</when>
		       		<when test="searchType == 'Number'">
						AND BM.Number_ LIKE '%'|| #{searchText} ||'%'  
					</when>
					<when test="searchType == 'Tag'">
			            AND  ( SELECT LISTAGG(Tag, ',') WITHIN GROUP (ORDER BY MessageID) FROM board_message_tag WHERE MessageID = BM.MessageID AND Version = BM.Version ) 
			            		LIKE '%' || #{searchText} || '%'  
			       	</when>
			       	<otherwise>
						AND 
						<choose>
							<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
							<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
							<otherwise>BM.Subject </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'  
			       	</otherwise>
				</choose>
				</if>
				<if test="startDate != '' or endDate != ''">
					AND BM.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
				</if>
			</if>
	    ) RESULT
		WHERE 1=1
    </select>
    
    <!-- 폴더/게시판 게시글 목록 조회 -->
    <select id="selectNormalMessageGridList" parameterType="cmap" resultType="cmap">
    /* user.message.selectNormalMessageGridList */
        <include refid="oracle.include.pagingHeader"/>
			SELECT DISTINCT
				BM.MessageID AS "MessageID"
				, BM.Version AS "Version"
				, BM.Number_ AS "Number"
				, BM.F_FolderID AS "FolderID"
				, (SELECT MenuID FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS "MenuID"
				, (SELECT FolderPath FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS "FolderPath"
				, BM.IsInherited AS "IsInherited"
				, BM.ParentID AS "ParentID" 
				, BM.MsgType AS "MsgType" 
				, CASE WHEN NVL(BM.DeleteDate, '') = '' THEN BM.MsgState ELSE 'DEL' END as "MsgState"
				, BM.CategoryID AS "CategoryID"
				, (SELECT FN_BASEGETDICTIONARY_S(#{lang},DisplayName) FROM BOARD_CATEGORY WHERE CategoryPath = BC.CategoryPath) AS "CategoryName"
				, BC.CategoryPath AS "CategoryPath"
				, BM.Seq AS "Seq"
				, BM.Step AS "Step"
				, BM.Depth AS "Depth" 
				, BM.Subject AS "Subject"
				, BM.IsPopup AS "IsPopup"
				, CASE WHEN (BM.IsTop = 'Y' AND ((BM.TopStartDate IS NOT NULL AND BM.TopStartDate &lt;= TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS')) AND (BM.TopEndDate IS NOT NULL AND BM.TopEndDate >= TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS')))) THEN 'Y' ELSE 'N' END AS "IsTop"
				, BM.PopupStartDate AS "PopupStartDate"
				, BM.PopupEndDate AS "PopupEndDate" 
				, BM.TopStartDate AS "TopStartDate"
				, BM.TopEndDate AS "TopEndDate" 
				, BM.ExpiredDate AS "ExpiredDate" 
				, BM.UseSecurity AS "UseSecurity"
				, BM.UseAnonym AS "UseAnonym"
				, BM.IsApproval AS "IsApproval"
				, BM.IsUserForm AS "IsUserForm" 
				, BM.IsCheckOut AS "IsCheckOut" 
				, BM.UseScrap AS "UseScrap" 
				, BM.NoticeMedia AS "NoticeMedia" 
				, BM.UseRSS AS "UseRSS" 
				, BM.TrackBackURL AS "TrackBackURL" 
				, BM.AnswerCnt AS "AnswerCnt" 
				, BM.ReadCnt AS "ReadCnt" 
				, BM.ListTop AS "ListTop"
				, (SELECT COUNT(*) 
				 	 FROM SYS_COMMENT 
				 	WHERE DeleteDate IS NULL 
				 	<choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				 	  AND TargetID = BM.MessageID||'_'||BM.Version)) AS "CommentCnt"
				, (SELECT COUNT(*) 
				     FROM SYS_LIKE 
				    WHERE 1=1
				    <choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				      AND TargetID = BM.MessageID||'_'||BM.Version) AS "RecommendCnt"
				, BM.ScrapCnt AS "ScrapCnt" 
				, BM.ReportCnt AS "ReportCnt" 
				, BM.FileCnt AS "FileCnt"
				, BM.FileExtension AS "FileExtension"
				, BM.TracbackCnt AS "TracbackCnt"
				, TO_CHAR(BM.RegistDate, 'YYYY.MM.DD HH24:MI:SS') AS "RegistDate"
				, BM.CreatorCode AS "CreatorCode" 
				, TO_CHAR(BM.CreateDate, 'YYYY-MM-DD HH24:MI:SS') AS "CreateDate"
				, DECODE(BM.UsePubDeptName , 'Y', FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorDept), FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorName)) AS "CreatorName"
				, BM.CreatorLevel AS "CreatorLevel"
				, BM.CreatorPosition AS "CreatorPosition"
				, BM.CreatorTitle AS "CreatorTitle" 
				, FN_BASEGETDICTIONARY_S(#{lang}, BM.CreatorDept) AS "CreatorDept"
				, BM.DeleteDate AS "DeleteDate"
				, BM.ReservationDate AS "ReservationDate"
				, BM.LinkURL AS "LinkURL" 
				, BM.RegistDept AS "RegistDept"
				, BM.OwnerCode AS "OwnerCode"
				, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS "OwnerName"
				, (SELECT FN_BASEGETDICTIONARY_S( #{lang}, MultiDisplayName) FROM SYS_OBJECT_GROUP WHERE groupcode = BM.RegistDept) AS "RegistDeptName"
				, (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS "FolderOwnerCode"
				, BP.DisplayName AS "ProgressState"
				, DECODE(BM.RevisionDate, NULL, TO_CHAR(BM.RegistDate,'YYYY.MM.DD HH24:MI:SS'), TO_CHAR(BM.RevisionDate, 'YYYY.MM.DD HH24:MI:SS')) AS "RevisionDate"
				, (SELECT FN_BASEGETDICTIONARY_S( #{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BM.RevisionCode) AS "RevisionName"
				, DECODE((SELECT COUNT(*) FROM BOARD_MESSAGE_READER WHERE MessageID = BM.MessageID AND ReaderCode = #{userCode}) ,0, 'N', 'Y' ) AS "IsRead"
				, DECODE((SELECT COUNT(*) FROM SYS_OBJECT_USER WHERE UserCode = #{userCode} AND BM.SecurityLevel IS NOT NULL AND BM.SecurityLevel != 256 AND BM.SecurityLevel >= SecurityLevel), 0, 'N', 'Y') AS "IsSecurity"
				<if test='useUserForm == "Y"'>
				<!-- 
				, FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value0, '')) AS "UF_Value0", FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value1, '')) AS "UF_Value1"
				, FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value2, '')) AS "UF_Value2", FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value3, '')) AS "UF_Value3"
				, FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value4, '')) AS "UF_Value4", FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value5, '')) AS "UF_Value5"
				, FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value6, '')) AS "UF_Value6", FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value7, '')) AS "UF_Value7"
				, FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value8, '')) AS "UF_Value8", FN_BASEGETDICTIONARY_S(#{lang}, NVL(BMUV.UF_Value9, '')) AS "UF_Value9"
				-->
				, UF_Value0 as "UF_Value0"
				, UF_Value1 as "UF_Value1"
				, UF_Value2 as "UF_Value2"
				, UF_Value3 as "UF_Value3"
				, UF_Value4 as "UF_Value4"
				, UF_Value5 as "UF_Value5"
				, UF_Value6 as "UF_Value6"
				, UF_Value7 as "UF_Value7"
				, UF_Value8 as "UF_Value8"
				, UF_Value9 as "UF_Value9"
				</if>
				<if test="bizSection == 'Board'">
			    	, (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = BM.CreatorCode) AS "MailAddress"
				</if>
				<if test="bizSection == 'Doc'">
				    , (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS "MailAddress"
				    , BM.MultiFolderType
				</if>
				<if test="viewType == 'Album'">
				    , (SELECT MAX(FileID) FROM SYS_FILE WHERE ObjectType ='FD' AND ObjectID = BM.FolderID AND MessageID = BM.MessageID AND SaveType IN ('IMAGE', 'INLINE')) AS "FileID"
				</if>
				FROM( SELECT BM.*, BM.FolderID AS F_FolderID, A.MenuID, A.FolderPath, 'ORIGIN' AS MultiFolderType
					,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
					FROM BOARD_MESSAGE BM
					JOIN SYS_OBJECT_FOLDER A ON BM.FolderID = A.FolderID
					<if test='useUserForm == "Y"'>
						<!-- LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version) AND BMUV.FolderID = #{folderID} -->
						LEFT OUTER JOIN (
							SELECT 
								MessageID, FolderID, Version,
								MAX(DECODE(rnum, 1, FieldValue, NULL)) AS UF_Value0,
								MAX(DECODE(rnum, 2, FieldValue, NULL)) AS UF_Value1,
								MAX(DECODE(rnum, 3, FieldValue, NULL)) AS UF_Value2,
								MAX(DECODE(rnum, 4, FieldValue, NULL)) AS UF_Value3,
								MAX(DECODE(rnum, 5, FieldValue, NULL)) AS UF_Value4,
								MAX(DECODE(rnum, 6, FieldValue, NULL)) AS UF_Value5,
								MAX(DECODE(rnum, 7, FieldValue, NULL)) AS UF_Value6,
								MAX(DECODE(rnum, 8, FieldValue, NULL)) AS UF_Value7,
								MAX(DECODE(rnum, 9, FieldValue, NULL)) AS UF_Value8,
								MAX(DECODE(rnum, 10, FieldValue, NULL)) AS UF_Value9
							FROM board_userform_value A
						  LEFT	JOIN (
				  				SELECT UserFormID,ROW_NUMBER() OVER(ORDER BY SortKey, UserFormID) AS rnum
								  FROM board_userform b  	
								 WHERE FolderID = #{folderID}
								   AND IsList = 'Y'
						           AND DeleteDate IS null) b ON (a.UserFormID = b.userformId
									)
			               WHERE a.FolderID = #{folderID}
						GROUP BY MessageID, FolderID, Version
						) BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version AND BMUV.FolderID = #{folderID})
					</if>
					LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = BM.MessageID AND BMA.Version = BM.Version
					<if test="multiCategory != null and multiCategory != ''">
						INNER JOIN (
							SELECT * FROM (
							    SELECT MessageID, Version
							    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
							    FROM board_userform_value
							    GROUP BY MessageID, Version
							) A
							WHERE 1=1
							<foreach collection="multiCategoryList" item="multiCategory" index="index">
								AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
							</foreach>
						) UFV ON UFV.MessageID = BM.MessageID AND UFV.Version = BM.Version
					</if>
					<!-- 보안등급 및 열람권한 체크 -->
					<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
					LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
									 FROM (
										SELECT SRA.ObjectID, SRA.MessageID
										FROM sys_read_acl AS SRA
										WHERE SRA.ObjectType = 'FD'
										AND SRA.TargetType = 'UR'
										AND SRA.TargetCode = #{userCode}
										UNION
										SELECT SRA.ObjectID, SRA.MessageID
										FROM sys_read_acl AS SRA
										WHERE SRA.ObjectType = 'FD'
										AND SRA.TargetType != 'UR'
										AND SRA.TargetCode IN
										<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
								            #{item}
									    </foreach>
									) AS SRA) SRA ON BM.FolderID = SRA.ObjectID AND BM.MessageID = SRA.MessageID
					</if>
					WHERE 1=1
					AND BM.DeleteDate IS NULL
					AND BM.MsgState IN ('C', 'A') 
					AND BM.MsgType != 'S' 
					<!-- UseSecurity가 Y일때 게시일 경우에는 작성자만 조회할 수 있음 -->
					AND (
						UseSecurity != 'Y'
						OR (
							UseSecurity = 'Y'
							AND (
								#{bizSection} = 'Board' AND CreatorCode = #{userCode}
								OR #{bizSection} = 'Doc'
							)
						)
					)
					AND (BM.ExpiredDate IS NULL OR BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
					AND (BM.ReservationDate IS NULL OR BM.ReservationDate &lt; TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))
					<if test="folderType != null and folderType == 'OneToOne'">
					    AND (BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = #{folderID}) LIKE '%' || #{userCode} || ';%' )
					</if>
					   AND BM.IsCurrent = 'Y'
					<if test="readSearchType != null and readSearchType != ''">
				       AND BM.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
				    </if>
					<!-- 보안등급 및 열람권한 체크 -->
					<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
				       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
				                 ELSE CASE WHEN (BM.SecurityLevel = '256' OR BM.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
				                	  ELSE 'N' END
				                 END) = 'Y'
				              		                		  
				       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
				                 ELSE CASE WHEN NVL(BM.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
							     		   WHEN NVL(BM.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
							     		   ELSE 'N' END
							     END) = 'Y'
 				    </if>
					<if test="searchText != null and searchText != ''">
						<choose>
					        <when test="searchType == 'Total'">
					            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
					       	</when>
					       	<when test="searchType == 'Mobile'">
					            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
					       	</when>
							<when test="searchType == 'UserForm'">
								AND 
								<choose>
									<when test='ufColumn.equalsIgnoreCase("UF_Value1")'>BMUV.UF_Value1 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value2")'>BMUV.UF_Value2 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value3")'>BMUV.UF_Value3 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value4")'>BMUV.UF_Value4 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value5")'>BMUV.UF_Value5 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value6")'>BMUV.UF_Value6 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value7")'>BMUV.UF_Value7 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value8")'>BMUV.UF_Value8 </when>
									<when test='ufColumn.equalsIgnoreCase("UF_Value9")'>BMUV.UF_Value9 </when>
									<otherwise>BMUV.UF_Value0 </otherwise>
								</choose>
								LIKE '%'|| #{searchText} ||'%'    
							</when>
					       	<when test="searchType == 'Number'">
								AND BM.Number_ LIKE '%'|| #{searchText} ||'%'  
							</when>
							<when test="searchType == 'Tag'">
					            AND  ( SELECT LISTAGG(Tag, ',') WITHIN GROUP (ORDER BY MessageID) FROM board_message_tag WHERE MessageID = BM.MessageID AND Version = BM.Version ) 
					            		LIKE '%' || #{searchText} || '%'  
					       	</when>
							<otherwise>
								AND 
								<choose>
									<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
									<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
									<otherwise>BM.Subject </otherwise>
								</choose>
								LIKE '%'|| #{searchText} ||'%'
							</otherwise>
						</choose>	
					</if>
					<if test="startDate != '' or endDate != ''">
						AND BM.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
					</if>
					<choose>
						<when test="bizSection == 'Doc' and grCode != null and grCode != ''">
						    AND A.FolderType = #{bizSection}
							AND BM.RegistDept = #{grCode}
						</when>
						<otherwise>
							AND BM.FolderID = #{folderID}
						</otherwise>
					</choose>
					
					<if test="bizSection == 'Doc' and (grCode == null or grCode == '')">
					    UNION ALL
					    
					    SELECT BM.*, BMF.FolderID AS F_FolderID, A.MenuID, A.FolderPath, 'SUB' AS MultiFolderType
							,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
						FROM BOARD_MESSAGE BM
						LEFT OUTER JOIN board_message_folder BMF ON BMF.MessageID = BM.MessageID AND BMF.Version = BM.Version
						JOIN SYS_OBJECT_FOLDER A ON A.FolderID = BMF.FolderID
						<if test='useUserForm == "Y"'>
							LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version) AND BMUV.FolderID = #{folderID}
						</if>
						LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = BM.MessageID AND BMA.Version = BM.Version
						<if test="multiCategory != null and multiCategory != ''">
							INNER JOIN (
								SELECT * FROM (
								    SELECT MessageID, Version
								    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
								    FROM board_userform_value
								    GROUP BY MessageID, Version
								) A
								WHERE 1=1
								<foreach collection="multiCategoryList" item="multiCategory" index="index">
									AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
								</foreach>
							) UFV ON UFV.MessageID = BM.MessageID AND UFV.Version = BM.Version
						</if>
						<!-- 보안등급 및 열람권한 체크 -->
						<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
						LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
										 FROM (
											SELECT SRA.ObjectID, SRA.MessageID
											FROM sys_read_acl AS SRA
											WHERE SRA.ObjectType = 'FD'
											AND SRA.TargetType = 'UR'
											AND SRA.TargetCode = #{userCode}
											UNION
											SELECT SRA.ObjectID, SRA.MessageID
											FROM sys_read_acl AS SRA
											WHERE SRA.ObjectType = 'FD'
											AND SRA.TargetType != 'UR'
											AND SRA.TargetCode IN
											<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
									            #{item}
										    </foreach>
										) AS SRA) SRA ON BM.FolderID = SRA.ObjectID AND BM.MessageID = SRA.MessageID
						</if>						
						WHERE BMF.FolderID = #{folderID}
						AND BM.DeleteDate IS NULL
						AND BM.MsgState IN ('C', 'A') 
						AND BM.MsgType != 'S' 
						<!-- UseSecurity가 Y일때 게시일 경우에는 작성자만 조회할 수 있음 -->
						AND (
							UseSecurity != 'Y'
							OR (
								UseSecurity = 'Y'
								AND (
									#{bizSection} = 'Board' AND CreatorCode = #{userCode}
									OR #{bizSection} = 'Doc'
								)
							)
						)
						AND (BM.ExpiredDate IS NULL OR BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
						AND (BM.ReservationDate IS NULL OR BM.ReservationDate &lt; TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))
						<if test="folderType != null and folderType == 'OneToOne'">
						    AND (BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = #{folderID}) LIKE '%' || #{userCode} || ';%' )
						</if>
						   AND BM.IsCurrent = 'Y'
						<if test="readSearchType != null and readSearchType != ''">
					       AND BM.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
					    </if>
						<!-- 보안등급 및 열람권한 체크 -->
						<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
					       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
					                 ELSE CASE WHEN (BM.SecurityLevel = '256' OR BM.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
					                	  ELSE 'N' END
					                 END) = 'Y'
					              		                		  
					       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
					                 ELSE CASE WHEN NVL(BM.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
								     		   WHEN NVL(BM.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
								     		   ELSE 'N' END
								     END) = 'Y'
						</if>
						<if test="searchText != null and searchText != ''">
							<choose>
						        <when test="searchType == 'Total'">
						            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
						       	</when>
						       	<when test="searchType == 'Mobile'">
						            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
						       	</when>
								<when test="searchType == 'UserForm'">
									AND 
									<choose>
										<when test='ufColumn.equalsIgnoreCase("UF_Value1")'>BMUV.UF_Value1 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value2")'>BMUV.UF_Value2 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value3")'>BMUV.UF_Value3 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value4")'>BMUV.UF_Value4 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value5")'>BMUV.UF_Value5 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value6")'>BMUV.UF_Value6 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value7")'>BMUV.UF_Value7 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value8")'>BMUV.UF_Value8 </when>
										<when test='ufColumn.equalsIgnoreCase("UF_Value9")'>BMUV.UF_Value9 </when>
										<otherwise>BMUV.UF_Value0 </otherwise>
									</choose>
									LIKE '%'|| #{searchText} ||'%'    
								</when>
						       	<when test="searchType == 'Number'">
									AND BM.Number_ LIKE '%'|| #{searchText} ||'%'
								</when>
								<when test="searchType == 'Tag'">
						            AND  ( SELECT LISTAGG(Tag, ',') WITHIN GROUP (ORDER BY MessageID) FROM board_message_tag WHERE MessageID = BM.MessageID AND Version = BM.Version ) 
						            		LIKE '%' || #{searchText} || '%'  
						       	</when>
								<otherwise>
									AND 
									<choose>
										<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
										<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
										<otherwise>BM.Subject </otherwise>
									</choose>
									LIKE '%'|| #{searchText} ||'%'
								</otherwise>
							</choose>	
						</if>
						<if test="startDate != '' or endDate != ''">
							AND BM.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
						</if>
				   </if>
			) BM 
			LEFT OUTER JOIN BOARD_CATEGORY BC ON BM.CategoryID = BC.CategoryID AND BC.FolderID = BM.FolderID
			LEFT OUTER JOIN BOARD_PROGRESSSTATE BP ON BM.progressstate = BP.StateID 
			<if test='useUserForm == "Y"'>
			LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version) AND BMUV.FolderID = #{folderID}
			</if>
			WHERE 1=1
			<if test="categoryID != null and categoryID != ''">
		        <choose>
			    	<when test="categoryGubun == 'Y'">
			    	    AND (BC.MemberOf = #{categoryID} OR BC.CategoryID = #{categoryID})
			        </when>
			        <otherwise>
			            AND BM.CategoryID = #{categoryID}
			        </otherwise>
			    </choose>
		    </if>
		    <trim prefix="ORDER BY"  prefixOverrides =",">
				<if test='useTopNotice == "Y"'>
					ListTop ASC,
				</if>
				<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
					<choose>
						<when test='sortColumn.equalsIgnoreCase("FileCnt")'>"FileCnt"</when>
						<when test='sortColumn.equalsIgnoreCase("CategoryName")'>"CategoryName"</when>
						<when test='sortColumn.equalsIgnoreCase("Subject")'>"Subject"</when>
						<when test='sortColumn.equalsIgnoreCase("LinkURL")'>"LinkURL"</when>
						<when test='sortColumn.equalsIgnoreCase("CreatorName")'>"CreatorName"</when>
						<when test='sortColumn.equalsIgnoreCase("RegistDate")'>"RegistDate"</when>
						<when test='sortColumn.equalsIgnoreCase("ReadCnt")'>"ReadCnt"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value0")'>"UF_Value0"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value1")'>"UF_Value1"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value2")'>"UF_Value2"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value3")'>"UF_Value3"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value4")'>"UF_Value4"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value5")'>"UF_Value5"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value6")'>"UF_Value6"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value7")'>"UF_Value7"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value8")'>"UF_Value8"</when>
						<when test='sortColumn.equalsIgnoreCase("UF_Value9")'>"UF_Value9"</when>
						<when test='sortColumn.equalsIgnoreCase("Version")'>"Version"</when>
						<when test='sortColumn.equalsIgnoreCase("Number")'>"Number"</when>
						<when test='sortColumn.equalsIgnoreCase("IsCheckOut")'>"IsCheckOut"</when>
						<when test='sortColumn.equalsIgnoreCase("RegistDept")'>"RegistDept"</when>
						<when test='sortColumn.equalsIgnoreCase("OwnerName")'>"OwnerName"</when>
						<when test='sortColumn.equalsIgnoreCase("RevisionDate")'>"RevisionDate"</when>
						<otherwise>"MessageID"</otherwise>
					</choose>
					<choose>
						<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
						<otherwise> DESC</otherwise>
					</choose>,
				</if>
				Seq DESC, Step ASC
			</trim>
		<include refid="oracle.include.pagingFooter"/>
		<if test="mode != null and mode != '' ">
		   	<choose>
			    <when test="mode == 'prev'" >
			      AND RNUM = TO_NUMBER(#{rNum}) - 1
			    </when>
			    <otherwise> 
			      AND RNUM = TO_NUMBER(#{rNum}) + 1
			    </otherwise>		  
		    </choose>
		</if>  
	</select>
    
	<select id="selectMessageGridCount" resultType="java.lang.Long">
	/* user.message.selectMessageGridCount */
		SELECT COUNT(0) FROM (
			SELECT BM.*
			FROM( 
				SELECT DISTINCT
				A.MessageID 
				,A.FolderID 
				,A.IsInherited	,A.ParentID
				,H.DisplayName AS FolderName
				,H.MenuID
				,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
				<choose>
			    	<when test="boardType == 'RequestModify'">
			    	    ,M.RequestID						
			    	    ,M.RequestMessage					
			    	    ,M.RequestorCode					
			    	    ,FN_BASEGETDICTIONARY_S(#{lang}, M.RequestorName) AS RequestorName	
			    	    , (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = M.RequestorCode) AS RequestorMailAddress
			    	    ,TO_CHAR(M.RequestDate,'YYYY.MM.DD HH24:MI:SS') AS RequestDate		
			    	    ,M.AnswererCode						
			    	    , (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = M.AnswererCode) AS AnswererMailAddress
			    	    ,FN_BASEGETDICTIONARY_S(#{lang}, M.AnswererName) AS AnswererName	
			    	    ,M.AnswerContent					
			    	    ,TO_CHAR(M.AnswerDate, 'YYYY.MM.DD HH24:MI:SS')	AS AnswerDate		
			    	    ,M.RequestStatus					
			    	</when>
			    	<when test="boardType == 'Approval'">
			    	    , F.ProcessID AS ProcessID
						, F.ProcessDefID AS ProcessDefID 
						, F.State AS ProcessState 
						, F.RegistDate AS ProcessRegistDate
						, F.RegisterCode AS ProcessRegisterCode
						, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State = 1 AND ActorCode = #{userCode}) AS State
						, (SELECT State FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} and ProcessID = F.ProcessID and ActorRole = 'Register') AS ActivityState
						, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID) AS TotalApproverCnt
						, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State IN (7,9)) AS TotalApprovalCnt 
			    	</when>
			    	<when test="boardType == 'DocAuth'">
			    	    , DRA.RequestID
			    	    , DRA.RegisterCode AS RequestorCode
			    	    , DRA.RequestMessage
			    	    , TO_CHAR(DRA.RequestDate, 'YYYY.MM.DD HH24:MI:SS') AS RequestDate
			    	    , DRA.AclList AS RequestAclList
			    	    , DRA.ActType
			    	</when>
		    	</choose>
				FROM BOARD_MESSAGE A
				INNER JOIN SYS_OBJECT_FOLDER H ON A.FolderID = H.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
				LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = A.MessageID AND BMA.Version = A.Version
				<choose>
			    	<when test="boardType == 'MyInterest'">
			    	    INNER JOIN BOARD_MESSAGE_FAVORITE J ON A.MessageID=J.MessageID AND J.RegisterCode=#{userCode}
			    	</when>
			    	<when test="boardType == 'RequestModify'">
			    	    INNER JOIN BOARD_REQUEST_MODIFY M ON (A.MessageID=M.MessageID AND M.RequestStatus != 'Deleted')
			    	</when>
			    	<when test="boardType == 'Approval'">
			    	    <if test="boxType == 'Request'">	
							INNER JOIN SYS_PROCESS F ON A.MessageID=F.MessageID AND F.ObjectType=#{bizSection}
						</if>
						<if test="boxType == 'Receive'">
							INNER JOIN SYS_PROCESS F ON A.MessageID=F.MessageID AND F.ObjectType=#{bizSection} 
							AND F.ProcessID IN (SELECT DISTINCT ProcessID FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} AND ActorRole != 'Register' )
						</if>
			    	</when>
			    	<when test="boardType == 'DocAuth'">
			    	    <if test="boxType == 'Request'">
			    	        INNER JOIN DOC_REQUEST_ACL DRA ON A.MessageID=DRA.MessageID AND A.Version=DRA.Version AND DRA.RegisterCode = #{userCode}
			    	    </if>
			    	    <if test="boxType == 'Receive'">
							INNER JOIN DOC_REQUEST_ACL DRA ON A.MessageID=DRA.MessageID AND A.Version=DRA.Version AND DRA.ActorCode = #{userCode}
						</if>
			    	</when>
			    	<when test="boardType == 'CheckIn' or boardType == 'CheckOut'">
			    	    LEFT OUTER JOIN (SELECT MAX(HistoryID) AS HistoryID, MessageID, MAX(Version) AS Version, CO_Code, ActType FROM DOC_INOUT_HISTORY WHERE DeleteDate IS NULL GROUP BY MessageID, CO_Code, ActType) DIH 
						ON (A.MessageID = DIH.MessageID AND A.Version = DIH.Version)
			    	</when>
			    	<when test="boardType == 'DocTotal' and searchFolderIDs != null and searchFolderIDs != ''">
			    	    INNER JOIN (
			    	    	SELECT * FROM (
						    	SELECT MessageID, Version
							    , ';' || LISTAGG(FolderID, ';' ) WITHIN GROUP(ORDER BY FolderID) || ';' AS FolderIDs
							    FROM (
							        SELECT MessageID, Version, FolderID
							        FROM board_message_folder
							        WHERE 1=1
							        <if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
										AND FolderID IN 
										<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
											#{searchFolderID}
										</foreach>
									</if>
							        
							        UNION
							        
							        SELECT MessageID, Version, FolderID
							        FROM board_message
							        WHERE 1=1
							        <if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
										AND FolderID IN 
										<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
											#{searchFolderID}
										</foreach>
									</if>
							    ) A
							    GROUP BY MessageID, Version
							) RESULT
							WHERE 1=1
							<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
								<foreach collection="searchFolderIDArr" item="searchFolderID" index="index">
									AND FolderIDs LIKE '%;' || #{searchFolderID} || ';%'
								</foreach>
							</if>
						) B ON A.MessageID = B.MessageID AND A.Version = B.Version
			    	</when>
		    	</choose>
		    	<if test="multiCategory != null and multiCategory != ''">
					INNER JOIN (
						SELECT * FROM (
						    SELECT MessageID, Version
						    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
						    FROM board_userform_value
						    GROUP BY MessageID, Version
						) A
						WHERE 1=1
						<foreach collection="multiCategoryList" item="multiCategory" index="index">
							AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
						</foreach>
					) UFV ON UFV.MessageID = A.MessageID AND UFV.Version = A.Version
				</if>
				<!-- 보안등급 및 열람권한 체크 -->
				<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
				LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
								 FROM (
									SELECT SRA.ObjectID, SRA.MessageID
									FROM sys_read_acl AS SRA
									WHERE SRA.ObjectType = 'FD'
									AND SRA.TargetType = 'UR'
									AND SRA.TargetCode = #{userCode}
									UNION
									SELECT SRA.ObjectID, SRA.MessageID
									FROM sys_read_acl AS SRA
									WHERE SRA.ObjectType = 'FD'
									AND SRA.TargetType != 'UR'
									AND SRA.TargetCode IN
									<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
							            #{item}
								    </foreach>
								) AS SRA) SRA ON A.FolderID = SRA.ObjectID AND A.MessageID = SRA.MessageID
				</if>
			WHERE 1=1
			AND IsCurrent = 'Y'
	        AND (H.MenuID = #{menuID} OR H.DomainID = 0)
			<if test='aclDataArr != null and aclDataArr.length != 0'>
				AND H.FolderID IN 
				<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			</if>
			<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
				AND H.FolderID IN 
				<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
					#{searchFolderID}
				</foreach>
			</if>
			<if test="folderID != null and folderID != ''">
				AND H.FolderID = #{folderID}
			</if>
	        AND H.FolderType != 'QuickComment' 
			<if test="bizSection == 'Board'">
			    AND MsgType NOT IN ('N', 'B')
			</if>
			<if test="bizSection == 'Doc'">
			    AND MsgType IN ('N', 'B', 'M') 
			</if>
			<if test="isMobileSupport == 'Y'">
			    AND H.isMobileSupport = 'Y'
			</if>
	        <choose>
			    <when test="communityID != null and communityID !=''">
					AND H.ObjectType = 'Community'
				</when>
				<otherwise>
					AND H.ObjectType = #{bizSection}
				</otherwise>
			</choose>
			<include refid="chooseBoardType"/>
		    <if test="requestStatus != null and requestStatus != ''">
		        <choose>
			    	<when test="requestStatus == 'Ready'">
			    	    AND MsgState IN ('Ready')
			        </when>
			        <when test="requestStatus == 'Process'">
			    	    AND MsgState IN ('Process')
			        </when>
			        <otherwise>
			            AND MsgState IN ('Complete')
			        </otherwise>
			    </choose>
		    </if>
		    <if test="readSearchType != null and readSearchType != ''">
		       AND A.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
		    </if>
		    <!-- 보안등급 및 열람권한 체크 -->
		    <if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
		        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
		                  ELSE CASE WHEN (A.SecurityLevel = '256' OR A.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
		                	   		ELSE 'N' END
		                  END) = 'Y'
		              		                		  
		        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
		                  ELSE CASE WHEN NVL(A.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
					     		    WHEN NVL(A.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
					     		    ELSE 'N' END
					      END) = 'Y'
			</if>		    
			<if test="searchText != null and searchText != ''">
			    <choose>
			        <when test="searchType == 'Total'">
			            AND ( A.Subject LIKE '%'|| #{searchText} || '%' OR BodyText LIKE '%'|| #{searchText} ||'%')
			       	</when>
			       	<when test="searchType == 'Mobile'">
			            AND ( A.Subject LIKE '%'|| #{searchText} || '%' OR BodyText LIKE '%'|| #{searchText} ||'%' OR CreatorName LIKE '%'|| #{searchText} ||'%')
			       	</when>
			       	<when test="searchType == 'Number'">
			            AND Number_ LIKE '%'|| #{searchText} ||'%'  
			       	</when>
			       	<when test="searchType == 'Tag'">
						AND  ( SELECT LISTAGG(Tag, ',') WITHIN GROUP (ORDER BY MessageID) FROM board_message_tag WHERE MessageID = A.MessageID AND Version = A.Version ) 
						LIKE '%' || #{searchText} || '%'  
					</when>
			       	<otherwise>
						AND 
						<choose>
							<when test='searchType.equalsIgnoreCase("BodyText")'>BodyText </when>
							<when test='searchType.equalsIgnoreCase("CreatorName")'>CreatorName </when>
							<otherwise>Subject </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'
			       	</otherwise>
				</choose>
			</if>
			<if test="startDate != '' or endDate != ''">
				AND A.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
			</if>
			<choose>
			   	<when test="boardType == 'Approval'">
		    	    
		    	    <if test="boxType == 'Request'">
						AND F.RegisterCode = #{userCode}
					</if>
		    	    <choose>
				    	<when test='approvalStatus == "R"'>	
				    		AND (MsgState IN ('R', 'BR')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State &gt; 0 -->
				        </when>
				        <when test='approvalStatus == "A"'> 
				    		AND (MsgState IN ('A', 'BA')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
				        </when>
				        <when test='approvalStatus == "D"'>
				    		AND (MsgState IN ('D')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
				        </when>
				        <when test='approvalStatus == "P"'> 
				    		AND (MsgState IN ('R')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
				        </when>
				        <otherwise>
				            AND (MsgState IN ('R', 'D', 'A', 'BR', 'BA')) AND (MsgType IN ('O', 'N', 'B'))
				        </otherwise>
				    </choose>
		    	</when>
		    	<when test="boardType == 'DocAuth'">
		    	    <!-- 요청함 -->
		    	    <if test="boxType == 'Receive'">	
						<choose>
					    	<when test='approvalStatus == "R"'>	
					    		AND (ActType IN ('R'))
					        </when>
					        <when test='approvalStatus == "A"'> 
					    		AND (ActType IN ('D', 'A'))
					        </when>
					        <when test='approvalStatus == "D"'> 
					    		AND (ActType IN ('D'))
					        </when>
					        <otherwise>
					            
					        </otherwise>
					    </choose>
					</if>
		    	</when>
	    	</choose>
	    	
			<if test="bizSection == 'Doc' and boardType == 'DocTotal'">
			    UNION ALL
			    
			    SELECT DISTINCT
					A.MessageID 
					,H.FolderID 
					,A.IsInherited	,A.ParentID
					,H.DisplayName AS FolderName
					,H.MenuID
					,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
					FROM BOARD_MESSAGE A
					LEFT OUTER JOIN board_message_folder BMF ON A.MessageID = BMF.MessageID AND A.Version = BMF.Version
					<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
						AND BMF.FolderID IN 
						<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
							#{searchFolderID}
						</foreach>
					</if>
					INNER JOIN SYS_OBJECT_FOLDER H ON H.FolderID = BMF.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
					LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = A.MessageID AND BMA.Version = A.Version
		    	    INNER JOIN (
		    	    	SELECT * FROM (
					    	SELECT MessageID, Version
						    , ';' || LISTAGG(FolderID, ';' ) WITHIN GROUP(ORDER BY FolderID) || ';' AS FolderIDs
						    FROM (
						        SELECT MessageID, Version, FolderID
						        FROM board_message_folder
						        WHERE 1=1
								<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
									AND FolderID IN 
									<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
										#{searchFolderID}
									</foreach>
								</if>
						        
						        UNION
						        
						        SELECT MessageID, Version, FolderID
						        FROM board_message
						        WHERE 1=1
								<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
									AND FolderID IN 
									<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
										#{searchFolderID}
									</foreach>
								</if>
						    ) A
						    GROUP BY MessageID, Version
						) RESULT
						WHERE 1=1
						<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
			    	    	<foreach collection="searchFolderIDArr" item="searchFolderID" index="index">
								AND FolderIDs LIKE '%;' || #{searchFolderID} || ';%'
							</foreach>
						</if>
					) B ON A.MessageID = B.MessageID AND A.Version = B.Version
					<if test="multiCategory != null and multiCategory != ''">
						INNER JOIN (
							SELECT * FROM (
							    SELECT MessageID, Version
							    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
							    FROM board_userform_value
							    GROUP BY MessageID, Version
							) A
							WHERE 1=1
							<foreach collection="multiCategoryList" item="multiCategory" index="index">
								AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
							</foreach>
						) UFV ON UFV.MessageID = A.MessageID AND UFV.Version = A.Version
					</if>
					<!-- 보안등급 및 열람권한 체크 -->
					<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
					LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
									 FROM (
										SELECT SRA.ObjectID, SRA.MessageID
										FROM sys_read_acl AS SRA
										WHERE SRA.ObjectType = 'FD'
										AND SRA.TargetType = 'UR'
										AND SRA.TargetCode = #{userCode}
										UNION
										SELECT SRA.ObjectID, SRA.MessageID
										FROM sys_read_acl AS SRA
										WHERE SRA.ObjectType = 'FD'
										AND SRA.TargetType != 'UR'
										AND SRA.TargetCode IN
										<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
								            #{item}
									    </foreach>
									) AS SRA) SRA ON A.FolderID = SRA.ObjectID AND A.MessageID = SRA.MessageID
					</if>
				WHERE 1=1
				AND IsCurrent = 'Y'
		        AND (H.MenuID = #{menuID} OR H.DomainID = 0)
				<if test='aclDataArr != null and aclDataArr.length != 0'>
					AND H.FolderID IN 
					<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
						#{item}
					</foreach>
				</if>
				<if test="folderID != null and folderID != ''">
					AND H.FolderID = #{folderID}
				</if>
				<if test="isMobileSupport == 'Y'">
				    AND H.isMobileSupport = 'Y'
				</if>
		        AND H.FolderType != 'QuickComment' 
				<if test="bizSection == 'Board'">
				    AND MsgType NOT IN ('N', 'B')
				</if>
				<if test="bizSection == 'Doc'">
				    AND MsgType IN ('N', 'B', 'M') 
				</if>
		        <choose>
				    <when test="communityID != null and communityID !=''">
						AND H.ObjectType = 'Community'
					</when>
					<otherwise>
						AND H.ObjectType = #{bizSection}
					</otherwise>
				</choose>
				<include refid="chooseBoardType"/>
			    <if test="requestStatus != null and requestStatus != ''">
			        <choose>
				    	<when test="requestStatus == 'Ready'">
				    	    AND MsgState IN ('Ready')
				        </when>
				        <when test="requestStatus == 'Process'">
				    	    AND MsgState IN ('Process')
				        </when>
				        <otherwise>
				            AND MsgState IN ('Complete')
				        </otherwise>
				    </choose>
			    </if>
			    <if test="readSearchType != null and readSearchType != ''">
				       AND A.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
			    </if>
			    <!-- 보안등급 및 열람권한 체크 -->
			    <if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
			        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
			                  ELSE CASE WHEN (A.SecurityLevel = '256' OR A.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
			                	   		ELSE 'N' END
			                  END) = 'Y'
			              		                		  
			        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
			                  ELSE CASE WHEN NVL(A.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
						     		    WHEN NVL(A.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
						     		    ELSE 'N' END
						      END) = 'Y'
				</if>
				<if test="searchText != null and searchText != ''">
				    <choose>
				        <when test="searchType == 'Total'">
				            AND ( A.Subject LIKE '%'|| #{searchText} || '%' OR BodyText LIKE '%'|| #{searchText} ||'%')
				       	</when>
				       	<when test="searchType == 'Mobile'">
				            AND ( A.Subject LIKE '%'|| #{searchText} || '%' OR BodyText LIKE '%'|| #{searchText} ||'%' OR CreatorName LIKE '%'|| #{searchText} ||'%')
				       	</when>
				       	<when test="searchType == 'Number'">
				            AND Number_ LIKE '%'|| #{searchText} ||'%'  
				       	</when>
						<otherwise>
							AND 
							<choose>
								<when test='searchType.equalsIgnoreCase("BodyText")'>BodyText </when>
								<when test='searchType.equalsIgnoreCase("CreatorName")'>CreatorName </when>
								<otherwise>Subject </otherwise>
							</choose>
							LIKE '%'|| #{searchText} ||'%'
				       	</otherwise>
					</choose>
				</if>
				<if test="startDate != '' or endDate != ''">
					AND A.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
				</if>
				<choose>
				   	<when test="boardType == 'Approval'">
			    	    
			    	    <if test="boxType == 'Request'">
							AND F.RegisterCode = #{userCode}
						</if>
			    	    <choose>
					    	<when test='approvalStatus == "R"'>	
					    		AND (MsgState IN ('R', 'BR')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State &gt; 0 -->
					        </when>
					        <when test='approvalStatus == "A"'> 
					    		AND (MsgState IN ('A', 'BA')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
					        </when>
					        <when test='approvalStatus == "D"'>
					    		AND (MsgState IN ('D')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
					        </when>
					        <when test='approvalStatus == "P"'> 
					    		AND (MsgState IN ('R')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
					        </when>
					        <otherwise>
					            AND (MsgState IN ('R', 'D', 'A', 'BR', 'BA')) AND (MsgType IN ('O', 'N', 'B'))
					        </otherwise>
					    </choose>
			    	</when>
			    	<when test="boardType == 'DocAuth'">
			    	    <!-- 요청함 -->
			    	    <if test="boxType == 'Receive'">	
							<choose>
						    	<when test='approvalStatus == "R"'>	
						    		AND (ActType IN ('R'))
						        </when>
						        <when test='approvalStatus == "A"'> 
						    		AND (ActType IN ('D', 'A'))
						        </when>
						        <when test='approvalStatus == "D"'> 
						    		AND (ActType IN ('D'))
						        </when>
						        <otherwise>
						            
						        </otherwise>
						    </choose>
						</if>
			    	</when>
		    	</choose>
			</if>
	    	) BM 
	    	WHERE 1 = 1
	    	<if test="boardType == 'Approval' and boxType == 'Receive' and approvalStatus != '' and approvalStatus != null">
	    		<choose>
			    	<when test='approvalStatus == "R"'>	<!-- 승인 요청 받은 게시 -->
			    		AND State &gt; 0
			        </when>
			        <otherwise> <!-- 승인 완료된 게시(A), 반려된 게시(D), 다른사람이 결제해야할 승인 요청 게시(진행중)(P)- -->
			            AND State = 0
			        </otherwise>
			    </choose>
	    	</if>
	    ) RESULT
	</select>
	
	<!-- 게시글 목록 Grid 데이터 / 게시판 구분에 따라 모든 데이터를 조회하므로 추후 분리 -->
	<select id="selectMessageGridList" parameterType="cmap" resultType="cmap">
	/* user.message.selectMessageGridList */
		SELECT RESULT.MessageID AS "MessageID" 
			 , RESULT.Version AS "Version" 
			 , RESULT.Number_ AS "Number" 
			 , RESULT.FolderID AS "FolderID" 
			 , RESULT.IsInherited AS "IsInherited"
			 , RESULT.ParentID AS "ParentID"
			 , RESULT.MsgType AS "MsgType"
			 , RESULT.MsgState AS "MsgState"
			 , RESULT.CategoryID  AS "CategoryID"
			 , RESULT.Seq   AS "Seq"
			 , RESULT.Step AS "Step"
			 , RESULT.Depth   AS "Depth"
			 , RESULT.Subject AS "Subject"
			 , RESULT.IsPopup AS "IsPopup"
			 , RESULT.IsTop AS "IsTop"
			 , RESULT.PopupStartDate AS "PopupStartDate"
			 , RESULT.PopupEndDate AS "PopupEndDate"
			 , RESULT.TopStartDate AS "TopStartDate"
			 , RESULT.TopEndDate AS "TopEndDate"
			 , RESULT.ExpiredDate AS "ExpiredDate"
			 , RESULT.ListTop AS "ListTop"
			 , RESULT.UseSecurity AS "UseSecurity"
			 , RESULT.UseAnonym AS "UseAnonym"
			 , RESULT.IsApproval AS "IsApproval"
			 , RESULT.IsUserForm  AS "IsUserForm"
			 , RESULT.IsCheckOut AS "IsCheckOut"	
			 , RESULT.UseScrap  AS "UseScrap"	
			 , RESULT.NoticeMedia AS "NoticeMedia"	
			 , RESULT.UseRSS AS "UseRSS"	
			 , RESULT.TrackBackURL   AS "TrackBackURL"	
			 , RESULT.TracbackCnt   AS "TracbackCnt"	
			 , RESULT.AnswerCnt  AS "AnswerCnt"	
			 , RESULT.ReadCnt AS "ReadCnt"	
			 , RESULT.ScrapCnt AS "ScrapCnt"	
			 , RESULT.ReportCnt AS "ReportCnt"	
			 , RESULT.FileCnt AS "FileCnt"	
			 , RESULT.FileExtension AS "FileExtension"	  
			 , RESULT.RegistDate   AS "RegistDate"	     
			 , RESULT.SecurityLevel AS "SecurityLevel"
			 , RESULT.RevisionCode AS "RevisionCode"	
			 , RESULT.DocRevisionDate AS "DocRevisionDate"	        
			 , RESULT.BoardReservationDate AS "BoardReservationDate"	    
			 , RESULT.ProgressState AS "ProgressState"	          
			 , RESULT.CreatorCode AS "CreatorCode"	   
			 , RESULT.CreateDate AS "CreateDate"	        
			 , RESULT.CreatorName AS "CreatorName"	   
			 , RESULT.CreatorLevel  AS "CreatorLevel"	   
			 , RESULT.CreatorPosition  AS "CreatorPosition"	 
			 , RESULT.CreatorTitle  AS "CreatorTitle"	   
			 , RESULT.CreatorDept   AS "CreatorDept"	 
			 , RESULT.DeleteDate  AS "DeleteDate"	 
			 , RESULT.RegistDept  AS "RegistDept"	 
			 , RESULT.OwnerCode AS "OwnerCode"	  
			 , RESULT.FolderName AS "FolderName"	  
			 , RESULT.MenuID   AS "MenuID"	  
			 , RESULT.CommentCnt  AS "CommentCnt"	  
			 , RESULT.RecommendCnt AS "RecommendCnt"	   
			 , RESULT.FolderOwnerCode AS "FolderOwnerCode"	 
			 , RESULT.MailAddress AS "MailAddress"	
			<choose>
			    	<when test="boardType == 'RequestModify'">
			    	    ,RESULT.RequestID AS "RequestID"		
			    	    ,RESULT.RequestMessage AS "RequestMessage"			
			    	    ,RESULT.RequestorCode AS "RequestorCode"				
			    	    ,RESULT.RequestorName AS "RequestorName"		
			    	    ,RESULT.RequestorMailAddress AS "RequestorMailAddress"		
			    	    ,RESULT.RequestDate	AS "RequestDate"		 	
			    	    ,RESULT.AnswererCode AS "AnswererCode"		 		
			    	    ,RESULT.AnswererMailAddress AS "AnswererMailAddress"		
			    	    ,RESULT.AnswererName AS "AnswererName"		
			    	    ,RESULT.AnswerContent AS "AnswerContent"			
			    	    ,RESULT.AnswerDate AS "AnswerDate"			
			    	    ,RESULT.RequestStatus AS "RequestStatus"		
			    	</when>
			    	<when test="boardType == 'Approval'">
			    	    , RESULT.ProcessID AS "ProcessID"
						, RESULT.ProcessDefID AS "ProcessDefID" 
						, RESULT.ProcessState AS "ProcessState" 
						, RESULT.ProcessRegistDate AS "ProcessRegistDate" 
						, RESULT.ProcessRegisterCode AS "ProcessRegisterCode" 
						, RESULT.State AS "State" 
						, RESULT.ActivityState AS "ActivityState" 
						, RESULT.TotalApproverCnt AS "TotalApproverCnt" 
						, RESULT.TotalApprovalCnt AS "TotalApprovalCnt" 
			    	</when>
			    	<when test="boardType == 'DocAuth'">
			    	    , RESULT.RequestID AS "RequestID" 
			    	    , RESULT.RequestorCode  AS "RequestorCode" 
			    	    , RESULT.RequestorName  AS "RequestorName" 
			    	    , RESULT.RequestMessage  AS "RequestMessage" 
			    	    , RESULT.RequestDate  AS "RequestDate" 
			    	    , RESULT.RequestAclList  AS "RequestAclList" 
			    	    , RESULT.ActType  AS "ActType"
			    	</when>
			    	<when test="boardType == 'DocTotal'">
			    	    , RESULT.MultiFolderType AS "MultiFolderType"
			    	</when>
		    	</choose>
			 , RESULT.OwnerName AS "OwnerName"  
			 , RESULT.RegistDeptName AS "RegistDeptName"   
			 , RESULT.RevisionName AS "RevisionName"   
			 , RESULT.RevisionDate AS "RevisionDate"    
			 , RESULT.ReservationDate AS "ReservationDate"      
			 , RESULT.IsRead AS "IsRead"
			 , RESULT.IsSecurity AS "IsSecurity"
			 , RESULT.FileID AS "FileID"      
			 , RNum "RNUM"      
		FROM (
			SELECT
				 BM.MessageID ,BM.Version, BM.Number_, BM.FolderID, BM.IsInherited, BM.ParentID
				,BM.MsgType, CASE WHEN NVL(BM.DeleteDate, '') = '' THEN BM.MsgState ELSE 'DEL' END as MsgState
				,BM.CategoryID, BM.Seq, BM.Step, BM.Depth, BM.Subject
				,BM.IsPopup, BM.IsTop, BM.PopupStartDate, BM.PopupEndDate
				,BM.TopStartDate	,BM.TopEndDate ,BM.ExpiredDate, BM.ListTop
				,BM.UseSecurity ,BM.UseAnonym ,BM.IsApproval ,BM.IsUserForm
				,BM.IsCheckOut ,BM.UseScrap ,BM.NoticeMedia
				,BM.UseRSS ,BM.TrackBackURL ,BM.TracbackCnt
				,BM.AnswerCnt, BM.ReadCnt, BM.ScrapCnt ,BM.ReportCnt
				,BM.FileCnt ,BM.FileExtension
				,TO_CHAR(BM.RegistDate, 'YYYY.MM.DD HH24:MI:SS') AS RegistDate
				,TO_CHAR(BM.CreateDate, 'YYYY.MM.DD HH24:MI:SS') AS CreateDate
				,BM.RevisionCode ,BM.RevisionDate AS DocRevisionDate
				,BM.ReservationDate AS BoardReservationDate
				,BM.ProgressState ,BM.CreatorCode ,FN_BASEGETDICTIONARY_S(#{lang}, BM.CreatorName) AS CreatorName
				,BM.CreatorLevel		,BM.CreatorPosition		,BM.CreatorTitle , FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorDept) AS CreatorDept
				,BM.DeleteDate ,BM.RegistDept ,BM.OwnerCode
				,BM.FolderName ,BM.MenuID
				,(SELECT COUNT(*) 
				 	FROM SYS_COMMENT 
				   WHERE DeleteDate IS NULL 
				 	<choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				 	  AND TargetID = BM.MessageID||'_'||BM.Version)) AS CommentCnt 
				,(SELECT COUNT(*) 
				    FROM SYS_LIKE 
				   WHERE 1=1
				    <choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				      AND TargetID = BM.MessageID||'_'||BM.Version) AS RecommendCnt
				,(SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS FolderOwnerCode
				<if test="bizSection == 'Board'">
			    	, (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = BM.CreatorCode) AS MailAddress
				</if>
				<if test="bizSection == 'Doc'">
				    , (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS MailAddress
				</if>
				<choose>
			    	<when test="boardType == 'RequestModify'">
			    	    ,BM.RequestID		
			    	    ,BM.RequestMessage	
			    	    ,BM.RequestorCode	
			    	    ,BM.RequestorName
			    	    ,BM.RequestorMailAddress
			    	    ,BM.RequestDate		
			    	    ,BM.AnswererCode	
			    	    ,BM.AnswererMailAddress
			    	    ,BM.AnswererName	
			    	    ,BM.AnswerContent	
			    	    ,BM.AnswerDate		
			    	    ,BM.RequestStatus	
			    	</when>
			    	<when test="boardType == 'Approval'">
			    	    , BM.ProcessID AS ProcessID
						, BM.ProcessDefID AS ProcessDefID 
						, BM.ProcessState 
						, BM.ProcessRegistDate
						, BM.ProcessRegisterCode
						, BM.State
						, BM.ActivityState
						, BM.TotalApproverCnt
						, BM.TotalApprovalCnt 
			    	</when>
			    	<when test="boardType == 'DocAuth'">
			    	    , BM.RequestID
			    	    , BM.RequestorCode
			    	    , BM.RequestorName
			    	    , BM.RequestMessage
			    	    , BM.RequestDate
			    	    , BM.RequestAclList
			    	    , BM.ActType
			    	</when>
			    	<when test="boardType == 'DocTotal'">
			    	    , BM.MultiFolderType
			    	</when>
		    	</choose>
				, BM.OwnerName
				, BM.RegistDeptName
				, BM.RevisionName
				, BM.RevisionDate
				, BM.ReservationDate
				, BM.SecurityLevel
				, BM.IsRead
		    	, BM.IsSecurity
		    	, BM.FileID
		    	, RNum
			FROM(
				<include refid="oracle.include.pagingHeader"/> 
				SELECT	  A.MessageID
						, A.Version 
						, A.Number_ 
						, A.FolderID
						, A.IsInherited
						, A.ParentID
						, A.MsgType
						, A.MsgState
						, A.CategoryID
						, A.Seq
						, A.Step
						, A.Depth
						, A.Subject
						, A.IsPopup
						, A.IsTop
						, A.PopupStartDate
						, A.PopupEndDate
						, A.TopStartDate
						, A.TopEndDate
						, A.ExpiredDate
						, A.UseSecurity
						, A.UseAnonym
						, A.IsApproval
						, A.IsUserForm
						, A.IsCheckOut
						, A.UseScrap
						, A.NoticeMedia
						, A.UseRSS
						, A.TrackBackURL
						, A.TracbackCnt
						, A.AnswerCnt
						, A.ReadCnt
						, A.ScrapCnt
						, A.ReportCnt
						, A.FileCnt
						, A.FileExtension
						, A.RegistDate
						, A.RevisionCode
						, A.ProgressState
						, A.CreatorCode
						, A.CreateDate
						, A.CreatorName
						, A.CreatorLevel
						, A.CreatorPosition
						, A.CreatorTitle
						, A.CreatorDept
						, A.DeleteDate
						, A.RegistDept
						, A.OwnerCode
						, A.SecurityLevel
						, A.FolderName
						, A.MenuID
						, A.ListTop
					<choose>
				    	<when test="boardType == 'RequestModify'">
							, A.RequestID
							, A.RequestMessage
							, A.RequestorCode
							, A.RequestorName
							, A.RequestorMailAddress
							, A.RequestDate
							, A.AnswererCode
							, A.AnswererMailAddress
							, A.AnswererName
							, A.AnswerContent
							, A.AnswerDate
							, A.RequestStatus
				    	</when>
				    	<when test="boardType == 'Approval'">
							, A.ProcessID
							, A.ProcessDefID
							, A.ProcessState
							, A.ProcessRegistDate
							, A.ProcessRegisterCode
							, A.State
							, A.ActivityState
							, A.TotalApproverCnt
							, A.TotalApprovalCnt
				    	</when>
				    	<when test="boardType == 'DocAuth'">
							, A.RequestID
							, A.RequestorCode AS RequestorCode
							, A. RequestorName
							, A.RequestMessage
							, A.RequestDate
							, A.RequestAclList
							, A.ActType
				    	</when>
				    	<when test="boardType == 'DocTotal'">
							, A.MultiFolderType
				    	</when>
			    	</choose>
			    	<if test='"OwnerName".equalsIgnoreCase(sortColumn)'>
			    	, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = A.OwnerCode) AS OwnerName
			    	</if>
			    	<if test='"RegistDeptName".equalsIgnoreCase(sortColumn)'>
					, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_GROUP WHERE GroupCode = A.RegistDept) AS RegistDeptName
					</if>
					, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = A.RevisionCode) AS RevisionName
					, DECODE(A.RevisionDate, NULL, TO_CHAR(A.RegistDate,'YYYY.MM.DD HH24:MI:SS'), TO_CHAR(A.RevisionDate,'YYYY.MM.DD HH24:MI:SS')) AS RevisionDate
					, A.SecurityLevel
					, TO_CHAR(A.ReservationDate, 'YYYY.MM.DD HH24:MI:SS') AS ReservationDate
					, DECODE((SELECT COUNT(*) FROM BOARD_MESSAGE_READER WHERE MessageID = A.MessageID AND ReaderCode = #{userCode}) , 0, 'N', 'Y' ) AS IsRead
			    	, DECODE((SELECT COUNT(*) FROM SYS_OBJECT_USER WHERE UserCode = #{userCode} AND A.SecurityLevel IS NOT NULL AND A.SecurityLevel != 256 AND A.SecurityLevel >= SecurityLevel), 0, 'N', 'Y') AS IsSecurity
			    	, (SELECT MAX(FileID) FROM SYS_FILE WHERE ObjectType ='FD' AND ObjectID = A.FolderID AND MessageID = A.MessageID AND SaveType IN ('IMAGE', 'INLINE')) AS FileID
				FROM (
					SELECT DISTINCT
						A.MessageID ,A.Version ,A.Number_ ,A.FolderID 
						,A.IsInherited	,A.ParentID
						,A.MsgType		,A.MsgState
						,A.CategoryID	,A.Seq		,A.Step		,A.Depth		,A.Subject
						,A.IsPopup		,A.IsTop
						,A.PopupStartDate	,A.PopupEndDate
						,A.TopStartDate	,A.TopEndDate
						,A.ExpiredDate	,A.UseSecurity		,A.UseAnonym 
						,A.IsApproval	,A.IsUserForm		,A.IsCheckOut
						,A.UseScrap 	,A.NoticeMedia		,A.UseRSS
						,A.TrackBackURL,A.TracbackCnt
						,A.AnswerCnt	,A.ReadCnt			,A.ScrapCnt		,A.ReportCnt
						,A.FileCnt		,A.FileExtension
						,A.RegistDate
						,A.RevisionCode ,A.RevisionDate	,A.ReservationDate
						,A.ProgressState
						,A.CreatorCode	,A.CreateDate
						,DECODE(A.UsePubDeptName, 'Y', A.CreatorDept, A.CreatorName) AS CreatorName
						,A.CreatorLevel	,A.CreatorPosition	,A.CreatorTitle	,A.CreatorDept
						,A.DeleteDate		,A.RegistDept			,A.OwnerCode, A.SecurityLevel
						,H.DisplayName AS FolderName ,H.MenuID
						,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
						<choose>
					    	<when test="boardType == 'RequestModify'">
					    	    ,M.RequestID						
					    	    ,M.RequestMessage					
					    	    ,M.RequestorCode					
					    	    ,FN_BASEGETDICTIONARY_S(#{lang}, M.RequestorName) AS RequestorName	
					    	    , (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = M.RequestorCode) AS RequestorMailAddress
					    	    ,TO_CHAR(M.RequestDate,'YYYY.MM.DD HH24:MI:SS') AS RequestDate		
					    	    ,M.AnswererCode					
					    	    , (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = M.AnswererCode) AS AnswererMailAddress
					    	    ,FN_BASEGETDICTIONARY_S(#{lang}, M.AnswererName) AS AnswererName	
					    	    ,M.AnswerContent					
					    	    ,TO_CHAR(M.AnswerDate, 'YYYY.MM.DD HH24:MI:SS')	AS AnswerDate		
					    	    ,M.RequestStatus					
					    	</when>
					    	<when test="boardType == 'Approval'">
					    	    , F.ProcessID AS ProcessID
								, F.ProcessDefID AS ProcessDefID 
								, F.State AS ProcessState 
								, F.RegistDate AS ProcessRegistDate
								, F.RegisterCode AS ProcessRegisterCode
								, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State = 1 AND ActorCode = #{userCode}) AS State
								, (SELECT State FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} and ProcessID = F.ProcessID and ActorRole = 'Register') AS ActivityState
								, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID) AS TotalApproverCnt
								, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State IN (7,9)) AS TotalApprovalCnt 
					    	</when>
					    	<when test="boardType == 'DocAuth'">
					    	    , DRA.RequestID
					    	    , DRA.RegisterCode AS RequestorCode
					    	    ,  (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = DRA.RegisterCode) AS RequestorName
					    	    , DRA.RequestMessage
					    	    , TO_CHAR(DRA.RequestDate, 'YYYY.MM.DD HH24:MI:SS') AS RequestDate
					    	    , DRA.AclList AS RequestAclList
					    	    , DRA.ActType
					    	</when>
					    	<when test="boardType == 'DocTotal'">
					    	    , 'ORIGIN' AS MultiFolderType
					    	</when>
				    	</choose>
					FROM BOARD_MESSAGE A
					INNER JOIN SYS_OBJECT_FOLDER H ON A.FolderID = H.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
					LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = A.MessageID AND BMA.Version = A.Version
					<choose>
				    	<when test="boardType == 'MyInterest'"> 
				    	    INNER JOIN BOARD_MESSAGE_FAVORITE J ON A.MessageID=J.MessageID AND J.RegisterCode=#{userCode}
				    	</when>
				    	<!-- 전 관심게시 -->
				    	<when test="boardType == 'RequestModify'">
				    	    INNER JOIN BOARD_REQUEST_MODIFY M ON (A.MessageID=M.MessageID AND M.RequestStatus != 'Deleted')
				    	</when>
				    	<when test="boardType == 'Approval'">
				    	    <if test="boxType == 'Request'">	
								INNER JOIN SYS_PROCESS F ON A.MessageID=F.MessageID AND F.ObjectType=#{bizSection}
							</if>
							<if test="boxType == 'Receive'">
								INNER JOIN SYS_PROCESS F ON A.MessageID=F.MessageID AND F.ObjectType=#{bizSection} 
								AND F.ProcessID IN (SELECT DISTINCT ProcessID FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} AND ActorRole != 'Register' )
							</if>
				    	</when>
				    	<when test="boardType == 'DocAuth'">
				    	    <if test="boxType == 'Request'">
				    	        INNER JOIN DOC_REQUEST_ACL DRA ON A.MessageID=DRA.MessageID AND A.Version=DRA.Version AND DRA.RegisterCode = #{userCode}
				    	    </if>
				    	    <if test="boxType == 'Receive'">
								INNER JOIN DOC_REQUEST_ACL DRA ON A.MessageID=DRA.MessageID AND A.Version=DRA.Version AND DRA.ActorCode = #{userCode}
							</if>
				    	</when>
				    	<when test="boardType == 'CheckIn' or boardType == 'CheckOut'">
				    	    LEFT OUTER JOIN (SELECT MAX(HistoryID) AS HistoryID, MessageID, MAX(Version) AS Version, CO_Code, ActType FROM DOC_INOUT_HISTORY WHERE DeleteDate IS NULL GROUP BY MessageID, CO_Code, ActType) DIH 
							ON (A.MessageID = DIH.MessageID AND A.Version = DIH.Version)
				    	</when>
				    	<when test="boardType == 'DocTotal' and searchFolderIDs != null and searchFolderIDs != ''">
				    	    INNER JOIN (
				    	    	SELECT * FROM (
							    	SELECT MessageID, Version
								    , ';' || LISTAGG(FolderID, ';' ) WITHIN GROUP(ORDER BY FolderID) || ';' AS FolderIDs
								    FROM (
								        SELECT MessageID, Version, FolderID
								        FROM board_message_folder
								        WHERE 1=1
										<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
											AND FolderID IN 
											<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
												#{searchFolderID}
											</foreach>
										</if>
								        
								        UNION
								        
								        SELECT MessageID, Version, FolderID
								        FROM board_message
								        WHERE 1=1
										<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
											AND FolderID IN 
											<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
												#{searchFolderID}
											</foreach>
										</if>
								    ) A
								    GROUP BY MessageID, Version
								) RESULT
								WHERE 1=1
								<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
									<foreach collection="searchFolderIDArr" item="searchFolderID" index="index">
										AND FolderIDs LIKE '%;' || #{searchFolderID} || ';%'
									</foreach>
								</if>
							) B ON A.MessageID = B.MessageID AND A.Version = B.Version
				    	</when>
			    	</choose>
			    	<if test="multiCategory != null and multiCategory != ''">
						INNER JOIN (
							SELECT * FROM (
							    SELECT MessageID, Version
							    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
							    FROM board_userform_value
							    GROUP BY MessageID, Version
							) A
							WHERE 1=1
							<foreach collection="multiCategoryList" item="multiCategory" index="index">
								AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
							</foreach>
						) UFV ON UFV.MessageID = A.MessageID AND UFV.Version = A.Version
					</if>
					<!-- 보안등급 및 열람권한 체크 -->
					<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
					LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
									 FROM (
										SELECT SRA.ObjectID, SRA.MessageID
										FROM sys_read_acl AS SRA
										WHERE SRA.ObjectType = 'FD'
										AND SRA.TargetType = 'UR'
										AND SRA.TargetCode = #{userCode}
										UNION
										SELECT SRA.ObjectID, SRA.MessageID
										FROM sys_read_acl AS SRA
										WHERE SRA.ObjectType = 'FD'
										AND SRA.TargetType != 'UR'
										AND SRA.TargetCode IN
										<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
								            #{item}
									    </foreach>
									) AS SRA) SRA ON A.FolderID = SRA.ObjectID AND A.MessageID = SRA.MessageID
					</if>
				WHERE 1=1
				AND IsCurrent = 'Y'
				<if test="bizSection == 'Board'">
					AND (H.MenuID = #{menuID} OR H.DomainID = 0)
				</if>	
				<if test='aclDataArr != null and aclDataArr.length != 0'>
					AND H.FolderID IN 
					<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
						#{item}
					</foreach>
				</if>
				<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
					AND H.FolderID IN 
					<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
						#{searchFolderID}
					</foreach>
				</if>
				<if test="folderID != null and folderID != ''">
					AND H.FolderID = #{folderID}
				</if>
		        AND H.FolderType != 'QuickComment'
				<if test="bizSection == 'Board'">
				    AND MsgType NOT IN ('N', 'B')
				</if>
				<if test="bizSection == 'Doc'">
				    AND MsgType IN ('N', 'B', 'M')
				</if>
				<if test="isMobileSupport == 'Y'">
				    AND H.isMobileSupport = 'Y'
				</if>
		        <choose>
				    <when test="communityID != null and communityID !=''">
						AND H.ObjectType = 'Community'
					</when>
					<otherwise>
						AND H.ObjectType = #{bizSection}
					</otherwise>
				</choose>
				<include refid="chooseBoardType"/>
			    <if test="requestStatus != null and requestStatus != ''">
			        <choose>
				    	<when test="requestStatus == 'Ready'">
				    	    AND MsgState IN ('Ready')
				        </when>
				        <when test="requestStatus == 'Process'">
				    	    AND MsgState IN ('Process')
				        </when>
				        <otherwise>
				            AND MsgState IN ('Complete')
				        </otherwise>
				    </choose>
			    </if>
			    <if test="readSearchType != null and readSearchType != ''">
					AND A.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
			    </if>
			    <!-- 보안등급 및 열람권한 체크 -->
			    <if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
			        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
			                  ELSE CASE WHEN (A.SecurityLevel = '256' OR A.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
			                	   		ELSE 'N' END
			                  END) = 'Y'
			              		                		  
			        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
			                  ELSE CASE WHEN NVL(A.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
						     		    WHEN NVL(A.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
						     		    ELSE 'N' END
						      END) = 'Y'
				</if>
				<if test="searchText != null and searchText != ''">
				    <choose>
				        <when test="searchType == 'Total'">
				            AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%')
				       	</when>
				       	<when test="searchType == 'Mobile'">
				            AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%' OR CreatorName LIKE '%'|| #{searchText} ||'%')
				       	</when>
				       	<when test="searchType == 'Number'">
				            AND Number_ LIKE '%'|| #{searchText} ||'%'  
				       	</when>
				       	<when test="searchType == 'Tag'">
							AND  ( SELECT LISTAGG(Tag, ',') WITHIN GROUP (ORDER BY MessageID) FROM board_message_tag WHERE MessageID = A.MessageID AND Version = A.Version ) 
							LIKE '%' || #{searchText} || '%'  
						</when>
						<otherwise>
							AND 
							<choose>
								<when test='searchType.equalsIgnoreCase("BodyText")'>BodyText </when>
								<when test='searchType.equalsIgnoreCase("CreatorName")'>CreatorName </when>
								<otherwise>Subject </otherwise>
							</choose>
							LIKE '%'|| #{searchText} ||'%'
				       	</otherwise>
					</choose>
				</if>
				<if test="startDate != '' or endDate != ''">
					AND A.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')	
				</if>
				<choose>
				   	<when test="boardType == 'Approval'">
			    	   
			    	    <if test="boxType == 'Request'">	
							AND F.RegisterCode = #{userCode}
						</if>
					
			    	    <choose>
					    	<when test='approvalStatus == "R"'>	
					    		AND (MsgState IN ('R', 'BR')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State &gt; 0 -->
					        </when>
					        <when test='approvalStatus == "A"'> 
					    		AND (MsgState IN ('A', 'BA')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
					        </when>
					        <when test='approvalStatus == "D"'> 
					    		AND (MsgState IN ('D')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
					        </when>
					        <when test='approvalStatus == "P"'> 
					    		AND (MsgState IN ('R')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
					        </when>
					        <otherwise>
					            AND (MsgState IN ('R', 'D', 'A', 'BR', 'BA')) AND (MsgType IN ('O', 'N', 'B'))
					        </otherwise>
					    </choose>
			    	</when>
			    	<when test="boardType == 'DocAuth'">
			    	    <!-- 요청함 -->
			    	    <if test="boxType == 'Receive'">	
							<choose>
						    	<when test='approvalStatus == "R"'>	
						    		AND (ActType IN ('R'))
						        </when>
						        <when test='approvalStatus == "A"'> 
						    		AND (ActType IN ('D', 'A'))
						        </when>
						        <when test='approvalStatus == "D"'> 
						    		AND (ActType IN ('D'))
						        </when>
						        <otherwise>
						            
						        </otherwise>
						    </choose>
						</if>
			    	</when>
		    	</choose>
		    	
				<if test="bizSection == 'Doc' and boardType == 'DocTotal'">
					UNION ALL
					
					SELECT DISTINCT
						A.MessageID ,A.Version ,A.Number_ ,H.FolderID 
						,A.IsInherited	,A.ParentID
						,A.MsgType		,A.MsgState
						,A.CategoryID	,A.Seq		,A.Step		,A.Depth		,A.Subject
						,A.IsPopup		,A.IsTop
						,A.PopupStartDate	,A.PopupEndDate
						,A.TopStartDate	,A.TopEndDate
						,A.ExpiredDate	,A.UseSecurity		,A.UseAnonym 
						,A.IsApproval	,A.IsUserForm		,A.IsCheckOut
						,A.UseScrap 	,A.NoticeMedia		,A.UseRSS
						,A.TrackBackURL,A.TracbackCnt
						,A.AnswerCnt	,A.ReadCnt			,A.ScrapCnt		,A.ReportCnt
						,A.FileCnt		,A.FileExtension
						,A.RegistDate
						,A.RevisionCode ,A.RevisionDate	,A.ReservationDate
						,A.ProgressState
						,A.CreatorCode	,A.CreateDate
						,DECODE(A.UsePubDeptName, 'Y', A.CreatorDept, A.CreatorName) AS CreatorName
						,A.CreatorLevel	,A.CreatorPosition	,A.CreatorTitle	,A.CreatorDept
						,A.DeleteDate		,A.RegistDept			,A.OwnerCode, A.SecurityLevel
						,H.DisplayName AS FolderName ,H.MenuID
						,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
			    	    , 'SUB' AS MultiFolderType
						FROM BOARD_MESSAGE A
						LEFT OUTER JOIN board_message_folder BMF ON A.MessageID = BMF.MessageID AND A.Version = BMF.Version
						<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
							AND BMF.FolderID IN 
							<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
								#{searchFolderID}
							</foreach>
						</if>
						INNER JOIN SYS_OBJECT_FOLDER H ON H.FolderID = BMF.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
						LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = A.MessageID AND BMA.Version = A.Version
			    	    INNER JOIN (
			    	    	SELECT * FROM (
						    	SELECT MessageID, Version
							    , ';' || LISTAGG(FolderID, ';' ) WITHIN GROUP(ORDER BY FolderID) || ';' AS FolderIDs
							    FROM (
							        SELECT MessageID, Version, FolderID
							        FROM board_message_folder
							        WHERE 1=1
									<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
										AND FolderID IN 
										<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
											#{searchFolderID}
										</foreach>
									</if>
							        
							        UNION
							        
							        SELECT MessageID, Version, FolderID
							        FROM board_message
							        WHERE 1=1
									<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
										AND FolderID IN 
										<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
											#{searchFolderID}
										</foreach>
									</if>
							    ) A
							    GROUP BY MessageID, Version
							) RESULT
							WHERE 1=1
							<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
								<foreach collection="searchFolderIDArr" item="searchFolderID" index="index">
									AND FolderIDs LIKE '%;' || #{searchFolderID} || ';%'
								</foreach>
							</if>
						) B ON A.MessageID = B.MessageID AND A.Version = B.Version
						<if test="multiCategory != null and multiCategory != ''">
							INNER JOIN (
								SELECT * FROM (
								    SELECT MessageID, Version
								    , ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
								    FROM board_userform_value
								    GROUP BY MessageID, Version
								) A
								WHERE 1=1
								<foreach collection="multiCategoryList" item="multiCategory" index="index">
									AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
								</foreach>
							) UFV ON UFV.MessageID = A.MessageID AND UFV.Version = A.Version
						</if>
						<if test="isMobileSupport == 'Y'">
						    AND H.isMobileSupport = 'Y'
						</if>
						<!-- 보안등급 및 열람권한 체크 -->
						<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
						LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
										  FROM (
											SELECT SRA.ObjectID, SRA.MessageID
											FROM sys_read_acl AS SRA
											WHERE SRA.ObjectType = 'FD'
											AND SRA.TargetType = 'UR'
											AND SRA.TargetCode = #{userCode}
											UNION
											SELECT SRA.ObjectID, SRA.MessageID
											FROM sys_read_acl AS SRA
											WHERE SRA.ObjectType = 'FD'
											AND SRA.TargetType != 'UR'
											AND SRA.TargetCode IN
											<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
									            #{item}
										    </foreach>
										) AS SRA) SRA ON A.FolderID = SRA.ObjectID AND A.MessageID = SRA.MessageID
						</if>						
					WHERE 1=1
					AND IsCurrent = 'Y'
					AND (H.MenuID = #{menuID} OR H.DomainID = 0)
					<if test='aclDataArr != null and aclDataArr.length != 0'>
						AND H.FolderID IN 
						<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
							#{item}
						</foreach>
					</if>
					<if test="folderID != null and folderID != ''">
						AND H.FolderID = #{folderID}
					</if>
			        AND H.FolderType != 'QuickComment'
					<if test="bizSection == 'Board'">
					    AND MsgType NOT IN ('N', 'B')
					</if>
					<if test="bizSection == 'Doc'">
					    AND MsgType IN ('N', 'B', 'M')
					</if>
			        <choose>
					    <when test="communityID != null and communityID !=''">
							AND H.ObjectType = 'Community'
						</when>
						<otherwise>
							AND H.ObjectType = #{bizSection}
						</otherwise>
					</choose>
					<include refid="chooseBoardType"/>
				    <if test="requestStatus != null and requestStatus != ''">
				        <choose>
					    	<when test="requestStatus == 'Ready'">
					    	    AND MsgState IN ('Ready')
					        </when>
					        <when test="requestStatus == 'Process'">
					    	    AND MsgState IN ('Process')
					        </when>
					        <otherwise>
					            AND MsgState IN ('Complete')
					        </otherwise>
					    </choose>
				    </if>
				    <if test="readSearchType != null and readSearchType != ''">
						AND A.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
				    </if>
				    <!-- 보안등급 및 열람권한 체크 -->
				    <if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
				        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
				                  ELSE CASE WHEN (A.SecurityLevel = '256' OR A.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
				                	   		ELSE 'N' END
				                  END) = 'Y'
				              		                		  
				        AND (CASE WHEN A.OwnerCode = #{userCode} THEN 'Y'
				                  ELSE CASE WHEN NVL(A.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
							     		    WHEN NVL(A.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
							     		    ELSE 'N' END
							      END) = 'Y'
					</if>
					<if test="searchText != null and searchText != ''">
					    <choose>
					        <when test="searchType == 'Total'">
					            AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%')
					       	</when>
					       	<when test="searchType == 'Mobile'">
					            AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%' OR CreatorName LIKE '%'|| #{searchText} ||'%')
					       	</when>
					       	<when test="searchType == 'Number'">
					            AND Number_ LIKE '%'|| #{searchText} ||'%'  
					       	</when>
							<otherwise>
								AND 
								<choose>
									<when test='searchType.equalsIgnoreCase("BodyText")'>BodyText </when>
									<when test='searchType.equalsIgnoreCase("CreatorName")'>CreatorName </when>
									<otherwise>Subject </otherwise>
								</choose>
								LIKE '%'|| #{searchText} ||'%'
					       	</otherwise>
						</choose>
					</if>
					<if test="startDate != '' or endDate != ''">
						AND A.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')	
					</if>
				</if>
			) A
			<trim prefix="ORDER BY" prefixOverrides =",">
				<if test='useTopNotice == "Y"'>
					ListTop ASC,
				</if>
				<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
					<choose>
						<when test='sortColumn.equalsIgnoreCase("FileCnt")'>TO_NUMBER(FileCnt)</when>
						<when test='sortColumn.equalsIgnoreCase("FolderName")'>FolderName</when>
						<when test='sortColumn.equalsIgnoreCase("Subject")'>Subject</when>
						<when test='sortColumn.equalsIgnoreCase("CreatorName")'>CreatorName</when>
						<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
						<when test='sortColumn.equalsIgnoreCase("Version")'>Version</when>
						<when test='sortColumn.equalsIgnoreCase("Number")'>Number_</when>
						<when test='sortColumn.equalsIgnoreCase("IsCheckOut")'>IsCheckOut</when>
						<when test='sortColumn.equalsIgnoreCase("RegistDept")'>RegistDept</when>
						<when test='sortColumn.equalsIgnoreCase("RegistDeptName")'>RegistDeptName</when>
						<when test='sortColumn.equalsIgnoreCase("OwnerName")'>OwnerName</when>
						<when test='sortColumn.equalsIgnoreCase("RevisionDate")'>RevisionDate</when>
						<when test='sortColumn.equalsIgnoreCase("MsgState")'>MsgState</when>
						<when test='sortColumn.equalsIgnoreCase("ReadCnt")'>TO_NUMBER(ReadCnt)</when>
						<when test='sortColumn.equalsIgnoreCase("ReservationDate")'>ReservationDate</when>
						<when test='sortColumn.equalsIgnoreCase("RequestMessage")'>RequestMessage</when>
						<when test='sortColumn.equalsIgnoreCase("RequestorName")'>RequestorName</when>
						<when test='sortColumn.equalsIgnoreCase("RequestDate")'>RequestDate</when>
						<when test='sortColumn.equalsIgnoreCase("AnswerContent")'>AnswerContent</when>
						<when test='sortColumn.equalsIgnoreCase("RequestStatus")'>RequestStatus</when>
						<when test='sortColumn.equalsIgnoreCase("ActType")'>ActType</when>
						<otherwise>MessageID</otherwise>
					</choose>
					<choose>
						<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
						<otherwise> DESC</otherwise>
					</choose>
					<include refid="oracle.include.listOrderBy"/>,
				</if>
				Seq Desc, depth, step ASC
			</trim>
			<include refid="oracle.include.pagingFooter"/>
		) BM 
		LEFT OUTER JOIN SYS_OBJECT_USER B ON (CASE WHEN BM.MsgType='S' THEN BM.OwnerCode ELSE BM.CreatorCode END) = B.UserCode
		WHERE 1=1
	    <if test="categoryID != null and categoryID != ''">
	        <choose>
		    	<when test="categoryGubun == 'Y'">
		    	    AND (C.MemberOf = #{categoryID} OR C.CategoryID = #{categoryID})
		        </when>
		        <otherwise>
		            AND BM.CategoryID = #{categoryID}
		        </otherwise>
		    </choose>
	    </if>
	    <if test="boardType == 'Approval' and boxType == 'Receive' and approvalStatus != '' and approvalStatus != null ">
    		<choose>
		    	<when test='approvalStatus == "R"'>	<!-- 승인 요청 받은 게시 -->
		    		AND State &gt; 0
		        </when>
		        <otherwise> <!-- 승인 완료된 게시(A), 반려된 게시(D), 다른사람이 결제해야할 승인 요청 게시(진행중)(P)- -->
		            AND State = 0
		        </otherwise>
		    </choose>
	    </if>
	   	) RESULT
	   	WHERE 1=1
	   	<if test="mode != null and mode != '' ">
		   	<choose>
			    <when test="mode == 'prev'" >
			      AND RNUM = TO_NUMBER(#{rNum}) - 1
			    </when>
			    <otherwise> 
			      AND RNUM = TO_NUMBER(#{rNum}) + 1
			    </otherwise>		  
		    </choose>
		</if>  
	   	<trim prefix="ORDER BY" prefixOverrides =",">
			<if test='useTopNotice == "Y"'>
				ListTop ASC,
			</if>
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("FileCnt")'>TO_NUMBER(FileCnt)</when>
					<when test='sortColumn.equalsIgnoreCase("FolderName")'>FolderName</when>
					<when test='sortColumn.equalsIgnoreCase("Subject")'>Subject</when>
					<when test='sortColumn.equalsIgnoreCase("CreatorName")'>CreatorName</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
					<when test='sortColumn.equalsIgnoreCase("Version")'>Version</when>
					<when test='sortColumn.equalsIgnoreCase("Number")'>Number_</when>
					<when test='sortColumn.equalsIgnoreCase("IsCheckOut")'>IsCheckOut</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDept")'>RegistDept</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDeptName")'>RegistDeptName</when>
					<when test='sortColumn.equalsIgnoreCase("OwnerName")'>OwnerName</when>
					<when test='sortColumn.equalsIgnoreCase("RevisionDate")'>RevisionDate</when>
					<when test='sortColumn.equalsIgnoreCase("MsgState")'>MsgState</when>
					<when test='sortColumn.equalsIgnoreCase("ReadCnt")'>TO_NUMBER(ReadCnt)</when>
					<when test='sortColumn.equalsIgnoreCase("ReservationDate")'>ReservationDate</when>
					<when test='sortColumn.equalsIgnoreCase("RequestMessage")'>RequestMessage</when>
					<when test='sortColumn.equalsIgnoreCase("RequestorName")'>RequestorName</when>
					<when test='sortColumn.equalsIgnoreCase("RequestDate")'>RequestDate</when>
					<when test='sortColumn.equalsIgnoreCase("AnswerContent")'>AnswerContent</when>
					<when test='sortColumn.equalsIgnoreCase("RequestStatus")'>RequestStatus</when>
					<when test='sortColumn.equalsIgnoreCase("ActType")'>ActType</when>
					<otherwise>MessageID</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
				<include refid="oracle.include.listOrderBy"/>,
			</if>
			Seq Desc, depth, step ASC
		</trim>
	</select>
 	
	<!-- 폴더/게시판 외의 게시글 목록 개수 조회 -->
	<select id="selectSearchMessageGridCount" resultType="java.lang.Long">
		SELECT COUNT(*) FROM (
			SELECT DISTINCT
				BM.MessageID
			  , BM.MsgState
			  , BM.MsgType
			  , H.FolderID
			FROM BOARD_MESSAGE BM
			INNER JOIN SYS_OBJECT_FOLDER H ON BM.FolderID = H.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
			LEFT OUTER JOIN SYS_OBJECT_USER B ON (CASE WHEN BM.MsgType='S' THEN BM.OwnerCode ELSE BM.CreatorCode END) = B.UserCode
			LEFT OUTER JOIN BOARD_CATEGORY BC ON BM.CategoryID = BC.CategoryID AND BC.FolderID = BM.FolderID
			LEFT OUTER JOIN BOARD_PROGRESSSTATE P ON BM.progressstate = P.StateID
			LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = BM.MessageID AND BMA.Version = BM.Version
			WHERE 1=1
			AND (H.MenuID = #{menuID} OR H.DomainID = 0)
			<if test='aclDataArr != null and aclDataArr.length != 0'>
				AND H.FolderID IN 
				<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			</if>
			AND IsCurrent = 'Y'
			AND H.FolderType != 'QuickComment' <!-- 한줄게시 표시하지 않음 -->
			AND ( (H.FolderType = 'OneToOne') AND (BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = H.FolderID) LIKE '%' || #{userCode} || ';%' ) OR (H.FolderType != 'OneToOne') )
			AND MsgState IN ('C', 'A') 
			AND MsgType != 'S' 
			<!-- UseSecurity가 Y일때 게시일 경우에는 작성자만 조회할 수 있음 -->
			AND (
				UseSecurity != 'Y'
				OR (
					UseSecurity = 'Y'
					AND (
						#{bizSection} = 'Board' AND CreatorCode = #{userCode}
						OR #{bizSection} = 'Doc'
					)
				)
			)
			AND (ExpiredDate IS NULL OR  ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
			AND BM.DeleteDate IS NULL
			<choose>
				<when test="communityID != null and communityID !=''">
					AND H.ObjectType = 'Community'
				</when>
				<otherwise>
					AND H.ObjectType = #{bizSection}
				</otherwise>
			</choose>
			<if test="bizSection == 'Board'">
				AND MsgType NOT IN ('N', 'B')
			</if>
			<if test="bizSection == 'Doc'">
				AND MsgType IN ('N', 'B', 'M')
			</if>
			<if test="searchText != null and searchText != ''">
				<if test="searchType == 'Total'">
					AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
				</if>
				<if test="searchType == 'Mobile'">
					AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
				</if>
			</if>
		) RESULT
		WHERE 1=1
	</select>
	
	<select id="selectSearchMessageGridList" parameterType="cmap" resultType="cmap">
		<include refid="oracle.include.pagingHeader"/>
		SELECT RESULT.MessageID AS "MessageID"
			 , RESULT.Version AS "Version"
			 , RESULT.Number_ AS "Number"
			 , RESULT.FolderID AS "FolderID"
			 , RESULT.FolderName AS "FolderName"
			 , RESULT.IsInherited AS "IsInherited"
			 , RESULT.ParentID AS "ParentID"
			 , RESULT.MsgType AS "MsgType"
			 , RESULT.MsgState AS "MsgState"
			 , RESULT.CategoryID AS "CategoryID"
			 , RESULT.CategoryPaths AS "CategoryPaths"
			 , RESULT.FolderPath AS "FolderPath"
			 , RESULT.Seq AS "Seq"
			 , RESULT.Step AS "Step"
			 , RESULT.Depth AS "Depth"
			 , RESULT.Subject AS "Subject"
			 , RESULT.IsPopup AS "IsPopup"
			 , RESULT.IsTop AS "IsTop"
			 , RESULT.PopupStartDate AS "PopupStartDate"
			 , RESULT.PopupEndDate AS "PopupEndDate"
			 , RESULT.TopStartDate AS "TopStartDate"
			 , RESULT.TopEndDate AS "TopEndDate"
			 , RESULT.ExpiredDate AS "ExpiredDate"
			 , RESULT.UseSecurity AS "UseSecurity"
			 , RESULT.UseAnonym AS "UseAnonym"
			 , RESULT.IsApproval AS "IsApproval"
			 , RESULT.IsUserForm AS "IsUserForm"
			 , RESULT.IsCheckOut AS "IsCheckOut"
			 , RESULT.UseScrap AS "UseScrap"
			 , RESULT.NoticeMedia AS "NoticeMedia"
			 , RESULT.UseRSS AS "UseRSS"
			 , RESULT.TrackBackURL AS "TrackBackURL"
			 , RESULT.AnswerCnt AS "AnswerCnt"
			 , RESULT.ReadCnt AS "ReadCnt"
			 , RESULT.ScrapCnt AS "ScrapCnt"
			 , RESULT.ReportCnt AS "ReportCnt"
			 , RESULT.CommentCnt AS "CommentCnt"
			 , RESULT.RecommendCnt AS "RecommendCnt"
			 , RESULT.FileCnt AS "FileCnt"
			 , RESULT.FileExtension AS "FileExtension"
			 , RESULT.TracbackCnt AS "TracbackCnt"
			 , RESULT.RegistDate AS "RegistDate"
			 , RESULT.CreatorCode AS "CreatorCode"
			 , RESULT.DisplayName AS "DisplayName"
			 , RESULT.CreateDate AS "CreateDate"
			 , RESULT.CreatorName AS "CreatorName"
			 , RESULT.CreatorLevel AS "CreatorLevel"
			 , RESULT.CreatorPosition AS "CreatorPosition"
			 , RESULT.CreatorTitle AS "CreatorTitle"
			 , RESULT.CreatorDept AS "CreatorDept"
			 , RESULT.DeleteDate AS "DeleteDate"
			 , RESULT.OwnerCode AS "OwnerCode"
			 , RESULT.RegistDept AS "RegistDept"
			 , RESULT.RegistDeptName AS "RegistDeptName"
			 , RESULT.RevisionName AS "RevisionName"
			 , RESULT.RevisionDate AS "RevisionDate"
			 , RESULT.ReservationDate AS "ReservationDate"
			 , RESULT.ListTop AS "ListTop"
		FROM (
			SELECT DISTINCT
				  BM.MessageID
				, BM.Version
				, BM.Number_
				, BM.FolderID 
				, H.DisplayName AS FolderName
				, BM.IsInherited
				, BM.ParentID
				, BM.MsgType
				, BM.MsgState
				, BM.CategoryID
				, BC.CategoryPath AS CategoryPaths 
				, H.FolderPath
				, BM.Seq
				, BM.Step
				, BM.Depth
				, BM.Subject
				, BM.IsPopup
				, BM.IsTop
				, BM.PopupStartDate
				, BM.PopupEndDate
				, BM.TopStartDate
				, BM.TopEndDate
				, BM.ExpiredDate
				, BM.UseSecurity
				, BM.UseAnonym 
				, BM.IsApproval
				, BM.IsUserForm
				, BM.IsCheckOut
				, BM.UseScrap
				, BM.NoticeMedia
				, BM.UseRSS
				, BM.TrackBackURL
				, BM.AnswerCnt, BM.ReadCnt, BM.ScrapCnt ,BM.ReportCnt
				, (SELECT COUNT(*) 
				 	 FROM SYS_COMMENT 
				    WHERE DeleteDate IS NULL 
				 	<choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				 	  AND TargetID = BM.MessageID||'_'||BM.Version)) AS CommentCnt 
				, (SELECT COUNT(*) 
				     FROM SYS_LIKE 
				    WHERE 1=1
				    <choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				      AND TargetID = BM.MessageID||'_'||BM.Version) AS RecommendCnt
				, BM.FileCnt ,BM.FileExtension
				, BM.TracbackCnt
				, TO_CHAR(BM.RegistDate, 'YYYY.MM.DD HH24:MI:SS') AS RegistDate
				, BM.CreatorCode 
				, B.DisplayName 
				, TO_CHAR(BM.CreateDate, 'YYYY-MM-DD HH24:MI:SS') AS CreateDate
				, DECODE(BM.UsePubDeptName, 'Y', FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorDept), FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorName)) AS CreatorName
				, BM.CreatorLevel
				, BM.CreatorPosition
				, BM.CreatorTitle
				, FN_BASEGETDICTIONARY_S(#{lang}, BM.CreatorDept) AS CreatorDept
				, BM.DeleteDate
				, BM.OwnerCode
				, BM.RegistDept
				, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_GROUP WHERE GroupCode = BM.RegistDept) AS RegistDeptName
				, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BM.RevisionCode) AS RevisionName
				, DECODE(BM.RevisionDate , NULL, TO_CHAR(BM.RegistDate,'YYYY.MM.DD HH24:MI:SS'), TO_CHAR(BM.RevisionDate,'YYYY.MM.DD HH24:MI:SS')) AS RevisionDate
				, BM.ReservationDate
				, (CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
			FROM BOARD_MESSAGE BM
			INNER JOIN SYS_OBJECT_FOLDER H ON BM.FolderID = H.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
			LEFT OUTER JOIN SYS_OBJECT_USER B ON (CASE WHEN BM.MsgType='S' THEN BM.OwnerCode ELSE BM.CreatorCode END) = B.UserCode
			LEFT OUTER JOIN BOARD_CATEGORY BC ON BM.CategoryID = BC.CategoryID AND BC.FolderID = BM.FolderID
			LEFT OUTER JOIN BOARD_PROGRESSSTATE P ON BM.progressstate = P.StateID
			LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = BM.MessageID AND BMA.Version = BM.Version
			WHERE 1=1
			AND (H.MenuID = #{menuID} OR H.DomainID = 0)
			<if test='aclDataArr != null and aclDataArr.length != 0'>
				AND H.FolderID IN 
				<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			</if>
			AND IsCurrent = 'Y'
			AND H.FolderType != 'QuickComment' <!-- 한줄게시 표시하지 않음 -->
			AND ( (H.FolderType = 'OneToOne') AND (BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = H.FolderID) LIKE '%' || #{userCode} || ';%' ) OR (H.FolderType != 'OneToOne') )
			AND MsgState IN ('C', 'A') 
			AND MsgType != 'S' 
			<!-- UseSecurity가 Y일때 게시일 경우에는 작성자만 조회할 수 있음 -->
			AND (
				UseSecurity != 'Y'
				OR (
					UseSecurity = 'Y'
					AND (
						#{bizSection} = 'Board' AND CreatorCode = #{userCode}
						OR #{bizSection} = 'Doc'
					)
				)
			)
			AND (ExpiredDate IS NULL OR  ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
			AND BM.DeleteDate IS NULL
			<choose>
				<when test="communityID != null and communityID !=''">
					AND H.ObjectType = 'Community'
				</when>
				<otherwise>
					AND H.ObjectType = #{bizSection}
				</otherwise>
			</choose>
			<if test="bizSection == 'Board'">
				AND MsgType NOT IN ('N', 'B')
			</if>
			<if test="bizSection == 'Doc'">
				AND MsgType IN ('N', 'B', 'M')
			</if>
			<if test="searchText != null and searchText != ''">
				<if test="searchText != null and searchText != ''">
					<if test="searchType == 'Total'">
						AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
					</if>
					<if test="searchType == 'Mobile'">
						AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
					</if>
				</if>
			</if>
		) RESULT
		WHERE 1=1
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test='useTopNotice == "Y"'>
				ListTop ASC,
			</if>
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("FileCnt")'>TO_NUMER(FileCnt)</when>
					<when test='sortColumn.equalsIgnoreCase("FolderName")'>FolderName</when>
					<when test='sortColumn.equalsIgnoreCase("Subject")'>Subject</when>
					<when test='sortColumn.equalsIgnoreCase("Number")'>Number_</when>
					<when test='sortColumn.equalsIgnoreCase("CreatorName")'>CreatorName</when>
					<when test='sortColumn.equalsIgnoreCase("RegistDate")'>RegistDate</when>
					<when test='sortColumn.equalsIgnoreCase("ReadCnt")'>TO_NUMBER(ReadCnt)</when>
					<otherwise>MessageID</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
				<include refid="oracle.include.listOrderBy"/>,
			</if>
			Seq DESC, depth, step ASC
		</trim>
		<include refid="oracle.include.pagingFooter"/>
	</select>
 	
 	<select id="selectDistributeGridCount" resultType="java.lang.Long">
 	    SELECT COUNT(*) FROM (
	 	    SELECT DDC.ConfirmType
				,DDC.DistributeID
				,DD.Version AS DistributeVersion
				,DD.DistributeMsg
				,DD.DistributeDate
				,DD.RegisterCode AS DistributeCode
				,SOU.MultiDisplayName
				,BM.FolderID
				,BM.MessageID
				,BM.Version
				,BM.IsInherited
				,BM.MsgType
				,BM.Subject
				,BM.Number_
				,BM.IsCheckOut
				,BM.RevisionDate
				,BM.CheckOuterCode
				,BM.OwnerCode
				,(SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS OwnerName
			FROM DOC_DISTRIBUTION_CONFIRM DDC
			INNER JOIN DOC_DISTRIBUTION DD ON (DDC.DistributeID = DD.DistributeID)
			INNER JOIN BOARD_MESSAGE BM ON (BM.MessageID = DD.MessageID)
			INNER JOIN SYS_OBJECT_FOLDER SOF ON (SOF.FolderID = BM.FolderID)
			LEFT OUTER JOIN SYS_OBJECT_USER SOU ON (DD.RegisterCode = SOU.UserCode)
			WHERE BM.MsgState IN ('C', 'A') 
			AND BM.IsCurrent = 'Y' 
			AND (BM.DeleteDate IS NULL) 
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))  
			AND DDC.UserCode = #{userCode}
			<!-- 검색어 항목 -->
			<if test="searchText != null and searchText != ''">
				<choose>
					<when test="searchType == 'Total'">
						AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
					</when>
					<when test="searchType == 'Mobile'">
						AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
					</when>
					<otherwise>
						AND 
						<choose>
							<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
							<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
							<when test='searchType.equalsIgnoreCase("Number")'>BM.Number_ </when>
							<otherwise>BM.Subject </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'  
					</otherwise>
				</choose>
			</if>
			<if test="startDate != '' or endDate != ''">
				AND DD.DistributeDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
			</if>
		) RESULT
	   	WHERE 1=1
 	</select>
 	
 	<!-- 배포문서 수신함 -->
 	<select id="selectDistributeGridList" parameterType="cmap" resultType="cmap">
 	    <include refid="oracle.include.pagingHeader"/>
 	    SELECT RESULT.ConfirmType AS "ConfirmType"
 	    	 , RESULT.DistributeID  AS "DistributeID"	
 	    	 , RESULT.DistributeVersion AS "DistributeVersion"	
 	    	 , RESULT.DistributeMsg AS "DistributeMsg"	
 	    	 , RESULT.DistributeDate AS "DistributeDate"	
 	    	 , RESULT.RegistDate  AS "RegistDate"	
 	    	 , RESULT.DistributerCode  AS "DistributerCode"	
 	    	 , RESULT.MailAddress  AS "MailAddress"	
 	    	 , RESULT.DistributerName  AS "DistributerName"	
 	    	 , RESULT.MultiDisplayName AS "MultiDisplayName"	
 	    	 , RESULT.FolderID AS "FolderID"	
 	    	 , RESULT.MessageID AS "MessageID"	 
 	    	 , RESULT.Version AS "Version"	 
 	    	 , RESULT.IsInherited AS "IsInherited"	 
 	    	 , RESULT.MsgType AS "MsgType"	 
 	    	 , RESULT.Subject AS "Subject"	 
 	    	 , RESULT.Number_ AS "Number"	 
 	    	 , RESULT.IsCheckOut AS "IsCheckOut"	 
 	    	 , RESULT.RevisionDate  AS "RevisionDate"	 
 	    	 , RESULT.CheckOuterCode  AS "CheckOuterCode"	 
 	    	 , RESULT.OwnerCode  AS "OwnerCode"	 
 	    	 , RESULT.FileCnt   AS "FileCnt"	 
 	    	 , RESULT.ReadCnt   AS "ReadCnt"	 
 	    	 , RESULT.CommentCnt AS "CommentCnt"	 
 	    	 , RESULT.RecommendCnt AS "RecommendCnt"	 
 	    	 , RESULT.OwnerName AS "OwnerName"	
 	    FROM (
	 	    SELECT DDC.ConfirmType
				,DDC.DistributeID
				,DD.Version AS DistributeVersion
				,DD.DistributeMsg
				,TO_CHAR(DD.DistributeDate,'YYYY.MM.DD HH24:MI:SS')AS DistributeDate 
				,TO_CHAR(DD.DistributeDate,'YYYY.MM.DD HH24:MI:SS')AS RegistDate 
				,DD.RegisterCode AS DistributerCode
				, (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = DD.RegisterCode) AS MailAddress
				,(SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = DD.RegisterCode) AS DistributerName
				,SOU.MultiDisplayName
				,BM.FolderID
				,BM.MessageID
				,BM.Version
				,BM.IsInherited
				,BM.MsgType
				,BM.Subject
				,BM.Number_
				,BM.IsCheckOut
				,TO_CHAR(BM.RevisionDate,'YYYY.MM.DD HH24:MI:SS')AS RevisionDate 
				,BM.CheckOuterCode
				,BM.OwnerCode
				, BM.FileCnt
				, BM.ReadCnt 
				, (SELECT COUNT(*) FROM SYS_COMMENT WHERE DeleteDate IS NULL AND TargetServiceType='Doc' AND TargetID = BM.MessageID||'_'||BM.Version) AS CommentCnt 
				, (SELECT COUNT(*) FROM SYS_LIKE WHERE TargetServiceType='Doc' AND TargetID = BM.MessageID||'_'||BM.Version) AS RecommendCnt
				,(SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS OwnerName
			FROM DOC_DISTRIBUTION_CONFIRM DDC
			INNER JOIN DOC_DISTRIBUTION DD ON (DDC.DistributeID = DD.DistributeID)
			INNER JOIN BOARD_MESSAGE BM ON (BM.MessageID = DD.MessageID)
			INNER JOIN SYS_OBJECT_FOLDER SOF ON (SOF.FolderID = BM.FolderID)
			LEFT OUTER JOIN SYS_OBJECT_USER SOU ON (DD.RegisterCode = SOU.UserCode)
			WHERE BM.MsgState IN ('C', 'A') 
			AND BM.IsCurrent = 'Y' 
			AND (BM.DeleteDate IS NULL) 
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') )  
			AND DDC.UserCode = #{userCode}
			<!-- 검색어 항목 -->
			<if test="searchText != null and searchText != ''">
				<choose>
					<when test="searchType == 'Total'">
						AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
					</when>
					<when test="searchType == 'Mobile'">
						AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
					</when>
					<otherwise>
						AND 
						<choose>
							<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
							<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
							<when test='searchType.equalsIgnoreCase("Number")'>BM.Number_ </when>
							<otherwise>BM.Subject </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'  
					</otherwise>
				</choose>
			</if>
			<if test="startDate != '' or endDate != ''">
				AND DD.DistributeDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
			</if>
		) RESULT
		WHERE 1=1
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("Version")'>TO_NUMBER(Version)</when>
					<when test='sortColumn.equalsIgnoreCase("Subject")'>Subject</when>
					<when test='sortColumn.equalsIgnoreCase("Number")'>Number_</when>
					<when test='sortColumn.equalsIgnoreCase("IsCheckOut")'>IsCheckOut</when>
					<when test='sortColumn.equalsIgnoreCase("DistributerName")'>DistributerName</when>
					<when test='sortColumn.equalsIgnoreCase("DistributeMsg")'>DistributeMsg</when>
					<otherwise>DistributeDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
				<include refid="oracle.include.listOrderBy"/>
			</if>
		</trim>
		<include refid="oracle.include.pagingFooter"/>
 	</select>
 	
 	<!-- 배포문서 배포함 -->
 	<select id="selectDistributeSendGridCount" resultType="java.lang.Long">
 	    SELECT COUNT(*) FROM (
	 	    SELECT DD.Version AS DistributeVersion
				,DD.DistributeMsg
				,DD.DistributeDate
				,DD.RegisterCode AS DistributerCode
				,SOU.MultiDisplayName
				,BM.FolderID
				,BM.MessageID
				,BM.Version
				,BM.IsInherited
				,BM.MsgType
				,BM.Subject
				,BM.Number_
				,BM.IsCheckOut
				,BM.RevisionDate
				,BM.CheckOuterCode
				,BM.OwnerCode
				,(SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS OwnerName
			FROM DOC_DISTRIBUTION DD 
			INNER JOIN BOARD_MESSAGE BM ON (BM.MessageID = DD.MessageID)
			INNER JOIN SYS_OBJECT_FOLDER SOF ON (SOF.FolderID = BM.FolderID)
			INNER JOIN SYS_OBJECT_USER SOU ON (BM.OwnerCode = SOU.UserCode)
			WHERE BM.MsgState IN ('C', 'A') 
			AND BM.IsCurrent = 'Y' 
			AND (BM.DeleteDate IS NULL) 
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') )  
			AND DD.RegisterCode = #{userCode}
			<!-- 검색어 항목 -->
		    <if test="searchText != null and searchText != ''">
				<choose>
			        <when test="searchType == 'Total'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
			       	</when>
			       	<when test="searchType == 'Mobile'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
			       	</when>
					<otherwise>
						AND 
						<choose>
							<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
							<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
							<when test='searchType.equalsIgnoreCase("Number")'>BM.Number_ </when>
							<otherwise>BM.Subject </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'  
					</otherwise>
				</choose>
			</if>
			<if test="startDate != '' or endDate != ''">
				AND DD.DistributeDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
			</if>
		) RESULT
	   	WHERE 1=1
 	</select>
 	
 	<select id="selectDistributeSendGridList" parameterType="cmap" resultType="cmap">
 	    <include refid="oracle.include.pagingHeader"/> 
 	    SELECT RESULT.DistributeVersion AS "DistributeVersion"
 	    	,  RESULT.DistributeMsg AS "DistributeMsg"
 	    	,  RESULT.DistributeDate AS "DistributeDate"
 	    	,  RESULT.RegistDate AS "RegistDate"
 	    	,  RESULT.DistributerCode AS "DistributerCode"
 	    	,  RESULT.DistributerName AS "DistributerName"
 	    	,  RESULT.MultiDisplayName AS "MultiDisplayName"
 	    	,  RESULT.FolderID AS "FolderID"
 	    	,  RESULT.MessageID AS "MessageID"
 	    	,  RESULT.Version AS "Version"
 	    	,  RESULT.IsInherited  AS "IsInherited"
 	    	,  RESULT.MsgType AS "MsgType"
 	    	,  RESULT.Subject AS "Subject"
 	    	,  RESULT.Number_  AS "Number"
 	    	,  RESULT.IsCheckOut  AS "IsCheckOut"
 	    	,  RESULT.RevisionDate  AS "RevisionDate"
 	    	,  RESULT.CheckOuterCode AS "CheckOuterCode"
 	    	,  RESULT.OwnerCode AS "OwnerCode"
 	    	,  RESULT.OwnerName AS "OwnerName"
 	    	,  RESULT.DocReadCnt  AS "DocReadCnt"
 	    	,  RESULT.DisCnt  AS "DisCnt"
 	    	,  RESULT.FileCnt AS "FileCnt"
 	    	,  RESULT.ReadCnt  AS "ReadCnt"
 	    	,  RESULT.CommentCnt AS "CommentCnt"
 	        ,  RESULT.RecommendCnt AS "RecommendCnt"
 	    
 	     FROM (
	 	    SELECT DD.Version AS DistributeVersion
				,DD.DistributeMsg
				,TO_CHAR(DD.DistributeDate,'YYYY.MM.DD HH24:MI:SS')AS DistributeDate 
				,TO_CHAR(DD.DistributeDate,'YYYY.MM.DD HH24:MI:SS')AS RegistDate 
				,DD.RegisterCode AS DistributerCode
				,(SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = DD.RegisterCode) AS DistributerName
				,SOU.MultiDisplayName
				,BM.FolderID
				,BM.MessageID
				,BM.Version
				,BM.IsInherited
				,BM.MsgType
				,BM.Subject
				,BM.Number_
				,BM.IsCheckOut
				,TO_CHAR(BM.RevisionDate,'YYYY.MM.DD HH24:MI:SS')AS RevisionDate
				,BM.CheckOuterCode
				,BM.OwnerCode
				,(SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS OwnerName
				,(SELECT COUNT(*) FROM DOC_DISTRIBUTION_CONFIRM WHERE DistributeID = DD.DistributeID AND ConfirmType ='Read') AS DocReadCnt	
				,(SELECT COUNT(*) FROM DOC_DISTRIBUTION_CONFIRM WHERE DistributeID = DD.DistributeID) AS DisCnt
				, BM.FileCnt
				, BM.ReadCnt 
				, (SELECT COUNT(*) FROM SYS_COMMENT WHERE DeleteDate IS NULL AND TargetServiceType='Doc' AND TargetID = BM.MessageID||'_'||BM.Version) AS CommentCnt 
				, (SELECT COUNT(*) FROM SYS_LIKE WHERE TargetServiceType='Doc' AND TargetID = BM.MessageID||'_'||BM.Version) AS RecommendCnt
			FROM DOC_DISTRIBUTION DD 
			INNER JOIN BOARD_MESSAGE BM ON (BM.MessageID = DD.MessageID)
			INNER JOIN SYS_OBJECT_FOLDER SOF ON (SOF.FolderID = BM.FolderID)
			INNER JOIN SYS_OBJECT_USER SOU ON (BM.OwnerCode = SOU.UserCode)
			WHERE BM.MsgState IN ('C', 'A') 
			AND BM.IsCurrent = 'Y' 
			AND (BM.DeleteDate IS NULL) 
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
			AND DD.RegisterCode = #{userCode}
			<!-- 검색어 항목 -->
		    <if test="searchText != null and searchText != ''">
				<choose>
			        <when test="searchType == 'Total'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
			       	</when>
			       	<when test="searchType == 'Mobile'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
			       	</when>
					<otherwise>
						AND 
						<choose>
							<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
							<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
							<when test='searchType.equalsIgnoreCase("Number")'>BM.Number_ </when>
							<otherwise>BM.Subject </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'  
					</otherwise>
				</choose>
			</if>
			<if test="startDate != '' or endDate != ''">
				AND DD.DistributeDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
			</if>
		) RESULT
	   	WHERE 1=1
    	<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("Version")'>TO_NUMBER(Version)</when>
					<when test='sortColumn.equalsIgnoreCase("Subject")'>Subject</when>
					<when test='sortColumn.equalsIgnoreCase("Number")'>Number_</when>
					<when test='sortColumn.equalsIgnoreCase("IsCheckOut")'>IsCheckOut</when>
					<when test='sortColumn.equalsIgnoreCase("DistributeMsg")'>DistributeMsg</when>
					<otherwise>DistributeDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
				<include refid="oracle.include.listOrderBy"/>
			</if>
		</trim>
		<include refid="oracle.include.pagingFooter"/>
 	</select>
 	
 	<select id="selectProcessActivityList" parameterType="cmap" resultType="cmap">
 	    SELECT State AS "State", 
 	    	   ActivityType AS "ActivityType", 
 	    	   ActorRole  AS "ActorRole", 
 	    	   FN_BASEGETDICTIONARY_S(#{lang}, ActorName) AS "ActorName", 
 	    	   NVL(TO_CHAR(CompleteDate,'YYYY.MM.DD'), '-') AS "CompleteDate" 
 	    FROM SYS_PROCESS_ACTIVITY 
 	    WHERE ProcessID = #{processID}
 	    ORDER BY Step, SubStep asc
 	</select>
 	
 	<select id="selectMessageViewerGridCount" resultType="java.lang.Long">
 	    SELECT COUNT(*)
		FROM (
			SELECT  MessageID, ReaderCode, ReadDate
			FROM BOARD_MESSAGE_READER
			WHERE MessageID = #{messageID}
			) BMR
		INNER JOIN SYS_OBJECT_USER SOU ON (SOU.UserCode = BMR.ReaderCode)
 	</select>
 	
 	<select id="selectMessageViewerGridList" parameterType="cmap" resultType="cmap">
 	    <include refid="oracle.include.pagingHeader"></include>
 	    SELECT RESULT.ReaderCode AS "ReaderCode"
 	        ,  RESULT.MessageID  AS "MessageID" 
 	        ,  RESULT.DisplayName  AS "DisplayName" 
 	        ,  RESULT.DeptName AS "DeptName" 
 	        ,  RESULT.JobPositionName  AS "JobPositionName" 
 	        ,  RESULT.ReadDate   AS "ReadDate" 
 	        ,  RESULT.ReaderPhoto   AS "ReaderPhoto" 
 	     FROM (
	 	    SELECT  
				BMR.ReaderCode AS ReaderCode,
				BMR.MessageID AS MessageID, 
				SOU.DisplayName AS DisplayName,
	 			SOUB.DeptName AS DeptName,
 				SOUB.JobPositionName AS JobPositionName,
				BMR.ReadDate AS ReadDate,
				SOU.PhotoPath AS ReaderPhoto
			FROM (
				SELECT  MessageID, ReaderCode, ReadDate
				FROM BOARD_MESSAGE_READER
				WHERE MessageID = #{messageID}
				) BMR
			INNER JOIN SYS_OBJECT_USER SOU ON (SOU.UserCode = BMR.ReaderCode)
	 		INNER JOIN SYS_OBJECT_USER_BASEGROUP SOUB ON (SOU.UserCode = SOUB.UserCode) AND SOUB.JobType = 'Origin'
		) RESULT
		WHERE 1=1
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("JobPositionName")'>JobPositionName</when>
					<when test='sortColumn.equalsIgnoreCase("DeptName")'>DeptName</when>
					<when test='sortColumn.equalsIgnoreCase("ReadDate")'>ReadDate</when>
					<when test='sortColumn.equalsIgnoreCase("Version")'>TO_NUMBER(Version)</when>
					<otherwise>DisplayName</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
				<include refid="oracle.include.listOrderBy"/>
			</if>
		</trim>
		<include refid="oracle.include.pagingFooter"/>
 	</select>
 	
 	<!-- 조회자 목록 Grid 데이터 관련 기존데이터와 맞는 유저정보가 없으므로 조건항목을 삭제하여 여러건 표시 -->
 	<select id="selectMessageHistoryGridCount" resultType="java.lang.Long">
 	    SELECT COUNT(BMH.MessageID)
		FROM BOARD_MESSAGE_HISTORY BMH
		LEFT OUTER JOIN SYS_OBJECT_USER SOU ON (BMH.RegisterCode = SOU.UserCode)
		LEFT OUTER JOIN SYS_OBJECT_USER_BASEGROUP SOUB ON (BMH.RegisterCode = SOUB.UserCode)
		WHERE BMH.MessageID = #{messageID}
 	</select>
 	
 	<select id="selectMessageHistoryGridList" parameterType="cmap" resultType="cmap">
 	    <include refid="oracle.include.pagingHeader"/>
 	    SELECT RESULT.MessageID AS "MessageID"
 	         , RESULT.HistoryType AS "HistoryType"
 	         , RESULT.Comment_ AS "Comment"
 	    	 , RESULT.RegistIP AS "RegistIP"
 	    	 , RESULT.RegistDate AS "RegistDate"
 	    	 , RESULT.RegisterCode  AS "RegisterCode"
 	    	 , RESULT.DisplayName AS "DisplayName"
 	    	 , RESULT.DeptName AS "DeptName"
 	    FROM (
	 	    SELECT BMH.MessageID
				,BMH.HistoryType
				,BMH.Comment_
				,BMH.RegistIP
				,BMH.RegistDate
				,BMH.RegisterCode
				,SOU.DisplayName
				,SOUB.DeptName
			FROM BOARD_MESSAGE_HISTORY BMH
			LEFT OUTER JOIN SYS_OBJECT_USER SOU ON (BMH.RegisterCode = SOU.UserCode)
			LEFT OUTER JOIN SYS_OBJECT_USER_BASEGROUP SOUB ON (BMH.RegisterCode = SOUB.UserCode)
			WHERE BMH.MessageID = #{messageID}
		) RESULT
		WHERE 1=1
		<trim prefix="ORDER BY" prefixOverrides =",">
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
	 			<choose>
					<when test='sortColumn.equalsIgnoreCase("HistoryType")'>HistoryType</when>
					<when test='sortColumn.equalsIgnoreCase("Comment")'>Comment_</when>
					<when test='sortColumn.equalsIgnoreCase("DisplayName")'>DisplayName</when>
					<when test='sortColumn.equalsIgnoreCase("DeptName")'>DeptName</when>
					<otherwise>RegistDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
				<include refid="oracle.include.listOrderBy"/>
			</if>
			<if test="sortColumn == null or sortColumn == '' or sortDirection == null or sortDirection =='' ">
				RegistDate ASC
			</if>
		</trim>
		<include refid="oracle.include.pagingFooter"/>
 	</select>
 	
 	<!-- 게시글 익명게시 설정 정보 -->
 	<select id="selectPrevAnonyFlag" parameterType="cmap" resultType="String">
 	    SELECT NVL(UseAnonym, 'N') 
 	    FROM BOARD_MESSAGE 
 	    WHERE MessageID = #{messageID} 
 	    AND Version = #{version}
 	</select>
 	
 	<!-- 원본글 찾성자 정보 표시 -->
 	<select id="selectCreatorCode" parameterType="cmap" resultType="String">
 	    SELECT NVL(CreatorCode, #{userCode})
 	    FROM BOARD_MESSAGE
 	    WHERE MessageID = #{messageID} 
 	    AND Version = #{version}
 	</select>
 	
 	<select id="selectCheckInHistoryGridCount" parameterType="cmap" resultType="java.lang.Long">
 	    SELECT COUNT(0)
		FROM DOC_INOUT_HISTORY DIOH
		WHERE 1=1
		AND DIOH.MessageID = #{messageID}
		AND DIOH.DeleteDate IS NULL
 	</select>
 	
 	<select id="selectCheckInHistoryGridList" parameterType="cmap" resultType="cmap">
 	    <include refid="oracle.include.pagingHeader"/>
 	    SELECT    RESULT.HistoryID AS "HistoryID"
		        , RESULT.Version AS "Version"
		        , RESULT.ActType  AS "ActType"
		        , RESULT.Comment_ AS "Comment"
		        , TO_CHAR(RESULT.CI_Date, 'YYYY-MM-DD HH24:MI:SS') AS "CI_Date"
		        , TO_CHAR(RESULT.CO_Date, 'YYYY-MM-DD HH24:MI:SS') AS "CO_Date"
		        , RESULT.ActorCode AS "ActorCode"
		        , RESULT.ActorName AS "ActorName"
 	    FROM (
	 	    SELECT DIOH.HistoryID
	 	    	,DIOH.Version
				,DIOH.ActType
				,DIOH.Msg AS Comment_
				,NVL(DIOH.CI_Date, '') AS CI_Date
				,NVL(DIOH.CO_Date, '') AS CO_Date
				,DIOH.CO_Code AS ActorCode
				,FN_BASEGETDICTIONARY_S(#{lang}, SOU.MultiDisplayName) AS ActorName
			FROM DOC_INOUT_HISTORY DIOH
			LEFT OUTER JOIN SYS_OBJECT_USER SOU ON (DIOH.CO_Code = SOU.UserCode)
			WHERE 1=1
			AND DIOH.MessageID = #{messageID}
			AND DIOH.DeleteDate IS NULL
		) RESULT
		WHERE 1=1
		<trim prefix="ORDER BY" prefixOverrides=",">
			<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("ActType")'>"ActType"</when>
					<when test='sortColumn.equalsIgnoreCase("CO_Date")'>"CO_Date"</when>
					<when test='sortColumn.equalsIgnoreCase("CI_Date")'>"CI_Date"</when>
					<when test='sortColumn.equalsIgnoreCase("Comment")'>"Comment"</when>
					<when test='sortColumn.equalsIgnoreCase("ActorName")'>"ActorName"</when>
					<otherwise>"Version"</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
				<include refid="oracle.include.listOrderBy"/>
			</if>
		</trim>
		<include refid="oracle.include.pagingFooter"/>
 	</select>
 	
 	<select id="selectLowerMessageID" parameterType="cmap" resultType="cmap">
 	    SELECT LISTAGG(MessageID, ';') WITHIN GROUP ( ORDER BY RegistDate ASC)  AS messageIDs
		FROM BOARD_MESSAGE
		WHERE 1=1
		AND MessageID != #{messageID}
    	CONNECT BY PRIOR MessageID = ParentID
		START WITH MessageID = #{messageID}
 	</select>
 	
 	<insert id="createFavorite" parameterType="cmap">
 	    INERT BOARD_INTEREST(RegisterCode, FolderID, RegistDate)
 	    VALUES (#{userCode}, #{folderID}, SYSDATE)
 	    
 	</insert>
 	
 	<delete id="deleteFavorite" parameterType="cmap">
 	    DELETE FROM BOARD_INTEREST 
 	    WHERE RegisterCode = #{userCode} 
 	    AND FolderID IN
 	    <foreach item="item" index="index" collection="folderIDs" open="(" close=")" separator=",">
            #{item}
    	</foreach>
 	</delete>
 	
 	<!-- 게시글 삭제 -->
 	<update id="deleteMessage" parameterType="cmap">
 	    UPDATE BOARD_MESSAGE
 	    SET
 	    	DeleteDate =  SYSDATE
 	    	,ModifierCode = #{userCode}
 	    WHERE 1=1
 	    AND MessageID = #{messageID}
 	    <if test="bizSection == 'Doc'">
			AND IsCurrent='Y'    
		</if>
 	</update>
 	
 	<!-- 하위 게시글 삭제: 답글 -->
 	<update id="deleteLowerMessage" parameterType="cmap">
 	    UPDATE BOARD_MESSAGE
 	    SET
 	    	  DeleteDate = SYSDATE
 	    	, ModifierCode = #{userCode}
 	    WHERE 1=1
		<if test='messageIDArr != null and messageIDArr.length != 0'>
			AND MessageID IN 
			<foreach collection="messageIDArr" item="item" open="(" close=")" separator=",">
				#{item}
			</foreach>
		</if>
 	</update>
 	
 	<insert id="createHistory" parameterType="cmap" useGeneratedKeys="true">
 	    INSERT INTO BOARD_MESSAGE_HISTORY(MessageID, HistoryType, COMMENT_, RegisterCode, RegistDate, RegistIP)
 	    VALUES(#{messageID}, #{historyType}, #{comment}, #{userCode}, SYSDATE, #{registIP})
 	    <selectKey keyProperty="historyID" resultType="long" order="AFTER">
			SELECT BOARD_MESSAGE_HISTORY_SEQ.CURRVAL FROM dual
        </selectKey>
 	</insert>
 	
 	<!-- 수정요청 게시물 상태 변경 -->
 	<update id="updateRequestStatus" parameterType="cmap">
        UPDATE BOARD_REQUEST_MODIFY
        SET
        	AnswererCode = #{answererCode}
        	,AnswererName = #{answererName}
        	,AnswerContent = #{answerContent}
        	,RequestStatus = #{requestStatus}
        	,AnswerDate = SYSDATE
        WHERE 1=1
        AND RequestID = #{requestID}
    </update>
 	
 	<!-- 게시글 삭제시 소속한 폴더의 현재 사용중인 용량 업데이트 -->
    <update id="updateCurrentFileSizeByMessage" parameterType="cmap">
        UPDATE BOARD_CONFIG 
        SET CurrentTotalFileSize = NVL(CurrentTotalFileSize, 0)
			<choose>
				<when test='storageControl.equals("-")'>-</when>
                 <otherwise>+</otherwise>
			</choose>	
			  NVL((SELECT SUM(SF.size_)
              FROM SYS_FILE SF
              WHERE SF.MessageID = #{messageID}
              AND SF.ObjectID = #{folderID}
              AND SF.ObjectType = 'FD'
              AND SF.SaveType != 'INLINE' 
              ),0)
        WHERE FolderID = #{folderID}
    </update>
    
    <insert id="createMessage" parameterType="cmap" useGeneratedKeys="true">
 	    INSERT INTO BOARD_MESSAGE
 	    (    FolderID
			,IsInherited
			,ParentID
			,MsgType 
			,MsgState
			,CategoryID
			,NUMBER_
			,Seq	
			,Step	
			,Depth
			,Subject
			,BodyText
			<if test='isPopup != null and isPopup != "N"'>
				,PopupStartDate 
				,PopupEndDate
				,IsPopup
			</if>
			,TopStartDate 
			,TopEndDate
			,IsApproval
			,IsCurrent
			,IsCheckOut
			,BodyFormID
			<if test="useSecurity != null and useSecurity != ''">
				,UseSecurity
			</if>
			<if test="expiredDate != null and expiredDate != ''">
				,ExpiredDate
			</if>
			<if test="bizSection != 'Doc'">
			    ,TableHistoryType
				,UseAnonym 
				,IsTop
				,IsUserForm
				,UseScrap
				,NoticeMedia
				,UseRSS
				,UseReplyNotice
				,UseCommNotice
				,TrackBackURL
			</if>
			,FileCnt
			,FileExtension
			,IsMobile 
			,RegistDate
			,CreatorCode
			,CreateDate
			,CreatorName
			,CreatorLevel
			,CreatorPosition
			,CreatorTitle
			,CreatorDept 
			,ProgressState
			,OwnerCode
			,ReservationDate 
			,SecurityLevel
			,UseMessageReadAuth
			,UsePubDeptName
			,Version
			<if test="keepyear != null and keepyear != ''">
				,Keepyear
			</if>
			<if test="registDept != null and registDept != ''">
				,RegistDept
			</if>
			<if test="linkURL != null and linkURL != ''">
				,LinkURL
			</if>			
			)
	VALUES(#{folderID},
			#{isInherited},
			NULL,
			#{msgType},
			#{msgState},
			#{categoryID},
			#{number},
			#{seq},		
			#{step},
			#{depth},
			#{subject},
			#{bodyText},
			<if test='isPopup != null and isPopup != "N"'>
				TO_DATE(#{popupStartDate}, 'YYYY.MM.DD HH24:MI:SS'),
				TO_DATE(#{popupEndDate}, 'YYYY.MM.DD HH24:MI:SS'),
				#{isPopup},
			</if>
			TO_DATE(#{topStartDate}, 'YYYY.MM.DD HH24:MI:SS'),
			TO_DATE(#{topEndDate}, 'YYYY.MM.DD HH24:MI:SS'),
			#{isApproval},
			#{isCurrent},
			#{isCheckOut},
			#{bodyFormID},
			<if test="useSecurity != null and useSecurity != ''">
				#{useSecurity},
			</if>
			<if test="expiredDate != null and expiredDate != ''">
				TO_DATE(#{expiredDate}, 'YYYY.MM.DD HH24:MI:SS'),
			</if>
			<if test="bizSection != 'Doc'">
			    #{tableHistoryType},
				#{useAnonym}, 
				#{isTop},
				#{isUserForm},
				#{useScrap},
				#{noticeMedia},
				#{useRSS},
				#{useReplyNotice},
				#{useCommNotice},
				#{trackBackURL},
			</if>
			#{fileCnt},
			#{fileExtension},
			#{isMobile}, 
			<choose>
				<when test="reservationDate != null and reservationDate != ''">
					TO_DATE(#{reservationLocalDate}, 'YYYY.MM.DD HH24:MI:SS'), 
				</when>
				<when test="registDate != null and registDate != ''">
					TO_DATE(#{registDate}, 'YYYY-MM-DD HH24:MI:SS'), 
				</when>
				<otherwise>
					SYSDATE ,
				</otherwise>
			</choose>
			#{userCode},
			SYSDATE ,
			#{creatorName},
			#{creatorLevel},
			#{creatorPosition},
			#{creatorTitle},
			#{creatorDept},
			#{progressStateID},
			#{ownerCode},		
			TO_DATE(#{reservationDate}, 'YYYY.MM.DD HH24:MI:SS'), 
			#{securityLevel},
			#{useMessageReadAuth},
			#{usePubDeptName},
			#{version}
			<if test="keepyear != null and keepyear != ''">
				,#{keepyear}
			</if>
			<if test="registDept != null and registDept != ''">
				,#{registDept}
			</if>
			<if test="linkURL != null and linkURL != ''">
				,#{linkURL}
			</if>			
			)
		<selectKey keyProperty="messageID" resultType="long" order="AFTER">
			SELECT BOARD_MESSAGE_SEQ.CURRVAL FROM dual
        </selectKey>
 	</insert>
    
    <!-- 게시글 개정 -->
    <insert id="revisionMessage" parameterType="cmap">
 	    INSERT INTO BOARD_MESSAGE
					(
						MessageID, Version,		FolderID,			IsCurrent,			IsInherited,		MsgType,
						categoryID, Seq, Step, Depth,
						MsgState,		Subject,		KeepYear, 		NUMBER_,			ExpiredDate,
						IsCheckOut,		BodyText,		FileCnt,			FileExtension,					SecurityLevel, 			
						RegistDate,		CreatorCode,		CreateDate,		CreatorName,		CreatorLevel,		CreatorPosition,
						CreatorTitle,	CreatorDept,		RegistDept,		OwnerCode,
						RevisionCode,	RevisionDate,		CheckOuterCode
					)
		SELECT			MessageID, (TO_NUMBER(#{version}) + 1),		#{folderID},		'Y',			#{isInherited},		MsgType,
						#{categoryID}, Seq, Step, Depth,
						MsgState,		#{subject},		#{keepyear},	Number_,				TO_DATE(#{expiredDate}, 'YYYY.MM.DD HH24:MI:SS' ),
						'N',			#{bodyText},	#{fileCnt},		#{fileExtension},				#{securityLevel},
						RegistDate,		CreatorCode,		CreateDate,		CreatorName,		CreatorLevel,		CreatorPosition,
						CreatorTitle,	CreatorDept,		RegistDept,		NVL(#{ownerCode}, OwnerCode),
						#{userCode},	SYSDATE,			NULL
		FROM BOARD_MESSAGE 
		WHERE MessageID = #{messageID} AND Version = #{version}
 	</insert>
 	
    <insert id="createMessageFolder" parameterType="cmap">
		INSERT INTO board_message_folder
		(
			  MessageID
			, FolderID
			, Version
		)
		<foreach collection="multiFolderIDs" item="multiFolderID" separator=" UNION ALL ">
			SELECT
				  #{messageID}
				, #{multiFolderID}
				, #{version}
			FROM DUAL
		</foreach>
	</insert>
	
	<delete id="deleteMessageFolder" parameterType="cmap">
		DELETE FROM board_message_folder
		WHERE MessageID = #{messageID}
		AND Version = #{version}
	</delete>
    
    <!-- 개정 이후 이전버전의 게시글 데이터중 checkout기록 및 최신버전 정보를 모두 N으로 변경 -->
    <update id="updatePrevMessage" parameterType="cmap">
    	UPDATE BOARD_MESSAGE 
    	SET 
    		IsCheckOut = 'N', 
    		IsCurrent = 'N', 
    		CheckOuterCode = NULL
		WHERE MessageID = #{orgMessageID} AND version &lt; #{version}
	</update>
    
    <update id="updateMessageSeq" parameterType="cmap">
        UPDATE BOARD_MESSAGE  
        SET 
        	Seq = #{seq}
        	,Depth = #{depth}
        	,Step = #{step}
        	<if test="orgMessageID != null and orgMessageID != ''">
				,ParentID = #{orgMessageID}
			</if>
        WHERE MessageID = #{messageID}
    </update>
    
    <update id="updateMessage" parameterType="cmap">
        UPDATE BOARD_MESSAGE  
        SET
        	IsInherited = #{isInherited}
        	<if test="msgState != null and msgState != ''">
				,MsgState = #{msgState}
			</if>
        	<if test="bizSection == 'Doc' and folderID != null and folderID != ''">
				,folderID = #{folderID}
			</if>
			,TableHistoryType = #{tableHistoryType}
			,CategoryID = #{categoryID}
			,Subject = #{subject}
			,BodyText = #{bodyText}
			<if test='isPopup == "Y"'>
				,PopupStartDate = TO_DATE(#{popupStartDate}, 'YYYY.MM.DD HH24:MI:SS') 
				,PopupEndDate = TO_DATE(#{popupEndDate}, 'YYYY.MM.DD HH24:MI:SS') 
			</if>
			<if test='isPopup == "N"'>
				,PopupStartDate = NULL
				,PopupEndDate = NULL 
			</if>
			,TopStartDate = TO_DATE(#{topStartDate}, 'YYYY.MM.DD HH24:MI:SS') 
			,TopEndDate = TO_DATE(#{topEndDate}, 'YYYY.MM.DD HH24:MI:SS') 
			<if test="expiredDate != null and expiredDate != ''">
				,ExpiredDate = TO_DATE(#{expiredDate}, 'YYYY.MM.DD HH24:MI:SS') 
			</if>
			,BodyFormID = #{bodyFormID}
			<if test="useSecurity != null and useSecurity != ''">
				,UseSecurity = #{useSecurity}	
			</if>	
			,UseAnonym = #{useAnonym}
			,UseReplyNotice = #{useReplyNotice}
			,UseCommNotice = #{useCommNotice}
			,IsPopup = #{isPopup}
			,IsTop = #{isTop}
			,IsApproval = #{isApproval}
			,IsUserForm = #{isUserForm}
			<if test="useScrap != null and useScrap != ''">
				,UseScrap = #{useScrap}
			</if>			
			,NoticeMedia = #{noticeMedia}
			,UseRSS = #{useRSS}
			,FileCnt = #{fileCnt}
			,FileExtension = #{fileExtension}
			,ModifierCode = #{userCode}
			<if test='useAnonym == "Y"'>
				,CreatorName = #{creatorName}
				,CreatorLevel = #{creatorLevel}
				,CreatorPosition = #{creatorPosition}
				,CreatorTitle = #{creatorTitle}
				,CreatorDept = #{creatorDept}
			</if>
			<if test='prevAnony == "Y" and useAnonym == "N"'>
				,CreatorName = #{creatorName}
				,CreatorLevel = #{creatorLevel}
				,CreatorPosition = #{creatorPosition}
				,CreatorTitle = #{creatorTitle}
				,CreatorDept = #{creatorDept}
			</if>
			,ReservationDate = TO_DATE(#{reservationDate}, 'YYYY.MM.DD HH24:MI:SS')
			,SecurityLevel = #{securityLevel}
			,UseMessageReadAuth = #{useMessageReadAuth}
			,UsePubDeptName = #{usePubDeptName}
			<if test="bizSection == 'Doc'">
			    ,KeepYear = #{keepyear}
			    ,RevisionCode = #{userCode}
			    ,RevisionDate = SYSDATE
			</if>
			<if test="boardType== 'OnWriting'">
				,RegistDate = SYSDATE
			</if>
			<if test="LinkURL != null and LinkURL != ''">
				,LinkURL= #{LinkURL}
			</if>			
        WHERE MessageID = #{messageID}
        <if test="version != null and version != ''">
			AND Version = #{version}
		</if>
    </update>
    
    <!-- 게시번호 조회: Domain별, Folder별 -->
    <select id="selectNumberByBoard" parameterType="cmap" resultType="String">
		SELECT NVL(MAX(NUMBER_), 0) + 1
		FROM BOARD_MESSAGE
		WHERE 1=1
		<choose>
	    	<when test='numberingRule == "D"'>
				AND FolderID IN (
					SELECT A.FolderID
					FROM SYS_OBJECT_FOLDER A
						INNER JOIN SYS_OBJECT_FOLDER B ON A.DomainID = B.DomainID
					WHERE B.FolderID = #{folderID}
				)
	        </when>
	        <otherwise>
	    	   AND FolderID = #{folderID}
	        </otherwise>
	    </choose>
    </select>
    
    <!-- 익명을 사용할경우 의미없음 -->
    <select id="selectCreatorProfileData" parameterType="cmap" resultType="cmap">
        SELECT SOU.MultiDisplayName AS "creatorName",		
			   SOUBG.MultiDeptName AS "creatorDept",
			   SOUBG.MultiJobTitleName AS "creatorTitle",
			   SOUBG.MultiJobPositionName AS "creatorPosition",
			   SOUBG.MultiJobLevelName AS "creatorLevel"
		FROM SYS_OBJECT_USER_BASEGROUP SOUBG 
		INNER JOIN SYS_OBJECT_USER SOU ON SOU.UserCode = SOUBG.UserCode
		WHERE SOU.usercode = #{creatorCode}
		<if test="URBG_ID != null and URBG_ID != ''">
		AND SOUBG.Seq = #{URBG_ID}
		</if>
		AND ROWNUM = 1 
    </select>

    <!-- 열람권한 추가/삭제 -->
    <insert id="createMessageReadAuth" parameterType="cmap">
 	    INSERT INTO SYS_READ_ACL(
 	    	ServiceType,	
 	    	ObjectID, 		
 	    	ObjectType, 	
 	    	MessageID, 		
 	    	TargetCode, 	
 	    	TargetType, 	
 	    	IsSetting, 		
 	    	RegisterCode	
 	    )
 	    VALUES (
 	    	#{bizSection},
 	    	#{objectID},
 	    	'FD',
 	    	#{messageID},
 	    	#{targetCode},
 	    	#{targetType},
 	    	#{isSetting},
 	    	#{userCode}
 	    )
 	</insert>
 	
 	<delete id="deleteMessageReadAuth" parameterType="cmap">
 	    DELETE FROM SYS_READ_ACL
 	    WHERE 1=1
 	    AND ServiceType = #{bizSection}
 	    AND ObjectID = #{objectID}		
 	    AND ObjectType = 'FD'	
 	    AND MessageID = #{messageID}
 	</delete>
 	
 	<!-- 열람권한 조회:group, user테이블에서 필요한 정보 추가 조회 -->
 	<select id="selectMessageReadAuthList" parameterType="cmap" resultType="cmap">
 	    SELECT A.TargetType AS "TargetType"
			 , A.TargetCode AS "TargetCode"
			 , A.DisplayName AS "DisplayName"   
 	    FROM (
	 	    SELECT SRA.TargetType, SRA.TargetCode, FN_BASEGETDICTIONARY_S(#{lang}, SOU.MultiDisplayName) AS DisplayName
			FROM SYS_READ_ACL SRA
			INNER JOIN SYS_OBJECT_USER SOU ON (SRA.TargetCode = SOU.UserCode)
			WHERE 1=1 
			AND SRA.MessageID = #{messageID}
			AND SRA.ObjectID = #{folderID}
			AND SRA.ObjectType = 'FD'
			AND SRA.TargetType = 'UR'
			UNION
			SELECT SRA.TargetType, SRA.TargetCode, FN_BASEGETDICTIONARY_S(#{lang}, SOG.MultiDisplayName) AS DisplayName
				FROM SYS_READ_ACL SRA
				INNER JOIN SYS_OBJECT_GROUP SOG ON (SRA.TargetCode = SOG.GroupCode)
				WHERE 1=1
				AND SRA.MessageID = #{messageID}
				AND SRA.ObjectID = #{folderID}
				AND SRA.TargetType != 'UR'
		)A
 	</select>
 	
 	<select id="selectMessageReadAuthListCnt" parameterType="cmap" resultType="java.lang.Long">
 	    SELECT COUNT(*)
 	    FROM (
	 	    SELECT SRA.TargetType, SRA.TargetCode
			FROM SYS_READ_ACL SRA
			INNER JOIN SYS_OBJECT_USER SOU ON (SRA.TargetCode = SOU.UserCode)
			WHERE 1=1 
			AND SRA.MessageID = #{messageID}
			AND SRA.ObjectID = #{folderID}
			AND SRA.ObjectType = 'FD'
			AND SRA.TargetType = 'UR'
			UNION
			SELECT SRA.TargetType, SRA.TargetCode
				FROM SYS_READ_ACL SRA
				INNER JOIN SYS_OBJECT_GROUP SOG ON (SRA.TargetCode = SOG.GroupCode)
				WHERE 1=1
				AND SRA.MessageID = #{messageID}
				AND SRA.ObjectID = #{folderID}
				AND SRA.TargetType != 'UR'
		)A
 	</select>
 	
 	<!-- 열람권한 조회:group, user테이블에서 필요한 정보 추가 조회 -->
 	<select id="selectMessageReadAuthCount" parameterType="cmap" resultType="java.lang.Long">
 	    SELECT COUNT(*) FROM (
			SELECT SRA.TargetType, SRA.TargetCode
			FROM SYS_READ_ACL SRA
			INNER JOIN SYS_OBJECT_USER SOU ON (SRA.TargetCode = SOU.UserCode)
			WHERE 1=1 
			AND SRA.MessageID = #{messageID}
			AND SRA.ObjectID = #{folderID}
			AND SRA.ObjectType = 'FD'
			AND SRA.TargetType = 'UR'
			AND SRA.TargetCode = #{userCode}
			UNION
			SELECT SRA.TargetType, SRA.TargetCode
			FROM SYS_READ_ACL SRA
			INNER JOIN SYS_OBJECT_GROUP SOG ON (SRA.TargetCode = SOG.GroupCode)
			WHERE 1=1
			AND SRA.MessageID = #{messageID}
			AND SRA.ObjectID = #{folderID}
			AND SRA.ObjectType = 'FD'
			AND SRA.TargetType != 'UR'
			AND SRA.TargetCode IN
			<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
	            #{item}
		    </foreach>
		) RESULT
 	</select>
 	
 	<!-- 상세권한 조회:group, user테이블에서 필요한 정보 추가 조회 -->
 	<select id="selectMessageAuthList" parameterType="cmap" resultType="cmap">
		SELECT A.AclList AS "AclList"
		 	 , A.TargetType AS "TargetType"
		 	 , A.TargetCode AS "TargetCode"
		 	 , A.DisplayName AS "DisplayName"
		 	 , A.IsSubInclude AS "IsSubInclude"
		 	 , A.InheritedObjectID AS "InheritedObjectID"
		 	 , A.GroupType AS "GroupType"
		 	 , A.SortKey AS "SortKey"
		 FROM (
	 	    SELECT BMA.AclList, BMA.TargetType, BMA.TargetCode, FN_BASEGETDICTIONARY_S(#{lang}, SOU.MultiDisplayName) AS DisplayName, BMA.IsSubInclude, BMA.InheritedObjectID, 'User' AS GroupType, SOU.SortKey
			FROM BOARD_MESSAGE_ACL BMA
			INNER JOIN SYS_OBJECT_USER SOU ON (BMA.TargetCode = SOU.UserCode)
			WHERE 1=1 
			AND BMA.MessageID = #{messageID}
			AND BMA.Version = #{version}
			AND BMA.TargetType = 'UR'
			UNION
			SELECT BMA.AclList, BMA.TargetType, BMA.TargetCode, FN_BASEGETDICTIONARY_S(#{lang}, SOG.MultiDisplayName) AS DisplayName, BMA.IsSubInclude, BMA.InheritedObjectID, G.GroupType, GT.SortKey
			FROM BOARD_MESSAGE_ACL BMA
			INNER JOIN SYS_OBJECT_GROUP SOG ON (BMA.TargetCode = SOG.GroupCode)
			INNER JOIN SYS_OBJECT_GROUP G ON BMA.TargetCode = G.GroupCode
			INNER JOIN SYS_OBJECT_GROUP_TYPE GT ON GT.GroupType = G.GroupType
			WHERE 1=1
			AND BMA.MessageID = #{messageID}
			AND BMA.Version = #{version}
			AND BMA.TargetType != 'UR'
		)A   
		ORDER BY A.InheritedObjectID DESC, A.SortKey, A.DisplayName
 	</select>
 	
 	<!-- 상세권한 조회:group, user테이블에서 필요한 정보 추가 조회 -->
 	<select id="selectMessageAclList" parameterType="cmap" resultType="cmap">
		  SELECT auth.TargetType AS "TargetType"
		      , auth.AclList AS "AclList"
		      , auth.Security AS "Security"
		      , auth.CREATE_ AS "Create"
		      , auth.DELETE_ AS "Delete"
		      , auth.MODIFY_ AS "Modify"
		      , auth.EXECUTE_ AS "Execute"
		      , auth.Read AS "Read"
		 FROM (   
	 	    SELECT BMA.TargetType
	              , BMA.AclList
	              , BMA.Security
	              , BMA.CREATE_
	              , BMA.DELETE_
	              , BMA.MODIFY_
	          	  , BMA.EXECUTE_	    
	              , BMA.Read
	              , '99' AS AclPriority
	              , 999 AS Priority
	              , '' AS GroupPath
			FROM BOARD_MESSAGE_ACL BMA
			INNER JOIN SYS_OBJECT_USER SOU ON (BMA.TargetCode = SOU.UserCode)
			WHERE BMA.MessageID = #{messageID}
			AND BMA.Version = #{version}
			AND BMA.TargetCode = #{userCode}
			AND BMA.TargetType = 'UR'
      
			UNION ALL
      
			SELECT BMA.TargetType
		          , BMA.AclList
		          , BMA.Security
		          , BMA.CREATE_
		          , BMA.DELETE_
		          , BMA.MODIFY_
		          , BMA.EXECUTE_
		          , BMA.Read
		          , (CASE WHEN TargetType = 'CM' THEN '9' WHEN TargetType = 'GR' THEN '2' ELSE '3' END) AS AclPriority
		          , SOGT.Priority AS Priority
		          , SOG.GroupPath AS GroupPath
			FROM BOARD_MESSAGE_ACL BMA
			INNER JOIN SYS_OBJECT_GROUP SOG ON (BMA.TargetCode = SOG.GroupCode)
			INNER JOIN SYS_OBJECT_GROUP_TYPE SOGT ON (SOG.GroupType = SOGT.GroupType)
      		WHERE BMA.MessageID = #{messageID}
			AND BMA.Version = #{version}
			AND BMA.TargetType != 'UR'
			AND (
		    	(BMA.IsSubInclude = 'Y' AND BMA.TargetCode IN 
		    	<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
		            #{item}
			    </foreach>) 
			    OR (BMA.IsSubInclude = 'N' AND BMA.TargetCode = #{deptCode})
			    )
	 	) auth
    	ORDER BY auth.AclPriority DESC, auth.Priority DESC, auth.GroupPath ASC
 	</select>
 	
 	<!-- 커뮤니티 상세권한 조회 -->
 	<select id="selectCommunityAclList" parameterType="cmap" resultType="cmap">
 		SELECT auth.TargetType AS "TargetType"
		      , auth.AclList AS "AclList"
		      , auth.Security AS "Security"
		      , auth.CREATE_ AS "Create"
		      , auth.DELETE_ AS "Delete"
		      , auth.MODIFY_ AS "Modify"
		      , auth.EXECUTE_ AS "Execute"
		      , auth.Read AS "Read"
		 FROM (   
	 	    SELECT BMA.TargetType
	              , BMA.AclList
	              , BMA.Security
	              , BMA.CREATE_
	              , BMA.DELETE_
	              , BMA.MODIFY_
	          	  , BMA.EXECUTE_	    
	              , BMA.Read
	              , '99' AS AclPriority
	              , 999 AS Priority
	              , '' AS GroupPath
			FROM BOARD_MESSAGE_ACL BMA
			INNER JOIN SYS_OBJECT_USER SOU ON (BMA.TargetCode = SOU.UserCode)
			WHERE BMA.MessageID = #{messageID}
			AND BMA.TargetCode = #{userCode}
			AND BMA.TargetType = 'UR'
      
			UNION ALL
			
			SELECT BMA.TargetType
				 , BMA.AclList
				 , BMA.Security
				 , BMA.Create
				 , BMA.Delete
				 , BMA.Modify
				 , BMA.Execute
				 , BMA.Read
				 , '90' AS AclPriority
				 , SOGT.Priority AS Priority
	          	 , SOG.GroupPath AS GroupPath
			FROM BOARD_MESSAGE_ACL BMA
			INNER JOIN SYS_OBJECT_GROUP SOG ON (BMA.TargetCode = SOG.GroupCode)
			INNER JOIN SYS_OBJECT_GROUP_TYPE SOGT ON (SOG.GroupType = SOGT.GroupType)
			WHERE 1=1
			AND MessageID = #{messageID}
			AND TargetType = 'GR'
			AND TargetCode IN (SELECT CU_Code
								 FROM community AS C
									  INNER JOIN sys_object_group_member AS SOGM ON (C.CU_Code = SOGM.GroupCode)
								WHERE C.CU_ID = #{communityID}
								  AND SOGM.UserCode = #{userCode}
								  AND SOGM.MemberStatus = 'A'
								  AND SOGM.IsUse = 'Y')
			
			UNION ALL
      
			SELECT BMA.TargetType
		          , BMA.AclList
		          , BMA.Security
		          , BMA.CREATE_
		          , BMA.DELETE_
		          , BMA.MODIFY_
		          , BMA.EXECUTE_
		          , BMA.Read
		          , (CASE WHEN TargetType = 'CM' THEN '9' WHEN TargetType = 'GR' THEN '2' ELSE '3' END) AS AclPriority
		          , SOGT.Priority AS Priority
		          , SOG.GroupPath AS GroupPath
			FROM BOARD_MESSAGE_ACL BMA
			INNER JOIN SYS_OBJECT_GROUP SOG ON (BMA.TargetCode = SOG.GroupCode)
			INNER JOIN SYS_OBJECT_GROUP_TYPE SOGT ON (SOG.GroupType = SOGT.GroupType)
      		WHERE BMA.MessageID = #{messageID}
			AND BMA.TargetType != 'UR'
			AND (
		    	(BMA.IsSubInclude = 'Y' AND BMA.TargetCode IN 
		    	<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
		            #{item}
			    </foreach>) 
			    OR (BMA.IsSubInclude = 'N' AND BMA.TargetCode = #{deptCode})
			    )
	 	) auth
    	ORDER BY auth.AclPriority DESC, auth.Priority DESC, auth.GroupPath ASC
 	</select>
 	
 	<!-- 상세권한 추가 -->
 	<insert id="createMessageAuth" parameterType="cmap" > 	    
 	    INSERT INTO BOARD_MESSAGE_ACL(
 	    	MessageID, 
 	    	<if test="version != null and version != ''">
 	    		Version, 		
 	    	</if>
 	    	TargetCode, 	
 	    	TargetType, 	
 	    	AclList, 		
 	    	Security, 		
 	    	CREATE_,
 	    	DELETE_, 		
 	    	MODIFY_,			
 	    	EXECUTE_,
 	    	Read,
 	    	IsSubInclude,
 	    	InheritedObjectID,
 	    	RegisterCode
 	    )
 	    VALUES (
 	    	#{messageID},
 	    	<if test="version != null and version != ''">
 	    	    #{version},
 	    	</if>
 	    	#{targetCode},
 	    	#{targetType},
 	    	#{aclList},
 	    	#{security},
 	    	#{create},
 	    	#{delete},
 	    	#{modify},
 	    	#{execute},
 	    	#{read},
 	    	#{isSubInclude},
 	    	#{inheritedObjectID},
 	    	#{userCode}
 	    )
 	</insert>
 	
 	<!-- 상세권한 삭제 -->
    <delete id="deleteMessageAuth" parameterType="cmap">
 	    DELETE FROM BOARD_MESSAGE_ACL
 	    WHERE 1=1
 	    AND MessageID = #{messageID}
 	   	AND Version = #{version}
 	</delete>
 	
    <!-- 태그: Tag C/R/D -->
    <select id="selectMessageTagList" parameterType="cmap" resultType="cmap">
        SELECT Tag AS "Tag"
        FROM BOARD_MESSAGE_TAG
        WHERE 1=1
        AND MessageID = #{messageID}
        AND Version = #{version}
    </select>
    
    <insert id="createMessageTag" parameterType="cmap">
        INSERT INTO BOARD_MESSAGE_TAG(MessageID, Version, Tag)
        VALUES(#{messageID}, #{version}, #{tag})
    </insert>

    <delete id="deleteMessageTag" parameterType="cmap">
        DELETE FROM BOARD_MESSAGE_TAG 
        WHERE MessageID = #{messageID}
        AND Version = #{version}
    </delete>
    
    <!-- 링크: Link C/R/D -->
    <select id="selectMessageLinkList" parameterType="cmap" resultType="cmap">
        SELECT LinkID AS "LinkID"
        	, Title AS "Title"
        	, Url AS "Url"
        FROM BOARD_MESSAGE_LINK
        WHERE 1=1
        AND MessageID = #{messageID}
    </select>
    
    <insert id="createMessageLink" parameterType="cmap" >
        INSERT INTO BOARD_MESSAGE_LINK(Title, Url, MessageID)
        VALUES(#{title}, #{url}, #{messageID})
    </insert>
    
    <!-- 본문 정보 내용 추가 -->
    <insert id="createContents" parameterType="cmap">
   		{	CALL
			DECLARE
			cdata CLOB;
			BEGIN
			  cdata := NVL(#{body},' ');
			  
			  INSERT INTO SYS_CONTENTS(ObjectID, ObjectType, MessageID, Version, Body, BodySize)
			  VALUES(#{folderID}, 'FD', #{messageID}, #{version}, cdata, #{bodySize});
			END
		}
    </insert>
    
    <!-- 본문 정보 내용 수정 -->
    <update id="updateContents" parameterType="cmap">
   		{	CALL
				DECLARE
				cdata CLOB;
				BEGIN
			  		cdata := NVL(#{body},' ');

			        UPDATE SYS_CONTENTS 
			        SET  Body = cdata
			        	,BodySize = #{bodySize} 
			        WHERE 1=1
			        AND ObjectID = #{folderID}
			        AND ObjectType = 'FD'
			        AND MessageID = #{messageID}
			        AND Version = #{version};
			END
		}        
    </update>
    
    <!-- 일괄삭제 후 재등록 -->
    <delete id="deleteMessageLink" parameterType="cmap">
        DELETE FROM BOARD_MESSAGE_LINK
        WHERE MessageID = #{messageID}
    </delete>
    
    <!-- 사용자정의 필드: UserDefField C/R/D -->
    <insert id="createUserDefFieldValue" parameterType="cmap" >
        INSERT INTO BOARD_USERFORM_VALUE(MessageID, Version, UserFormID, FolderID, FieldValue)
        VALUES(#{messageID}, #{version}, #{userFormID}, #{folderID}, #{fieldValue})
    </insert>
    
    <!-- 화면표시용 사용자정의 필드 데이터표시: 이전에는 트리거로 추가하던 기능 -->
    <insert id="createMessageDefFieldValue" parameterType="cmap">
        INSERT INTO BOARD_MESSAGE_USERFORM_VALUE(
        	MessageID, FolderID, Version,
        	<foreach collection="fieldArray" item="item" index="index" separator="," >
				<choose>
					<when test='index == 1'>UF_Value1</when>
					<when test='index == 2'>UF_Value2</when>
					<when test='index == 3'>UF_Value3</when>
					<when test='index == 4'>UF_Value4</when>
					<when test='index == 5'>UF_Value5</when>
					<when test='index == 6'>UF_Value6</when>
					<when test='index == 7'>UF_Value7</when>
					<when test='index == 8'>UF_Value8</when>
					<when test='index == 9'>UF_Value9</when>
					<otherwise>UF_Value0</otherwise>
				</choose>
        	</foreach>
        )
        VALUES( #{messageID}, #{folderID}, #{version},
        	<foreach collection="fieldArray" item="item" index="index" separator="," >
            	#{item.FieldText}
        	</foreach>
        )
    </insert>
    
    <!-- 사용자정의 필드 데이터 갱신 -->
    <update id="updateMessageDefFieldValue" parameterType="cmap">
        UPDATE board_message_userform_value
        SET MessageID = #{messageID}
	        <if test='userFormIndex == "0"'>,UF_Value0 = #{userFormValue}</if>
	        <if test='userFormIndex == "1"'>,UF_Value1 = #{userFormValue}</if>
	        <if test='userFormIndex == "2"'>,UF_Value2 = #{userFormValue}</if>
	        <if test='userFormIndex == "3"'>,UF_Value3 = #{userFormValue}</if>
	        <if test='userFormIndex == "4"'>,UF_Value4 = #{userFormValue}</if>
	        <if test='userFormIndex == "5"'>,UF_Value5 = #{userFormValue}</if>
	        <if test='userFormIndex == "6"'>,UF_Value6 = #{userFormValue}</if>
	        <if test='userFormIndex == "7"'>,UF_Value7 = #{userFormValue}</if>
	        <if test='userFormIndex == "8"'>,UF_Value8 = #{userFormValue}</if>
	        <if test='userFormIndex == "9"'>,UF_Value9 = #{userFormValue}</if>
        WHERE MessageID = #{messageID}
        AND FolderID = #{folderID}
        AND Version = #{version}
    </update>
    
    <update id="createMessageEvent" parameterType="cmap">
	  MERGE INTO BOARD_MESSAGE_EVENT
	  USING DUAL ON (MessageID = #{messageID})
	  WHEN MATCHED THEN 
	   UPDATE SET EventType=#{eventType}, EventDate=#{eventDate}, EventOwner=#{eventOwner}
	   WHEN NOT MATCHED THEN 
	   INSERT (MessageID, EventType, EventDate, EventOwner)
	   VALUES (#{messageID}, #{eventType}, #{eventDate}, #{eventOwner})
    </update>
    
    <delete id="deleteMessageEvent" parameterType="cmap">
        DELETE FROM BOARD_MESSAGE_EVENT
        WHERE 1=1
        AND MessageID = #{messageID}
    </delete>
    
	<select id="selectUserDefFieldValue" parameterType="cmap" resultType="cmap">
		SELECT UserFormID AS "UserFormID", 
			   FieldValue AS "FieldValue"
		FROM BOARD_USERFORM_VALUE
		WHERE 1=1
		AND MessageID = #{messageID}
		AND Version = #{version}
	</select>
    
    <!-- 일괄삭제 후 재등록 -->
    <delete id="deleteUserDefFieldValue" parameterType="cmap">
        DELETE FROM BOARD_USERFORM_VALUE
        WHERE MessageID = #{messageID} AND Version = #{version}
    </delete>
    
    <delete id="deleteMessageDefFieldValue" parameterType="cmap">
        DELETE FROM BOARD_MESSAGE_USERFORM_VALUE
        WHERE MessageID = #{messageID} AND Version = #{version}
    </delete>
    
    <!-- 승인프로세스  -->
    <insert id="createProcess" parameterType="cmap" useGeneratedKeys="true">
        INSERT INTO SYS_PROCESS (ProcessDefID, MessageID, ObjectType, State, Subject, RegisterCode)
		VALUES (
		<if test="processID != null and processID != ''">
			#{processID},
		</if>
		<if test="processID == null or processID == ''">
			(SELECT ProcessID FROM SYS_PROCESS_TARGET WHERE ObjectType = 'FD' AND ObjectID = #{folderID}),
		</if>
			#{messageID}, #{bizSection}, 1, #{subject}, #{userCode})
		<selectKey keyProperty="instanceID" resultType="long" order="AFTER">
			SELECT SYS_PROCESS_SEQ.CURRVAL FROM dual
        </selectKey>	
    </insert>
        
   	<!-- 게시 작성자의 Activity 추가 -->
    <insert id="createActivity" parameterType="cmap">
		INSERT INTO SYS_PROCESS_ACTIVITY ( ProcessID, Step, SubStep, ActorRole, ActivityType, Seq, State, Comment_, StartDate, CompleteDate, 
			ActorCode, ActorName, ActorLevel, ActorPosition, ActorTitle, ActorDept)
		VALUES ( #{instanceID}, 0, 0, 'Register', 'Serial', 0, 7, '', SYSDATE, SYSDATE, 
			#{actorCode}, #{actorName}, NVL(#{actorLevel}, ' '), NVL(#{actorPosition}, ' '), NVL(#{actorTitle}, ' '), #{actorDept})
    </insert>
    
    <!-- 정의된 Performer 데이터로 Activity 데이터 추가 -->
    <insert id="createPerformerActivity" parameterType="cmap">
        INSERT INTO SYS_PROCESS_ACTIVITY ( ProcessID, Step, SubStep, ActorRole, ActivityType, Seq, State, Comment_, 
			ActorCode, ActorName, ActorLevel, ActorPosition, ActorTitle, ActorDept , StartDate)
		SELECT #{instanceID}, Step + 1 AS Step, SubStep, ActorRole, ActivityType, Step + 1, DECODE(Step+1, 1, 1, 0), '', 
				ActorCode, DisplayName, NVL(B.MultiJobLevelName, ' '), NVL(B.MultiJobPositionName, ' '), NVL(B.MultiJobTitleName, ' '), B.MultiDeptName, DECODE(Step+1, 1, SYSDATE, NULL)
		FROM	SYS_PROCESS_PERFORMER A
				LEFT OUTER JOIN SYS_OBJECT_USER_BASEGROUP B ON	A.ActorCode = B.UserCode
		WHERE 1=1
		AND JobType = 'Origin'
		<if test="processID != null and processID != ''">
			AND ProcessID = #{processID}
		</if>
		<if test="processID == null or processID == ''">
			AND ProcessID = (SELECT ProcessID FROM SYS_PROCESS_TARGET WHERE ObjectType = 'FD' AND ObjectID = #{folderID})
		</if>
		ORDER BY Step ASC, A.SubStep ASC 
    </insert>
    
    <!-- 상세 보기 조회 쿼리 -->
    <select id="selectMessageDetail" parameterType="cmap" resultMap="bodyResult">
        SELECT  
			A.MessageID AS "MessageID"
	 	  , A.FolderID AS "FolderID"
		  , A.IsInherited AS "IsInherited"
		  , NVL(ParentID, '') AS "ParentID"
		  , MsgType AS "MsgType"
		  , NVL(MsgState, '') AS "MsgState"
		  , NVL(A.CategoryID, '') AS "CategoryID"
		  , Number_  AS "Number"
		  , Seq AS "Seq"
		  , Step AS "Step"
		  , Depth AS "Depth"
		  , NVL(A.Subject, '') AS "Subject"
		  , NVL(SUBSTR(BodyText, 1, dbms_lob.getlength(BodyText)), '') AS "BodyText"
		  , NVL(PopupStartDate, '') AS "PopupStartDate"
		  , NVL(PopupEndDate, '') AS "PopupEndDate"
		  , A.Version AS "Version"
		  , NVL(TO_CHAR(A.TopStartDate, 'YYYY.MM.DD'), '') AS "TopStartDate"
		  , NVL(TO_CHAR(A.TopEndDate, 'YYYY.MM.DD'), '') AS "TopEndDate"
		  , NVL(BodyFormID, '') AS "BodyFormID"
		  , NVL(UseSecurity, 'N') AS "UseSecurity"
		  , NVL(UseAnonym, 'N')  AS "UseAnonym"
		  , NVL(IsPopup, 'N')  AS "IsPopup"
		  , IsTop AS "IsTop"
		  , NVL(IsApproval, 'N') AS "IsApproval"
		  , NVL(IsUserForm, 'N') AS "IsUserForm"
		  , NVL(UseScrap, 'N') AS "UseScrap"
		  , NVL(NoticeMedia, '') AS "NoticeMedia"
		  , NVL(UseRSS, 'N') AS "UseRSS"
		  , NVL(UseReplyNotice, 'N') AS "UseReplyNotice"
		  , NVL(UseCommNotice, 'N')  AS "UseCommNotice"
		  , NVL(TrackBackURL, '') AS "TrackBackURL"
		  , AnswerCnt  AS "AnswerCnt"
		  , ReadCnt  AS "ReadCnt"
		  , SatisfactionPoint  AS "SatisfactionPoint"
		  , ScrapCnt  AS "ScrapCnt"
		  , ReportCnt  AS "ReportCnt"
		  , FileCnt   AS "FileCnt"
		  , NVL(FileExtension, '') AS "FileExtension"
		  , TracbackCnt AS "TracbackCnt"
		  , NVL(IsMobile, 'N') AS "IsMobile"
		  , IsCurrent AS "IsCurrent"
		  , IsCheckOut AS "IsCheckOut"
		  , NVL(CheckOuterCode, '') AS "CheckOuterCode"
		  , NVL(A.ProgressState, '') AS "ProgressState"
		  , A.CreatorCode AS "CreatorCode"
		  , NVL(A.OwnerCode, '') AS "OwnerCode"
		  , NVL((SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = A.OwnerCode), '') AS "OwnerName"
		  , F.OwnerCode AS "FolderOwnerCode"
		  , F.FolderType AS "FolderType"
		  , F.ObjectType AS "ServiceType"
		  , CreateDate AS "CreateDate"
		  , FN_BASEGETDICTIONARY_S(#{lang}, CreatorName) AS "CreatorName"
		  , FN_BASEGETDICTIONARY_S(#{lang}, CreatorLevel) AS "CreatorLevel"
		  , FN_BASEGETDICTIONARY_S(#{lang}, CreatorPosition) AS "CreatorPosition"
		  , FN_BASEGETDICTIONARY_S(#{lang}, CreatorTitle) AS "CreatorTitle"
		  , FN_BASEGETDICTIONARY_S(#{lang}, CreatorDept) AS "CreatorDept"
		  , (SELECT NVL(PhotoPath, '') FROM SYS_OBJECT_USER WHERE UserCode = A.CreatorCode) AS "PhotoPath"
		  , TO_CHAR(A.RegistDate, 'YYYY.MM.DD HH24:MI:SS') AS "RegistDate"
		  , NVL(TO_CHAR(A.ExpiredDate, 'YYYY.MM.DD'), '') AS "ExpiredDate"
		  , NVL(TO_CHAR(A.ReservationDate, 'YYYY.MM.DD HH24:MI:SS'), '') AS "ReservationDate"
		  , NVL(TO_CHAR(A.DeleteDate, 'YYYY.MM.DD HH24:MI:SS'), '') AS "DeleteDate"
		  , NVL(A.TableHistoryType, '') AS "TableHistoryType"
		  , NVL(TO_CHAR(A.TableBody), '') AS "TableBody"
		  , NVL(TO_CHAR(A.HistoryBody), '') AS "HistoryBody"
		  , NVL(A.ScheduleStartDate,'') AS "ScheduleStartDate"
		  , NVL(A.ScheduleEndDate,'') AS "ScheduleEndDate"
		  , NVL(A.ScheduleDisplayColor,'') AS "ScheduleDisplayColor"
		  , NVL(A.ScheduleStartHour,'') AS "ScheduleStartHour"
		  , NVL(A.ScheduleStartMinute,'') AS "ScheduleStartMinute"
		  , NVL(A.ScheduleEndHour,'') AS "ScheduleEndHour"
		  , NVL(A.ScheduleEndMinute,'') AS "ScheduleEndMinute"
		  , NVL(A.IsAllDay,'') AS "IsAllDay"
		  , NVL(SUBSTR(B.Body, 1, dbms_lob.getlength(B.Body)), '') AS "Body"
		  , NVL(FN_BASEGETDICTIONARY_S(#{lang}, C.DisplayName), '') AS "CategoryName"
		  , NVL(C.MemberOf, '') AS "CategoryMemberOf"
		  , NVL(P.ProcessID, '') AS "ProcessID"
		  , NVL(P.ProcessDefID, '') AS "ProcessDefID"
		  , NVL(A.SecurityLevel, '999') AS "SecurityLevel"
		  , NVL(A.UseMessageReadAuth, 'N') AS "UseMessageReadAuth"
		  , (SELECT NVL(UseMessageAuth,'N') FROM BOARD_CONFIG WHERE FolderID = A.FolderID) AS "UseMessageAuth"
		  , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' END FROM BOARD_MESSAGE_ACL WHERE MessageID = A.MessageID) AS "MessageAuth"
		  ,	NVL(A.UsePubDeptName, 'N') AS "UsePubDeptName"
		  , NVL(A.KeepYear, '') AS "KeepYear"
		  , NVL(A.RegistDept, '') AS "RegistDept"
		  , NVL(BME.EventOwner, '') AS "EventOwnerCode"
		  , NVL(BME.EventType, '') AS "EventType"
		  ,	NVL(TO_CHAR(BME.EventDate, 'YYYY.MM.DD'), '') AS "EventDate"
		  , NVL((SELECT FN_BASEGETDICTIONARY_S( #{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = BME.EventOwner), '') AS "EventOwnerName"
		  , NVL((SELECT FN_BASEGETDICTIONARY_S( #{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = A.RevisionCode), '') AS "RevisionName"
		  ,	DECODE(A.RevisionDate , NULL, TO_CHAR(A.RegistDate, 'YYYY.MM.DD HH24:MI:SS'), TO_CHAR(A.RevisionDate, 'YYYY.MM.DD HH24:MI:SS')) AS "RevisionDate"
		  ,	NVL(Fn_BaseGetDictionary_S( #{lang}, G.MultiDisplayName),'') AS "RegistDeptName"
		  ,	NVL(A.LinkURL, '') AS "LinkURL"
		  , NVL((SELECT LISTAGG(FolderID, ';') WITHIN GROUP(ORDER BY FolderID) FROM board_message_folder WHERE MessageID = #{messageID} AND Version = #{version}), '') AS "MultiFolderIDs"
		FROM BOARD_MESSAGE A 
		LEFT OUTER JOIN SYS_CONTENTS B ON A.MessageID = B.MessageID AND A.FolderID = B.ObjectID AND A.Version = B.Version
		LEFT OUTER JOIN BOARD_CATEGORY C ON C.FolderID = #{folderID} AND A.CategoryID = C.CategoryID	
		LEFT OUTER JOIN BOARD_MESSAGE_EVENT BME ON (BME.MessageID = A.MessageID)
		LEFT OUTER JOIN SYS_PROCESS P ON P.MessageID = A.MessageID  AND P.ObjectType = #{bizSection}
		LEFT OUTER JOIN sys_object_folder F ON A.FolderID = f.FolderID 
        LEFT OUTER JOIN sys_object_group G ON A.RegistDept = G.groupcode
		WHERE A.MessageID = #{messageID} 
		AND A.Version = #{version}
		<![CDATA[
		AND ROWNUM = 1
		]]>
    </select>
    
	<!-- 원본 게시글 하위에 있는 답글들의 step을 전부 1씩 증가시킴 -->
	<update id="updatePrevReplyMessage" parameterType="cmap">
	    UPDATE BOARD_MESSAGE
	    SET
	    	Step = Step+1
	    WHERE Seq = #{seq}
	    AND Step > #{step}
	</update>
	
	<!-- 체크아웃 상태 여부 확인 -->
	<select id="selectMessageCheckOutStatus" parameterType="cmap" resultType="java.lang.Long">
	    SELECT COUNT(*) 
	    FROM BOARD_MESSAGE
	    WHERE 1=1
	    AND MessageID = #{messageID}
	    AND Version = #{version}
	    <choose>
	    	<when test="actType == 'In' or actType == 'Revision' or actType == 'Cancel'">
				AND IsCheckOut  = 'Y'
	    	</when>
	    	<when test="actType == 'Renew' or actType == 'Out'">
	    	    AND IsCheckOut='N'
	    	</when>
    	</choose>
    	<if test="actType == 'Out' or actType == 'Cancel'">
    	    AND IsCurrent  = 'Y'
    	</if>
	</select>
	
	<!-- 개정이력 조회 -->
	<select id="selectRevisionHistory" parameterType="cmap" resultType="cmap">
	     SELECT	
       		MAX(BM.MessageID) AS "MessageID"
 			, BM.Version  AS "Version"
 			,  MAX(BM.Subject) AS "Subject"
 			,  MAX(SOU.UserCode) AS "UserCode"
 			,  MAX(BM.IsCurrent) AS "IsCurrent"
			, FN_BASEGETDICTIONARY_S( #{lang}, MAX(SOU.MultiDisplayName)) AS "RevisionName"
			, DECODE(MAX(BM.RevisionDate), NULL, TO_CHAR(MAX(BM.RegistDate),'YYYY.MM.DD'), TO_CHAR(MAX(BM.RevisionDate),'YYYY.MM.DD')) AS "RevisionDate"
			, DECODE(MAX(BM.RevisionDate), NULL, TO_CHAR(MAX(BM.RegistDate),'HH24:MI:SS'), TO_CHAR(MAX(BM.RevisionDate),'HH24:MI:SS')) AS "RevisionTime"
		FROM BOARD_MESSAGE BM
		LEFT OUTER JOIN SYS_OBJECT_USER SOU ON BM.RevisionCode = SOU.UserCode
		WHERE BM.MessageID = #{messageID}
		GROUP BY BM.Version
    	ORDER BY BM.Version DESC
	</select>
	
	<!-- 개정 이력 추가 -->
	<insert id="createCheckInOutHistory" parameterType="cmap">
	    INSERT INTO DOC_INOUT_HISTORY(MessageID,Version, CO_Code, ActType, Msg, CO_Date, CI_Date)
		VALUES(#{messageID},#{version},#{userCode},#{actType},#{comment},
			<choose>
		    	<when test="actType == 'In' or actType == 'Cancel' or actType == 'Revision'">
		    	    NULL
					, SYSDATE
		        </when>
		        <otherwise>
		            SYSDATE
					, NULL
		        </otherwise>
		    </choose>
			
		)
	</insert>
	
	<!-- 기존에 체크아웃된 게시글 상태 변경 -->
	<update id="updateCheckInOutHistory" parameterType="cmap">
	    UPDATE DOC_INOUT_HISTORY 
	    SET 
	    	<choose>
		    	<when test="actType == 'Cancel'">
		    	    DeleteDate = SYSDATE
		    	    , DeleterCode = #{userCode}
		    	</when>
		    	<otherwise>
		    	    CI_Date = SYSDATE
	    			, ActType = #{actType}
		    	</otherwise>
	    	</choose>
		WHERE MessageID = #{messageID} 
		AND Version = #{version} 
		AND ActType = 'Out'
		AND DeleteDate IS NULL
	</update>
	
	<!-- 문서 게시글 수정페이지 접근시 게시글 체크아웃 상태로 변경 -->
    <update id="updateMessageCheckOut" parameterType="cmap" >
        UPDATE BOARD_MESSAGE
        SET
        	IsCheckOut = 'Y'
        	,CheckOuterCode = #{userCode}
        WHERE MessageID = #{messageID}
        AND Version = #{version}
    </update>
    
    <!-- 수정/개정시 첨부파일 삭제 처리 -->
    <delete id="deleteFile" parameterType="cmap">
       <![CDATA[
		DELETE FROM SYS_FILE
		WHERE ServiceType = #{ServiceType} AND ObjectID = #{ObjectID} AND ObjectType = #{ObjectType} AND MessageID = #{MessageID} AND Version = #{Version}
		]]>
	</delete>
    
    <!-- 게시물 이동 -->
    <update id="moveMessage" parameterType="cmap">
        UPDATE BOARD_MESSAGE
        SET
        	MsgType = 'M'
        	,FolderID = #{folderID}
        WHERE 1=1
      	AND Seq = #{messageID}
    </update>
    
    <!-- 게시물 이동시 첨부파일 정보 변경 -->
    <update id="moveMessageFile" parameterType="cmap">
        UPDATE SYS_FILE
        SET
        	objectID = #{folderID}
        WHERE MessageID = #{messageID}
        AND ObjectType = 'FD'
        AND ObjectID = #{orgFolderID}
    </update>
    
    <!-- 게시물 이동시 본문 내용 정보 변경 -->
    <update id="moveMessageContents" parameterType="cmap">
        UPDATE SYS_CONTENTS
        SET
        	objectID = #{folderID}
        WHERE MessageID = #{messageID}
        AND ObjectType = 'FD'
        AND ObjectID = #{orgFolderID}
    </update>
    
    <!-- 게시물 이동시 사용자 정의 필드 정보 변경 -->
    <update id="moveMessageUserDefField" parameterType="cmap">
        UPDATE BOARD_USERFORM_VALUE
        SET
        	FolderID = #{folderID}
        WHERE MessageID = #{messageID}
        AND FolderID = #{orgFolderID}
    </update>
    
    <!-- 게시글 이동 이력 추가 -->
    <insert id="createMoveHistory" parameterType="cmap">
        INSERT INTO BOARD_MESSAGE_MOVE (SourceMessageID, SourceFD, MoveFD, HistoryID, RegisterCode, RegistDate)
		VALUES (#{messageID}, #{orgFolderID}, #{folderID}, #{historyID}, #{userCode}, SYSDATE)
    </insert>
    
    <insert id="copyMessage" parameterType="cmap" useGeneratedKeys="true">
        INSERT INTO BOARD_MESSAGE
				(FolderID, Version, IsInherited, IsCurrent, IsCheckOut, ParentID, MsgType, MsgState, CategoryID, NUMBER_, Seq, Step, Depth,
				Subject, BodyText, PopupStartDate, PopupEndDate, TopStartDate, TopEndDate, ExpiredDate,
				UseSecurity, IsPopup, IsTop, IsApproval, IsUserForm, UseScrap, NoticeMedia, UseRSS,
				UseReplyNotice, UseCommNotice, TrackBackURL, AnswerCnt, ReadCnt, 
				ScrapCnt, ReportCnt, FileCnt, FileExtension, TracbackCnt, RegistDate,
				CreatorCode, CreateDate, CreatorName, CreatorLevel, CreatorPosition, CreatorTitle, CreatorDept, 
				ModifierCode, ModifyDate,OwnerCode) 
        SELECT	#{folderID}, Version, 'Y', IsCurrent, 'N', NULL, 'C', 'C', #{categoryID}, #{number}, 0, Step, Depth,
				Subject, BodyText, NULL, NULL, NULL, NULL, '9999-12-31',
				'N', 'N', 'N', 'N', IsUserForm, 'Y', NULL, 'N',
				'N', 'N', NULL, 0, 0,
				0, 0, FileCnt, FileExtension, 0, SYSDATE,
				#{creatorCode}, SYSDATE, #{creatorName}, #{creatorLevel}, #{creatorPosition}, #{creatorTitle}, #{creatorDept},
				NULL, SYSDATE, #{ownerCode}  
		FROM BOARD_MESSAGE
		WHERE MessageID = #{orgMessageID}
		<selectKey keyProperty="messageID" resultType="long" order="AFTER">
			SELECT BOARD_MESSAGE_SEQ.CURRVAL FROM dual
        </selectKey>
    </insert>
    
    <!-- 게시글 스크랩 -->
    <insert id="scrapMessage" parameterType="cmap" useGeneratedKeys="true">
        INSERT INTO BOARD_MESSAGE
				(FolderID, Version, IsInherited, IsCurrent, IsCheckOut, ParentID, MsgType, MsgState, CategoryID, Number_, Seq, Step, Depth,
				Subject, BodyText, PopupStartDate, PopupEndDate, TopStartDate, TopEndDate, ExpiredDate,
				UseSecurity, IsPopup, IsTop, IsApproval, IsUserForm, UseScrap, NoticeMedia, UseRSS,
				UseReplyNotice, UseCommNotice, TrackBackURL, AnswerCnt, ReadCnt, 
				ScrapCnt, ReportCnt, FileCnt, FileExtension, TracbackCnt, RegistDate,
				CreatorCode, CreateDate, CreatorName, CreatorLevel, CreatorPosition, CreatorTitle, CreatorDept, 
				ModifierCode, ModifyDate,OwnerCode) 
        SELECT	FolderID, Version, 'Y', IsCurrent, 'N', NULL, 'S', 'C', CategoryID, Number_, 0, Step, Depth,
				Subject, BodyText, NULL, NULL, NULL, NULL, '9999-12-31',
				'N', 'N', 'N', 'N', IsUserForm, 'Y', NULL, 'N',
				'N', 'N', NULL, 0, 0,
				0, 0, FileCnt, FileExtension, 0, SYSDATE,
				#{userCode}, SYSDATE, #{creatorName}, #{creatorLevel}, #{creatorPosition}, #{creatorTitle}, #{creatorDept},
				#{userCode}, SYSDATE, OwnerCode      
		FROM BOARD_MESSAGE
		WHERE MessageID = #{orgMessageID}
		<selectKey keyProperty="messageID" resultType="long" order="AFTER">
			SELECT BOARD_MESSAGE_SEQ.CURRVAL FROM dual
        </selectKey>
    </insert>
    
    <insert id="scrapMessageContents" parameterType="cmap">
        INSERT INTO SYS_CONTENTS
			(ObjectID, ObjectType, MessageID, Version, Body, BodySize, Reserved1)
		SELECT ObjectID, ObjectType, #{messageID}, Version, Body, BodySize, Reserved1
		FROM SYS_CONTENTS
		WHERE MessageID  = #{orgMessageID}
    </insert>
    
    <!-- 스크랩 게시글의 Seq및 정보 수정 -->
    <update id="updateScrapMessageSeq" parameterType="cmap">
        UPDATE BOARD_MESSAGE
        SET Seq = #{messageID}
        WHERE MessageID = #{messageID}
    </update>
    
    <!-- 업로드된 파일 정보 복사 -->
    <insert id="copyMessageFile" parameterType="cmap">
        INSERT INTO SYS_FILE
			   (StorageID, ServiceType, ObjectID, ObjectType, MessageID, Version
				SaveType, Seq, FilePath, FileName, SavedName, Extention, 
				SIZE_, Description, RegistDate) 
		SELECT 	StorageID, ServiceType, #{folderID}, ObjectType, #{messageID}, Version
				SaveType, Seq, FilePath, FileName, SavedName, Extention, 
				SIZE_, Description, SYSDATE
		FROM SYS_FILE  
		WHERE MessageID  = #{orgMessageID} AND ObjectID = #{orgFolderID}
    </insert>
    
    <!-- 링크 옵션 복사 -->
    <insert id="copyMessageLink" parameterType="cmap">
        INSERT INTO BOARD_MESAAGE_LINK
			(MessageID, Title, URL, RegistDate)
		SELECT #{messageID}, Title, URL, SYSDATE 
		FROM BOARD_MESSAGE_LINK 
		WHERE MessageID=#{orgMessageID}
    </insert>
    
    <!-- 태그 옵션 복사 -->
    <insert id="copyMessageTag" parameterType="cmap">
        INSERT INTO BOARD_MESSAGE_TAG
			(MessageID, Tag)
		SELECT #{messageID}, Tag 
		FROM BOARD_MESSAGE_TAG
		WHERE MessageID=#{OrgMessageID}	
    </insert>
    
    <insert id="copyMessageContents" parameterType="cmap">
        INSERT INTO SYS_CONTENTS
			(ObjectID, ObjectType, MessageID, Version,  Body, BodySize, Reserved1)
		SELECT #{folderID}, ObjectType, #{messageID}, Version, Body, BodySize, Reserved1
		FROM SYS_CONTENTS
		WHERE MessageID  = #{orgMessageID} AND ObjectID = #{orgFolderID}
    </insert>
    
    <insert id="copyMessageUserDefField" parameterType="cmap">
        INSERT INTO BOARD_USERFORM_VALUE
			(MessageID, UserFormID, FolderID, FieldValue)
		SELECT #{messageID}, UserFormID, #{folderID}, FieldValue 
		FROM BOARD_USERFORM_VALUE  
		WHERE MessageID=#{orgMessageID} AND FolderID=#{orgFolderID}
    </insert>
    
    <!-- 복사된 게시글의 Seq정보 수정 -->
    <update id="updateCopyMessageSeq" parameterType="cmap">
        UPDATE BOARD_MESSAGE
        SET Seq = #{messageID}
        WHERE MessageID = #{messageID}
    </update>
    
    <!-- 게시글 복사 이력 추가 -->
    <insert id="createCopyHistory" parameterType="cmap">
        INSERT INTO BOARD_MESSAGE_COPY (SourceMessageID, CopyMessageID, SourceFolderID, CopyFolderID, HistoryID, RegisterCode, RegistDate)
		VALUES (#{orgMessageID}, #{messageID}, #{orgFolderID}, #{folderID}, #{historyID}, #{userCode}, SYSDATE)
    </insert>
    
    <!-- 게시글 신고 -->
    <insert id="reportMessage" parameterType="cmap">
        INSERT INTO BOARD_MESSAGE_REPORT(MessageID, HistoryID, RegisterCode, RegistDate)
        VALUES(#{messageID}, #{historyID}, #{userCode},  SYSDATE)
    </insert>
    
    <!-- 게시글 신고 회수 추가 -->
    <update id="updateMessageCnt" parameterType="cmap">
        UPDATE BOARD_MESSAGE
        SET ReportCnt = NVL(ReportCnt, 0)+1
        WHERE MessageID = #{messageID}
    </update>
    
    <!-- 신고 게시글 중복 신고 여부 확인 -->
    <select id="checkExistReport" parameterType="cmap" resultType="java.lang.Long">
        SELECT COUNT(*) 
        FROM BOARD_MESSAGE_REPORT
        WHERE RegisterCode = #{userCode} AND MessageID = #{messageID}
    </select>
    
    <!-- 현재 사용자 결새 Step 검색 -->
    <select id="selectProcessActivityStep" parameterType="cmap" resultType="cmap">
        SELECT Step AS "step"
		FROM SYS_PROCESS_ACTIVITY
		WHERE 1=1
		AND ProcessID = #{processID}
		AND ActorCode = #{userCode}
		AND CompleteDate IS NULL
		AND StartDate IS NOT NULL
    </select>
    
    <!-- SubStep: SubStep검색 -->
    <select id="selectProcessActivitySubStep" parameterType="cmap" resultType="cmap">
        SELECT COUNT(*) AS "subStep"
        FROM SYS_PROCESS_ACTIVITY 
        WHERE ProcessID = #{processID} 
        AND Step = #{step} 
        AND State = 7
    </select>
    
    <!-- LastSubStep: 전체 승인 개수 검색 -->
    <select id="selectProcessActivityLastSubStep" parameterType="cmap" resultType="cmap">
        SELECT COUNT(*) AS "lastSubStep"
        FROM SYS_PROCESS_ACTIVITY
        WHERE ProcessID = #{processID} 
        AND Step = #{step} 
    </select>
    
    <select id="selectProcessActivityLastStep" parameterType="cmap" resultType="cmap">
        SELECT MAX(Step) AS "lastStep" 
        FROM SYS_PROCESS_ACTIVITY
		WHERE ProcessID = #{processID}
		ORDER BY Step DESC
    </select>
    
    <!-- 다음 승인자 상태값 변경 -->
    <update id="updateNextApproverState" parameterType="cmap">
        UPDATE SYS_PROCESS_ACTIVITY
        SET State = 1 
        	,StartDate = SYSDATE
        WHERE ProcessID = #{processID} AND Step = #{step}
    </update>
    
    <update id="updateProcessActivity" parameterType="cmap">
        UPDATE SYS_PROCESS_ACTIVITY
        SET State = #{state}		
        	,CompleteDate = SYSDATE
        	,Comment_ = #{comment} 
        WHERE ProcessID = #{processID} 
        AND ActorCode = #{userCode}
        <if test="step == null or step == ''">
			AND Step = #{step}
		</if>
    </update>
    
    <!-- 승인 거절, 반려시 병렬 진행중인 프로세스 상태값 초기화 -->
    <update id="updateProcessActivityParallel" parameterType="cmap">
        UPDATE SYS_PROCESS_ACTIVITY
        SET State = 0		
        	,CompleteDate = NULL
        WHERE ProcessID = #{processID}
        AND Step = #{step} 
        AND State = 1
    </update>
    
    <update id="updateProcess" parameterType="cmap">
        UPDATE SYS_PROCESS
        SET State = #{state}		
        	,CompleteDate= SYSDATE
        WHERE ProcessID = #{processID} 
    </update>
    
    <!-- 승인/거부 이후 게시글 상태 변경 -->
    <update id="updateMessageWorkState" parameterType="cmap">
        UPDATE BOARD_MESSAGE
        SET 
        	<if test="historyType == 'Approval'">
        		MsgState = 'A'
        		,RegistDate = SYSDATE
        		,IsCheckOut = 'N'
        	</if>
        	<if test="historyType == 'Return'">
        	    MsgState = 'D'
        	</if>
       	WHERE MessageID = #{messageID}
    </update>
    
    <!-- 체크아웃 상태 변경 -->
    <update id="updateCheckOutState" parameterType="cmap">
        UPDATE BOARD_MESSAGE 
		SET IsCheckOut = #{isCheckOut}
			,CheckOuterCode = #{checkOuterCode}
			<if test="actType == 'Revision' or actType == 'Renew'">
			    IsCurrent = 'N'
			</if>
		WHERE MessageID = #{messageID}
		AND Version = #{version}
		AND DeleteDate IS NULL
    </update>
    
    <!-- 조회기록 추가 변경전 확인 -->
    <select id="selectMessageReader" parameterType="cmap" resultType="java.lang.Long">
        SELECT COUNT(*)
        FROM BOARD_MESSAGE_READER
		WHERE MessageID = #{messageID} 
		AND ReaderCode = #{userCode}
		AND Version = #{version}
    </select>
    
    <!-- 조회수 변경 -->
    <update id="updateReadCount" parameterType="cmap">
        UPDATE BOARD_MESSAGE
        SET readcnt = readcnt + 1
        WHERE 1=1
        AND MessageID = #{messageID}
        AND Version = #{version}
    </update>
    
    <!-- 조회 이력 추가 -->
    <insert id="createMessageReader" parameterType="cmap">
        INSERT INTO BOARD_MESSAGE_READER(MessageID, Version, ReaderCode, ReadDate)
        VALUES(#{messageID}, #{version}, #{userCode}, SYSDATE)
    </insert>
    
    <!-- 수정요청 추가 -->
    <insert id="createRequestModifyMessage" parameterType="cmap">
        INSERT INTO BOARD_REQUEST_MODIFY( MessageID, FolderID, RequestMessage, RequestorCode, RequestorName, RequestDate, RequestStatus)
        VALUES(#{messageID}, #{folderID}, #{comment}, #{userCode}, (SELECT MultiDisplayName FROM SYS_OBJECT_USER WHERE UserCode = #{userCode}), SYSDATE, #{requestStatus})
    </insert>
    
    <select id="selectNormalPrevNextMessage" parameterType="cmap" resultType="cmap">
	   SELECT A.MessageID AS "MessageID"
	        , A.Version AS "Version"
	        , A.FolderID AS "FolderID"
	        , A.MenuID AS "MenuID"
	        , A.Subject AS "Subject"
	        , A.RegistDate AS "RegistDate"
	        , A.CreatorCode AS "CreatorCode"
	        , A.CreateDate AS "CreateDate"
	        , A.Seq AS "Seq"
	        , A.CommentCnt  AS "CommentCnt"
	        , A.CreatorName AS "CreatorName"
	        , A.CreatorLevel AS "CreatorLevel"
	        , A.CreatorPosition AS "CreatorPosition"
	        , A.CreatorTitle AS "CreatorTitle"
	        , A.CreatorDept AS "CreatorDept"
	        , A.ListTop AS "ListTop"
	        , A.UF_Value0 AS "UF_Value0"  
	        , A.UF_Value1 AS "UF_Value1"  
	        , A.UF_Value2 AS "UF_Value2"  
	        , A.UF_Value3 AS "UF_Value3"  
	        , A.UF_Value4 AS "UF_Value4"  
	        , A.UF_Value5 AS "UF_Value5"  
	        , A.UF_Value6 AS "UF_Value6"  
	        , A.UF_Value7 AS "UF_Value7"  
	        , A.UF_Value8 AS "UF_Value8"  
	        , A.UF_Value9 AS "UF_Value9"  
	   FROM ( 
        SELECT * FROM ( 
				SELECT
					BM.MessageID 
					, BM.Version
					, BM.FolderID 
					, (SELECT MenuID FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS MenuID
					, BM.Subject  
					, TO_CHAR(BM.RegistDate,'YYYY.MM.DD HH24:MI:SS') AS RegistDate
					, BM.CreatorCode 
					, BM.CreateDate 
					, BM.Seq
					, (SELECT COUNT(*) 
					 	 FROM SYS_COMMENT 
					    WHERE DeleteDate IS NULL 
					 	<choose>
							<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
								AND TargetServiceType IN ('Board', 'Doc', 'Community')
							</when>
							<otherwise>
								AND TargetServiceType = #{bizSection}
							</otherwise>
						</choose>
					 	  AND TargetID = BM.MessageID||'_'||BM.Version)) AS CommentCnt
					, DECODE(BM.UsePubDeptName, 'Y', FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorDept), FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorName)) AS CreatorName
					, BM.CreatorLevel
					, BM.CreatorPosition
					, BM.CreatorTitle 
					, BM.CreatorDept 
					,(CASE BM.IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
					, BMUV.UF_Value0
					, BMUV.UF_Value1
					, BMUV.UF_Value2
					, BMUV.UF_Value3
					, BMUV.UF_Value4
					, BMUV.UF_Value5
					, BMUV.UF_Value6
					, BMUV.UF_Value7
					, BMUV.UF_Value8
					, BMUV.UF_Value9
				FROM BOARD_MESSAGE BM
				LEFT OUTER JOIN BOARD_CATEGORY BC ON BM.CategoryID = BC.CategoryID AND BC.FolderID = BM.FolderID
				LEFT OUTER JOIN BOARD_PROGRESSSTATE BP ON BM.progressstate = BP.StateID 
				LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version)
				<!-- 보안등급 및 열람권한 체크 -->
				<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
				LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
								 FROM (
									SELECT SRA.ObjectID, SRA.MessageID
									FROM sys_read_acl AS SRA
									WHERE SRA.ObjectType = 'FD'
									AND SRA.TargetType = 'UR'
									AND SRA.TargetCode = #{userCode}
									UNION
									SELECT SRA.ObjectID, SRA.MessageID
									FROM sys_read_acl AS SRA
									WHERE SRA.ObjectType = 'FD'
									AND SRA.TargetType != 'UR'
									AND SRA.TargetCode IN
									<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
							            #{item}
								    </foreach>
								) AS SRA) SRA ON BM.FolderID = SRA.ObjectID AND BM.MessageID = SRA.MessageID
				</if>	
				WHERE 1=1
				AND BM.MsgState IN ('C', 'A') 
				AND MsgType != 'S' 
				AND (NVL(UseSecurity,'N') != 'Y' OR (NVL(UseSecurity,'N') = 'Y' AND CreatorCode = #{userCode}))
				AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
				AND DeleteDate IS NULL
				AND BM.FolderID = #{folderID}
				AND BM.Depth = 0
				<if test='IsUseListRestriction == null or IsUseListRestriction == "N"'>
					AND NVL(BM.SecurityLevel,999) >= (SELECT SecurityLevel FROM SYS_OBJECT_USER WHERE UserCode = #{userCode})
				</if>
				AND BM.IsCurrent = 'Y'
				<!-- CHECK: 권한체크, 열람권한 체크 -->
				<if test="folderType != null and folderType == 'OneToOne'">
				    	AND (BM.Depth = 0 AND BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = #{folderID}) LIKE '%' || #{userCode} || ';%' )
				</if>
				<if test="categoryID != null and categoryID != ''">
			        <choose>
				    	<when test="categoryGubun == 'Y'">
				    	    AND (BC.MemberOf = #{categoryID} OR BC.CategoryID = #{categoryID})
				        </when>
				        <otherwise>
				            AND BM.CategoryID = #{categoryID}
				        </otherwise>
				    </choose>
			    </if>
			    <if test="readSearchType != null and readSearchType != ''">
			       <!-- CHECK: 읽음/읽음 조회 설정 -->
			       AND BM.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
			    </if>
			    <!-- 보안등급 및 열람권한 체크 -->
				<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
			       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
			                 ELSE CASE WHEN (BM.SecurityLevel = '256' OR BM.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
			                	  ELSE 'N' END
			                 END) = 'Y'
			              		                		  
			       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
			                 ELSE CASE WHEN NVL(BM.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
						     		   WHEN NVL(BM.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
						     		   ELSE 'N' END
						     END) = 'Y'
			    </if>
			    <!-- 검색어 항목 -->
				<if test="searchText != null and searchText != ''">
					<choose>
				        <when test="searchType == 'Total'">
				            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
				       	</when>
				       	<when test="searchType == 'Mobile'">
				            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
				       	</when>
				       	<otherwise>
							AND 
							<choose>
								<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
								<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
								<when test='searchType.equalsIgnoreCase("Number")'>BM.Number_ </when>
								<otherwise>BM.Subject </otherwise>
							</choose>
							LIKE '%'|| #{searchText} ||'%'  
						</otherwise>
					</choose>		
				</if>
				<if test="startDate != '' or endDate != ''">
					AND BM.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
				</if>
			) RESULT
			WHERE 1=1
			<choose>
			    <when test="mode == 'prev'" >
			        <!-- <choose>
					    <when test="sortColumn != null and sortColumn != ''" >
					        AND ${sortColumn} &lt; (
					        	SELECT ${sortColumn} FROM BOARD_MESSAGE BM
					        	LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version)
					        	WHERE BM.MessageID = #{messageID} AND BM.Version = #{version})
							ORDER BY ${sortColumn} DESC
					    </when>
					    <otherwise>
							AND Seq &lt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
							ORDER BY Seq DESC
					    </otherwise>
				    </choose> -->
				    AND Seq &lt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
					ORDER BY Seq DESC
			    </when>
			    <otherwise> 
			        <!-- <choose>
					    <when test="sortColumn != null and sortColumn != ''" >
					        AND ${sortColumn} &gt; (
					        	SELECT ${sortColumn} FROM BOARD_MESSAGE BM
					        	LEFT OUTER JOIN BOARD_MESSAGE_USERFORM_VALUE BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version)
					        	WHERE BM.MessageID = #{messageID} AND BM.Version = #{version})
							ORDER BY ${sortColumn} ASC
					    </when>
					    <otherwise>
							AND Seq &gt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
							ORDER BY Seq ASC
					    </otherwise>
				    </choose> -->
				    AND Seq &gt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
					ORDER BY Seq ASC
			    </otherwise>		  
		    </choose>
		 )A WHERE 1=1
		 AND ROWNUM = 1  
			
    </select>
    
    <select id="selectPrevNextMessage" parameterType="cmap" resultType="cmap">
        SELECT RESULT.MessageID AS "MessageID"
             , RESULT.Version AS "Version"
             , RESULT.FolderName AS "FolderName"
             , RESULT.MenuID AS "MenuID"
             , RESULT.FolderID AS "FolderID"
             , RESULT.CategoryID AS "CategoryID"
             , RESULT.Seq AS "Seq"
             , RESULT.Step AS "Step"
             , RESULT.Depth AS "Depth"
             , RESULT.Subject AS "Subject"
             , RESULT.RegistDate AS "RegistDate"
             , RESULT.CreatorCode AS "CreatorCode"
             , RESULT.DisplayName AS "DisplayName"
             , RESULT.CreatorName AS "CreatorName"
             , RESULT.CreatorLevel AS "CreatorLevel"
             , RESULT.CreatorPosition AS "CreatorPosition"
             , RESULT.CreatorTitle AS "CreatorTitle"
             , RESULT.CreatorDept AS "CreatorDept"
             , RESULT.CommentCnt AS "CommentCnt"
             , RESULT.ListTop AS "ListTop"
             <choose>
			    	<when test="boardType == 'RequestModify'">
			    	    ,RESULT.RequestID AS "RequestID"						
			    	    ,RESULT.RequestMessage AS "RequestMessage"			 			
			    	    ,RESULT.RequestorCode AS "RequestorCode"						
			    	    ,RESULT.RequestorName AS "RequestorName"							
			    	    ,RESULT.RequestDate	AS "RequestDate"						
			    	    ,RESULT.AnswererCode AS "AnswererCode"						
			    	    ,RESULT.AnswererName AS "AnswererName"						
			    	    ,RESULT.AnswerContent	AS "AnswerContent"					
			    	    ,RESULT.AnswerDate	AS "AnswerDate"							
			    	    ,RESULT.RequestStatus AS "RequestStatus"							
			    	</when>
			    	<when test="boardType == 'Approval'">
			    	    , RESULT.ProcessID AS "ProcessID"	
						, RESULT.ProcessDefID AS "ProcessDefID"	
						, RESULT.ProcessState AS "ProcessState"	
						, RESULT.ProcessRegistDate AS "ProcessRegistDate"	
						, RESULT.ProcessRegisterCode AS "ProcessRegisterCode"	
						, RESULT.State AS "State"	
						, RESULT.ActivityState AS "ActivityState"	
						, RESULT.TotalApproverCnt AS "TotalApproverCnt"	
						, RESULT.TotalApprovalCnt AS "TotalApprovalCnt"	
			    	</when>
			    	<when test="boardType == 'CheckIn' or boardType == 'CheckOut'">
			    	 	, RESULT.CO_Date AS "CO_Date"	
			    	 	, RESULT.CI_Date AS "CI_Date"
			    	</when>
		    	</choose>
             
        FROM (
			SELECT 
				BM.MessageID 
				,BM.Version
				,H.DisplayName AS FolderName
				, (SELECT MenuID FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS MenuID
				,H.FolderID
				,BM.CategoryID
				,BM.Seq			
				,BM.Step			
				,BM.Depth
				,BM.Subject
				,TO_CHAR(BM.RegistDate, 'YYYY.MM.DD HH24:MI:SS') AS RegistDate
				,BM.CreatorCode 
				,B.DisplayName 
				,DECODE(BM.UsePubDeptName , 'Y', FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorDept), FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorName)) AS CreatorName
				,BM.CreatorLevel		
				,BM.CreatorPosition		
				,BM.CreatorTitle		
				,BM.CreatorDept
				,(SELECT COUNT(*) 
				 	FROM SYS_COMMENT 
				   WHERE DeleteDate IS NULL 
				 	<choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				 	  AND TargetID = BM.MessageID||'_'||BM.Version)) AS CommentCnt
				,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
				<choose>
			    	<when test="boardType == 'RequestModify'">
			    	    ,M.RequestID						
			    	    ,M.RequestMessage					
			    	    ,M.RequestorCode					
			    	    ,M.RequestorName					
			    	    ,M.RequestDate					
			    	    ,M.AnswererCode				
			    	    ,M.AnswererName					
			    	    ,M.AnswerContent					
			    	    ,M.AnswerDate						
			    	    ,M.RequestStatus					
			    	</when>
			    	<when test="boardType == 'Approval'">
			    	    , F.ProcessID AS ProcessID
						, F.ProcessDefID AS ProcessDefID 
						, F.State AS ProcessState 
						, F.RegistDate AS ProcessRegistDate
						, F.RegisterCode AS ProcessRegisterCode
						, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State = 1 AND ActorCode = #{userCode}) AS State
						, (SELECT State FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} and ProcessID = F.ProcessID and ActorRole = 'Register') AS ActivityState
						, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID) AS TotalApproverCnt
						, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State IN (7,9)) AS TotalApprovalCnt 
						, BM.MSGState
						, BM.MSGType
			    	</when>
			    	<when test="boardType == 'CheckIn' or boardType == 'CheckOut'">
			    	 	, DIH.CO_Date
			    	 	, DIH.CI_Date
			    	</when>
		    	</choose>
			FROM BOARD_MESSAGE BM
			INNER JOIN SYS_OBJECT_FOLDER H ON BM.FolderID = H.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
			LEFT OUTER JOIN SYS_OBJECT_USER B ON (CASE WHEN BM.MsgType='S' THEN BM.OwnerCode ELSE BM.CreatorCode END) = B.UserCode
			LEFT OUTER JOIN BOARD_CATEGORY BC ON BM.CategoryID = BC.CategoryID AND BC.FolderID = BM.FolderID
			LEFT OUTER JOIN BOARD_PROGRESSSTATE P ON BM.progressstate = P.StateID
			<!-- 보안등급 및 열람권한 체크 -->
			<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
			LEFT OUTER JOIN (SELECT SRA.ObjectID, SRA.MessageID
							 FROM (
								SELECT SRA.ObjectID, SRA.MessageID
								FROM sys_read_acl AS SRA
								WHERE SRA.ObjectType = 'FD'
								AND SRA.TargetType = 'UR'
								AND SRA.TargetCode = #{userCode}
								UNION
								SELECT SRA.ObjectID, SRA.MessageID
								FROM sys_read_acl AS SRA
								WHERE SRA.ObjectType = 'FD'
								AND SRA.TargetType != 'UR'
								AND SRA.TargetCode IN
								<foreach item="item" index="index" collection="groupPath" open="(" close=")" separator=",">
						            #{item}
							    </foreach>
							) AS SRA) SRA ON BM.FolderID = SRA.ObjectID AND BM.MessageID = SRA.MessageID
			</if>	
			<choose>
		    	<when test="boardType == 'MyInterest'"> 
		    	    INNER JOIN BOARD_MESSAGE_FAVORITE J ON BM.MessageID=J.MessageID AND J.RegisterCode=#{userCode}
		    	</when>
		    
		    	<when test="boardType == 'RequestModify'">
		    	    INNER JOIN BOARD_REQUEST_MODIFY M ON (BM.MessageID=M.MessageID AND M.RequestStatus != 'Deleted')
		    	</when>
		    	<when test="boardType == 'Approval'">
					INNER JOIN SYS_PROCESS F ON BM.MessageID=F.MessageID AND F.ObjectType=#{bizSection} 
					AND F.ProcessID IN (SELECT DISTINCT ProcessID FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} AND ActorRole != 'Register' )	
		    	</when>
		    	<when test="boardType == 'CheckIn' or boardType == 'CheckOut'">
		    	    LEFT OUTER JOIN DOC_INOUT_HISTORY DIH ON (BM.MessageID = DIH.MessageID AND BM.Version = DIH.Version AND DIH.DeleteDate IS NULL)
		    	</when>
	    	</choose>
			WHERE 1=1
			AND BM.Depth = 0
	    	AND H.DomainID IN (0, #{domainID})
			AND H.MenuID = #{menuID}
			<if test="bizSection == 'Board'">
			    AND MsgType NOT IN ('N', 'B')
			</if>
			<if test="bizSection == 'Doc'">
			    AND MsgType IN ('N', 'B')
			</if>
			<choose>
			    <when test="boardType == 'Total'">
			        AND H.FolderType != 'OneToOne'
			        <if test='IsUseListRestriction == null or IsUseListRestriction == "N"'>
			        	AND NVL(BM.SecurityLevel,999) >= (SELECT SecurityLevel FROM SYS_OBJECT_USER WHERE UserCode = #{userCode})
			        </if>
		    	    AND BM.MsgState IN ('C', 'A') 
					AND BM.MsgType != 'S' 
					AND (NVL(UseSecurity,'N') != 'Y' OR (NVL(UseSecurity,'N') = 'Y' AND BM.CreatorCode = #{userCode}))
					AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
					AND BM.DeleteDate IS NULL
		    	</when>
			    <when test="boardType == 'Normal'">
		    	    <!-- 에러나야해 -->
		    	    ERROR
		    	</when>
		    	<when test="boardType == 'MyInterest'">	
		    	    AND BM.ExpiredDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS')
					AND (MsgState IN ('C', 'A')) AND (MsgType IN ('O', 'C', 'M'))
		    	</when>
		    	<when test="boardType == 'MyOwnWrite'">
		    	    AND BM.CreatorCode = #{userCode}
					AND MsgState != 'T' AND MsgType != 'S' 
		    	</when>
		    	<when test="boardType == 'RequestModify'">
		    	    AND M.RequestorCode = #{userCode}
		    	</when>
		    	<when test="boardType == 'Scrap'">
		    	    AND BM.ModifierCode = #{userCode}
					AND (MsgState IN ('C')) AND (MsgType IN ('S'))	
		    	</when>
		    	<when test="boardType == 'OnWriting'">
		    	    AND BM.CreatorCode = #{userCode}
					AND MsgState IN ('T')							
		    	</when>
		    	<when test="boardType == 'MyBooking'">
		    	    AND BM.CreatorCode = #{userCode}
		    	    AND (BM.ReservationDate IS NOT NULL AND BM.ReservationDate >= TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS'))
		    	</when>
	    	</choose>
		    <!-- 카테고리별 검색 기능 사용시 참조 -->
		    <if test="categoryID != null and categoryID != ''">
		        <choose>
			    	<when test="categoryGubun == 'Y'">
			    	    AND (BC.MemberOf = #{categoryID} OR BC.CategoryID = #{categoryID})
			        </when>
			        <otherwise>
			            AND BM.CategoryID = #{categoryID}
			        </otherwise>
			    </choose>
		    </if>
		    <if test="requestStatus != null and requestStatus != ''">
		        <choose>
			    	<when test="requestStatus == 'Ready'">
			    	    AND MsgState IN ('Ready')
			        </when>
			        <when test="requestStatus == 'Process'">
			    	    AND MsgState IN ('Process')
			        </when>
			        <otherwise>
			            AND MsgState IN ('Complete')
			        </otherwise>
			    </choose>
		    </if>
		    <!-- 보안등급 및 열람권한 체크 -->
			<if test='IsUseListRestriction != null and IsUseListRestriction == "Y"'>
		       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
		                 ELSE CASE WHEN (BM.SecurityLevel = '256' OR BM.SecurityLevel <![CDATA[ >= ]]> #{userSecurityLevel}) THEN 'Y'
		                	  ELSE 'N' END
		                 END) = 'Y'
		              		                		  
		       AND (CASE WHEN BM.OwnerCode = #{userCode} THEN 'Y'
		                 ELSE CASE WHEN NVL(BM.UseMessageReadAuth, 'N') = 'N' THEN 'Y' 
					     		   WHEN NVL(BM.UseMessageReadAuth, 'N') = 'Y' AND NVL(SRA.MessageID, '') != '' THEN 'Y' 
					     		   ELSE 'N' END
					     END) = 'Y'
		    </if>
		    <!-- 검색어 항목 -->
			<if test="searchText != null and searchText != ''">
				<choose>
			        <when test="searchType == 'Total'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%')
			       	</when>
			       	<when test="searchType == 'Mobile'">
			            AND ( BM.Subject LIKE '%'|| #{searchText} ||'%' OR BM.BodyText LIKE '%'|| #{searchText} ||'%' OR BM.CreatorName LIKE '%'|| #{searchText} ||'%')
			       	</when>
			       	<otherwise>
						AND 
						<choose>
							<when test='searchType.equalsIgnoreCase("BodyText")'>BM.BodyText </when>
							<when test='searchType.equalsIgnoreCase("CreatorName")'>BM.CreatorName </when>
							<when test='searchType.equalsIgnoreCase("Number")'>BM.Number_ </when>
							<otherwise>BM.Subject </otherwise>
						</choose>
						LIKE '%'|| #{searchText} ||'%'  
					</otherwise>
				</choose>	
			</if>
			<if test="startDate != '' or endDate != ''">
				AND BM.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')
			</if>
		   <choose>
			    <when test="mode == 'prev'" >
			        <!-- <choose>
					    <when test="sortColumn != null and sortColumn != ''" >
					        AND BM.${sortColumn} &lt; ( SELECT ${sortColumn} FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version} )
							ORDER BY BM.${sortColumn} DESC
					    </when>
					    <otherwise>
							AND Seq &lt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
							ORDER BY Seq DESC
					    </otherwise>
				    </choose> -->
				    AND Seq &lt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
					ORDER BY Seq DESC
			    </when>
			    <otherwise> 
			        <!-- <choose>
					   <when test="sortColumn != null and sortColumn != ''" >
					        AND BM.${sortColumn} &gt; ( SELECT ${sortColumn} FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version} )
							ORDER BY BM.${sortColumn} ASC
					    </when>
					    <otherwise>
							AND Seq &gt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
							ORDER BY Seq ASC
					    </otherwise>
				    </choose> -->
				    AND Seq &gt; (SELECT Seq FROM BOARD_MESSAGE WHERE MessageID = #{messageID} AND Version = #{version})
					ORDER BY Seq ASC	  
			    </otherwise>		  
		    </choose>
		    ) RESULT
	    WHERE 1=1
		AND ROWNUM = 1
	    <choose>
			<when test="boardType == 'Approval'">
	    	    <choose>
			    	<when test='approvalStatus == "R"'>	
			    		AND (MsgState IN ('R', 'BR')) AND (MsgType IN ('O', 'N', 'B')) AND State &gt; 0
			        </when>
			        <when test='approvalStatus == "A"'> 
			    		AND (MsgState IN ('A', 'BA')) AND (MsgType IN ('O', 'N', 'B')) AND State = 0
			        </when>
			        <when test='approvalStatus == "D"'> 
			    		AND (MsgState IN ('D')) AND (MsgType IN ('O', 'N', 'B')) AND State = 0
			        </when>
			        <when test='approvalStatus == "P"'> 
			    		AND (MsgState IN ('R')) AND (MsgType IN ('O', 'N', 'B')) AND State = 0
			        </when>
			        <otherwise>
			            AND (MsgState IN ('R', 'D', 'A', 'BR', 'BA')) AND (MsgType IN ('O', 'N', 'B'))
			        </otherwise>
			    </choose>
	    	</when>
    	</choose>
    </select>
    
    <select id="selectBodyFormData" parameterType="cmap" resultType="cmap">
        SELECT B.FormPath AS "FormPath" 
        	, B.FileID AS "FileID"
        	, S.FilePath AS "StorageFilePath"
        	, F.FilePath AS "FileFilePath"
        	, F.SavedName AS "SavedName"
        	, F.CompanyCode AS "CompanyCode"
        	, (REPLACE(S.FilePath,'{0}',F.CompanyCode)|| F.FilePath|| F.SavedName) AS "FullPath"
        FROM BOARD_BODYFORM B
        LEFT OUTER JOIN sys_file F ON F.FileID = B.FileID
        LEFT OUTER JOIN sys_storage S ON S.StorageID = F.StorageID
        WHERE B.BodyFormID = #{bodyFormID}
    </select>
    
    <!-- 컨텐츠 타입 폴더의 게시물 조회. 미삭제 게시글 중 최신등록 1건으로 제한 -->
    <select id="selectContentMessage" parameterType="cmap" resultType="cmap">
 	    SELECT 
 	    	MessageID AS "MessageID",
 	    	FolderID AS "FolderID",
 	    	Version  AS "Version"
 	    FROM (
			SELECT * 
			FROM BOARD_MESSAGE
			WHERE FolderID = #{folderID} 
	 	    AND DeleteDate IS NULL
			ORDER BY REGISTDATE DESC
		) t 
		WHERE rownum = 1
 	</select>
 	
    <!-- 게시판 담당자 조회 -->
    <select id="selectMessageOwner" parameterType="cmap" resultType="cmap">
        SELECT OwnerCode AS "OwnerCode"
        FROM SYS_OBJECT_FOLDER
        WHERE 1=1
        AND FolderID = #{folderID}
    </select>
    
    <!-- 연결 게시글 일괄삭제 후 재등록 -->
    <delete id="deleteLinkedMessage" parameterType="cmap">
        DELETE FROM BOARD_LINKED
        WHERE MessageID = #{messageID}
        AND Version = #{version}
    </delete>
    
    <!-- 연결 게시글/바인더 등록-->
    <insert id="createLinkedMessage" parameterType="cmap">
        INSERT INTO BOARD_LINKED(MessageID, Version, TargetID, ServiceType, RegisterCode, RegistDate)
        VALUES(#{messageID}, #{version}, #{targetID}, #{bizSection}, #{userCode}, SYSDATE)
    </insert>
    
    <select id="selectLinkedMessageList" parameterType="cmap" resultType="cmap">
		SELECT BL.TargetID AS "MessageID"
		, BL.Version AS "Version"
		, BM.FolderID AS "FolderID"
		, BM.Subject AS "DisplayName"
		FROM BOARD_LINKED BL
		INNER JOIN BOARD_MESSAGE BM ON (BM.MessageID = BL.TargetID)
		WHERE 1=1
		AND BL.ServiceType = #{bizSection}
		AND BL.MessageID = #{messageID}
		AND BL.Version = #{version}
		AND BM.IsCurrent = 'Y'
	</select>

	<!-- 권한 요청 -->
	<select id="selectRequestAclInfo" parameterType="cmap"
		resultType="cmap">
		SELECT AclList AS "AclList"
		, TargetCode AS "TargetCode"
		FROM DOC_REQUEST_ACL
		WHERE 1=1
		AND RequestID = #{requestID}
	</select>

	<select id="selectNextApprover" parameterType="cmap" resultType="String">
		SELECT LISTAGG(ActorCode, ';') WITHIN GROUP(ORDER BY ActorCode) AS
		actorCode
		FROM sys_process_activity
		WHERE 1=1
		AND state = 1
		AND ProcessID = #{instanceID}
	</select>

	<!-- 게시글 기본 정보 조회 -->
	<select id="selectMessageInfo" parameterType="cmap" resultType="cmap">
		SELECT
		SOF.MenuID AS "menuID",
		SOF.FolderID AS "folderID",
		BM.MessageID AS "messageID",
		BM.Version AS "version",
		BM.CreatorCode AS "creatorCode",
		BM.Subject AS "subject"
		FROM board_message BM
		LEFT OUTER JOIN sys_object_folder SOF ON (BM.FolderID = SOF.FolderID)
		WHERE BM.MessageID = #{messageID}
		<if test="version != null and version != ''">
			AND BM.Version = #{version}
		</if>
	</select>

	<!-- 승인 게시글 정보 조회 -->
	<select id="selectApprovalMessageInfo" parameterType="cmap"
		resultType="cmap">
		SELECT SOF.MenuID AS menuID, SOF.FolderID AS folderID, BM.Subject AS subject
		FROM board_message BM
		INNER JOIN sys_object_folder SOF ON (BM.FolderID =
		SOF.FolderID)
		WHERE 1=1
		AND MessageID = #{messageID}
	</select>
    
    
    <select id="selectRequestAclDetail" parameterType="cmap" resultType="cmap">
        SELECT DRA.RequestID AS "RequestID"
             , DRA.RegisterCode AS "RequestorCode" 
             , (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = DRA.RegisterCode) AS "RequestorName" 
             , DRA.RequestMessage AS "RequestMessage"
             , TO_CHAR(DRA.RequestDate, 'YYYY.MM.DD HH24:MI:SS') AS "RequestDate" 
             , DRA.AclList AS "RequestAclList" 
             , DRA.ActType AS "ActType"
		FROM DOC_REQUEST_ACL DRA
		WHERE RequestID = #{requestID}
    </select>
    
    <select id="checkDuplicateRequest" parameterType="cmap" resultType="java.lang.Long">
        SELECT COUNT(0)
        FROM DOC_REQUEST_ACL
        WHERE 1=1
        AND MessageID = #{messageID}
        AND Version = #{version}
        AND TargetCode = #{userCode}
        AND ActorCode = #{ownerCode}
        AND ActType = 'R'
    </select>
    
    <insert id="createRequestAuth" parameterType="cmap">
        INSERT INTO DOC_REQUEST_ACL(MessageID, Version, TargetCode, AclList, RequestMessage, RegisterCode, ActorCode, ActType)
        VALUES(#{messageID}, #{version}, #{userCode}, #{aclList}, #{requestMsg}, #{userCode}, #{ownerCode}, 'R')
    </insert>
    
	<update id="updateRequestAuthInfo" parameterType="cmap">
		MERGE INTO BOARD_MESSAGE_ACL G 
		USING (
			SELECT #{messageID} AS MessageID
				 , #{version} AS Version
				 , #{targetCode} AS TargetCode
				 , 'UR' AS TargetType
				 , #{aclList} AS AclList
				 , #{security} AS Security
				 , #{create} AS CREATE_
				 , #{delete} AS DELETE_
				 , #{modify} AS MODIFY_
				 , #{execute} AS EXECUTE_
				 , #{read} AS Read
				 , #{userCode} AS registercode
			FROM DUAL
		) E ON ( G.MESSAGEID = E.MESSAGEID
			AND G.Version = E.Version
			AND G.TargetCode = E.TargetCode
		)
		WHEN MATCHED THEN 
			UPDATE SET G.AclList = E.AclList
					 , G.Security = E.Security
					 , G.CREATE_ = E.CREATE_
					 , G.DELETE_ = E.DELETE_
					 , G.MODIFY_ = E.MODIFY_
					 , G.EXECUTE_ = E.EXECUTE_
					 , G.Read = E.Read
		WHEN NOT MATCHED THEN 
			INSERT (
				  G.MessageID
				, G.Version
				, G.TargetCode
				, G.TargetType
				, G.AclList
				, G.Security
				, G.CREATE_
				, G.DELETE_
				, G.MODIFY_
				, G.EXECUTE_
				, G.Read
				, G.registercode
			)
			VALUES (
				  E.MessageID
				, E.Version
				, E.TargetCode
				, E.TargetType
				, E.AclList
				, E.Security
				, E.CREATE_
				, E.DELETE_
				, E.MODIFY_
				, E.EXECUTE_
				, E.Read
				, E.registercode
			)
	</update>
    
    <update id="updateRequestAuth" parameterType="cmap">
        UPDATE DOC_REQUEST_ACL SET
        	ActType = #{ActType}
        	,ActMessage = #{ActMessage}
        WHERE RequestID = #{requestID}
    </update>
    
    <insert id="createDistribution" parameterType="cmap" useGeneratedKeys="true">
        INSERT INTO DOC_DISTRIBUTION(MessageID,		Version,	DistributeDate,		DistributeMsg,	RegisterCode)
		VALUES(#{messageID}, #{version}, SYSDATE,	#{comment},	#{userCode})
		<selectKey keyProperty="distributeID" resultType="long" order="AFTER">
			SELECT DOC_DISTRIBUTION_SEQ.CURRVAL FROM dual
        </selectKey>
    </insert>
    
    <insert id="createDistributionTarget" parameterType="cmap">
        INSERT INTO DOC_DISTRIBUTION_TARGET(DistributeID, TargetCode, TargetType)
		VALUES(#{distributeID}, #{targetCode}, #{targetType})
    </insert>
    
    <update id="updateDistributionTargetAuth" parameterType="cmap">
        MERGE INTO BOARD_MESSAGE_ACL ORG
        	USING (
        		 SELECT MessageID, Version, TargetCode, TargetType
		 	     FROM BOARD_MESSAGE_ACL G
		 	     WHERE MESSAGEID = #{messageID}
        	) TMP
        ON (
        	ORG.MessageID=TMP.MessageID
        	AND ORG.Version=TMP.Version
        	AND ORG.TargetCode=TMP.TargetCode
        	AND ORG.TargetType=TMP.TargetType
        ) WHEN MATCHED THEN
        	UPDATE SET AclList = SUBSTR(AclList, 0, 4) || 'ER', Execute_='E', Read='R'
        WHEN NOT MATCHED THEN
			INSERT (MessageID, Version, TargetCode, TargetType, AclList, Create_, Execute_, Read, registercode)
			VALUES(#{messageID}, #{version}, #{targetCode}, #{targetType}, '____ER', '_', 'E', 'R', #{userCode})
    </update>
    
    <insert id="createDistributionConfirm" parameterType="cmap">
        INSERT INTO DOC_DISTRIBUTION_CONFIRM(DistributeID,	UserCode)
        <choose>
            <when test="targetType == 'UR'">
                VALUES(#{distributeID}, #{targetCode})
            </when>
            <when test="targetType == 'GR'">
                Select #{distributeID}, UserCode FROM SYS_OBJECT_GROUP SOG
				LEFT OUTER JOIN SYS_OBJECT_GROUP_MEMBER SOGM ON (SOG.GroupCode = SOGM.GroupCode)
				WHERE SOGM.GroupCode = #{targetCode}
				AND SOGM.IsUse = 'Y'
				AND SOG.IsUse = 'Y'
				GROUP BY SOGM.UserCode
            </when>
			<when test="targetType == 'CM'">
				Select #{distributeID}, UserCode FROM SYS_OBJECT_GROUP SOG
				LEFT OUTER JOIN SYS_OBJECT_GROUP_MEMBER SOGM ON (SOG.GroupCode = SOGM.GroupCode)
				WHERE SOG.CompanyCode = #{targetCode}
				AND SOGM.IsUse = 'Y'
				AND SOG.IsUse = 'Y'
				GROUP BY SOGM.UserCode
			</when>
        </choose>
    </insert>
    
    <!-- 문서번호 자동발번 조회 -->
    <select id="selectAutoDocNumber" parameterType="cmap" resultType="String">
        SELECT FN_DOCNUMBERCREATE_S(#{domainID}, #{folderID}, #{groupCode}, #{userCode}) FROM dual
    </select>
    
    <!-- 문서번호 발번 현황 업데이트 -->
    <update id="updateAutoDocNumber" parameterType="cmap">
		MERGE INTO DOC_NUMBER G
			USING DUAL
			ON (G.DomainID = #{domainID} AND G.Prefix = #{prefix})
		WHEN MATCHED THEN
			UPDATE SET G.Number_ = G.Number_+1
		WHEN NOT MATCHED THEN
			INSERT (G.DomainID, G.Prefix, G.Number_, G.CreateDate)
			VALUES (#{domainID}, #{prefix}, 1, SYSDATE)
    </update>
    
    <!-- 웹파트용 공지 게시판 목록 조회 -->
    <select id="selectNoticeMessageList" parameterType="cmap" resultType="cmap">
		SELECT A.MenuID AS "MenuID"
	        ,  A.FolderID AS "FolderID"
	        ,  A.Subject AS "Subject"
	        ,  A.Version AS "Version"
	        ,  A.MessageID AS "MessageID"
	        ,  A.FolderName AS "FolderName"
	        ,  A.CommentCnt  AS "CommentCnt"
	        ,  A.CreatorCode AS "CreatorCode"
	        ,  A.CreateDate AS "CreateDate"
			,  A.CreatorName AS "CreatorName"
			,  A.FolderOwnerCode AS "FolderOwnerCode"
			,  A.ListTop AS "ListTop"
			,  A.FileID  AS "FileID"
		FROM (
	        SELECT
				SOF.MenuID
				,BM.FolderID
				,BM.Subject
				,BM.Version
				,BM.MessageID
				,FN_BASEGETDICTIONARY_S(#{lang}, SOF.MultiDisplayName) AS FolderName
				,(SELECT COUNT(*) FROM SYS_COMMENT WHERE DeleteDate IS NULL AND TargetServiceType='Board' AND TargetID = BM.MessageID||'_'||BM.Version) AS CommentCnt 
				,BM.CreatorCode 
				,TO_CHAR(BM.CreateDate, 'YYYY.MM.DD HH24:MI:SS') AS CreateDate
				,DECODE(BM.UsePubDeptName, 'Y', FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorDept), FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorName)) AS CreatorName
				,(SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS FolderOwnerCode
				,(CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
				,(SELECT MAX(FileID) FROM SYS_FILE WHERE ObjectType ='FD' AND ObjectID = BM.FolderID AND MessageID = BM.MessageID AND SaveType IN ('IMAGE', 'INLINE')) AS FileID 
			FROM BOARD_MESSAGE BM
			INNER JOIN SYS_OBJECT_FOLDER SOF ON (BM.FolderID = SOF.FolderID)
			WHERE 1=1
			AND SOF.FolderType = 'Notice'
			AND SOF.ObjectType = 'Board'
			AND SOF.DeleteDate IS NULL
			AND SOF.IsUse = 'Y'
			AND SOF.DomainID IN (0, #{domainID})
			AND BM.DeleteDate IS NULL
			AND BM.MsgType IN ('O', 'C', 'M')
			AND BM.RegistDate <![CDATA[<=]]> TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS')
			AND NVL(BM.SecurityLevel,999) >= (SELECT SecurityLevel FROM SYS_OBJECT_USER WHERE UserCode = #{userCode})
			AND (BM.UseSecurity != 'Y' OR (BM.UseSecurity = 'Y' AND BM.CreatorCode = #{userCode}))
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate >= TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS')) 
			AND BM.MsgState IN ('C', 'A') 
			<if test='aclDataArr != null and aclDataArr.length != 0'>
				AND BM.FolderID IN  
				<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			</if>
			ORDER BY BM.CreateDate DESC
		)A  <![CDATA[  WHERE ROWNUM <= 3 ]]> 
    </select>
    
    <select id="selectLatestMessageList" parameterType="cmap" resultType="cmap">
      SELECT A.FolderName AS "FolderName"
      	  ,  A.MessageID  AS "MessageID"
      	  ,  A.FolderID  AS "FolderID"
      	  ,  A.Version  AS "Version"
      	  ,  A.Subject  AS "Subject"
      	  ,  A.CreateDate AS "CreateDate"
      	  ,  A.MenuID AS "MenuID"
      FROM (  
	        SELECT 
	        	FN_BASEGETDICTIONARY_S(#{lang}, SOF.MultiDisplayName) AS FolderName,
		        BM.MessageID,
				BM.FolderID,
				BM.Version,
				BM.Subject,
				TO_CHAR(BM.CreateDate, 'YYYY.MM.DD HH24:MI:SS') AS CreateDate,
				SOF.MenuID
			FROM BOARD_MESSAGE BM
			INNER JOIN SYS_OBJECT_FOLDER SOF ON BM.FolderID = SOF.FolderID
			LEFT JOIN BOARD_CONFIG BC ON BM.FolderID = BC.FolderID
			LEFT JOIN BOARD_CONFIG_DEFAULT BCD ON SOF.FolderType = BCD.FolderType
			WHERE 1=1
			AND BM.DeleteDate IS NULL
			AND SOF.DeleteDate IS NULL 
			AND SOF.IsUse = 'Y'
			AND BM.IsCurrent = 'Y'
			AND BM.MsgState IN ('C', 'A')
			<if test="bizSection == 'Board'">
			    AND MsgType IN ('O', 'C', 'M')
			</if>
			<if test="bizSection == 'Doc'">
			    AND MsgType IN ('N', 'B')
			</if>
			AND BM.RegistDate <![CDATA[<=]]> TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS')
			AND ( (SOF.FolderType = 'OneToOne') AND (BM.OwnerCode = #{userCode} OR (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = SOF.FolderID) LIKE '%' || #{userCode} || ';%' ) OR (SOF.FolderType != 'OneToOne') )
			AND NVL(BM.SecurityLevel,999) >= (SELECT SecurityLevel FROM SYS_OBJECT_USER WHERE UserCode = #{userCode})
			AND (BM.UseSecurity != 'Y' OR (BM.UseSecurity = 'Y' AND BM.CreatorCode = #{userCode}))
			AND (BM.ExpiredDate IS NULL OR BM.ExpiredDate >= TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS')) 
			AND SOF.ObjectType = #{bizSection}
			<if test='aclDataArr != null and aclDataArr.length != 0'>
				AND BM.FolderID IN  
				<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			</if>
			AND (';'||#{menuID}|| ';') LIKE ('%;'||SOF.MenuID ||';%')
			<if test="bizSection == 'Board'">
				AND NVL(BC.UseIncludeRecentReg, BCD.UseIncludeRecentReg) = 'Y'
			</if>
			ORDER BY BM.RegistDate DESC
	 )A  <![CDATA[   WHERE ROWNUM <= 5 ]]> 
    </select>
    
    <select id="selectOriginReplyNotice" parameterType="cmap" resultType="String">
        SELECT NVL(useReplyNotice, 'N')
        FROM BOARD_MESSAGE
        WHERE 1=1
        AND MessageID = #{seq}
    </select>
    
    <select id="selectOriginMediaType" parameterType="cmap" resultType="String">
        SELECT NoticeMedia
        FROM BOARD_MESSAGE
        WHERE 1=1
        AND MessageID = #{seq}
    </select>
    
    <!-- 상세 보기 조회 쿼리 -->
    <select id="selectMessageDetailSimple" parameterType="cmap" resultType="cmap">
        SELECT B.MessageID AS "MessageID"
        	 , B.FolderID AS "FolderID"
        	 , B.FolderName AS "FolderName"
        	 , B.CategoryID AS "CategoryID"
        	 , B.CategoryName AS "CategoryName"
        	 , B.Subject AS "Subject"
        	 , B.IsTop AS "IsTop"
        FROM (
	        SELECT  
				A.MessageID, 
				A.FolderID, 
				NVL(FN_BASEGETDICTIONARY_S(#{lang}, SOF.MultiDisplayName), ' ') AS FolderName,
				NVL(A.CategoryID, 0) AS CategoryID,
				NVL(FN_BASEGETDICTIONARY_S(#{lang}, C.DisplayName), ' ') AS CategoryName,
				A.Subject, 
				IsTop
			FROM BOARD_MESSAGE A
				LEFT OUTER JOIN BOARD_CATEGORY C ON A.FolderID = C.FolderID AND A.CategoryID = C.CategoryID
				LEFT OUTER JOIN SYS_OBJECT_FOLDER SOF on A.FolderID = SOF.FolderID
			WHERE A.MessageID = #{messageID} 
				AND A.Version = #{version}
	 	)B
    </select>
    
    <!-- 웹파트 특정 폴더 리스트 보기 -->
    <select id="selectFolderLatestMessageList" parameterType="cmap" resultType="cmap">
      SELECT A.FolderName AS "FolderName"
      	  ,  A.MessageID  AS "MessageID"
      	  ,  A.FolderID  AS "FolderID"
      	  ,  A.Version  AS "Version"
      	  ,  A.Subject  AS "Subject"
      	  ,  A.CreateDate AS "CreateDate"
      	  ,  A.CreatorName AS "CreatorName"
      	  ,  A.MenuID AS "MenuID"
      FROM (  
	        SELECT 
	        	FN_BASEGETDICTIONARY_S(#{lang}, SOF.MultiDisplayName) AS FolderName,
		        BM.MessageID,
				BM.FolderID,
				BM.Version,
				BM.Subject,
				TO_CHAR(BM.CreateDate, 'YYYY.MM.DD HH24:MI:SS') AS CreateDate,
				FN_BASEGETDICTIONARY_S(#{lang}, BM.CreatorName) AS CreatorName,
				SOF.MenuID
			FROM BOARD_MESSAGE BM
			INNER JOIN SYS_OBJECT_FOLDER SOF ON BM.FolderID = SOF.FolderID
			WHERE 1=1
			<if test='folderIDArr != null and folderIDArr.length != 0'>
				AND SOF.FolderID IN  
				<foreach collection="folderIDArr" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			</if>
			AND BM.DeleteDate IS NULL
			AND SOF.DeleteDate IS NULL 
			AND SOF.IsUse = 'Y'
			AND BM.MsgState IN ('C', 'A')
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate <![CDATA[>=]]> TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
			AND SOF.DeleteDate IS NULL
			AND SOF.IsUse = 'Y'
			AND BM.IsCurrent = 'Y'
			<if test="bizSection == 'Board'">
			    AND MsgType IN ('O', 'C', 'M')
			</if>
			<if test="bizSection == 'Doc'">
			    AND MsgType IN ('N', 'B')
			</if>
			AND NVL(BM.SecurityLevel,999) <![CDATA[>=]]> (SELECT SecurityLevel FROM SYS_OBJECT_USER WHERE UserCode = #{userCode})
			AND (BM.ExpiredDate IS NULL OR  BM.ExpiredDate <![CDATA[>=]]> TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') ) 
			AND SOF.ObjectType = #{bizSection}
			<if test='aclDataArr != null and aclDataArr.length != 0'>
				AND BM.FolderID IN  
				<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach>
			</if>
			ORDER BY BM.RegistDate DESC
	 )A  <![CDATA[   WHERE ROWNUM <= 5 ]]> 
    </select>
    
    <!-- 웹파트 - 링크사이트 게시글 조회 -->
    <select id="selectSystemLinkBoardList" parameterType="cmap" resultType="cmap">
		SELECT BM.MessageID AS "MessageID"
		     , BM.Version AS "Version"
		     , BM.Number_ AS "Number"
		     , BM.FolderID AS "FolderID"
		     , (SELECT MenuID FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS "MenuID"
		     , (SELECT FolderPath FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS "FolderPath"
		     , BM.IsInherited AS "IsInherited"
		     , BM.ParentID AS "ParentID" 
		     , BM.MsgType AS "MsgType" 
		     , BM.MsgState AS "MsgState" 
		     , BM.CategoryID AS "CategoryID"
		     , BM.Seq AS "Seq"
		     , BM.Step AS "Step"
		     , BM.Depth AS "Depth" 
		     , BM.Subject AS "Subject"
		     , BM.IsPopup AS "IsPopup"
		     , BM.IsTop AS "IsTop"
		     , BM.PopupStartDate AS "PopupStartDate"
		     , BM.PopupEndDate AS "PopupEndDate" 
		     , BM.TopStartDate AS "TopStartDate"
		     , BM.TopEndDate AS "TopEndDate" 
		     , BM.ExpiredDate AS "ExpiredDate" 
		     , BM.UseSecurity AS "UseSecurity"
		     , BM.UseAnonym AS "UseAnonym"
		     , BM.IsApproval AS "IsApproval"
		     , BM.IsUserForm AS "IsUserForm" 
		     , BM.IsCheckOut AS "IsCheckOut" 
		     , BM.UseScrap AS "UseScrap" 
		     , BM.NoticeMedia AS "NoticeMedia" 
		     , BM.UseRSS AS "UseRSS" 
		     , BM.TrackBackURL AS "TrackBackURL" 
		     , BM.AnswerCnt AS "AnswerCnt" 
		     , BM.ReadCnt AS "ReadCnt" 
		     , BM.ScrapCnt AS "ScrapCnt" 
		     , BM.ReportCnt AS "ReportCnt" 
		     , BM.FileCnt AS "FileCnt"
		     , BM.FileExtension AS "FileExtension"
		     , BM.TracbackCnt AS "TracbackCnt"
		     , TO_CHAR(BM.RegistDate, 'YYYY.MM.DD HH24:MI:SS') AS "RegistDate"
		     , BM.CreatorCode AS "CreatorCode" 
		     , TO_CHAR(BM.CreateDate, 'YYYY-MM-DD HH24:MI:SS') AS "CreateDate"
		     , DECODE(BM.UsePubDeptName, 'Y', FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorDept), FN_BASEGETDICTIONARY_S(#{lang},BM.CreatorName)) AS "CreatorName"
		     , BM.CreatorLevel AS "CreatorLevel"
		     , BM.CreatorPosition AS "CreatorPosition"
		     , BM.CreatorTitle AS "CreatorTitle" 
		     , FN_BASEGETDICTIONARY_S(#{lang}, BM.CreatorDept) AS "CreatorDept"
		     , BM.DeleteDate AS "DeleteDate"
		     , BM.ReservationDate AS "ReservationDate"
		     , BM.LinkURL AS "LinkURL" 
		     , BM.RegistDept AS "RegistDept"
		     , BM.OwnerCode AS "OwnerCode"
		     , BUO.SortKey AS "OpenType"
		FROM sys_object_folder SOF
		INNER JOIN board_message BM ON BM.FolderID = SOF.FolderID
		LEFT OUTER JOIN board_message_userform_value BMUV ON (BM.MessageID = BMUV.MessageID AND BM.Version = BMUV.Version) AND BMUV.FolderID = BM.FolderID
		LEFT OUTER JOIN board_userform_option BUO ON BUO.FolderID = BM.FolderID AND BUO.OptionName = BMUV.UF_Value0
		WHERE SOF.ObjectType = 'Board'
		AND SOF.FolderType = 'LinkSite'
		<if test="folderID != null and folderID != ''">
			AND SOF.FolderID = #{folderID}
		</if>
		AND BM.DeleteDate IS NULL
		AND BM.MsgState IN ('C', 'A')
		AND BM.MsgType != 'S'
		AND (BM.UseSecurity != 'Y' OR (BM.UseSecurity = 'Y' AND BM.CreatorCode = #{userCode}))
		AND (BM.ExpiredDate IS NULL OR BM.ExpiredDate >= TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS'))
		AND (BM.ReservationDate IS NULL OR BM.ReservationDate &lt; TO_DATE(#{localCurrentDate}, 'YYYY-MM-DD HH24:MI:SS'))
		AND NVL(BM.SecurityLevel, 999) >= (SELECT BM.SecurityLevel FROM sys_object_user WHERE UserCode = #{userCode})
		AND BM.IsCurrent = 'Y'
		ORDER BY TO_NUMBER(NVL(BMUV.UF_Value1, 0)) ASC
    </select>
    
    <select id="selectBoardGroupName" parameterType="cmap" resultType="String">
		SELECT Fn_BaseGetDictionary_S(#{lang}, MultiDisplayName) AS "GroupName"
		FROM sys_object_group
		WHERE GroupCode = #{grCode}
	</select>
	
	<select id="selectMultiFolderName" parameterType="cmap" resultType="String">
		SELECT LISTAGG(Fn_BaseGetDictionary_S(#{lang}, MultiDisplayName), ', ') WITHIN GROUP(ORDER BY FolderID) AS "MultiFolderName"
		FROM sys_object_folder
		WHERE 1=1
		<if test='multiFolderIDArr != null and multiFolderIDArr.length != 0'>
			AND FolderID IN 
			<foreach collection="multiFolderIDArr" item="folderID" open="(" close=")" separator=",">
				#{folderID}
			</foreach>
		</if>
	</select>
	
	<select id="selectUserSecurityLevel" parameterType="cmap" resultType="java.lang.Long">
		SELECT SecurityLevel AS "SecurityLevel"
		FROM SYS_OBJECT_USER
		WHERE UserCode = #{userCode}
	</select>
	
	<select id="selectFolderOwnerCode" parameterType="cmap" resultType="String">
		SELECT OwnerCode
		FROM SYS_OBJECT_FOLDER
		WHERE FolderID = #{folderID}
	</select>
	
	<select id="selectDocAuthCnt" parameterType="cmap" resultType="java.lang.Long">
		SELECT COUNT(*)
		FROM DOC_REQUEST_ACL
		WHERE 1=1
		AND RequestID = #{requestID}
		AND MessageID = #{messageID}
		AND Version = #{version}
		AND ActorCode = #{userCode}
	</select>
	
	<select id="selectApprovalCnt" parameterType="cmap" resultType="java.lang.Long">
		SELECT COUNT(*)
		FROM SYS_PROCESS_ACTIVITY
		WHERE 1=1 
		AND ProcessID = #{processID}
		AND State = 1
		AND ActorCode = #{userCode}
	</select>
	
	<select id="selectProcessActorList" parameterType="cmap" resultType="cmap">
		SELECT	  SP.ProcessID AS "ProcessID"
				, SP.MessageID AS "MessageID"
				, SP.ObjectType AS "ObjectType"
				, SP.Subject AS "Subject"
				, SP.RegisterCode AS "RegisterCode"
				, TO_DATE(SP.RegistDate, 'YYYY-MM-DD HH24:MI:SS') AS "RegistDate"
				, SPA.Step AS "Step"
				, SPA.ActivityType AS "ActivityType"
				, SPA.ActorCode AS "ActorCode"
				, SPA.ActorRole AS "ActorRole"
		FROM sys_process SP
		INNER JOIN sys_process_activity SPA ON SP.ProcessID = SPA.ProcessID
		WHERE 1=1
		AND SP.MessageID = #{messageID}
		AND SPA.ActorRole != 'Register'
	</select>
	
	<select id="selectTypeList" parameterType="cmap" resultType="cmap">
		SELECT 
			<choose>
				<when test='searchGroupType.equalsIgnoreCase("category")'>FolderID</when>
				<when test='searchGroupType.equalsIgnoreCase("date")'>SUBSTR(RegistDate, 1, 10)</when>
			</choose> AS "fieldID"
			, COUNT(1) AS "fieldCnt"
			<if test="searchGroupType == 'category'">
				, MAX(FolderName) AS "fieldName"
			</if>
			<if test="searchGroupType == 'date'">
				, REPLACE(SUBSTR(RegistDate, 1, 10), '.', '-') AS "fieldName"
			</if>
		FROM (
			SELECT
				  BM.MessageID
				, BM.Version
				, BM.Number_
				, BM.FolderID
				, BM.IsInherited
				, BM.ParentID
				, BM.MsgType
				, BM.MsgState
				, BM.CategoryID
				, BM.Seq
				, BM.Step
				, BM.Depth
				, BM.Subject
				, BM.IsPopup
				, BM.IsTop
				, BM.PopupStartDate
				, BM.PopupEndDate
				, BM.TopStartDate
				, BM.TopEndDate
				, BM.ExpiredDate
				, BM.ListTop
				, BM.UseSecurity
				, BM.UseAnonym
				, BM.IsApproval
				, BM.IsUserForm
				, BM.IsCheckOut
				, BM.UseScrap
				, BM.NoticeMedia
				, BM.UseRSS
				, BM.TrackBackURL
				, BM.TracbackCnt
				, BM.AnswerCnt
				, BM.ReadCnt
				, BM.ScrapCnt
				, BM.ReportCnt
				, BM.FileCnt
				, BM.FileExtension
				, TO_CHAR(BM.RegistDate, 'YYYY.MM.DD HH24:MI:SS') AS RegistDate
				, TO_CHAR(BM.CreateDate, 'YYYY.MM.DD HH24:MI:SS') AS CreateDate
				, BM.RevisionCode
				, BM.RevisionDate AS DocRevisionDate
				, BM.ReservationDate AS BoardReservationDate
				, BM.ProgressState
				, BM.CreatorCode
				, FN_BASEGETDICTIONARY_S(#{lang}, BM.CreatorName) AS CreatorName
				, BM.CreatorLevel
				, BM.CreatorPosition
				, BM.CreatorTitle
				, FN_BASEGETDICTIONARY_S(#{lang}, BM.CreatorDept) AS CreatorDept
				, BM.DeleteDate
				, BM.RegistDept
				, BM.OwnerCode
				, BM.FolderName
				, BM.MenuID
				, (SELECT COUNT(*) 
				 	 FROM SYS_COMMENT 
				    WHERE DeleteDate IS NULL 
				 	<choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				 	  AND TargetID = BM.MessageID||'_'||BM.Version)) AS CommentCnt
				, (SELECT COUNT(*) 
				     FROM SYS_LIKE 
				    WHERE 1=1
				    <choose>
						<when test="bizSection != null and bizSection != '' and (bizSection == 'Board' or bizSection == 'Doc' or bizSection == 'Community')">
							AND TargetServiceType IN ('Board', 'Doc', 'Community')
						</when>
						<otherwise>
							AND TargetServiceType = #{bizSection}
						</otherwise>
					</choose>
				      AND TargetID = BM.MessageID||'_'||BM.Version) AS RecommendCnt
				, (SELECT OwnerCode FROM SYS_OBJECT_FOLDER WHERE FolderID = BM.FolderID) AS FolderOwnerCode
				<if test="bizSection == 'Board'">
					, (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = BM.CreatorCode) AS MailAddress
				</if>
				<if test="bizSection == 'Doc'">
					, (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = BM.OwnerCode) AS MailAddress
				</if>
				<choose>
					<when test="boardType == 'RequestModify'">
						,BM.RequestID		
						,BM.RequestMessage	
						,BM.RequestorCode	
						,BM.RequestorName
						,BM.RequestorMailAddress
						,BM.RequestDate		
						,BM.AnswererCode	
						,BM.AnswererMailAddress
						,BM.AnswererName	
						,BM.AnswerContent	
						,BM.AnswerDate		
						,BM.RequestStatus	
					</when>
					<when test="boardType == 'Approval'">
						, BM.ProcessID AS ProcessID
						, BM.ProcessDefID AS ProcessDefID 
						, BM.ProcessState 
						, BM.ProcessRegistDate
						, BM.ProcessRegisterCode
						, BM.State
						, BM.ActivityState
						, BM.TotalApproverCnt
						, BM.TotalApprovalCnt 
					</when>
					<when test="boardType == 'DocAuth'">
						, BM.RequestID
						, BM.RequestorCode
						, BM.RequestorName
						, BM.RequestMessage
						, BM.RequestDate
						, BM.RequestAclList
						, BM.ActType
					</when>
					<when test="boardType == 'DocTotal'">
						, BM.MultiFolderType
					</when>
				</choose>
				, BM.OwnerName
				, BM.RegistDeptName
				, BM.RevisionName
				, BM.RevisionDate
				, BM.ReservationDate
				, BM.IsRead
				, BM.IsSecurity
				, BM.FileID
			FROM(
				SELECT	  A.MessageID
						, A.Version 
						, A.Number_ 
						, A.FolderID
						, A.IsInherited
						, A.ParentID
						, A.MsgType
						, A.MsgState
						, A.CategoryID
						, A.Seq
						, A.Step
						, A.Depth
						, A.Subject
						, A.IsPopup
						, A.IsTop
						, A.PopupStartDate
						, A.PopupEndDate
						, A.TopStartDate
						, A.TopEndDate
						, A.ExpiredDate
						, A.UseSecurity
						, A.UseAnonym
						, A.IsApproval
						, A.IsUserForm
						, A.IsCheckOut
						, A.UseScrap
						, A.NoticeMedia
						, A.UseRSS
						, A.TrackBackURL
						, A.TracbackCnt
						, A.AnswerCnt
						, A.ReadCnt
						, A.ScrapCnt
						, A.ReportCnt
						, A.FileCnt
						, A.FileExtension
						, A.RegistDate
						, A.RevisionCode
						, A.ProgressState
						, A.CreatorCode
						, A.CreateDate
						, A.CreatorName
						, A.CreatorLevel
						, A.CreatorPosition
						, A.CreatorTitle
						, A.CreatorDept
						, A.DeleteDate
						, A.RegistDept
						, A.OwnerCode
						, A.SecurityLevel
						, A.FolderName
						, A.MenuID
						, A.ListTop
					<choose>
						<when test="boardType == 'RequestModify'">
							, A.RequestID
							, A.RequestMessage
							, A.RequestorCode
							, A.RequestorName
							, A.RequestorMailAddress
							, A.RequestDate
							, A.AnswererCode
							, A.AnswererMailAddress
							, A.AnswererName
							, A.AnswerContent
							, A.AnswerDate
							, A.RequestStatus
						</when>
						<when test="boardType == 'Approval'">
							, A.ProcessID
							, A.ProcessDefID
							, A.ProcessState
							, A.ProcessRegistDate
							, A.ProcessRegisterCode
							, A.State
							, A.ActivityState
							, A.TotalApproverCnt
							, A.TotalApprovalCnt
						</when>
						<when test="boardType == 'DocAuth'">
							, A.RequestID
							, A.RequestorCode AS RequestorCode
							, A. RequestorName
							, A.RequestMessage
							, A.RequestDate
							, A.RequestAclList
							, A.ActType
						</when>
						<when test="boardType == 'DocTotal'">
							, A.MultiFolderType
						</when>
					</choose>
					, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = A.OwnerCode) AS OwnerName
					, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_GROUP WHERE GroupCode = A.RegistDept) AS RegistDeptName
					, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = A.RevisionCode) AS RevisionName
					, DECODE(A.RevisionDate, NULL, TO_CHAR(A.RegistDate,'YYYY.MM.DD HH24:MI:SS'), TO_CHAR(A.RevisionDate,'YYYY.MM.DD HH24:MI:SS')) AS RevisionDate
					, TO_CHAR(A.ReservationDate, 'YYYY.MM.DD HH24:MI:SS') AS ReservationDate
					, DECODE((SELECT COUNT(*) FROM BOARD_MESSAGE_READER WHERE MessageID = A.MessageID AND ReaderCode = #{userCode}) , 0, 'N', 'Y' ) AS IsRead
					, DECODE((SELECT COUNT(*) FROM SYS_OBJECT_USER WHERE UserCode = #{userCode} AND A.SecurityLevel IS NOT NULL AND A.SecurityLevel != 256 AND A.SecurityLevel >= SecurityLevel), 0, 'N', 'Y') AS IsSecurity
					, (SELECT MAX(FileID) FROM SYS_FILE WHERE ObjectType ='FD' AND ObjectID = A.FolderID AND MessageID = A.MessageID AND SaveType IN ('IMAGE', 'INLINE')) AS FileID
				FROM (
					SELECT DISTINCT
						  A.MessageID
						, A.Version
						, A.Number_
						, A.FolderID 
						, A.IsInherited
						, A.ParentID
						, A.MsgType
						, A.MsgState
						, A.CategoryID
						, A.Seq
						, A.Step
						, A.Depth
						, A.Subject
						, A.IsPopup
						, A.IsTop
						, A.PopupStartDate
						, A.PopupEndDate
						, A.TopStartDate
						, A.TopEndDate
						, A.ExpiredDate
						, A.UseSecurity
						, A.UseAnonym
						, A.IsApproval
						, A.IsUserForm
						, A.IsCheckOut
						, A.UseScrap
						, A.NoticeMedia
						, A.UseRSS
						, A.TrackBackURL
						, A.TracbackCnt
						, A.AnswerCnt
						, A.ReadCnt
						, A.ScrapCnt
						, A.ReportCnt
						, A.FileCnt
						, A.FileExtension
						, A.RegistDate
						, A.RevisionCode
						, A.RevisionDate
						, A.ReservationDate
						, A.ProgressState
						, A.CreatorCode
						, A.CreateDate
						, DECODE(A.UsePubDeptName, 'Y', A.CreatorDept, A.CreatorName) AS CreatorName
						, A.CreatorLevel
						, A.CreatorPosition
						, A.CreatorTitle
						, A.CreatorDept
						, A.DeleteDate
						, A.RegistDept
						, A.OwnerCode
						, A.SecurityLevel
						, H.DisplayName AS FolderName
						, H.MenuID
						, (CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
						<choose>
							<when test="boardType == 'RequestModify'">
								, M.RequestID						
								, M.RequestMessage					
								, M.RequestorCode					
								, FN_BASEGETDICTIONARY_S(#{lang}, M.RequestorName) AS RequestorName	
								, (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = M.RequestorCode) AS RequestorMailAddress
								, TO_CHAR(M.RequestDate,'YYYY.MM.DD HH24:MI:SS') AS RequestDate		
								, M.AnswererCode					
								, (SELECT MailAddress FROM SYS_OBJECT_USER WHERE UserCode = M.AnswererCode) AS AnswererMailAddress
								, FN_BASEGETDICTIONARY_S(#{lang}, M.AnswererName) AS AnswererName	
								, M.AnswerContent					
								, TO_CHAR(M.AnswerDate, 'YYYY.MM.DD HH24:MI:SS')	AS AnswerDate		
								, M.RequestStatus					
							</when>
							<when test="boardType == 'Approval'">
								, F.ProcessID AS ProcessID
								, F.ProcessDefID AS ProcessDefID 
								, F.State AS ProcessState 
								, F.RegistDate AS ProcessRegistDate
								, F.RegisterCode AS ProcessRegisterCode
								, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State = 1 AND ActorCode = #{userCode}) AS State
								, (SELECT State FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} and ProcessID = F.ProcessID and ActorRole = 'Register') AS ActivityState
								, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID) AS TotalApproverCnt
								, (SELECT COUNT(*) FROM SYS_PROCESS_ACTIVITY WHERE ProcessID=F.ProcessID AND State IN (7,9)) AS TotalApprovalCnt 
							</when>
							<when test="boardType == 'DocAuth'">
								, DRA.RequestID
								, DRA.RegisterCode AS RequestorCode
								, (SELECT FN_BASEGETDICTIONARY_S(#{lang}, MultiDisplayName) FROM SYS_OBJECT_USER WHERE UserCode = DRA.RegisterCode) AS RequestorName
								, DRA.RequestMessage
								, TO_CHAR(DRA.RequestDate, 'YYYY.MM.DD HH24:MI:SS') AS RequestDate
								, DRA.AclList AS RequestAclList
								, DRA.ActType
							</when>
							<when test="boardType == 'DocTotal'">
								, 'ORIGIN' AS MultiFolderType
							</when>
						</choose>
					FROM BOARD_MESSAGE A
					INNER JOIN SYS_OBJECT_FOLDER H ON A.FolderID = H.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
					LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = A.MessageID AND BMA.Version = A.Version
					<choose>
						<when test="boardType == 'MyInterest'"> 
							INNER JOIN BOARD_MESSAGE_FAVORITE J ON A.MessageID=J.MessageID AND J.RegisterCode=#{userCode}
						</when>
						<!-- 전 관심게시 -->
						<when test="boardType == 'RequestModify'">
							INNER JOIN BOARD_REQUEST_MODIFY M ON (A.MessageID=M.MessageID AND M.RequestStatus != 'Deleted')
						</when>
						<when test="boardType == 'Approval'">
							<if test="boxType == 'Request'">	
								INNER JOIN SYS_PROCESS F ON A.MessageID=F.MessageID AND F.ObjectType=#{bizSection}
							</if>
							<if test="boxType == 'Receive'">
								INNER JOIN SYS_PROCESS F ON A.MessageID=F.MessageID AND F.ObjectType=#{bizSection} 
								AND F.ProcessID IN (SELECT DISTINCT ProcessID FROM SYS_PROCESS_ACTIVITY WHERE ActorCode = #{userCode} AND ActorRole != 'Register' )
							</if>
						</when>
						<when test="boardType == 'DocAuth'">
							<if test="boxType == 'Request'">
								INNER JOIN DOC_REQUEST_ACL DRA ON A.MessageID=DRA.MessageID AND A.Version=DRA.Version AND DRA.RegisterCode = #{userCode}
							</if>
							<if test="boxType == 'Receive'">
								INNER JOIN DOC_REQUEST_ACL DRA ON A.MessageID=DRA.MessageID AND A.Version=DRA.Version AND DRA.ActorCode = #{userCode}
							</if>
						</when>
						<when test="boardType == 'CheckIn' or boardType == 'CheckOut'">
							LEFT OUTER JOIN (SELECT MAX(HistoryID) AS HistoryID, MessageID, MAX(Version) AS Version, CO_Code, ActType FROM DOC_INOUT_HISTORY WHERE DeleteDate IS NULL GROUP BY MessageID, CO_Code, ActType) DIH 
							ON (A.MessageID = DIH.MessageID AND A.Version = DIH.Version)
						</when>
						<when test="boardType == 'DocTotal' and searchFolderIDs != null and searchFolderIDs != ''">
							INNER JOIN (
								SELECT * FROM (
									SELECT MessageID, Version
									, ';' || LISTAGG(FolderID, ';' ) WITHIN GROUP(ORDER BY FolderID) || ';' AS FolderIDs
									FROM (
										SELECT MessageID, Version, FolderID
										FROM board_message_folder
										WHERE 1=1
										<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
											AND FolderID IN 
											<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
												#{searchFolderID}
											</foreach>
										</if>
										
										UNION
										
										SELECT MessageID, Version, FolderID
										FROM board_message
										WHERE 1=1
										<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
											AND FolderID IN 
											<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
												#{searchFolderID}
											</foreach>
										</if>
									) A
									GROUP BY MessageID, Version
								) RESULT
								WHERE 1=1
								<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
									<foreach collection="searchFolderIDArr" item="searchFolderID" index="index">
										AND FolderIDs LIKE '%;' || #{searchFolderID} || ';%'
									</foreach>
								</if>
							) B ON A.MessageID = B.MessageID AND A.Version = B.Version
						</when>
					</choose>
					<if test="multiCategory != null and multiCategory != ''">
						INNER JOIN (
							SELECT * FROM (
								SELECT MessageID, Version
								, ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
								FROM board_userform_value
								GROUP BY MessageID, Version
							) A
							WHERE 1=1
							<foreach collection="multiCategoryList" item="multiCategory" index="index">
								AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
							</foreach>
						) UFV ON UFV.MessageID = A.MessageID AND UFV.Version = A.Version
					</if>
					WHERE 1=1
					AND IsCurrent = 'Y'
					<if test="bizSection == 'Board'">
						AND (H.MenuID = #{menuID} OR H.DomainID = 0)
					</if>	
					<if test='aclDataArr != null and aclDataArr.length != 0'>
						AND H.FolderID IN 
						<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
							#{item}
						</foreach>
					</if>
					<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
						AND H.FolderID IN 
						<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
							#{searchFolderID}
						</foreach>
					</if>
					<if test="folderID != null and folderID != ''">
						AND H.FolderID = #{folderID}
					</if>
					AND H.FolderType != 'QuickComment'
					<if test="bizSection == 'Board'">
						AND MsgType NOT IN ('N', 'B')
					</if>
					<if test="bizSection == 'Doc'">
						AND MsgType IN ('N', 'B', 'M')
					</if>
					<if test="isMobileSupport == 'Y'">
						AND H.isMobileSupport = 'Y'
					</if>
					<choose>
						<when test="communityID != null and communityID !=''">
							AND H.ObjectType = 'Community'
						</when>
						<otherwise>
							AND H.ObjectType = #{bizSection}
						</otherwise>
					</choose>
					<include refid="chooseBoardType"/>
					<if test="requestStatus != null and requestStatus != ''">
						<choose>
							<when test="requestStatus == 'Ready'">
								AND MsgState IN ('Ready')
							</when>
							<when test="requestStatus == 'Process'">
								AND MsgState IN ('Process')
							</when>
							<otherwise>
								AND MsgState IN ('Complete')
							</otherwise>
						</choose>
					</if>
					<if test="readSearchType != null and readSearchType != ''">
						AND A.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
					</if>
					<if test="searchText != null and searchText != ''">
						<choose>
							<when test="searchType == 'Total'">
								AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%')
							</when>
							<when test="searchType == 'Mobile'">
								AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%' OR CreatorName LIKE '%'|| #{searchText} ||'%')
							</when>
							<when test="searchType == 'Number'">
								AND Number_ LIKE '%'|| #{searchText} ||'%'  
							</when>
							<otherwise>
								AND 
								<choose>
									<when test='searchType.equalsIgnoreCase("BodyText")'>BodyText </when>
									<when test='searchType.equalsIgnoreCase("CreatorName")'>CreatorName </when>
									<otherwise>Subject </otherwise>
								</choose>
								LIKE '%'|| #{searchText} ||'%'
							</otherwise>
						</choose>
					</if>
					<if test="startDate != '' or endDate != ''">
						AND A.RegistDate BETWEEN TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') AND TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')	
					</if>
					<choose>
						<when test="boardType == 'Approval'">
							<if test="boxType == 'Request'">	
								AND F.RegisterCode = #{userCode}
							</if>
							<choose>
								<when test='approvalStatus == "R"'>	
									AND (MsgState IN ('R', 'BR')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State &gt; 0 -->
								</when>
								<when test='approvalStatus == "A"'> 
									AND (MsgState IN ('A', 'BA')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
								</when>
								<when test='approvalStatus == "D"'> 
									AND (MsgState IN ('D')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
								</when>
								<when test='approvalStatus == "P"'> 
									AND (MsgState IN ('R')) AND (MsgType IN ('O', 'N', 'B')) <!-- AND State = 0 -->
								</when>
								<otherwise>
									AND (MsgState IN ('R', 'D', 'A', 'BR', 'BA')) AND (MsgType IN ('O', 'N', 'B'))
								</otherwise>
							</choose>
						</when>
						<when test="boardType == 'DocAuth'">
							<!-- 요청함 -->
							<if test="boxType == 'Receive'">	
								<choose>
									<when test='approvalStatus == "R"'>	
										AND (ActType IN ('R'))
									</when>
									<when test='approvalStatus == "A"'> 
										AND (ActType IN ('D', 'A'))
									</when>
									<when test='approvalStatus == "D"'> 
										AND (ActType IN ('D'))
									</when>
									<otherwise>
										
									</otherwise>
								</choose>
							</if>
						</when>
					</choose>
					
					<if test="bizSection == 'Doc' and boardType == 'DocTotal'">
						UNION ALL
						
						SELECT DISTINCT
							  A.MessageID
							, A.Version
							, A.Number_
							, H.FolderID 
							, A.IsInherited
							, A.ParentID
							, A.MsgType
							, A.MsgState
							, A.CategoryID
							, A.Seq
							, A.Step
							, A.Depth
							, A.Subject
							, A.IsPopup
							, A.IsTop
							, A.PopupStartDate
							, A.PopupEndDate
							, A.TopStartDate
							, A.TopEndDate
							, A.ExpiredDate
							, A.UseSecurity
							, A.UseAnonym 
							, A.IsApproval
							, A.IsUserForm
							, A.IsCheckOut
							, A.UseScrap
							, A.NoticeMedia
							, A.UseRSS
							, A.TrackBackURL
							, A.TracbackCnt
							, A.AnswerCnt
							, A.ReadCnt
							, A.ScrapCnt
							, A.ReportCnt
							, A.FileCnt
							, A.FileExtension
							, A.RegistDate
							, A.RevisionCode
							, A.RevisionDate
							, A.ReservationDate
							, A.ProgressState
							, A.CreatorCode
							, A.CreateDate
							, DECODE(A.UsePubDeptName, 'Y', A.CreatorDept, A.CreatorName) AS CreatorName
							, A.CreatorLevel
							, A.CreatorPosition
							, A.CreatorTitle
							, A.CreatorDept
							, A.DeleteDate
							, A.RegistDept
							, A.OwnerCode
							, A.SecurityLevel
							, H.DisplayName AS FolderName
							, H.MenuID
							, (CASE IsTop WHEN 'N' THEN 'Z' ELSE (CASE WHEN TO_DATE(#{localCurrentDate},'YYYY-MM-DD HH24:MI:SS') BETWEEN TopStartDate AND TopEndDate THEN 'A' ELSE 'Z' END) END) AS ListTop
							, 'SUB' AS MultiFolderType
							FROM BOARD_MESSAGE A
							LEFT OUTER JOIN board_message_folder BMF ON A.MessageID = BMF.MessageID AND A.Version = BMF.Version
							<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
								AND BMF.FolderID IN 
								<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
									#{searchFolderID}
								</foreach>
							</if>
							INNER JOIN SYS_OBJECT_FOLDER H ON H.FolderID = BMF.FolderID AND H.IsUse = 'Y' AND H.DeleteDate IS NULL
							LEFT OUTER JOIN board_message_acl BMA ON BMA.MessageID = A.MessageID AND BMA.Version = A.Version
							INNER JOIN (
								SELECT * FROM (
									SELECT MessageID, Version
									, ';' || LISTAGG(FolderID, ';' ) WITHIN GROUP(ORDER BY FolderID) || ';' AS FolderIDs
									FROM (
										SELECT MessageID, Version, FolderID
										FROM board_message_folder
										WHERE 1=1
										<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
											AND FolderID IN 
											<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
												#{searchFolderID}
											</foreach>
										</if>
										
										UNION
										
										SELECT MessageID, Version, FolderID
										FROM board_message
										WHERE 1=1
										<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
											AND FolderID IN 
											<foreach collection="searchFolderIDArr" item="searchFolderID" open="(" close=")" separator=",">
												#{searchFolderID}
											</foreach>
										</if>
									) A
									GROUP BY MessageID, Version
								) RESULT
								WHERE 1=1
								<if test='searchFolderIDArr != null and searchFolderIDArr.size != 0'>
									<foreach collection="searchFolderIDArr" item="searchFolderID" index="index">
										AND FolderIDs LIKE '%;' || #{searchFolderID} || ';%'
									</foreach>
								</if>
							) B ON A.MessageID = B.MessageID AND A.Version = B.Version
							<if test="multiCategory != null and multiCategory != ''">
								INNER JOIN (
									SELECT * FROM (
										SELECT MessageID, Version
										, ';' || LISTAGG((UserFormID || '-' || FieldValue), ';') WITHIN GROUP(ORDER BY UserFormID, FieldValue) || ';' AS UserFormField
										FROM board_userform_value
										GROUP BY MessageID, Version
									) A
									WHERE 1=1
									<foreach collection="multiCategoryList" item="multiCategory" index="index">
										AND UserFormField LIKE '%;' || #{multiCategory} || ';%'
									</foreach>
								) UFV ON UFV.MessageID = A.MessageID AND UFV.Version = A.Version
							</if>
						WHERE 1=1
						AND IsCurrent = 'Y'
						AND (H.MenuID = #{menuID} OR H.DomainID = 0)
						<if test='aclDataArr != null and aclDataArr.length != 0'>
							AND H.FolderID IN 
							<foreach collection="aclDataArr" item="item" open="(" close=")" separator=",">
								#{item}
							</foreach>
						</if>
						<if test="isMobileSupport == 'Y'">
						    AND H.isMobileSupport = 'Y'
						</if>
						<if test="folderID != null and folderID != ''">
							AND H.FolderID = #{folderID}
						</if>
						AND H.FolderType != 'QuickComment'
						<if test="bizSection == 'Board'">
							AND MsgType NOT IN ('N', 'B')
						</if>
						<if test="bizSection == 'Doc'">
							AND MsgType IN ('N', 'B', 'M')
						</if>
						<choose>
							<when test="communityID != null and communityID !=''">
								AND H.ObjectType = 'Community'
							</when>
							<otherwise>
								AND H.ObjectType = #{bizSection}
							</otherwise>
						</choose>
						<include refid="chooseBoardType"/>
						<if test="requestStatus != null and requestStatus != ''">
							<choose>
								<when test="requestStatus == 'Ready'">
									AND MsgState IN ('Ready')
								</when>
								<when test="requestStatus == 'Process'">
									AND MsgState IN ('Process')
								</when>
								<otherwise>
									AND MsgState IN ('Complete')
								</otherwise>
							</choose>
						</if>
						<if test="readSearchType != null and readSearchType != ''">
							AND A.MessageID NOT IN (SELECT MessageID FROM BOARD_MESSAGE_READER WHERE ReaderCode = #{userCode})
						</if>
						<if test="searchText != null and searchText != ''">
							<choose>
								<when test="searchType == 'Total'">
									AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%')
								</when>
								<when test="searchType == 'Mobile'">
									AND ( A.Subject LIKE '%'|| #{searchText} ||'%' OR BodyText LIKE '%'|| #{searchText} ||'%' OR CreatorName LIKE '%'|| #{searchText} ||'%')
								</when>
								<when test="searchType == 'Number'">
									AND Number_ LIKE '%'|| #{searchText} ||'%'  
								</when>
								<otherwise>
									AND 
									<choose>
										<when test='searchType.equalsIgnoreCase("BodyText")'>BodyText </when>
										<when test='searchType.equalsIgnoreCase("CreatorName")'>CreatorName </when>
										<otherwise>Subject </otherwise>
									</choose>
									LIKE '%'|| #{searchText} ||'%'
								</otherwise>
							</choose>
						</if>
						<if test="startDate != '' or endDate != ''">
							AND A.RegistDate between TO_DATE(#{startDate},'YYYY-MM-DD HH24:MI:SS') and TO_DATE(#{endDate},'YYYY-MM-DD HH24:MI:SS')	
						</if>
					</if>
				) A
			) BM 
			LEFT OUTER JOIN SYS_OBJECT_USER B ON (CASE WHEN BM.MsgType='S' THEN BM.OwnerCode ELSE BM.CreatorCode END) = B.UserCode
			WHERE 1=1
			<if test="categoryID != null and categoryID != ''">
				<choose>
					<when test="categoryGubun == 'Y'">
						AND (C.MemberOf = #{categoryID} OR C.CategoryID = #{categoryID})
					</when>
					<otherwise>
						AND BM.CategoryID = #{categoryID}
					</otherwise>
				</choose>
			</if>
			<if test="boardType == 'Approval' and boxType == 'Receive' and approvalStatus != '' and approvalStatus != null ">
				<choose>
					<when test='approvalStatus == "R"'>	<!-- 승인 요청 받은 게시 -->
						AND State &gt; 0
					</when>
					<otherwise> <!-- 승인 완료된 게시(A), 반려된 게시(D), 다른사람이 결제해야할 승인 요청 게시(진행중)(P)- -->
						AND State = 0
					</otherwise>
				</choose>
			</if>
		) RESULT
		WHERE 1=1
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
			<if test="searchGroupType != null and searchGroupType != ''">
				<choose>
					<when test='searchGroupType.equalsIgnoreCase("category")'>FolderID</when>
					<when test='searchGroupType.equalsIgnoreCase("date")'>SUBSTR(RegistDate, 1, 10)</when>
				</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
			<if test="searchGroupType != null">
				"fieldName" ASC
			</if>
		</trim>
	</select>
	
	<!-- 사용자 정의 필드 값 변경 -->
    <update id="updateMessageUserDefFieldValue" parameterType="cmap">
        UPDATE board_userform_value
        SET
        	FieldValue = #{fieldValue}
        WHERE MessageID = #{messageID}
        AND FolderID = #{folderID}
        AND Version = #{version}
        AND UserFormID = #{userFormID}
    </update>
    
    <insert id="copyMessageByOrg" parameterType="cmap">
    	INSERT INTO board_message
				(FolderID, Version, IsInherited, IsCurrent, IsCheckOut, ParentID, MsgType, MsgState, CategoryID, Number_, Seq, Step, Depth,
				Subject, BodyText, PopupStartDate, PopupEndDate, TopStartDate, TopEndDate, ExpiredDate,
				UseSecurity, IsPopup, IsTop, IsApproval, IsUserForm, UseScrap, NoticeMedia, UseRSS,
				UseReplyNotice, UseCommNotice, TrackBackURL, AnswerCnt, ReadCnt, 
				ScrapCnt, ReportCnt, FileCnt, FileExtension, TracbackCnt, RegistDate,
				CreatorCode, CreateDate, CreatorName, CreatorLevel, CreatorPosition, CreatorTitle, CreatorDept, 
				ModifierCode, ModifyDate,OwnerCode)
        SELECT	#{folderID}, Version, 'Y', IsCurrent, 'N', NULL, 'C', 'C', #{categoryID}, #{number}, 0, 0, 0,
				Subject, BodyText, NULL, NULL, NULL, NULL, '9999-12-31',
				'N', 'N', 'N', 'N', IsUserForm, 'Y', NULL, 'N',
				'N', 'N', NULL, 0, 0,
				0, 0, FileCnt, FileExtension, 0, SYSDATE,
				#{userCode}, SYSDATE, #{creatorName}, #{creatorLevel}, #{creatorPosition}, #{creatorTitle}, #{creatorDept},
				#{userCode}, SYSDATE, OwnerCode      
		FROM 	board_message
		WHERE 	MessageID = #{orgMessageID}
		<selectKey keyProperty="messageID" resultType="long" order="AFTER">
			SELECT MAX(MessageID) AS "messageID" FROM board_Message
        </selectKey>
    </insert>
    
</mapper>
