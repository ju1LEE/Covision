<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user.approvalList">
    <!-- 예고함 목록 데이터 -->
	<select id="selectPreApprovalList" parameterType="cmap" resultType="cmap">
			SELECT PreApprovalList.* FROM (
				SELECT A.ProcessID
						, B.WorkItemID
						, C.PerformerID
						, A.InitiatorID
						, A.InitiatorName
						, A.InitiatorUnitID
						, A.InitiatorUnitName
						, C.UserCode
						, C.UserName
						, C.SubKind
						, C.SubKind AS FormSubKind
						, D.*
						, B.Created
						, B.TaskID
						, F.ExtInfo
						, U.PhotoPath
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>				
				WHERE C.UserCode = #{userID}
				AND C.State = 1
				AND C.SubKind = 'T010'
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>					
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS PreApprovalList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                	AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}    
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	,
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("Created")'>Created</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>IsModify</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 예고함 목록 개수 데이터 -->
	<select id="selectPreApprovalListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT A.ProcessID
						, B.WorkItemID
						, C.PerformerID
						, A.InitiatorID
						, A.InitiatorName
						, A.InitiatorUnitID
						, A.InitiatorUnitName
						, C.UserCode
						, C.UserName
						, C.SubKind
						, C.SubKind AS FormSubKind
						, D.*
						, B.Created
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>					
				WHERE C.UserCode = #{userID}
				AND C.State = 1
				AND C.SubKind = 'T010'
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>					
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS PreApprovalList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 예고함 그룹별 목록 조회 -->
	<select id="selectPreApprovalGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>PreApprovalList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>PreApprovalList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>PreApprovalList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>PreApprovalList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>PreApprovalList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , PreApprovalList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , MAX(PreApprovalList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(PreApprovalList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , MAX(PreApprovalList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(PreApprovalList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT A.ProcessID
						, B.WorkItemID
						, C.PerformerID
						, A.InitiatorID
						, A.InitiatorName
						, A.InitiatorUnitID
						, A.InitiatorUnitName
						, C.UserCode
						, C.UserName
						, C.SubKind
						, C.SubKind AS FormSubKind
						, D.*
						<choose>
							<when test="searchGroupType == 'Date'">
								, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Created),'%Y-%m-%d') AS `Date`
							</when>
							<otherwise>
								, DATE_FORMAT(B.Created,'%Y-%m-%d') AS `Date`
							</otherwise>
						</choose>
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>				
				WHERE C.UserCode = #{userID}
				AND C.State = 1
				AND C.SubKind = 'T010'
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS PreApprovalList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>PreApprovalList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>PreApprovalList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>PreApprovalList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>PreApprovalList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>PreApprovalList.SubKind</when>
           		</choose>
		 	</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

    <!-- 미결함 목록 데이터 -->
    <select id="selectApprovalList" parameterType="cmap" resultType="cmap">
			SELECT ApprovalList.* FROM (
				SELECT A.ProcessID
				, A.ParentProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, C.SubKind AS FormSubKind
				, D.*
				, B.Created
				, B.TaskID
				, R.ReadDate
				, F.ExtInfo
				, U.PhotoPath
				, A.ProcessName
				, IFNULL(JF.SchemaContext, '') as SchemaContext
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.AdminYN = 'N' AND R.FormInstID > 0
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				LEFT OUTER JOIN COVI_APPROVAL4J.jwf_formsschema AS JF ON F.SchemaID = JF.SchemaID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>					
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, A.ParentProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, C.SubKind AS FormSubKind
					, D.*
					, B.Created
					, B.TaskID
					, R.ReadDate
					, F.ExtInfo
					, U.PhotoPath
					, A.ProcessName
					, IFNULL(JF.SchemaContext, '') as SchemaContext
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND B.DeputyID = R.UserID AND R.FormInstID > 0
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
					LEFT OUTER JOIN COVI_APPROVAL4J.jwf_formsschema AS JF ON F.SchemaID = JF.SchemaID
					LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
					AND C.State = 1
					AND B.State = 288
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ApprovalList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
		  	<if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("Created")'>Created</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 미결함 목록 개수 데이터 -->
	<select id="selectApprovalListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, D.*
				, B.Created
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>					
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, D.*
					, B.Created
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
					AND C.State = 1
					AND B.State = 288
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ApprovalList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 미결함 그룹별 목록 조회 -->
	<select id="selectApprovalGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>ApprovalList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>ApprovalList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>ApprovalList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>ApprovalList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>ApprovalList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , ApprovalList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , MAX(ApprovalList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(ApprovalList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , MAX(ApprovalList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(ApprovalList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT A.ProcessID
				, A.DocSubject AS FormSubject
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, D.FormID
				, D.FormPrefix
				, D.FormName
				<choose>
					<when test="searchGroupType == 'Date'">
						, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Created),'%Y-%m-%d') AS `Date`
					</when>
					<otherwise>
						, DATE_FORMAT(B.Created,'%Y-%m-%d') AS `Date`
					</otherwise>
				</choose>
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>				
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, A.DocSubject AS FormSubject
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, D.FormID
					, D.FormPrefix
					, D.FormName
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Created),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.Created,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
					AND C.State = 1
					AND B.State = 288
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ApprovalList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				) 
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>ApprovalList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>ApprovalList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>ApprovalList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>ApprovalList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>ApprovalList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 미결함 엑셀 데이터 조회 -->
	<select id="selectApprovalListExcel" parameterType="cmap" resultType="cmap">
			SELECT ApprovalList.* FROM (
				SELECT C.SubKind
				,D.ApprovalStep
				,D.FormSubject
				,A.InitiatorID
				,A.InitiatorName
				,A.InitiatorUnitID
				,A.InitiatorUnitName
				,D.IsFile
				,D.FormName
				,DATE_FORMAT(B.Created,'%Y-%m-%d %H:%i:%s') AS Created
				,D.IsComment
				,D.IsModify
				,D.FormID
				,D.Priority
				,D.BusinessData3
				,D.BusinessData4
				,D.BusinessData5
				,Fn_SplitString_r(D.businessdata5, '^^^', 2) as SubUserName
				,D.FormPrefix
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>					
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT C.SubKind
					,D.ApprovalStep
					,D.FormSubject
					,A.InitiatorID
					,A.InitiatorName
					,A.InitiatorUnitID
					,A.InitiatorUnitName
					,D.IsFile
					,D.FormName
					,DATE_FORMAT(B.Created,'%Y-%m-%d %H:%i:%s') AS Created
					,D.IsComment
					,D.IsModify
					,D.FormID
					,D.Priority
					,D.BusinessData3
					,D.BusinessData4
					,D.BusinessData5
					,Fn_SplitString_r(D.businessdata5, '^^^', 2) as SubUserName
					,D.FormPrefix
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
					AND C.State = 1
					AND B.State = 288
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ApprovalList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("Created")'>Created</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 진행함 목록 데이터 -->
	<select id="selectProcessList" parameterType="cmap" resultType="cmap">
			SELECT ProcessList.*,JD.DomainDataContext FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, C.SubKind AS FormSubKind
				, D.*
				, A.StartDate
				, IFNULL(B.Finished, '') AS Finished
				, IFNULL(R.ReadDate, '') AS ReadDate
				, B.TaskID
				, F.ExtInfo
				, U.PhotoPath
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.AdminYN = 'N' AND R.FormInstID > 0
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>				
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, C.SubKind AS FormSubKind
					, D.*
					, A.StartDate
					, IFNULL(B.Finished, '') AS Finished
					, IFNULL(R.ReadDate, '') AS ReadDate
					, B.TaskID
					, F.ExtInfo
					, U.PhotoPath
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.AdminYN = 'N' AND R.FormInstID > 0
					LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
					AND C.State = 1
					AND B.State = 528
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ProcessList
		INNER JOIN COVI_APPROVAL4J.jwf_domaindata JD ON ProcessList.ProcessID = JD.ProcessID
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Finished BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Finished BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">  
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Finished Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("Created")'>Created</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>IsModify</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 진행함 목록 개수 데이터 -->
	<select id="selectProcessListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, D.*
				, A.StartDate
				, IFNULL(B.Finished, '') AS Finished
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>				
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, D.*
					, A.StartDate
					, IFNULL(B.Finished, '') AS Finished
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
					AND C.State = 1
					AND B.State = 528
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ProcessList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Finished BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Finished BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 진행함 그룹별 목록 조회 -->
	<select id="selectProcessGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>ProcessList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>ProcessList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>ProcessList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>ProcessList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>ProcessList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , ProcessList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , MAX(ProcessList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(ProcessList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , MAX(ProcessList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(ProcessList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, D.*
				<choose>
					<when test="searchGroupType == 'Date'">
						, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Finished),'%Y-%m-%d') AS `Date`
					</when>
					<otherwise>
						, DATE_FORMAT(B.Finished,'%Y-%m-%d') AS `Date`
					</otherwise>
				</choose>
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>				
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, D.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Finished),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.Finished,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
					AND C.State = 1
					AND B.State = 528
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ProcessList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>ProcessList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>ProcessList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>ProcessList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>ProcessList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>ProcessList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 진행함 엑셀 데이터 조회 -->
	<select id="selectProcessListExcel" parameterType="cmap" resultType="cmap">
			SELECT ProcessList.* FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, D.*
				, IFNULL(DATE_FORMAT(B.Finished,'%Y-%m-%d %H:%i:%s'),'') AS Finished
				, Fn_SplitString_r(D.businessdata5, '^^^', 2) as SubUserName
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
				</if>				
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, D.*
					, IFNULL(B.Finished,'') AS Finished
					,Fn_SplitString_r(D.businessdata5, '^^^', 2) as SubUserName
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					<if test="companyCode != null and companyCode != '' ">
						INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = A.InitiatorUnitID
					</if>					
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
					AND C.State = 1
					AND B.State = 528
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<if test="companyCode != null and companyCode != '' ">
						AND SOG.CompanyCode = #{companyCode}
						AND SOG.GroupType = 'Dept'
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ProcessList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   Finished BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Finished BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Finished Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("Created")'>Created</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>IsModify</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 완료함 목록 데이터 -->
	<select id="selectCompleteList" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID,C.FormID, C.FormPrefix, C.FormName,C.FormSubject,C.IsSecureDoc,C.IsFile,C.FileExt,C.IsComment
					, C.DocNo, C.ApproverCode,C.ApproverName,C.ApprovalStep
					, C.ApproverSIPAddress,C.IsReserved,C.ReservedGubun,C.ReservedTime,C.Priority,C.IsModify,C.Reserved1,C.Reserved2,C.BusinessData1,C.BusinessData2,C.BusinessData3,C.BusinessData4,C.BusinessData5
					, C.BusinessData6,C.BusinessData7,C.BusinessData8,C.BusinessData9,C.BusinessData10
					
					, B.EndDate
					, A.TaskID
					, F.ExtInfo
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				AND B.ProcessState = 528				
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="formSubject != null and formSubject !=''">
				AND FormSubject LIKE CONCAT('%',#{formSubject},'%')
			</if>
			<if test="initiatorName != null and initiatorName !=''">
				AND InitiatorName LIKE CONCAT('%',#{initiatorName},'%')
			</if>
			<if test="initiatorUnitName != null and initiatorUnitName !=''">
				AND InitiatorUnitName LIKE CONCAT('%',#{initiatorUnitName},'%')
			</if>
			<if test="formName != null and formName !=''">
				AND FormName LIKE CONCAT('%',#{formName},'%')
			</if>
			<if test="docNo != null and docNo !=''">
				AND DocNo LIKE CONCAT('%',#{docNo},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("endDate")'>endDate</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 완료함 목록 개수 데이터 -->
	<select id="selectCompleteListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				AND B.ProcessState = 528				
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
				<if test="viewStartDate != null and viewStartDate != '' ">
					AND endDate <![CDATA[>=]]> #{viewStartDate}
				</if>
				<if test="viewEndDate != null and viewEndDate != '' ">
					AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
				</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="formSubject != null and formSubject !=''">
				AND FormSubject LIKE CONCAT('%',#{formSubject},'%')
			</if>
			<if test="initiatorName != null and initiatorName !=''">
				AND InitiatorName LIKE CONCAT('%',#{initiatorName},'%')
			</if>
			<if test="initiatorUnitName != null and initiatorUnitName !=''">
				AND InitiatorUnitName LIKE CONCAT('%',#{initiatorUnitName},'%')
			</if>
			<if test="formName != null and formName !=''">
				AND FormName LIKE CONCAT('%',#{formName},'%')
			</if>
			<if test="docNo != null and docNo !=''">
				AND DocNo LIKE CONCAT('%',#{docNo},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 완료함 그룹별 목록 조회 -->
	<select id="selectCompleteGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , CompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
	        , MAX(CompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(CompleteList.InitiatorName) as fieldName
	    </if>
     	<if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
	        , MAX(CompleteList.InitiatorUnitName) as fieldName
	    </if>
     	<if test="searchGroupType == 'SubKind'">
	        , MAX(CompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				AND B.ProcessState = 528				
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> #{viewEndDate}
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="formSubject != null and formSubject !=''">
				AND FormSubject LIKE CONCAT('%',#{formSubject},'%')
			</if>
			<if test="initiatorName != null and initiatorName !=''">
				AND InitiatorName LIKE CONCAT('%',#{initiatorName},'%')
			</if>
			<if test="initiatorUnitName != null and initiatorUnitName !=''">
				AND InitiatorUnitName LIKE CONCAT('%',#{initiatorUnitName},'%')
			</if>
			<if test="formName != null and formName !=''">
				AND FormName LIKE CONCAT('%',#{formName},'%')
			</if>
			<if test="docNo != null and docNo !=''">
				AND DocNo LIKE CONCAT('%',#{docNo},'%')
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
           			<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 완료함 엑셀 데이터 조회 -->
	<select id="selectCompleteListExcel" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID,C.FormID, C.FormPrefix, C.FormName,C.FormSubject,C.IsSecureDoc,C.IsFile,C.FileExt,C.IsComment
					, C.DocNo, C.ApproverCode,C.ApproverName,C.ApprovalStep
					, C.ApproverSIPAddress,C.IsReserved,C.ReservedGubun,C.ReservedTime,C.Priority,C.IsModify,C.Reserved1,C.Reserved2,C.BusinessData1,C.BusinessData2,C.BusinessData3,C.BusinessData4,C.BusinessData5
					, C.BusinessData6,C.BusinessData7,C.BusinessData8,C.BusinessData9,C.BusinessData10
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
					,Fn_SplitString_r(C.businessdata5, '^^^', 2) as SubUserName
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				AND B.ProcessState = 528				
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="formSubject != null and formSubject !=''">
				AND FormSubject LIKE CONCAT('%',#{formSubject},'%')
			</if>
			<if test="initiatorName != null and initiatorName !=''">
				AND InitiatorName LIKE CONCAT('%',#{initiatorName},'%')
			</if>
			<if test="initiatorUnitName != null and initiatorUnitName !=''">
				AND InitiatorUnitName LIKE CONCAT('%',#{initiatorUnitName},'%')
			</if>
			<if test="formName != null and formName !=''">
				AND FormName LIKE CONCAT('%',#{formName},'%')
			</if>
			<if test="docNo != null and docNo !=''">
				AND DocNo LIKE CONCAT('%',#{docNo},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =","> 
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("endDate")'>endDate</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
	
	<!-- 수신공람함 목록 데이터 -->
	<select id="selectReceiveExhibitList" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind

					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID,C.FormID, C.FormPrefix, C.FormName,C.FormSubject,C.IsSecureDoc,C.IsFile,C.FileExt,C.IsComment
					, C.DocNo, C.ApproverCode,C.ApproverName,C.ApprovalStep
					, C.ApproverSIPAddress,C.IsReserved,C.ReservedGubun,C.ReservedTime,C.Priority,C.IsModify,C.Reserved1,C.Reserved2,C.BusinessData1,C.BusinessData2,C.BusinessData3,C.BusinessData4,C.BusinessData5
					, C.BusinessData6,C.BusinessData7,C.BusinessData8,C.BusinessData9,C.BusinessData10
					
					, B.EndDate
					, A.TaskID
					, F.ExtInfo
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>
				WHERE A.UserCode = #{userID}
				AND B.ProcessState = 528
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>		
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>IsModify</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 수신공람함 목록 개수 데이터 -->
	<select id="selectReceiveExhibitListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind

					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID,C.FormID, C.FormPrefix, C.FormName,C.FormSubject,C.IsSecureDoc,C.IsFile,C.FileExt,C.IsComment
					, C.DocNo, C.ApproverCode,C.ApproverName,C.ApprovalStep
					, C.ApproverSIPAddress,C.IsReserved,C.ReservedGubun,C.ReservedTime,C.Priority,C.IsModify,C.Reserved1,C.Reserved2,C.BusinessData1,C.BusinessData2,C.BusinessData3,C.BusinessData4,C.BusinessData5
					, C.BusinessData6,C.BusinessData7,C.BusinessData8,C.BusinessData9,C.BusinessData10
					
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>	
				WHERE A.UserCode = #{userID}
				AND B.ProcessState = 528
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 수신공람함 그룹별 목록 조회 -->
	<select id="selectReceiveExhibitGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , CompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , MAX(CompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(CompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , MAX(CompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(CompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE A.UserCode = #{userID}
				AND B.ProcessState = 528
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 수신공람함 엑셀 데이터 조회 -->
	<select id="selectReceiveExhibitListExcel" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID,C.FormID, C.FormPrefix, C.FormName,C.FormSubject,C.IsSecureDoc,C.IsFile,C.FileExt,C.IsComment
					, C.DocNo, C.ApproverCode,C.ApproverName,C.ApprovalStep
					, C.ApproverSIPAddress,C.IsReserved,C.ReservedGubun,C.ReservedTime,C.Priority,C.IsModify,C.Reserved1,C.Reserved2,C.BusinessData1,C.BusinessData2,C.BusinessData3,C.BusinessData4,C.BusinessData5
					, C.BusinessData6,C.BusinessData7,C.BusinessData8,C.BusinessData9,C.BusinessData10
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE A.UserCode = #{userID}
				AND B.ProcessState = 528
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =","> 
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>IsModify</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 반려함 목록 데이터 -->
	<select id="selectRejectList" parameterType="cmap" resultType="cmap">
			SELECT RejectList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind

					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID,C.FormID, C.FormPrefix, C.FormName,C.FormSubject,C.IsSecureDoc,C.IsFile,C.FileExt,C.IsComment
					, C.DocNo, C.ApproverCode,C.ApproverName,C.ApprovalStep
					, C.ApproverSIPAddress,C.IsReserved,C.ReservedGubun,C.ReservedTime,C.Priority,C.IsModify,C.Reserved1,C.Reserved2,C.BusinessData1,C.BusinessData2,C.BusinessData3,C.BusinessData4,C.BusinessData5
					, C.BusinessData6,C.BusinessData7,C.BusinessData8,C.BusinessData9,C.BusinessData10
					
					, B.EndDate
					, A.TaskID
					, F.ExtInfo
					, U.PhotoPath
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021','T023'	))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				AND B.ProcessState = 528
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
				
			) AS RejectList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>IsModify</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 반려함 목록 개수 데이터 -->
	<select id="selectRejectListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				AND	B.ProcessState = 528
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS RejectList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 반려함 그룹별 목록 조회 -->
	<select id="selectRejectGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>RejectList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>RejectList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>RejectList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>RejectList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>RejectList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , RejectList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , MAX(RejectList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(RejectList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , MAX(RejectList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(RejectList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				AND	B.ProcessState = 528
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS RejectList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>RejectList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>RejectList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>RejectList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>RejectList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>RejectList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 반려함 엑셀 데이터 조회 -->
	<select id="selectRejectListExcel" parameterType="cmap" resultType="cmap">
			SELECT RejectList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID,C.FormID, C.FormPrefix, C.FormName,C.FormSubject,C.IsSecureDoc,C.IsFile,C.FileExt,C.IsComment
					, C.DocNo, C.ApproverCode,C.ApproverName,C.ApprovalStep
					, C.ApproverSIPAddress,C.IsReserved,C.ReservedGubun,C.ReservedTime,C.Priority,C.IsModify,C.Reserved1,C.Reserved2,C.BusinessData1,C.BusinessData2,C.BusinessData3,C.BusinessData4,C.BusinessData5
					, C.BusinessData6,C.BusinessData7,C.BusinessData8,C.BusinessData9,C.BusinessData10
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
					,Fn_SplitString_r(C.businessdata5, '^^^', 2) as SubUserName
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				AND	B.ProcessState = 528
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS RejectList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>IsModify</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 임시함 목록 데이터 -->
	<select id="selectTempSaveList" parameterType="cmap" resultType="cmap">
		<![CDATA[
			SELECT TempSaveList.* FROM (
				SELECT
					  A .*
					, A.Kind AS SubKind
					, B.FormName
					, B.FormName AS FormSubject
					, U.PhotoPath
				FROM COVI_APPROVAL4J.JWF_FormsTempInstBox AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Forms AS B ON B.FormID = A.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.UserCode
				WHERE A.UserCode = #{userID}
		]]>
				<if test="isMobile != null and isMobile !='' and isMobile =='Y'.toString()">
					AND B.ExtInfo LIKE CONCAT('%"MobileFormYN":"', #{isMobile}, '"%')
				</if>
			) AS TempSaveList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    CreatedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND TempSaveList.Subject LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                	AND TempSaveList.CreatedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND TempSaveList.Subject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , CreatedDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("Subject")'>Subject</when>
					<otherwise>CreatedDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 임시함 목록 개수 데이터 -->
	<select id="selectTempSaveListCnt" resultType="java.lang.Long">
	    <![CDATA[
			SELECT COUNT(*) FROM (
				SELECT
					  A .*
					, A.Kind AS SubKind
					, B.FormName
					, B.FormName AS FormSubject
				FROM COVI_APPROVAL4J.JWF_FormsTempInstBox AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Forms AS B ON B.FormID = A.FormID
				WHERE A.UserCode = #{userID}
		]]>
				<if test="isMobile != null and isMobile !='' and isMobile =='Y'.toString()">
					AND B.ExtInfo LIKE CONCAT('%"MobileFormYN":"', #{isMobile}, '"%')
				</if>
			) AS TempSaveList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    CreatedDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND TempSaveList.Subject LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                	AND TempSaveList.CreatedDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND TempSaveList.Subject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 임시함 그룹별 목록 조회 -->
	<select id="selectTempSaveGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>TempSaveList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>TempSaveList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>TempSaveList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>TempSaveList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>TempSaveList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , TempSaveList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , MAX(TempSaveList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(TempSaveList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , MAX(TempSaveList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(TempSaveList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT
					  A .*
					  , A.Kind AS SubKind
					  <choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, A.CreatedDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(A.CreatedDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					, B.FormName
				FROM COVI_APPROVAL4J.JWF_FormsTempInstBox AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Forms AS B ON B.FormID = A.FormID
				WHERE A.UserCode = #{userID}
			) AS TempSaveList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND TempSaveList.Subject LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND TempSaveList.Subject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>TempSaveList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>TempSaveList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>TempSaveList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>TempSaveList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>TempSaveList.SubKind </when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 참조/회람함 목록 데이터 -->
	<select id="selectTCInfoList" parameterType="cmap" resultType="cmap">
			SELECT TCInfoList.* FROM (
					SELECT 	  A.*
						, A.kind AS FormSubKind
						, A.kind AS SubKind
						, B.InitiatorID
						, P.InitiatorName
						, B.InitiatorUnitID
						, P.InitiatorUnitName
						, B.InitiatedDate
						, B.DocNo
						, B.BodyContextOrg
						, C.FormID
						, F.FormName
						, C.FormPrefix
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
						, F.ExtInfo
						, U.PhotoPath
						, D.BusinessData1
						, D.BusinessData2
						, D.BusinessData3
						, D.BusinessData4
						, D.BusinessData5
						, D.BusinessData6
						, D.BusinessData7
						, D.BusinessData8
						, D.BusinessData9
						, D.BusinessData10
					FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
					LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
					WHERE A.State = 'C'
					<if test="adminYn == null or adminYn == '' ">
						AND B.DeletedDate IS NULL
					</if>
					AND A.ReceiptType = 'P'
					AND A.ReceiptID = #{userID}
					<if test='requestType != null and requestType.equalsIgnoreCase("DocList")'>AND P.BusinessState like '02_01%'</if>
					AND A.DataState != 'D'
					<if test="companyCode != null and companyCode != '' ">
						AND B.EntCode = #{companyCode}
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
			) AS TCInfoList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		     <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 참조/회람함 목록 개수 데이터 -->
	<select id="selectTCInfoListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
					SELECT A.*
						, A.kind AS SubKind
						, B.InitiatorID
						, P.InitiatorName
						, B.InitiatorUnitID
						, P.InitiatorUnitName
						, B.InitiatedDate
						, B.DocNo
						, B.BodyContextOrg
						, C.FormPrefix
						, C.FormID
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
					FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
					WHERE A.State = 'C'
					<if test="adminYn == null or adminYn == '' ">
						AND B.DeletedDate IS NULL
					</if>
					AND A.ReceiptType = 'P'
					AND A.ReceiptID = #{userID}
					<if test='requestType != null and requestType.equalsIgnoreCase("DocList")'>AND P.BusinessState like '02_01%'</if>
					AND A.DataState != 'D'
					<if test="companyCode != null and companyCode != '' ">
						AND B.EntCode = #{companyCode}
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
			) AS TCInfoList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 참조/회람함 그룹별 목록 조회 -->
	<select id="selectTCInfoGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>TCInfoList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>TCInfoList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>TCInfoList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>TCInfoList.InitiatorUnitName </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>TCInfoList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>TCInfoList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>TCInfoList.SubKind</when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , TCInfoList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , MAX(TCInfoList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(TCInfoList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , MAX(TCInfoList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(TCInfoList.SubKind) as fieldName
	    </if>
			FROM (
					SELECT 	  A.*
						, A.kind AS SubKind
						, B.InitiatorID
						, P.InitiatorName
						, B.InitiatorUnitID
						, P.InitiatorUnitName
						, B.FormID
						, B.BodyContextOrg
						, B.DocNo
						<choose>
							<when test="searchGroupType == 'Date'">
								, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, A.RegDate),'%Y-%m-%d') AS `Date`
							</when>
							<otherwise>
								, DATE_FORMAT(A.RegDate,'%Y-%m-%d') AS `Date`
							</otherwise>
						</choose>
						, C.FormID AS BoxFormID
						, C.FormPrefix
						, F.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
						, F.ExtInfo
					FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
					WHERE A.State = 'C'
					AND B.DeletedDate IS NULL
					AND A.ReceiptType = 'P'
					AND A.ReceiptID = #{userID}
					AND A.DataState != 'D'
					<if test="companyCode != null and companyCode != '' ">
						AND B.EntCode = #{companyCode}
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
			) AS TCInfoList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>TCInfoList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>TCInfoList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>TCInfoList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>TCInfoList.InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>TCInfoList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>TCInfoList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>TCInfoList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 참조함 엑셀 데이터 조회 -->
	<select id="selectTCInfoListExcel" parameterType="cmap" resultType="cmap">
			SELECT TCInfoList.* FROM (
					SELECT 	  A.CirculationBoxID
						    , A.ProcessID
						    , A.CirculationBoxDescriptionID
						    , A.FormInstID
						    , A.ReceiptID
						    , A.ReceiptType
						    , A.ReceiptName
						    , A.ReceiptDate
							, A.Kind AS FormSubKind
							, A.Kind AS SubKind
						    , A.State
						    , A.ReadDate
						    , A.SenderID
						    , A.SenderName
						    , A.Subject
						    , A.Comment
						    , A.DataState
						    , A.RegID
						    , DATE_FORMAT(A.RegDate,'%Y-%m-%d %H:%i:%s') AS RegDate
						    , A.ModID
						    , A.ModDate
							, B.InitiatorID
							, P.InitiatorName
							, B.InitiatorUnitID
							, P.InitiatorUnitName
							, B.InitiatedDate
							, B.BodyContextOrg
							, B.DocNo
							, C.FormPrefix
							, C.FormID
							, F.FormName
							, C.FormSubject
							, C.IsSecureDoc
							, C.IsFile
							, C.FileExt
							, C.IsComment
							, C.ApproverCode
							, C.ApproverName
							, C.ApprovalStep
							, C.ApproverSIPAddress
							, C.IsReserved
							, C.ReservedGubun
							, C.ReservedTime
							, C.Priority
							, C.IsModify
							, C.Reserved1
							, C.Reserved2
							, D.BusinessData3
							, D.BusinessData4
							, D.BusinessData5
							, Fn_SplitString_r(D.businessdata5, '^^^', 2) as SubUserName
					FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0		
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
					WHERE A.State = 'C'
					AND B.DeletedDate IS NULL
					AND A.ReceiptType = 'P'
					AND A.ReceiptID = #{userID}
					AND A.DataState != 'D'
					<if test="companyCode != null and companyCode != '' ">
						AND B.EntCode = #{companyCode}
					</if>					
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
			) AS TCInfoList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatedDate")'>InitiatedDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData3")'>BusinessData3</when>
					<when test='sortColumn.equalsIgnoreCase("BusinessData4")'>BusinessData4</when>
					<when test='sortColumn.equalsIgnoreCase("SubUserName")'>BusinessData5</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 임시함 JWF_FormsTempInstBox 삭제 -->
	<delete id="deleteFormsTempInstBox" parameterType="cmap">
		DELETE FROM COVI_APPROVAL4J.JWF_FormsTempInstBox
		WHERE
			UserCode = #{userID}
		AND FormInstID IN
		<foreach collection="FormInstId" item="item" index="index" separator="," open="(" close=")">
		    #{item}
		</foreach>
	</delete>

	<!-- 임시함 JWF_FormInstance 삭제 -->
	<delete id="deleteFormInstance" parameterType="cmap">
		DELETE FROM COVI_APPROVAL4J.JWF_FormInstance
		WHERE
			InitiatorID = #{userID}
		AND FormInstID IN
	    <foreach collection="FormInstId" item="item" index="index" separator="," open="(" close=")">
		    #{item}
		</foreach>
	</delete>

	<!-- 임시함 JWF_PrivateDomainData 삭제 -->
	<delete id="deletePrivateDomainData" parameterType="cmap">
		DELETE FROM COVI_APPROVAL4J.JWF_PrivateDomainData
		WHERE OWNERID IN
		<foreach collection="FormInstBoxId" item="item" index="index" separator="," open="(" close=")">
		    #{item}
		</foreach>
	</delete>

	<!-- 반려함 JWF_WorkitemArchive 업데이트 -->
	<update id="updateWorkitemArchive" parameterType="cmap">
		UPDATE
			COVI_APPROVAL4J.JWF_Workitem
		SET Deleted	= now(3)
		WHERE WorkitemID IN
		<foreach collection="WorkItemId" item="item" index="index" separator="," open="(" close=")">
		    #{item}
		</foreach>
	</update>

	<select id="selectAdminMnLIstData" parameterType="cmap" resultType="cmap">
	    <![CDATA[
	    	SELECT
				 MenuID
				,DisplayName
				,Reserved2 AS TypeCode
			FROM covi_smart4j.sys_object_menu
			WHERE IsUse = 'Y'
			AND IsDisplay = 'Y'
			AND MenuType = 'LeftSub'
			AND Reserved1 = #{MemberOf}
			AND DomainID = (
		        CASE WHEN EXISTS (
			        SELECT 'X' FROM covi_smart4j.sys_object_menu 
	        		WHERE IsUse = 'Y'
					AND IsDisplay = 'Y'
					AND MenuType = 'LeftSub'
					AND Reserved1 = #{MemberOf}
					AND DomainID = #{DomainID})
		        THEN #{DomainID}
		        ELSE '0'
		        END
	        )
        	ORDER BY SortKey 
		]]>
	</select>

	<select id="selectApprovalNotDocReadCnt" resultType="java.lang.Long">
			SELECT COUNT(ApprovalList.FormInstID) FROM (
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, C.SubKind AS FormSubKind
					, D.*
					, B.Created
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					WHERE C.UserCode = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
					AND C.State = 1
					AND B.State = 288
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>

					<if test="userID != null and userID != '' ">
						UNION ALL
	
						SELECT A.ProcessID
						, B.WorkItemID
						, C.PerformerID
						, A.InitiatorID
						, A.InitiatorName
						, A.InitiatorUnitID
						, A.InitiatorUnitName
						, C.UserCode
						, C.UserName
						, C.SubKind
						, C.SubKind AS FormSubKind
						, D.*
						, B.Created
						FROM COVI_APPROVAL4J.JWF_Process AS A
						INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
						INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
						INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
						WHERE B.DeputyID = #{userID}
						AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
						AND C.State = 1
						AND B.State = 288
						AND A.ProcessState = 288
						<if test="adminYn == null or adminYn == '' ">
							AND A.DeleteDate IS NULL
						</if>
						<choose>
							<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
								AND (D.BusinessData1 IS NULL
									<if test='bizDataList != null'>
										OR D.BusinessData1 IN 
										<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
											#{item}
										</foreach>
									</if>
								)
							</when>
							<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
								AND D.BusinessData1 = #{businessData1}
							</when>
						</choose>
					</if>
				) AS ApprovalList
		WHERE
		1=1
		AND NOT EXISTS (
							SELECT
									DISTINCT R.FormInstID
							FROM
									covi_approval4j.jwf_docreadhistory R
									INNER JOIN covi_approval4j.jwf_forminstance FI ON R.FormInstID = FI.FormInstID
							WHERE 1=1
							AND AdminYN = 'N'
							AND UserID = #{userID}
							AND ApprovalList.FormInstID = R.FormInstID
						)
	</select>

	<select id="selectProcessNotDocReadCnt" resultType="java.lang.Long">
	    	SELECT COUNT(ProcessList.FormInstID) FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, C.SubKind AS FormSubKind
				, D.*
				, B.Created
				, B.Finished
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>


				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, C.SubKind AS FormSubKind
					, D.*
					, B.Created
					, B.Finished
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
					AND C.State = 1
					AND B.State = 528
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ProcessList
		WHERE
			1=1
		AND NOT EXISTS (
							SELECT
									DISTINCT R.FormInstID
							FROM
									covi_approval4j.jwf_docreadhistory R
									INNER JOIN covi_approval4j.jwf_forminstance FI ON R.FormInstID = FI.FormInstID
							WHERE 1=1
							AND AdminYN = 'N'
							AND UserID = #{userID}
							AND ProcessList.FormInstID = R.FormInstID
						)
	</select>

	<select id="selectTCInfoNotDocReadCnt" resultType="java.lang.Long">
		SELECT count(*)
		FROM (
			SELECT A.CirculationBoxID
			FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
			INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
			INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
			INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
			INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
			WHERE A.State = 'C'
			<if test="adminYn == null or adminYn == '' ">
				AND B.DeletedDate IS NULL
			</if>
			AND A.ReceiptType = 'P'
			AND A.ReceiptID = #{userID}
			AND A.DataState != 'D'
			AND (A.ReadDate IS NULL OR A.ReadDate = '0000-00-00 00:00:00')
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (D.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR D.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND D.BusinessData1 = #{businessData1}
				</when>
			</choose>
		) AA
	</select>
	
	<select id="selectApprovalTCInfoSingleDocRead" resultType="java.lang.Long">
		SELECT COUNT(A.FormInstID)
		FROM (
			SELECT A.CirculationBoxID
			FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
			INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
			INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
			INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
			INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
			WHERE A.State = 'C'
			AND A.ReceiptType = 'P'
			AND A.DataState != 'D'
			AND A.ReceiptID = #{userID}
			AND A.ProcessID = #{ProcessID}
			AND A.FormInstID = #{FormInstID}
			AND A.ReadDate IS NOT NULL 
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (D.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR D.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND D.BusinessData1 = #{businessData1}
				</when>
			</choose>
		) AA
	</select>

	<!-- 개인결재함- 특정사용자 부서조회-->
	<select id="selectPersonOneCount" parameterType="cmap" resultType="int">
	<![CDATA[
	   	SELECT COUNT(*)
		FROM covi_approval4j.jwf_persondirector A 
		LEFT OUTER JOIN covi_approval4j.jwf_persondirectormember B ON A.UserCode = B.UserCode AND A.EntCode = B.EntCode
		WHERE A.UserCode = #{UserCode}
		AND A.EntCode IN ('ORGROOT', #{EntCode})
		AND ((A.AuthEndDate IS NULL OR A.AuthEndDate = '00:00:00') OR (A.AuthStartDate  <= DATE_FORMAT(sysdate(), '%Y-%m-%d') AND A.AuthEndDate  >= DATE_FORMAT(sysdate(), '%Y-%m-%d')))
	]]>
	</select>
	
	<select id="selectPersonOne" parameterType="cmap" resultType="cmap">
		<![CDATA[
			SELECT A.* FROM (
				SELECT
						 '사용자명'  AS UserName
						,'all'        AS UserCode
						, NULL AS ViewStartDate
						, NULL AS ViewEndDate
				UNION ALL
				
				SELECT B.TargetName AS UserName
						,B.TargetCode AS UserCode
						,DATE_FORMAT(B.ViewStartDate,'%Y-%m-%d') , DATE_FORMAT(B.ViewEndDate,'%Y-%m-%d') 
				FROM covi_approval4j.jwf_persondirector A 
				LEFT OUTER JOIN covi_approval4j.jwf_persondirectormember B ON A.UserCode = B.UserCode AND A.EntCode = B.EntCode
				WHERE A.UserCode = #{UserCode}
				AND A.EntCode IN ('ORGROOT', #{EntCode})
				AND ((A.AuthEndDate IS NULL OR A.AuthEndDate = '00:00:00') OR (A.AuthStartDate  <= DATE_FORMAT(sysdate(), '%Y-%m-%d') AND A.AuthEndDate  >= DATE_FORMAT(sysdate(), '%Y-%m-%d')))
			) A
	    ]]>
	</select>
	
	<select id="selectProfileImagePath" parameterType="cmap" resultType="cmap">
	    SELECT U.UserCode, P.PhotoPath
	    FROM
		<foreach collection="UserCodes" item="UserCode" open="(" close=")" separator=" UNION ">
		    SELECT #{UserCode} AS UserCode
		</foreach>
		 U
		LEFT JOIN covi_smart4j.sys_object_user P ON U.UserCode = P.UserCode
	</select>
	
	<!-- 지연 알림 미결함 리스트 -->
	<select id="selectDelayApprovalUsers" parameterType="cmap" resultType="cmap">
	    SELECT UserCode FROM (
				SELECT C.UserCode
				, B.Created
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.AdminYN = 'N' AND R.FormInstID > 0
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				WHERE C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
				# 양식 조건문
		 		<if test='DelayFormPrefix != null '>
		 			AND F.FormPrefix IN
		 			<foreach collection="DelayFormPrefix" item="item" index="index" separator="," open="(" close=")">
						#{item}
					</foreach>
		 		</if>

				UNION ALL

				SELECT B.DeputyID AS UserCode
				, B.Created
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.FormInstID > 0
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				WHERE C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				AND B.DeputyID != ''
					
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
				# 양식 조건문
		 		<if test='DelayFormPrefix != null '>
		 			AND F.FormPrefix IN
		 			<foreach collection="DelayFormPrefix" item="item" index="index" separator="," open="(" close=")">
						#{item}
					</foreach>
		 		</if>
			) AS ApprovalList
		WHERE DATEDIFF(now(3), Created) >= #{DelayPeriodDay}
		GROUP BY UserCode
	</select>
	
	<!-- 지연 알림 미결함 리스트 -->
	<select id="selectDelayApprovalList" parameterType="cmap" resultType="cmap">
	    SELECT ApprovalList.* FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID 
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, C.SubKind AS FormSubKind
				, D.*
				, B.Created
				, B.TaskID
				, R.ReadDate
				, F.ExtInfo
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.AdminYN = 'N' AND R.FormInstID > 0
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				WHERE C.UserCode = #{UserCode}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
				# 양식 조건문
		 		<if test="DelayFormPrefix != null ">
		 			AND F.FormPrefix IN
		 			<foreach collection="DelayFormPrefix" item="item" index="index" separator="," open="(" close=")">
						#{item}
					</foreach>
		 		</if>

				<if test="UserCode != null and UserCode != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, C.SubKind AS FormSubKind
					, D.*
					, B.Created
					, B.TaskID
					, R.ReadDate
					, F.ExtInfo
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.FormInstID > 0
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
					WHERE B.DeputyID = #{UserCode}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
					AND C.State = 1
					AND B.State = 288
					AND A.ProcessState = 288
					AND A.DeleteDate IS NULL
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
					# 양식 조건문
			 		<if test="DelayFormPrefix != null ">
			 			AND F.FormPrefix IN
			 			<foreach collection="DelayFormPrefix" item="item" index="index" separator="," open="(" close=")">
							#{item}
						</foreach>
			 		</if>
			 	</if>
			) AS ApprovalList
		WHERE DATEDIFF(now(3), Created) >= #{DelayPeriodDay}
		ORDER BY Priority DESC, Created ASC
		<!-- LIMIT #{DelayListCount} -->
	</select>
	
	<!-- 홈화면 미결함 쿼리 -->
	<select id="selectHomeApprovalList" parameterType="cmap" resultType="cmap">
	    SELECT ApprovalList.* FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.FormInstID
				, A.ProcessDescriptionID
				, A.DocSubject AS FormSubject
				, D.FormPrefix
				, F.FormID
				, A.InitiatorID
				, A.InitiatorName
				, C.UserCode
				, C.UserName
				, C.SubKind AS FormSubKind
				, B.Created
				, B.TaskID
				, U.PhotoPath
				, E.DomainDataContext
				, S.SchemaContext
				, D.BusinessData1
				, D.BusinessData2
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.jwf_domaindata AS E ON A.ProcessID = E.ProcessID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				LEFT OUTER JOIN COVI_APPROVAL4J.jwf_forms AS F ON D.FormID = F.FormID
				LEFT OUTER JOIN COVI_APPROVAL4J.jwf_formsschema AS S ON F.SchemaID = S.SchemaID
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T023')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.FormInstID
					, A.ProcessDescriptionID
					, A.DocSubject AS FormSubject
					, D.FormPrefix
					, F.FormID
					, A.InitiatorID
					, A.InitiatorName
					, C.UserCode
					, C.UserName
					, C.SubKind AS FormSubKind
					, B.Created
					, B.TaskID
					, U.PhotoPath
					, E.DomainDataContext
					, S.SchemaContext
					, D.BusinessData1
					, D.BusinessData2
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J.jwf_domaindata AS E ON A.ProcessID = E.ProcessID
					LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
					LEFT OUTER JOIN COVI_APPROVAL4J.jwf_forms AS F ON D.FormID = F.FormID
					LEFT OUTER JOIN COVI_APPROVAL4J.jwf_formsschema AS S ON F.SchemaID = S.SchemaID
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017')
					AND C.State = 1
					AND B.State = 288
					AND A.ProcessState = 288
					AND A.DeleteDate IS NULL
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS ApprovalList
			ORDER BY Created DESC
			LIMIT 5;
	</select>
	
	<!-- 홈화면 진행함 쿼리 -->
	<select id="selectHomeProcessList" parameterType="cmap" resultType="cmap">
	    SELECT ProcessList.* FROM (
			SELECT A.ProcessID
			, B.WorkItemID
			, C.PerformerID
			, A.FormInstID
			, A.ProcessDescriptionID
			, A.DocSubject AS FormSubject
			, D.FormPrefix
			, D.FormID
			, A.InitiatorID
			, A.InitiatorName
			, C.UserCode
			, C.UserName
			, C.SubKind AS FormSubKind
			, A.StartDate
			, IFNULL(B.Finished, '') AS Finished
			, B.TaskID
			, E.DomainDataContext
			, U.PhotoPath
			, D.BusinessData1
			, D.BusinessData2
			FROM COVI_APPROVAL4J.JWF_Process AS A
			INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
			INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
			INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
			LEFT OUTER JOIN COVI_APPROVAL4J.jwf_domaindata AS E ON A.ProcessID = E.ProcessID
			LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
			WHERE C.UserCode = #{userID}
			AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
			AND C.State = 1
			AND B.State = 528
			AND A.ProcessState = 288
			AND A.DeleteDate IS NULL
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (D.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR D.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND D.BusinessData1 = #{businessData1}
				</when>
			</choose>

			<if test="userID != null and userID != '' ">
				UNION ALL
	
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.FormInstID
				, A.ProcessDescriptionID
				, A.DocSubject AS FormSubject
				, D.FormPrefix
				, D.FormID
				, A.InitiatorID
				, A.InitiatorName
				, C.UserCode
				, C.UserName
				, C.SubKind AS FormSubKind
				, A.StartDate
				, IFNULL(B.Finished, '') AS Finished
				, B.TaskID
				, E.DomainDataContext
				, U.PhotoPath
				, D.BusinessData1
				, D.BusinessData2
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.jwf_domaindata AS E ON A.ProcessID = E.ProcessID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				WHERE B.DeputyID = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			</if>
		) AS ProcessList
		ORDER BY Finished DESC
		LIMIT 5;
	</select>
	
	<!-- 홈화면 완료함 쿼리 -->
	<select id="selectHomeCompleteList" parameterType="cmap" resultType="cmap">
	    SELECT CompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, B.FormInstID
					, B.FormPrefix
					, C.FormID
					, B.InitiatorID
					, B.InitiatorName
					, B.DocSubject AS FormSubject
					, A.UserCode
					, B.EndDate
					, A.SubKind AS FormSubKind
					, U.PhotoPath
					, C.BusinessData1
					, C.BusinessData2
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				AND	B.ProcessState = 528
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				AND A.Deleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
				
			) AS CompleteList
			ORDER BY endDate DESC
			LIMIT 5;
	</select>
	
	<!-- 홈화면 반려함 쿼리 -->
	<select id="selectHomeRejectList" parameterType="cmap" resultType="cmap">
	    SELECT RejectList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkitemID AS WorkitemArchiveID
					, B.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, B.FormInstID
					, B.FormPrefix
					, C.FormID
					, B.InitiatorID
					, B.InitiatorName
					, B.DocSubject AS FormSubject
					, A.UserCode
					, B.EndDate
					, A.SubKind AS FormSubKind
					, U.PhotoPath
					, C.BusinessData1
					, C.BusinessData2
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021','T023'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				AND B.ProcessState = 528
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				AND A.Deleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
				
			) AS RejectList
			ORDER BY EndDate DESC
			LIMIT 5;
	</select>
	<!-- 통합진행함 목록 데이터 -->
	<select id="selectTotalProcessList" parameterType="cmap" resultType="cmap">
			SELECT ProcessList.* FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, C.SubKind AS FormSubKind
				, D.*
				, A.StartDate
				, IFNULL(B.Finished, '') AS Finished
				, IFNULL(R.ReadDate, '') AS ReadDate
				, B.TaskID
				, F.ExtInfo
				, U.PhotoPath
				, IF(B.State = 288, 'Approval', 'Process') AS Mode
				, B.State AS WIState
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.AdminYN = 'N' AND R.FormInstID > 0
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
				AND C.State = 1
				AND B.State IN (288, 528)
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, C.SubKind AS FormSubKind
					, D.*
					, A.StartDate
					, IFNULL(B.Finished, '') AS Finished
					, IFNULL(R.ReadDate, '') AS ReadDate
					, B.TaskID
					, F.ExtInfo
					, U.PhotoPath
					, IF(B.State = 288, 'Approval', 'Process') AS Mode
					, B.State AS WIState
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_DocReadHistory AS R ON A.ProcessID = R.ProcessID AND C.UserCode = R.UserID AND R.AdminYN = 'N' AND R.FormInstID > 0
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
					LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
					AND C.State = 1
					AND B.State IN (288, 528)
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
				</if>
			) AS ProcessList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Finished BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Finished BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">  
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , StartDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	    </if>
	</select>	
    <!-- 통합진행함 목록 개수 데이터 -->
	<select id="selectTotalProcessListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT A.ProcessID
				, B.WorkItemID
				, C.PerformerID
				, A.InitiatorID
				, A.InitiatorName
				, A.InitiatorUnitID
				, A.InitiatorUnitName
				, C.UserCode
				, C.UserName
				, C.SubKind
				, D.*
				, A.StartDate
				, IFNULL(B.Finished, '') AS Finished
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{userID}
				AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T019','T020','T023')
				AND C.State = 1
				AND B.State = 528
				AND B.State IN (288,528)
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>

				<if test="userID != null and userID != '' ">
					UNION ALL
	
					SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, A.InitiatorID
					, A.InitiatorName
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, C.UserCode
					, C.UserName
					, C.SubKind
					, D.*
					, A.StartDate
					, IFNULL(B.Finished, '') AS Finished
					FROM COVI_APPROVAL4J.JWF_Process AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
					WHERE B.DeputyID = #{userID}
					AND C.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016')
					AND C.State = 1
					AND B.State IN (288,528)
					AND A.ProcessState = 288
					<if test="adminYn == null or adminYn == '' ">
						AND A.DeleteDate IS NULL
					</if>
				</if>
			) AS ProcessList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Finished BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Finished BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>
	
	<update id="updateHandoverUser" parameterType="cmap">
		UPDATE COVI_APPROVAL4J.JWF_FormsTempInstBox
		SET UserCode = #{UserCode}
		WHERE FormInstID IN
		<foreach collection="FormInstId" item="item" index="index" separator="," open="(" close=")">
		    #{item}
		</foreach>
	</update>

	<!-- 완료함 목록 데이터 -->
	<select id="selectStoreCompleteList" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
					, A.TaskID
					, F.ExtInfo
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>endDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 완료함 목록 개수 데이터 -->
	<select id="selectStoreCompleteListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 완료함 그룹별 목록 조회 -->
	<select id="selectStoreCompleteGroupList" parameterType="cmap" resultType="cmap">
		SELECT 
			<choose>
				<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName </when>
				<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix </when>
				<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName </when>
				<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind </when>
        	</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , CompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
	        , MAX(CompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(CompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
	        , MAX(CompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(CompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<choose>
           			<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 완료함 엑셀 데이터 조회 -->
	<select id="selectStoreCompleteListExcel" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021'))
					</if>
				)
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =","> 
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
				<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>endDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
		
	<!-- 완료함 목록 데이터(이관함 > 관리자문서함) -->
	<select id="selectCompleteListStoreAdmin" parameterType="cmap" resultType="cmap">
		SELECT CompleteList.* FROM (
			SELECT B.ProcessArchiveID
				, A.PerformerID
				, A.WorkitemArchiveID
				, B.FormPrefix
				, B.InitiatorID
				, B.InitiatorName
				, B.InitiatorUnitID
				, B.InitiatorUnitName
				, IFNULL(A.UserCode, B.InitiatorID) AS UserCode
				, IFNULL(A.UserName, B.InitiatorName) AS UserName
				, IFNULL(A.SubKind, 'T006') AS SubKind
				, IFNULL(A.SubKind, 'T006') AS FormSubKind
				, C.*
				, B.EndDate
				, A.TaskID
				, F.ExtInfo
				, U.PhotoPath
			FROM 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessArchive</when>
			</choose> 
			AS B
			LEFT OUTER JOIN 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_WorkitemArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_WorkitemArchive</when>
			</choose> 
			AS A ON B.ProcessArchiveID = A.ProcessArchiveID AND A.SubKind = 'T006'
			INNER JOIN 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessDescriptionArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive</when>
			</choose> 
			AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
			LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
			LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
			WHERE 1 = 1 
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (C.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR C.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND C.BusinessData1 = #{businessData1}
				</when>
			</choose>
		) AS CompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>EndDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 완료함 목록 개수 데이터(이관함 > 관리자문서함) -->
	<select id="selectCompleteListCntStoreAdmin" resultType="java.lang.Long">
		SELECT COUNT(*) FROM (
			SELECT B.ProcessArchiveID
				, A.PerformerID
				, A.WorkitemArchiveID
				, B.FormPrefix
				, B.InitiatorID
				, B.InitiatorName
				, B.InitiatorUnitID
				, B.InitiatorUnitName
				, IFNULL(A.UserCode, B.InitiatorID) AS UserCode
				, IFNULL(A.UserName, B.InitiatorName) AS UserName
				, IFNULL(A.SubKind, 'T006') AS SubKind
				, IFNULL(A.SubKind, 'T006') AS FormSubKind
				, C.*
				, B.EndDate
			FROM 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessArchive</when>
			</choose> 
			AS B
			LEFT OUTER JOIN 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_WorkitemArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_WorkitemArchive</when>
			</choose> 
			AS A ON B.ProcessArchiveID = A.ProcessArchiveID AND A.SubKind = 'T006'
			INNER JOIN 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessDescriptionArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive</when>
			</choose> 
			AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
			
			WHERE 1 = 1 
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (C.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR C.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND C.BusinessData1 = #{businessData1}
				</when>
			</choose>
			) AS CompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>
	<!-- 완료함 그룹별 목록 조회(이관함 > 관리자문서함) -->
	<select id="selectCompleteGroupListStoreAdmin" parameterType="cmap" resultType="cmap">
			SELECT 
         		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind </when>
         		</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , CompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
	        , MAX(CompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , MAX(CompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
	        , MAX(CompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , MAX(CompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, IFNULL(A.UserCode, B.InitiatorID) AS UserCode
					, IFNULL(A.UserName, B.InitiatorName) AS UserName
					, IFNULL(A.SubKind, 'T006') AS SubKind
					, IFNULL(A.SubKind, 'T006') AS FormSubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM 
	    		<choose>
					<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessArchive</when>
					<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessArchive</when>
				</choose> 
				AS B
				LEFT OUTER JOIN 
	    		<choose>
					<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_WorkitemArchive</when>
					<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_WorkitemArchive</when>
				</choose> 
				AS A ON B.ProcessArchiveID = A.ProcessArchiveID AND A.SubKind = 'T006'
				INNER JOIN 
	    		<choose>
					<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessDescriptionArchive</when>
					<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive</when>
				</choose> 
				AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE 1 = 1 
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
    	<!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
           		<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 완료함 엑셀 데이터 조회(이관함 > 관리자문서함) -->
	<select id="selectCompleteListExcelStoreAdmin" parameterType="cmap" resultType="cmap">
		SELECT CompleteList.* FROM (
			SELECT B.ProcessArchiveID
				, A.PerformerID
				, A.WorkitemArchiveID
				, B.FormPrefix
				, B.InitiatorID
				, B.InitiatorName
				, B.InitiatorUnitID
				, B.InitiatorUnitName
				, IFNULL(A.UserCode, B.InitiatorID) AS UserCode
				, IFNULL(A.UserName, B.InitiatorName) AS UserName
				, IFNULL(A.SubKind, 'T006') AS SubKind
				, IFNULL(A.SubKind, 'T006') AS FormSubKind
				, C.*
				, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					, D.BodyContextOrg
				</if>
			FROM 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessArchive</when>
			</choose> 
			AS B
			LEFT OUTER JOIN 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_WorkitemArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_WorkitemArchive</when>
			</choose> 
			AS A ON B.ProcessArchiveID = A.ProcessArchiveID AND A.SubKind = 'T006'
			INNER JOIN 
    		<choose>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_ARCHIVE")'>COVI_APPROVAL4J_ARCHIVE.JWF_ProcessDescriptionArchive</when>
				<when test='DBName.equalsIgnoreCase("COVI_APPROVAL4J_STORE")'>COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive</when>
			</choose> 
			AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
			<if test="searchType != null and searchType == 'BodyContextOrg' ">
				INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
			</if>
			WHERE 1 = 1 
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (C.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR C.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND C.BusinessData1 = #{businessData1}
				</when>
			</choose>
		) AS CompleteList
     	<!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                	AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =","> 
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
	
	
	<!-- 수신공람함 목록 데이터 -->
	<select id="selectStoreReceiveExhibitList" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
					, A.TaskID
					, F.ExtInfo
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				WHERE A.UserCode = #{userID}
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                   AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>endDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 수신공람함 목록 개수 데이터 -->
	<select id="selectStoreReceiveExhibitListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{userID}
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 수신공람함 그룹별 목록 조회 -->
	<select id="selectStoreReceiveExhibitGroupList" parameterType="cmap" resultType="cmap">
		SELECT
			<choose>
				<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName </when>
				<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix </when>
				<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName </when>
				<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind </when>
        	</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , CompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , CompleteList.FormName as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , CompleteList.InitiatorName as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , CompleteList.InitiatorUnitName as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , CompleteList.SubKind as fieldName
	    </if>
			FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE A.UserCode = #{userID}
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<choose>
           			<when test='searchGroupType.equalsIgnoreCase("Date")'>CompleteList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>CompleteList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>CompleteList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>CompleteList.InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>CompleteList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>CompleteList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>CompleteList.SubKind </when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 수신공람함 엑셀 데이터 조회 -->
	<select id="selectStoreReceiveExhibitListExcel" parameterType="cmap" resultType="cmap">
			SELECT CompleteList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE A.UserCode = #{userID}
				AND A.SubKind = 'T022'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_01'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS CompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =","> 
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>endDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>	
	<!-- 반려함 목록 데이터 -->
	<select id="selectStoreRejectList" parameterType="cmap" resultType="cmap">
			SELECT RejectList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
					, A.TaskID
					, F.ExtInfo
					, U.PhotoPath
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
				
			) AS RejectList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>endDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 반려함 목록 개수 데이터 -->
	<select id="selectStoreRejectListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, B.EndDate
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS RejectList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 반려함 그룹별 목록 조회 -->
	<select id="selectStoreRejectGroupList" parameterType="cmap" resultType="cmap">
		SELECT
			<choose>
					<when test='searchGroupType.equalsIgnoreCase("Date")'>RejectList.Date </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>RejectList.InitiatorID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>RejectList.InitiatorUnitID </when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>RejectList.InitiatorUnitName </when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>RejectList.FormPrefix </when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>RejectList.FormName </when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>RejectList.SubKind </when>
	        	</choose>
				AS fieldID
				, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , RejectList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	        , RejectList.FormName as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , RejectList.InitiatorName as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	        , RejectList.InitiatorUnitName as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , RejectList.SubKind as fieldName
	    </if>
			FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS RejectList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<choose>
           			<when test='searchGroupType.equalsIgnoreCase("Date")'>RejectList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>RejectList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>RejectList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>RejectList.InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>RejectList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>RejectList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>RejectList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 반려함 엑셀 데이터 조회 -->
	<select id="selectStoreRejectListExcel" parameterType="cmap" resultType="cmap">
			SELECT RejectList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.FormPrefix
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, A.SubKind AS FormSubKind
					, C.*
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="companyCode != null and companyCode != '' ">
					INNER JOIN COVI_SMART4J.sys_object_group AS SOG  ON SOG.GroupCode = B.InitiatorUnitID
				</if>				
				WHERE ((A.UserCode = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					<if test="userID != null and userID != '' ">
						OR (A.DeputyID = #{userID} AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021'))
					</if>
				)
				AND A.SubKind IN ('T000','T004','T005','T006','T008','T009','T011','T016','T017','T018','T109','T020','T021')
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				AND A.PIBusinessState = '02_02'
				<if test="companyCode != null and companyCode != '' ">
					AND SOG.CompanyCode = #{companyCode}
					AND SOG.GroupType = 'Dept'
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS RejectList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>endDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
	<!-- 참조/회람함 목록 데이터 -->
	<select id="selectStoreTCInfoList" parameterType="cmap" resultType="cmap">
			SELECT TCInfoList.* FROM (
				SELECT 	  A.*
						, A.kind AS FormSubKind
						, A.kind AS SubKind
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.InitiatedDate
						, B.DocNo
						, B.BodyContextOrg
						, C.FormID
						, C.FormName
						, C.FormPrefix
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
						, F.ExtInfo
						, U.PhotoPath
						, D.BusinessData1
						, D.BusinessData2
						, D.BusinessData3
						, D.BusinessData4
						, D.BusinessData5
						, D.BusinessData6
						, D.BusinessData7
						, D.BusinessData8
						, D.BusinessData9
						, D.BusinessData10
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<choose>
					<when test="DBName == 'COVI_APPROVAL4J_STORE'">
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON D.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
					</when>
					<otherwise>
						INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
					</otherwise>
				</choose>
				WHERE A.State = 'C'
				<if test="adminYn == null or adminYn == '' ">
					AND B.DeletedDate IS NULL
				</if>
				AND A.ReceiptType = 'P'
				AND A.ReceiptID = #{userID}
				AND A.DataState != 'D'
				<if test="companyCode != null and companyCode != '' ">
					AND B.EntCode = #{companyCode}
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS TCInfoList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		     <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise> RegDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 참조/회람함 목록 개수 데이터 -->
	<select id="selectStoreTCInfoListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT A.*
						, A.kind AS SubKind
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.InitiatedDate
						, B.DocNo
						, B.BodyContextOrg
						, C.FormPrefix
						, C.FormID
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				<choose>
					<when test="DBName == 'COVI_APPROVAL4J_STORE'">
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON D.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
					</when>
					<otherwise>
						INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
					</otherwise>
				</choose>	
				WHERE A.State = 'C'
				<if test="adminYn == null or adminYn == '' ">
					AND B.DeletedDate IS NULL
				</if>
				AND A.ReceiptType = 'P'
				AND A.ReceiptID = #{userID}
				AND A.DataState != 'D'
				<if test="companyCode != null and companyCode != '' ">
					AND B.EntCode = #{companyCode}
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

			) AS TCInfoList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 참조/회람함 그룹별 목록 조회 -->
	<select id="selectStoreTCInfoGroupList" parameterType="cmap" resultType="cmap">
		SELECT
			<choose>
				<when test='searchGroupType.equalsIgnoreCase("Date")'>TCInfoList.Date </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>TCInfoList.InitiatorID </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>TCInfoList.InitiatorUnitID </when>
				<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>TCInfoList.InitiatorUnitName </when>
				<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>TCInfoList.FormPrefix </when>
				<when test='searchGroupType.equalsIgnoreCase("FormName")'>TCInfoList.FormName </when>
				<when test='searchGroupType.equalsIgnoreCase("SubKind")'>TCInfoList.SubKind </when>
        	</choose>
			AS fieldID
			, COUNT(1) AS fieldCnt
		<if test="searchGroupType == 'Date'">
	        , TCInfoList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
	        , TCInfoList.FormName as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	        , TCInfoList.InitiatorName as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
	        , TCInfoList.InitiatorUnitName as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	        , TCInfoList.SubKind as fieldName
	    </if>
			FROM (
				SELECT 	  A.*
						, A.kind AS SubKind
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.FormID
						, B.BodyContextOrg
						<choose>
							<when test="searchGroupType == 'Date'">
								, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, A.RegDate),'%Y-%m-%d') AS `Date`
							</when>
							<otherwise>
								, DATE_FORMAT(A.RegDate,'%Y-%m-%d') AS `Date`
							</otherwise>
						</choose>
						, C.FormID AS BoxFormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
						, F.ExtInfo
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				<choose>
					<when test="DBName == 'COVI_APPROVAL4J_STORE'">
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON D.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
					</when>
					<otherwise>
						INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
					</otherwise>
				</choose>	
				WHERE A.State = 'C'
				AND B.DeletedDate IS NULL
				AND A.ReceiptType = 'P'
				AND A.ReceiptID = #{userID}
				AND A.DataState != 'D'
				<if test="companyCode != null and companyCode != '' ">
					AND B.EntCode = #{companyCode}
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS TCInfoList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> #{viewEndDate}
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<choose>
           			<when test='searchGroupType.equalsIgnoreCase("Date")'>TCInfoList.Date</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>TCInfoList.InitiatorID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>TCInfoList.InitiatorUnitID</when>
					<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>TCInfoList.InitiatorUnitName</when>
					<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>TCInfoList.FormPrefix</when>
					<when test='searchGroupType.equalsIgnoreCase("FormName")'>TCInfoList.FormName</when>
					<when test='searchGroupType.equalsIgnoreCase("SubKind")'>TCInfoList.SubKind</when>
           		</choose>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 참조함 엑셀 데이터 조회 -->
	<select id="selectStoreTCInfoListExcel" parameterType="cmap" resultType="cmap">
			SELECT TCInfoList.* FROM (
				SELECT 	  A.CirculationBoxID
					    , A.ProcessID
					    , A.CirculationBoxDescriptionID
					    , A.FormInstID
					    , A.ReceiptID
					    , A.ReceiptType
					    , A.ReceiptName
					    , A.ReceiptDate
						, A.Kind AS FormSubKind
						, A.Kind AS SubKind
					    , A.State
					    , A.ReadDate
					    , A.SenderID
					    , A.SenderName
					    , A.Subject
					    , A.Comment
					    , A.DataState
					    , A.RegID
					    , DATE_FORMAT(A.RegDate,'%Y-%m-%d %H:%i:%s') AS RegDate
					    , A.ModID
					    , A.ModDate
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.InitiatedDate
						, B.BodyContextOrg
						, B.DocNo
						, C.FormPrefix
						, C.FormID
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				<choose>
					<when test="DBName == 'COVI_APPROVAL4J_STORE'">
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON D.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
					</when>
					<otherwise>
						INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
					</otherwise>
				</choose>		
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID
				WHERE A.State = 'C'
				AND B.DeletedDate IS NULL
				AND A.ReceiptType = 'P'
				AND A.ReceiptID = #{userID}
				AND A.DataState != 'D'
				<if test="companyCode != null and companyCode != '' ">
					AND B.EntCode = #{companyCode}
				</if>				
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS TCInfoList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	            		<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							<when test='searchGroupType.equalsIgnoreCase("FormName")'>FormName</when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
	            		</choose>
	            		= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
	    		<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise> RegDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
	
	<!-- 문서분류함 목록 데이터 -->
	<select id="selectDocTypeList" parameterType="cmap" resultType="cmap">
		SELECT DocTypeList.* FROM (
			SELECT DISTINCT P.ProcessID
				, PD.*
				, P.InitiatorName
				, P.InitiatorID
				, P.InitiatorUnitID
				, P.InitiatorUnitName
				, P.EndDate 
			FROM covi_approval4j.jwf_forminstance FI
			INNER JOIN covi_approval4j.jwf_process P ON FI.FormInstID = P.FormInstID 
			INNER JOIN covi_approval4j.JWF_ProcessDescription PD ON P.ProcessDescriptionID = PD.ProcessDescriptionID 
			INNER JOIN covi_approval4j.jwf_workitem WI ON P.ProcessID = WI.ProcessID
			WHERE FI.DocClassID = #{docClassID}
			AND WI.Deleted IS NULL
			AND WI.PIDeleted IS NULL
			AND (
				(
					(WI.UserCode = #{userID} OR WI.DeputyID = #{userID})
					AND WI.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021')
					AND WI.PIBusinessState = '02_01'
				)
				OR (
					WI.UserCode = #{deptID}
					AND (WI.SubKind = 'A' OR (WI.SubKind IN ('REQCMP', 'AA') AND P.BusinessState LIKE '02_01%'))
					AND FI.FormInstID NOT IN (
						SELECT FI.FormInstID 
						FROM covi_approval4j.jwf_forminstance FI
						INNER JOIN covi_approval4j.jwf_process P ON FI.FormInstID = P.FormInstID 
						INNER JOIN covi_approval4j.jwf_workitem WI ON P.ProcessID = WI.ProcessID 
						WHERE FI.DocClassID = #{docClassID}
						AND WI.Deleted IS NULL
						AND WI.PIDeleted IS NULL
						AND (WI.UserCode = #{userID} OR WI.DeputyID = #{userID})
						AND WI.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021')
						AND WI.PIBusinessState = '02_01'
					)
				)
			)
		) AS DocTypeList
     	<!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
				<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>EndDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>
	
	<select id="selectDocTypeListCnt" resultType="java.lang.Long">
		SELECT COUNT(*) FROM (
			SELECT DISTINCT P.ProcessID
				, PD.*
				, P.InitiatorName
				, P.InitiatorID
				, P.InitiatorUnitID
				, P.InitiatorUnitName
				, P.EndDate 
			FROM covi_approval4j.jwf_forminstance FI
			INNER JOIN covi_approval4j.jwf_process P ON FI.FormInstID = P.FormInstID 
			INNER JOIN covi_approval4j.JWF_ProcessDescription PD ON P.ProcessDescriptionID = PD.ProcessDescriptionID 
			INNER JOIN covi_approval4j.jwf_workitem WI ON P.ProcessID = WI.ProcessID
			WHERE FI.DocClassID = #{docClassID}
			AND WI.Deleted IS NULL
			AND WI.PIDeleted IS NULL
			AND (
				(
					(WI.UserCode = #{userID} OR WI.DeputyID = #{userID})
					AND WI.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021')
					AND WI.PIBusinessState = '02_01'
				)
				OR (
					WI.UserCode = #{deptID}
					AND (WI.SubKind = 'A' OR (WI.SubKind IN ('REQCMP', 'AA') AND P.BusinessState LIKE '02_01%'))
					AND FI.FormInstID NOT IN (
						SELECT FI.FormInstID 
						FROM covi_approval4j.jwf_forminstance FI
						INNER JOIN covi_approval4j.jwf_process P ON FI.FormInstID = P.FormInstID 
						INNER JOIN covi_approval4j.jwf_workitem WI ON P.ProcessID = WI.ProcessID 
						WHERE FI.DocClassID = #{docClassID}
						AND WI.Deleted IS NULL
						AND WI.PIDeleted IS NULL
						AND (WI.UserCode = #{userID} OR WI.DeputyID = #{userID})
						AND WI.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021')
						AND WI.PIBusinessState = '02_01'
					)
				)
			)
		) AS DocTypeList
     	<!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</trim>
	</select>
	
	<!-- 문서분류함 엑셀 데이터 조회 -->
	<select id="selectDocTypeListExcel" parameterType="cmap" resultType="cmap">
		SELECT DocTypeList.* FROM (
			SELECT DISTINCT P.ProcessID
				, PD.*
				, P.InitiatorName
				, P.InitiatorID
				, P.InitiatorUnitID
				, P.InitiatorUnitName
				, P.EndDate 
			FROM covi_approval4j.jwf_forminstance FI
			INNER JOIN covi_approval4j.jwf_process P ON FI.FormInstID = P.FormInstID 
			INNER JOIN covi_approval4j.JWF_ProcessDescription PD ON P.ProcessDescriptionID = PD.ProcessDescriptionID 
			INNER JOIN covi_approval4j.jwf_workitem WI ON P.ProcessID = WI.ProcessID
			WHERE FI.DocClassID = #{docClassID}
			AND WI.Deleted IS NULL
			AND WI.PIDeleted IS NULL
			AND (
				(
					(WI.UserCode = #{userID} OR WI.DeputyID = #{userID})
					AND WI.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021')
					AND WI.PIBusinessState = '02_01'
				)
				OR (
					WI.UserCode = #{deptID}
					AND (WI.SubKind = 'A' OR (WI.SubKind IN ('REQCMP', 'AA') AND P.BusinessState LIKE '02_01%'))
					AND FI.FormInstID NOT IN (
						SELECT FI.FormInstID 
						FROM covi_approval4j.jwf_forminstance FI
						INNER JOIN covi_approval4j.jwf_process P ON FI.FormInstID = P.FormInstID 
						INNER JOIN covi_approval4j.jwf_workitem WI ON P.ProcessID = WI.ProcessID 
						WHERE FI.DocClassID = #{docClassID}
						AND WI.Deleted IS NULL
						AND WI.PIDeleted IS NULL
						AND (WI.UserCode = #{userID} OR WI.DeputyID = #{userID})
						AND WI.SubKind IN ('T000','T004','T005','T006','T009','T011','T016','T017','T018','T019','T020','T021')
						AND WI.PIBusinessState = '02_01'
					)
				)
			)
		) AS DocTypeList
     	<!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
	    		AND 
	    		<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
				</choose>
	    		LIKE CONCAT('%',#{searchWord},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	, 
				<choose>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<otherwise>EndDate</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
</mapper>