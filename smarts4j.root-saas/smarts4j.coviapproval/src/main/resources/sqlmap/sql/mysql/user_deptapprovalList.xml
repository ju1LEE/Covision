<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user.deptapprovalList">
    <!-- 완료함 목록 데이터 -->
	<select id="selectDeptDraftCompleteList" parameterType="cmap" resultType="cmap">
			SELECT DeptDraftCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID, C.FormID, C.FormPrefix, C.FormName, C.FormSubject, C.IsSecureDoc, C.IsFile, C.FileExt, C.IsComment, C.ApproverCode, C.ApproverName, C.ApprovalStep, C.ApproverSIPAddress, C.IsReserved, C.ReservedGubun, C.ReservedTime, C.Priority, C.IsModify
					, C.Reserved1, C.Reserved2, C.BusinessData1, C.BusinessData2, C.BusinessData3, C.BusinessData4, C.BusinessData5, C.BusinessData6, C.BusinessData7, C.BusinessData8, C.BusinessData9, C.BusinessData10, C.DocNo
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.EndDate
					, U.PhotoPath
					, F.ExtInfo
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON C.FormID = F.FormID 
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'A'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                     AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 완료함 목록 개수 데이터 -->
	<select id="selectDeptDraftCompleteListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID, C.FormID, C.FormPrefix, C.FormName, C.FormSubject, C.IsSecureDoc, C.IsFile, C.FileExt, C.IsComment, C.ApproverCode, C.ApproverName, C.ApprovalStep, C.ApproverSIPAddress, C.IsReserved, C.ReservedGubun, C.ReservedTime, C.Priority, C.IsModify
					, C.Reserved1, C.Reserved2, C.BusinessData1, C.BusinessData2, C.BusinessData3, C.BusinessData4, C.BusinessData5, C.BusinessData6, C.BusinessData7, C.BusinessData8, C.BusinessData9, C.BusinessData10, C.DocNo
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'A'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 완료함 그룹별 목록 조회 -->
	<select id="selectDeptDraftCompleteGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptDraftCompleteList.`Date` AS fieldID
			, COUNT(DeptDraftCompleteList.`Date`) AS fieldCnt
	        , DeptDraftCompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'"> <!-- 20210126 이관함 -->
	    	SELECT DeptDraftCompleteList.FormPrefix AS fieldID
			, COUNT(DeptDraftCompleteList.FormPrefix) AS fieldCnt
	        , MAX(DeptDraftCompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptDraftCompleteList.InitiatorID AS fieldID
			, COUNT(DeptDraftCompleteList.InitiatorID) AS fieldCnt
	        , MAX(DeptDraftCompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'"> <!-- 20210126 이관함 -->
	     	SELECT DeptDraftCompleteList.InitiatorUnitID AS fieldID
			, COUNT(DeptDraftCompleteList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptDraftCompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptDraftCompleteList.SubKind AS fieldID
			, COUNT(DeptDraftCompleteList.SubKind) AS fieldCnt
	        , MAX(DeptDraftCompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					, C.*
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'A'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> #{viewEndDate}
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
				<if test="searchGroupType == 'Date'">
			 		DeptDraftCompleteList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
		 	    	DeptDraftCompleteList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptDraftCompleteList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
			     	DeptDraftCompleteList.InitiatorUnitID
			    </if>	
			     <if test="searchGroupType == 'SubKind'">
			     	DeptDraftCompleteList.SubKind
			    </if>		 	
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 완료함 엑셀 데이터 조회 -->
	<select id="selectDeptDraftCompleteListExcel" parameterType="cmap" resultType="cmap">
	    <![CDATA[
			SELECT DeptDraftCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate
		]]>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'A'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

    <!-- 발신함 목록 데이터 -->
    <select id="selectDeptSenderCompleteList" parameterType="cmap" resultType="cmap">
			SELECT DeptSenderCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName					
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID, C.FormID, C.FormPrefix, C.FormName, C.FormSubject, C.IsSecureDoc, C.IsFile, C.FileExt, C.IsComment, C.ApproverCode, C.ApproverName, C.ApprovalStep, C.ApproverSIPAddress, C.IsReserved, C.ReservedGubun, C.ReservedTime, C.Priority, C.IsModify
					, C.Reserved1, C.Reserved2, C.BusinessData1, C.BusinessData2, C.BusinessData3, C.BusinessData4, C.BusinessData5, C.BusinessData6, C.BusinessData7, C.BusinessData8, C.BusinessData9, C.BusinessData10, C.DocNo
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.EndDate
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'S'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptSenderCompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 발신함 목록 개수 데이터 -->
	<select id="selectDeptSenderCompleteListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, C.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, C.FormInstID, C.FormID, C.FormPrefix, C.FormName, C.FormSubject, C.IsSecureDoc, C.IsFile, C.FileExt, C.IsComment, C.ApproverCode, C.ApproverName, C.ApprovalStep, C.ApproverSIPAddress, C.IsReserved, C.ReservedGubun, C.ReservedTime, C.Priority, C.IsModify
					, C.Reserved1, C.Reserved2, C.BusinessData1, C.BusinessData2, C.BusinessData3, C.BusinessData4, C.BusinessData5, C.BusinessData6, C.BusinessData7, C.BusinessData8, C.BusinessData9, C.BusinessData10, C.DocNo
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'S'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptSenderCompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 발신함 그룹별 목록 조회 -->
	<select id="selectDeptSenderCompleteGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptSenderCompleteList.`Date` AS fieldID
			, COUNT(DeptSenderCompleteList.`Date`) AS fieldCnt
	        , DeptSenderCompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	SELECT DeptSenderCompleteList.FormPrefix AS fieldID
			, COUNT(DeptSenderCompleteList.FormPrefix) AS fieldCnt
	        , MAX(DeptSenderCompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptSenderCompleteList.InitiatorID AS fieldID
			, COUNT(DeptSenderCompleteList.InitiatorID) AS fieldCnt
	        , MAX(DeptSenderCompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	SELECT DeptSenderCompleteList.InitiatorUnitID AS fieldID
			, COUNT(DeptSenderCompleteList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptSenderCompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptSenderCompleteList.SubKind AS fieldID
			, COUNT(DeptSenderCompleteList.SubKind) AS fieldCnt
	        , MAX(DeptSenderCompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'S'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptSenderCompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> #{viewEndDate}
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptSenderCompleteList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix'">
		 	    	DeptSenderCompleteList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptSenderCompleteList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	DeptSenderCompleteList.InitiatorUnitID
			    </if>
			     <if test="searchGroupType == 'SubKind'">
			     	DeptSenderCompleteList.SubKind
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 발신함 엑셀 데이터 조회 -->
	<select id="selectDeptSenderCompleteListExcel" parameterType="cmap" resultType="cmap">
	    <![CDATA[
			SELECT DeptSenderCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate 
		]]>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND A.SubKind = 'S'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptSenderCompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		  	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 수신함 목록 데이터 -->
	<select id="selectDeptReceiveList" parameterType="cmap" resultType="cmap">
			SELECT DeptReceiveList.* FROM (
				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, B.TaskID
					, C.SubKind
					, C.SubKind AS FormSubKind
					, C.UserCode
					, C.UserName
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, CASE B.State WHEN 288 THEN 'REDRAFT' ELSE 'COMPLETE' END AS MODE
					, B.Created
					, R.ReadDate
					, F.ExtInfo
					, U.PhotoPath
					, IFNULL(JF.SchemaContext, '') as SchemaContext
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J.jwf_docreadhistory AS R ON A.ProcessID = R.ProcessID AND R.UserID = #{userID} AND R.AdminYN = 'N' AND R.FormInstID > 0
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON D.FormID = F.FormID
				LEFT OUTER JOIN COVI_APPROVAL4J.jwf_formsschema AS JF ON F.SchemaID = JF.SchemaID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
		    <if test ="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
			    , Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
					<when test='sortColumn.equalsIgnoreCase("Created")'>Created</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 수신함 목록 개수 데이터 -->
	<select id="selectDeptReceiveListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, CASE B.State WHEN 288 THEN 'REDRAFT' ELSE 'COMPLETE' END AS MODE
					, B.Created
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 수신함 그룹별 목록 조회 -->
	<select id="selectDeptReceiveGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptReceiveList.`Date` AS fieldID
			, COUNT(DeptReceiveList.`Date`) AS fieldCnt
	        , DeptReceiveList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	SELECT DeptReceiveList.FormPrefix AS fieldID
			, COUNT(DeptReceiveList.FormPrefix) AS fieldCnt
	        , MAX(DeptReceiveList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptReceiveList.InitiatorID AS fieldID
			, COUNT(DeptReceiveList.InitiatorID) AS fieldCnt
	        , MAX(DeptReceiveList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	SELECT DeptReceiveList.InitiatorUnitID AS fieldID
			, COUNT(DeptReceiveList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptReceiveList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptReceiveList.SubKind AS fieldID
			, COUNT(DeptReceiveList.SubKind) AS fieldCnt
	        , MAX(DeptReceiveList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT A.ProcessID
						, B.WorkItemID
						, C.PerformerID
						, A.InitiatorID
						, A.InitiatorName
						, A.InitiatorUnitID
						, A.InitiatorUnitName
						, C.UserCode
						, C.UserName
						, C.SubKind
						, D.FormSubject as Subject
						, D.*
						<choose>
							<when test="searchGroupType == 'Date'">
								, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Created),'%Y-%m-%d') AS `Date`
							</when>
							<otherwise>
								, DATE_FORMAT(B.Created,'%Y-%m-%d') AS `Date`
							</otherwise>
						</choose>
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptReceiveList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix'">
		 	    	DeptReceiveList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptReceiveList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	DeptReceiveList.InitiatorUnitID
			    </if>
			     <if test="searchGroupType == 'SubKind'">
			     	DeptReceiveList.SubKind
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 수신함 엑셀 데이터 조회 -->
	<select id="selectDeptReceiveListExcel" parameterType="cmap" resultType="cmap">
			SELECT DeptReceiveList.* FROM (
				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.FormSubject as Subject
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, CASE B.State WHEN 288 THEN 'REDRAFT' ELSE 'COMPLETE' END AS MODE
					, DATE_FORMAT(B.Created,'%Y-%m-%d %H:%i:%s') AS Created
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 수신완료함(수신처리함) 목록 데이터 -->
	<select id="selectDeptReceiveCompleteList" parameterType="cmap" resultType="cmap">
			SELECT DeptReceiveCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, C.FormSubject as Subject
					, C.ProcessDescriptionID as ProcessDescriptionArchiveID
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, B.EndDate
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind IN ('REQCMP', 'AA')
				AND B.BusinessState LIKE '02_01%'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		 	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 수신완료함(수신처리함) 목록 개수 데이터 -->
	<select id="selectDeptReceiveCompleteListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind IN ('REQCMP', 'AA')
				AND B.BusinessState LIKE '02_01%'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 수신완료함 그룹별 목록 조회 -->
	<select id="selectDeptReceiveCompleteGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptReceiveCompleteList.`Date` AS fieldID
			, COUNT(DeptReceiveCompleteList.`Date`) AS fieldCnt
	        , DeptReceiveCompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	SELECT DeptReceiveCompleteList.FormPrefix AS fieldID
			, COUNT(DeptReceiveCompleteList.FormPrefix) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptReceiveCompleteList.InitiatorID AS fieldID
			, COUNT(DeptReceiveCompleteList.InitiatorID) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	SELECT DeptReceiveCompleteList.InitiatorUnitID AS fieldID
			, COUNT(DeptReceiveCompleteList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptReceiveCompleteList.SubKind AS fieldID
			, COUNT(DeptReceiveCompleteList.SubKind) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT	B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind IN ('REQCMP', 'AA')
				AND B.BusinessState LIKE '02_01%'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> #{viewEndDate}
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptReceiveCompleteList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix'">
		 	    	DeptReceiveCompleteList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptReceiveCompleteList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	DeptReceiveCompleteList.InitiatorUnitID
			    </if>
			     <if test="searchGroupType == 'SubKind'">
			     	DeptReceiveCompleteList.SubKind
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 수신완료함(수신처리함) 엑셀 데이터 조회 -->
	<select id="selectDeptReceiveCompleteListExcel" parameterType="cmap" resultType="cmap">
	    <![CDATA[
			SELECT DeptReceiveCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate ]]>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
					FROM COVI_APPROVAL4J.JWF_Workitem AS A
					INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
					INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind IN ('REQCMP', 'AA')
				AND B.BusinessState LIKE '02_01%'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND endDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND endDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		  	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 수신공람함 목록 데이터 -->
	<select id="selectDeptReceiveExhibitList" parameterType="cmap" resultType="cmap">
			SELECT DeptReceiveCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, C.FormSubject as Subject
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, B.EndDate
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND A.SubKind = 'RE'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		 	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 수신공람함 목록 개수 데이터 -->
	<select id="selectDeptReceiveExhibitListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessID AS ProcessArchiveID
						, A.PerformerID
						, A.WorkItemID AS WorkitemArchiveID
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'RE'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 수신공람함 그룹별 목록 조회 -->
	<select id="selectDeptReceiveExhibitGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptReceiveCompleteList.`Date` AS fieldID
			, COUNT(DeptReceiveCompleteList.`Date`) AS fieldCnt
	        , DeptReceiveCompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	SELECT DeptReceiveCompleteList.FormPrefix AS fieldID
			, COUNT(DeptReceiveCompleteList.FormPrefix) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptReceiveCompleteList.InitiatorID AS fieldID
			, COUNT(DeptReceiveCompleteList.InitiatorID) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	SELECT DeptReceiveCompleteList.InitiatorUnitID AS fieldID
			, COUNT(DeptReceiveCompleteList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptReceiveCompleteList.SubKind AS fieldID
			, COUNT(DeptReceiveCompleteList.SubKind) AS fieldCnt
	        , MAX(DeptReceiveCompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT	B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, C.*
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND A.SubKind = 'RE'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptReceiveCompleteList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix'">
		 	    	DeptReceiveCompleteList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptReceiveCompleteList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	DeptReceiveCompleteList.InitiatorUnitID
			    </if>
			     <if test="searchGroupType == 'SubKind'">
			     	DeptReceiveCompleteList.SubKind
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 수신공람함 엑셀 데이터 조회 -->
	<select id="selectDeptReceiveExhibitListExcel" parameterType="cmap" resultType="cmap">
	    <![CDATA[
			SELECT DeptReceiveCompleteList.* FROM (
				SELECT B.ProcessID AS ProcessArchiveID
					, A.PerformerID
					, A.WorkItemID AS WorkitemArchiveID
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, A.UserCode
					, A.UserName
					, A.SubKind
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate ]]>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J.JWF_Workitem AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Process AS B ON B.ProcessID = A.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS C ON B.ProcessDescriptionID = C.ProcessDescriptionID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND B.ProcessState = 528
				AND A.SubKind = 'RE'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveCompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind</when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		  	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 참조/회람 목록 데이터 -->
	<select id="selectDeptTCInfoList" parameterType="cmap" resultType="cmap">
			SELECT DeptTCInfoList.* FROM (
					SELECT
						 A.CirculationBoxID
					   , A.ProcessID
					   , A.CirculationBoxDescriptionID
					   , A.FormInstID
					   , A.ReceiptID
					   , A.ReceiptType
					   , A.ReceiptName
					   , A.ReceiptDate
					   , A.Kind AS SubKind
					   , A.Kind AS FormSubKind
					   , A.State
					   , A.ReadDate
					   , A.SenderID
					   , A.SenderName
					   , A.Subject
					   , A.Comment
					   , A.DataState
					   , A.RegID
					   , A.RegDate
					   , A.ModID
					   , A.ModDate
					   , B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.InitiatedDate
						, B.DocNo
						, B.BodyContextOrg
						, C.FormID AS FormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
						<choose>
			                <when test="DBName == 'COVI_APPROVAL4J' ">
			                    ,(CASE
									WHEN D.UserCode IS NOT NULL
										THEN 'Y'
									ELSE 'N'
								END) AS ReadCheck
			                </when>
			                <otherwise>
			                    , 'Y' AS ReadCheck
			                </otherwise>
			            </choose>
						, F.ExtInfo
						, U.PhotoPath
						, E.BusinessData1
						, E.BusinessData2
						, E.BusinessData3
						, E.BusinessData4
						, E.BusinessData5
						, E.BusinessData6
						, E.BusinessData7
						, E.BusinessData8
						, E.BusinessData9
						, E.BusinessData10
					FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					<if test="DBName == 'COVI_APPROVAL4J' ">
						LEFT OUTER JOIN COVI_APPROVAL4J.jwf_circulationread AS D ON A.CirculationBoxID = D.CirculationBoxID AND D.UserCode = #{userID}
					</if>
					LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON B.FormID = F.FormID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS E ON B.FormInstID = E.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON E.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
					WHERE A.State = 'C'
					<if test="adminYn == null or adminYn == '' ">
						AND B.DeletedDate IS NULL
					</if>
					AND A.ReceiptType = 'U'
					AND A.ReceiptID =  #{deptID}
					<if test='requestType != null and requestType.equalsIgnoreCase("DocList")'>AND P.BusinessState like '02_01%'</if>
					AND A.DataState != 'D'
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (E.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR E.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND E.BusinessData1 = #{businessData1}
						</when>
					</choose>
			) AS DeptTCInfoList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatedDate")'>InitiatedDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 참조/회람함 목록 개수 데이터 -->
	<select id="selectDeptTCInfoListCnt" resultType="java.lang.Long">
		SELECT COUNT(*) FROM (
				SELECT A.CirculationBoxID
				   , A.ProcessID
				   , A.CirculationBoxDescriptionID
				   , A.FormInstID
				   , A.ReceiptID
				   , A.ReceiptType
				   , A.ReceiptName
				   , A.ReceiptDate
				   , A.Kind AS SubKind
				   , A.State
				   , A.ReadDate
				   , A.SenderID
				   , A.SenderName
				   , A.Subject
				   , A.Comment
				   , A.DataState
				   , A.RegID
				   , A.RegDate
				   , A.ModID
				   , A.ModDate
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.InitiatedDate
					, B.DocNo
					, B.BodyContextOrg
					, C.FormID AS FormID
					, C.FormPrefix
					, C.FormName
					, C.FormSubject
					, C.IsSecureDoc
					, C.IsFile
					, C.FileExt
					, C.IsComment
					, C.ApproverCode
					, C.ApproverName
					, C.ApprovalStep
					, C.ApproverSIPAddress
					, C.IsReserved
					, C.ReservedGubun
					, C.ReservedTime
					, C.Priority
					, C.IsModify
					, C.Reserved1
					, C.Reserved2
				FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
				INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
				WHERE A.State = 'C'
				<if test="adminYn == null or adminYn == '' ">
					AND B.DeletedDate IS NULL
				</if>
				AND A.ReceiptType = 'U'
				AND A.ReceiptID =  #{deptID}
				<if test='requestType != null and requestType.equalsIgnoreCase("DocList")'>AND P.BusinessState like '02_01%'</if>
				AND A.DataState != 'D'
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
		) AS DeptTCInfoList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 참조/회람함 그룹별 목록 조회 -->
	<select id="selectDeptTCInfoGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptTCInfoList.`Date` AS fieldID
			, COUNT(DeptTCInfoList.`Date`) AS fieldCnt
	        , DeptTCInfoList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'"> <!-- 20210126 이관함 -->
	    	SELECT DeptTCInfoList.FormPrefix AS fieldID
			, COUNT(DeptTCInfoList.FormPrefix) AS fieldCnt
	        , MAX(DeptTCInfoList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptTCInfoList.InitiatorID AS fieldID
			, COUNT(DeptTCInfoList.InitiatorID) AS fieldCnt
	        , MAX(DeptTCInfoList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'"> <!-- 20210126 이관함 -->
	     	SELECT DeptTCInfoList.InitiatorUnitID AS fieldID
			, COUNT(DeptTCInfoList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptTCInfoList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptTCInfoList.SubKind AS fieldID
			, COUNT(DeptTCInfoList.SubKind) AS fieldCnt
	        , MAX(DeptTCInfoList.SubKind) as fieldName
	    </if>
			FROM (
					SELECT 	  A.*
						, A.Kind AS SubKind
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.BodyContextOrg
						, B.DocNo
						, C.FormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						<choose>
							<when test="searchGroupType == 'Date'">
								, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, A.RegDate),'%Y-%m-%d') AS `Date`
							</when>
							<otherwise>
								, DATE_FORMAT(A.RegDate,'%Y-%m-%d') AS `Date`
							</otherwise>
						</choose>
					FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
					WHERE A.State = 'C'
					AND B.DeletedDate IS NULL
					AND A.ReceiptType = 'U'
					AND A.ReceiptID =  #{deptID}
					AND A.DataState != 'D'
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
			) AS DeptTCInfoList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> #{viewEndDate}
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptTCInfoList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
		 	    	DeptTCInfoList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptTCInfoList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
			     	DeptTCInfoList.InitiatorUnitID
			    </if>	
			     <if test="searchGroupType == 'SubKind'">
			     	DeptTCInfoList.SubKind
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 참조/회람함 엑셀 데이터 조회 -->
	<select id="selectDeptTCInfoListExcel" parameterType="cmap" resultType="cmap">
			SELECT DeptTCInfoList.* FROM (
					SELECT  A.CirculationBoxID
					    , A.ProcessID
					    , A.CirculationBoxDescriptionID
					    , A.FormInstID
					    , A.ReceiptID
					    , A.ReceiptType
					    , A.ReceiptName
					    , A.ReceiptDate
					    , A.Kind AS SubKind
					    , A.State
					    , A.ReadDate
					    , A.SenderID
					    , A.SenderName
					    , A.Subject
					    , A.Comment
					    , A.DataState
					    , A.RegID
					    , DATE_FORMAT(A.RegDate,'%Y-%m-%d %H:%i:%s') AS RegDate
					    , A.ModID
					    , A.ModDate
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.InitiatedDate
						, B.BodyContextOrg
						, B.DocNo
						, C.FormID AS FormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
					FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
					WHERE A.State = 'C'
					AND B.DeletedDate IS NULL
					AND A.ReceiptType = 'U'
					AND A.ReceiptID =  #{deptID}
					AND A.DataState != 'D'
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
			) AS DeptTCInfoList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			   <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		  	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<!-- 진행함 목록 데이터 -->
	<select id="selectDeptReceiveProcessList" parameterType="cmap" resultType="cmap">
			SELECT DeptReceiveProcessList.* FROM (
				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.SubKind AS FormSubKind
					, C.UserCode
					, C.UserName
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, B.Created
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
					, U.PhotoPath
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				UNION ALL

				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.SubKind AS FormSubKind
					, C.UserCode
					, C.UserName
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, B.Created
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
					, U.PhotoPath
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = A.InitiatorID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('T008')
				AND B.Name IN ('ReceiptBox', 'CoordiReceiptBox')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveProcessList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
					<when test='sortColumn.equalsIgnoreCase("Created")'>Created</when>
					<when test='sortColumn.equalsIgnoreCase("UserName")'>UserName</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 진행함 목록 개수 데이터 -->
	<select id="selectDeptReceiveProcessListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, B.Created
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				UNION ALL

				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, B.Created
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('T008')
				AND B.Name IN ('ReceiptBox', 'CoordiReceiptBox')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveProcessList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 진행함 그룹별 목록 조회 -->
	<select id="selectDeptReceiveProcessGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptReceiveProcessList.`Date` AS fieldID
			, COUNT(DeptReceiveProcessList.`Date`) AS fieldCnt
	        , DeptReceiveProcessList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	SELECT DeptReceiveProcessList.FormPrefix AS fieldID
			, COUNT(DeptReceiveProcessList.FormPrefix) AS fieldCnt
	        , MAX(DeptReceiveProcessList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptReceiveProcessList.InitiatorID AS fieldID
			, COUNT(DeptReceiveProcessList.InitiatorID) AS fieldCnt
	        , MAX(DeptReceiveProcessList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	SELECT DeptReceiveProcessList.InitiatorUnitID AS fieldID
			, COUNT(DeptReceiveProcessList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptReceiveProcessList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptReceiveProcessList.SubKind AS fieldID
			, COUNT(DeptReceiveProcessList.SubKind) AS fieldCnt
	        , MAX(DeptReceiveProcessList.SubKind) as fieldName
	    </if>
			FROM (
			SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.FormSubject as Subject
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Created),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.Created,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				UNION ALL

				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.FormSubject as Subject
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.Created),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.Created,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('T008')
				AND B.Name IN ('ReceiptBox', 'CoordiReceiptBox')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveProcessList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptReceiveProcessList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix'">
		 	    	DeptReceiveProcessList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptReceiveProcessList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	DeptReceiveProcessList.InitiatorUnitID
			    </if>	
			     <if test="searchGroupType == 'SubKind'">
			     	DeptReceiveProcessList.SubKind
			    </if>	
			</if>

		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 진행함 엑셀 데이터 조회 -->
	<select id="selectDeptReceiveProcessListExcel" parameterType="cmap" resultType="cmap">
			SELECT DeptReceiveProcessList.* FROM (
				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.FormSubject as Subject
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, DATE_FORMAT(B.Created,'%Y-%m-%d %H:%i:%s') AS Created
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 528
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>

				UNION ALL

				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.UserCode
					, C.UserName
					, D.FormSubject as Subject
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, B.Created
					, CASE B.STATE WHEN 288 THEN 'REDRAFT' ELSE 'PROCESS' END AS Mode
					, B.Charge
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('T008')
				AND B.Name IN ('ReceiptBox', 'CoordiReceiptBox')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				AND A.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveProcessList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   Created BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
		    <if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

	<select id="selectDeptProcessNotDocReadCnt" resultType="java.lang.Long">
	    SELECT COUNT(DeptReceiveList.FormInstID) FROM (
				SELECT A.ProcessID
					, B.WorkItemID
					, C.PerformerID
					, C.SubKind
					, C.SubKind AS FormSubKind
					, C.UserCode
					, C.UserName
					, D.*
					, A.InitiatorName
					, A.InitiatorID
					, A.InitiatorUnitID
					, A.InitiatorUnitName
					, CASE B.State WHEN 288 THEN 'REDRAFT' ELSE 'COMPLETE' END AS MODE
					, B.Created
				FROM COVI_APPROVAL4J.JWF_Process AS A
				INNER JOIN COVI_APPROVAL4J.JWF_Workitem AS B ON A.ProcessID = B.ProcessID
				INNER JOIN COVI_APPROVAL4J.JWF_Performer AS C ON B.WorkItemID = C.WorkItemID
				INNER JOIN COVI_APPROVAL4J.JWF_ProcessDescription AS D ON A.ProcessDescriptionID = D.ProcessDescriptionID
				WHERE C.UserCode = #{deptID}
				AND C.SubKind IN ('R', 'C', 'AD', 'AS', 'AE')
				AND C.State = 1
				AND B.State = 288
				AND A.ProcessState = 288
				<if test="adminYn == null or adminYn == '' ">
					AND A.DeleteDate IS NULL
				</if>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptReceiveList
		WHERE
				1=1
		AND NOT EXISTS (
							SELECT
									DISTINCT R.FormInstID
							FROM
									covi_approval4j.jwf_docreadhistory R
									INNER JOIN covi_approval4j.jwf_forminstance FI ON R.FormInstID = FI.FormInstID
							WHERE 1=1
							AND AdminYN = 'N'
							AND UserID = #{userID}
							AND DeptReceiveList.FormInstID = R.FormInstID
						)
	</select>

	<select id="selectDeptTCInfoNotDocReadCnt" resultType="java.lang.Long">
		SELECT count(*)
		FROM (
			SELECT A.CirculationBoxID
			FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
			INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
			INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
			LEFT OUTER JOIN COVI_APPROVAL4J.jwf_circulationread AS D ON A.CirculationBoxID = D.CirculationBoxID AND D.UserCode = #{userID}
			INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS E ON B.FormInstID = E.FormInstID
			INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON E.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0
			WHERE A.State = 'C'
			AND A.ReceiptType = 'U'
			AND A.ReceiptID =  #{deptID}
			AND A.DataState != 'D'
			AND D.UserCode IS NULL
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (E.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR E.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND E.BusinessData1 = #{businessData1}
				</when>
			</choose>
		) AA
	</select>
	
	<select id="selectDeptTCInfoSingleDocRead" resultType="java.lang.Long">
	    SELECT COUNT(C.UserCode)
	    FROM (
			SELECT A.CirculationBoxID
			FROM COVI_APPROVAL4J.JWF_CirculationBox AS A
			INNER JOIN COVI_APPROVAL4J.JWF_CirculationBoxDescription AS B ON A.CirculationBoxDescriptionID = B.CirculationBoxDescriptionID
			LEFT OUTER JOIN COVI_APPROVAL4J.jwf_circulationread AS C ON A.CirculationBoxID = C.CirculationBoxID AND C.UserCode = #{userID}
			INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
			INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
			WHERE A.State = 'C'
			AND A.ReceiptType = 'U'
			AND A.ReceiptID = #{deptID}
			AND A.DataState != 'D'
	 		AND A.ProcessID = #{ProcessID}
	 		AND A.FormInstID = #{FormInstID}
	 		<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (D.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR D.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND D.BusinessData1 = #{businessData1}
				</when>
			</choose>
		) AA
	</select>
	
	<!-- 부서결재함- 특정부서 부서조회-->
	<select id="selectDeptDirectorAllCount" parameterType="cmap" resultType="int">
		<![CDATA[
	    SELECT COUNT(*) AS CNT FROM (
			SELECT b.UnitName,b.UnitCode
			FROM covi_approval4j.JWF_DIRECTOR A LEFT OUTER JOIN covi_approval4j.JWF_DIRECTORMEMBER B
			ON A.USERCODE = B.USERCODE
			WHERE	A.UserCode = #{UserCode}
			AND	A.EntCode IN ('ORGROOT', #{EntCode})
			AND ((A.AuthEndDate IS NULL OR A.AuthEndDate = '00:00:00') OR (A.AuthStartDate  <= DATE_FORMAT(sysdate(), '%Y-%m-%d') AND A.AuthEndDate  >= DATE_FORMAT(sysdate(), '%Y-%m-%d')))
			
			UNION
							
			SELECT B.TargetUnitName AS UnitName,B.TargetUnitCode AS UnitCode
			FROM covi_approval4j.jwf_unitdirector A LEFT OUTER JOIN covi_approval4j.jwf_unitdirectormember B
			ON A.UnitCode = B.UnitCode
			WHERE	A.UnitCode = #{UnitCode}
			AND	A.EntCode IN ('ORGROOT', #{EntCode})
			AND ((A.AuthEndDate IS NULL OR A.AuthEndDate = '00:00:00') OR (A.AuthStartDate  <= DATE_FORMAT(sysdate(), '%Y-%m-%d') AND A.AuthEndDate  >= DATE_FORMAT(sysdate(), '%Y-%m-%d')))
		) AS A
		]]>
	</select>
	
	<select id="selectDeptDirector" parameterType="cmap" resultType="cmap">
	    <![CDATA[
			SELECT
					B.UnitName
					,B.UnitCode
					,DATE_FORMAT(B.ViewStartDate,'%Y-%m-%d') AS ViewStartDate
					,DATE_FORMAT(B.ViewEndDate,'%Y-%m-%d') AS ViewEndDate
			FROM covi_approval4j.JWF_DIRECTOR A
			LEFT OUTER JOIN covi_approval4j.JWF_DIRECTORMEMBER B ON A.USERCODE = B.USERCODE
			WHERE	A.UserCode = #{UserCode}
			AND	A.EntCode IN ('ORGROOT', #{EntCode})
			AND ((A.AuthEndDate IS NULL OR A.AuthEndDate = '00:00:00') OR (A.AuthStartDate  <= DATE_FORMAT(sysdate(), '%Y-%m-%d') AND A.AuthEndDate  >= DATE_FORMAT(sysdate(), '%Y-%m-%d')))
	    ]]>
	</select>
	
	<select id="selectDeptUnitDirector" parameterType="cmap" resultType="cmap">
	    <![CDATA[
		    SELECT
					B.TargetUnitName AS UnitName
					,B.TargetUnitCode AS UnitCode
					,DATE_FORMAT(B.ViewStartDate,'%Y-%m-%d') AS ViewStartDate
					,DATE_FORMAT(B.ViewEndDate,'%Y-%m-%d') AS ViewEndDate
			FROM covi_approval4j.jwf_unitdirector A
			LEFT OUTER JOIN covi_approval4j.jwf_unitdirectormember B ON A.UnitCode = B.UnitCode
			WHERE	A.UnitCode = #{UnitCode}
			AND A.EntCode IN ('ORGROOT', #{EntCode})
			AND ((A.AuthEndDate IS NULL OR A.AuthEndDate = '00:00:00') OR (A.AuthStartDate  <= DATE_FORMAT(sysdate(), '%Y-%m-%d') AND A.AuthEndDate  >= DATE_FORMAT(sysdate(), '%Y-%m-%d')))
		 ]]>
	</select>
    <!-- 완료함 목록 데이터 -->
	<select id="selectStoreDeptDraftCompleteList" parameterType="cmap" resultType="cmap">
			SELECT DeptDraftCompleteList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, B.FormPrefix
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.EndDate
					, U.PhotoPath
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND A.SubKind = 'A'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 완료함 목록 개수 데이터 -->
	<select id="selectStoreDeptDraftCompleteListCnt" resultType="java.lang.Long">
			SELECT COUNT(*) FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, B.FormPrefix
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.EndDate
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND A.SubKind = 'A'
				<if test="adminYn == null or adminYn == '' ">
					AND A.Deleted IS NULL
				</if>
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 완료함 그룹별 목록 조회 -->
	<select id="selectStoreDeptDraftCompleteGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptDraftCompleteList.`Date` AS fieldID
			, COUNT(DeptDraftCompleteList.`Date`) AS fieldCnt
	        , DeptDraftCompleteList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'"> <!-- 20210126 이관함 -->
	    	SELECT DeptDraftCompleteList.FormPrefix AS fieldID
			, COUNT(DeptDraftCompleteList.FormPrefix) AS fieldCnt
	        , MAX(DeptDraftCompleteList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptDraftCompleteList.InitiatorID AS fieldID
			, COUNT(DeptDraftCompleteList.InitiatorID) AS fieldCnt
	        , MAX(DeptDraftCompleteList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'"> <!-- 20210126 이관함 -->
	     	SELECT DeptDraftCompleteList.InitiatorUnitID AS fieldID
			, COUNT(DeptDraftCompleteList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptDraftCompleteList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptDraftCompleteList.SubKind AS fieldID
			, COUNT(DeptDraftCompleteList.SubKind) AS fieldCnt
	        , MAX(DeptDraftCompleteList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.FormPrefix
					, A.UserCode
					, A.UserName
					, A.SubKind
					<choose>
						<when test="searchGroupType == 'Date'">
							, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, B.EndDate),'%Y-%m-%d') AS `Date`
						</when>
						<otherwise>
							, DATE_FORMAT(B.EndDate,'%Y-%m-%d') AS `Date`
						</otherwise>
					</choose>
					, C.*
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND A.SubKind = 'A'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptDraftCompleteList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
		 	    	DeptDraftCompleteList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptDraftCompleteList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
			     	DeptDraftCompleteList.InitiatorUnitID
			    </if>
			     <if test="searchGroupType == 'SubKind'">
			     	DeptDraftCompleteList.SubKind
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 완료함 엑셀 데이터 조회 -->
	<select id="selectStoreDeptDraftCompleteListExcel" parameterType="cmap" resultType="cmap">
	    <![CDATA[
			SELECT DeptDraftCompleteList.* FROM (
				SELECT B.ProcessArchiveID
					, A.PerformerID
					, A.WorkitemArchiveID
					, A.SubKind
					, A.UserCode
					, A.UserName
					, B.FormPrefix
					, C.*
					, B.InitiatorName
					, B.InitiatorID
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, DATE_FORMAT(B.EndDate,'%Y-%m-%d %H:%i:%s') AS EndDate ]]>
					<if test="searchType != null and searchType == 'BodyContextOrg' ">
						, D.BodyContextOrg
					</if>
				FROM COVI_APPROVAL4J_STORE.JWF_WorkitemArchive AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessArchive AS B ON B.ProcessArchiveID = A.ProcessArchiveID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_ProcessDescriptionArchive AS C ON B.ProcessDescriptionArchiveID = C.ProcessDescriptionArchiveID
				<if test="searchType != null and searchType == 'BodyContextOrg' ">
					INNER JOIN COVI_APPROVAL4J.JWF_FormInstance AS D ON B.FormInstID = D.FormInstID
				</if>
				WHERE A.UserCode = #{deptID}
				AND A.SubKind = 'A'
				AND A.Deleted IS NULL
				AND A.PIDeleted IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (C.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR C.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND C.BusinessData1 = #{businessData1}
					</when>
				</choose>
			) AS DeptDraftCompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   endDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	 </if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND endDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                     AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , endDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
			<!-- 참조/회람 목록 데이터 -->
	<select id="selectStoreDeptTCInfoList" parameterType="cmap" resultType="cmap">
			SELECT DeptTCInfoList.* FROM (
				SELECT
					 A.CirculationBoxID
				   , A.ProcessID
				   , A.CirculationBoxDescriptionID
				   , A.FormInstID
				   , A.ReceiptID
				   , A.ReceiptType
				   , A.ReceiptName
				   , A.ReceiptDate
				   , A.Kind AS SubKind
				   , A.Kind AS FormSubKind
				   , A.State
				   , A.ReadDate
				   , A.SenderID
				   , A.SenderName
				   , A.Subject
				   , A.Comment
				   , A.DataState
				   , A.RegID
				   , A.RegDate
				   , A.ModID
				   , A.ModDate
				   , B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.InitiatedDate
					, B.DocNo
					, B.BodyContextOrg
					, C.FormID AS FormID
					, C.FormPrefix
					, C.FormName
					, C.FormSubject
					, C.IsSecureDoc
					, C.IsFile
					, C.FileExt
					, C.IsComment
					, C.ApproverCode
					, C.ApproverName
					, C.ApprovalStep
					, C.ApproverSIPAddress
					, C.IsReserved
					, C.ReservedGubun
					, C.ReservedTime
					, C.Priority
					, C.IsModify
					, C.Reserved1
					, C.Reserved2
                    ,(CASE
						WHEN D.UserCode IS NOT NULL
							THEN 'Y'
						ELSE 'N'
					END) AS ReadCheck
					, F.ExtInfo
					, U.PhotoPath
					, E.BusinessData1
					, E.BusinessData2
					, E.BusinessData3
					, E.BusinessData4
					, E.BusinessData5
					, E.BusinessData6
					, E.BusinessData7
					, E.BusinessData8
					, E.BusinessData9
					, E.BusinessData10
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				LEFT OUTER JOIN COVI_APPROVAL4J_STORE.jwf_circulationread AS D ON A.CirculationBoxID = D.CirculationBoxID AND D.UserCode = #{userID}
				LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON B.FormID = F.FormID
				LEFT OUTER JOIN COVI_SMART4J.sys_object_user AS U ON U.UserCode = B.InitiatorID
				<choose>
					<when test="DBName == 'COVI_APPROVAL4J_STORE'">
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS E ON B.FormInstID = E.FormInstID
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON E.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
					</when>
					<otherwise>
						INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS E ON B.FormInstID = E.FormInstID
						INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON E.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
					</otherwise>
				</choose>
				WHERE A.State = 'C'
				<if test="adminYn == null or adminYn == '' ">
					AND B.DeletedDate IS NULL
				</if>
				AND A.ReceiptType = 'U'
				AND A.ReceiptID =  #{deptID}
				AND A.DataState != 'D'
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (E.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR E.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND E.BusinessData1 = #{businessData1}
					</when>
				</choose>
				
				<!-- Store는 Union ALL X -->
				<if test="DBName != 'COVI_APPROVAL4J_STORE'">
					UNION ALL
					
					SELECT
						 A.CirculationBoxID
					   , A.ProcessID
					   , A.CirculationBoxDescriptionID
					   , A.FormInstID
					   , A.ReceiptID
					   , A.ReceiptType
					   , A.ReceiptName
					   , A.ReceiptDate
					   , A.Kind AS SubKind
					   , A.Kind AS FormSubKind
					   , A.State
					   , A.ReadDate
					   , A.SenderID
					   , A.SenderName
					   , A.Subject
					   , A.Comment
					   , A.DataState
					   , A.RegID
					   , A.RegDate
					   , A.ModID
					   , A.ModDate
					   , B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.InitiatedDate
						, B.DocNo
						, B.BodyContextOrg
						, C.FormID AS FormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
	                    ,(CASE
							WHEN D.UserCode IS NOT NULL
								THEN 'Y'
							ELSE 'N'
						END) AS ReadCheck
						, F.ExtInfo
						, E.BusinessData1
						, E.BusinessData2
						, E.BusinessData3
						, E.BusinessData4
						, E.BusinessData5
						, E.BusinessData6
						, E.BusinessData7
						, E.BusinessData8
						, E.BusinessData9
						, E.BusinessData10
					FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					LEFT OUTER JOIN COVI_APPROVAL4J_STORE.jwf_circulationread AS D ON A.CirculationBoxID = D.CirculationBoxID AND D.UserCode = #{userID}
					LEFT OUTER JOIN COVI_APPROVAL4J.JWF_Forms AS F ON B.FormID = F.FormID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS E ON B.FormInstID = E.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON E.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = 528
					WHERE A.State = 'C'
					<if test="adminYn == null or adminYn == '' ">
						AND B.DeletedDate IS NULL
					</if>
					AND A.ReceiptType = 'U'
					AND A.ReceiptID =  #{deptID}
					AND A.DataState != 'D'
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (E.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR E.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND E.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS DeptTCInfoList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatedDate")'>InitiatedDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		 <!-- paging query
	    	LIMIT {가져오는 로우수} OFFSET {몇번째 로우부터인지}
	     -->
	    <if test="pageSize != null and pageOffset != null">
	   		LIMIT #{pageSize} OFFSET #{pageOffset}
	   	</if>
	</select>

    <!-- 참조/회람함 목록 개수 데이터 -->
	<select id="selectStoreDeptTCInfoListCnt" resultType="java.lang.Long">
		SELECT COUNT(*) FROM (
			SELECT A.CirculationBoxID
				   , A.ProcessID
				   , A.CirculationBoxDescriptionID
				   , A.FormInstID
				   , A.ReceiptID
				   , A.ReceiptType
				   , A.ReceiptName
				   , A.ReceiptDate
				   , A.Kind AS SubKind
				   , A.State
				   , A.ReadDate
				   , A.SenderID
				   , A.SenderName
				   , A.Subject
				   , A.Comment
				   , A.DataState
				   , A.RegID
				   , A.RegDate
				   , A.ModID
				   , A.ModDate
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.InitiatedDate
					, B.DocNo
					, B.BodyContextOrg
					, C.FormID AS FormID
					, C.FormPrefix
					, C.FormName
					, C.FormSubject
					, C.IsSecureDoc
					, C.IsFile
					, C.FileExt
					, C.IsComment
					, C.ApproverCode
					, C.ApproverName
					, C.ApprovalStep
					, C.ApproverSIPAddress
					, C.IsReserved
					, C.ReservedGubun
					, C.ReservedTime
					, C.Priority
					, C.IsModify
					, C.Reserved1
					, C.Reserved2
			FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
			INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
			INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
			<choose>
				<when test="DBName == 'COVI_APPROVAL4J_STORE'">
					INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON D.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
				</when>
				<otherwise>
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
				</otherwise>
			</choose>
			WHERE A.State = 'C'
			<if test="adminYn == null or adminYn == '' ">
				AND B.DeletedDate IS NULL
			</if>
			AND A.ReceiptType = 'U'
			AND A.ReceiptID =  #{deptID}
			AND A.DataState != 'D'
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (D.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR D.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND D.BusinessData1 = #{businessData1}
				</when>
			</choose>
			
			<!-- Store는 Union ALL X -->
			<if test="DBName != 'COVI_APPROVAL4J_STORE'">
				UNION ALL
				
				SELECT A.CirculationBoxID
				   , A.ProcessID
				   , A.CirculationBoxDescriptionID
				   , A.FormInstID
				   , A.ReceiptID
				   , A.ReceiptType
				   , A.ReceiptName
				   , A.ReceiptDate
				   , A.Kind AS SubKind
				   , A.State
				   , A.ReadDate
				   , A.SenderID
				   , A.SenderName
				   , A.Subject
				   , A.Comment
				   , A.DataState
				   , A.RegID
				   , A.RegDate
				   , A.ModID
				   , A.ModDate
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.InitiatedDate
					, B.DocNo
					, B.BodyContextOrg
					, C.FormID AS FormID
					, C.FormPrefix
					, C.FormName
					, C.FormSubject
					, C.IsSecureDoc
					, C.IsFile
					, C.FileExt
					, C.IsComment
					, C.ApproverCode
					, C.ApproverName
					, C.ApprovalStep
					, C.ApproverSIPAddress
					, C.IsReserved
					, C.ReservedGubun
					, C.ReservedTime
					, C.Priority
					, C.IsModify
					, C.Reserved1
					, C.Reserved2
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
				INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = 528
				WHERE A.State = 'C'
				<if test="adminYn == null or adminYn == '' ">
					AND B.DeletedDate IS NULL
				</if>
				AND A.ReceiptType = 'U'
				AND A.ReceiptID =  #{deptID}
				AND A.DataState != 'D'
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
			</if>
		) AS DeptTCInfoList
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				<choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	</select>

	<!-- 참조/회람함 그룹별 목록 조회 -->
	<select id="selectStoreDeptTCInfoGroupList" parameterType="cmap" resultType="cmap">
		<if test="searchGroupType == 'Date'">
			SELECT DeptTCInfoList.`Date` AS fieldID
			, COUNT(DeptTCInfoList.`Date`) AS fieldCnt
	        , DeptTCInfoList.`Date` as fieldName
	    </if>
	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'"> <!-- 20210126 이관함 -->
	    	SELECT DeptTCInfoList.FormPrefix AS fieldID
			, COUNT(DeptTCInfoList.FormPrefix) AS fieldCnt
	        , MAX(DeptTCInfoList.FormName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	SELECT DeptTCInfoList.InitiatorID AS fieldID
			, COUNT(DeptTCInfoList.InitiatorID) AS fieldCnt
	        , MAX(DeptTCInfoList.InitiatorName) as fieldName
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'"> <!-- 20210126 이관함 -->
	     	SELECT DeptTCInfoList.InitiatorUnitID AS fieldID
			, COUNT(DeptTCInfoList.InitiatorUnitID) AS fieldCnt
	        , MAX(DeptTCInfoList.InitiatorUnitName) as fieldName
	    </if>
	     <if test="searchGroupType == 'SubKind'">
	     	SELECT DeptTCInfoList.SubKind AS fieldID
			, COUNT(DeptTCInfoList.SubKind) AS fieldCnt
	        , MAX(DeptTCInfoList.SubKind) as fieldName
	    </if>
			FROM (
				SELECT 	  A.*
						, A.Kind AS SubKind
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.BodyContextOrg
						, B.DocNo
						, C.FormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						<choose>
							<when test="searchGroupType == 'Date'">
								, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, A.RegDate),'%Y-%m-%d') AS `Date`
							</when>
							<otherwise>
								, DATE_FORMAT(A.RegDate,'%Y-%m-%d') AS `Date`
							</otherwise>
						</choose>
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				<choose>
					<when test="DBName == 'COVI_APPROVAL4J_STORE'">
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON D.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
					</when>
					<otherwise>
						INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
					</otherwise>
				</choose>
				WHERE A.State = 'C'
				AND B.DeletedDate IS NULL
				AND A.ReceiptType = 'U'
				AND A.ReceiptID =  #{deptID}
				AND A.DataState != 'D'
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
				
				<!-- Store는 Union ALL X -->
				<if test="DBName != 'COVI_APPROVAL4J_STORE'">
					UNION ALL
					
					SELECT 	  A.*
						, A.Kind AS SubKind
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.BodyContextOrg
						, B.DocNo
						, C.FormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						<choose>
							<when test="searchGroupType == 'Date'">
								, DATE_FORMAT(Fn_ComURTimeZoneTrans_S(#{userID}, A.RegDate),'%Y-%m-%d') AS `Date`
							</when>
							<otherwise>
								, DATE_FORMAT(A.RegDate,'%Y-%m-%d') AS `Date`
							</otherwise>
						</choose>
					FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = 528
					WHERE A.State = 'C'
					AND B.DeletedDate IS NULL
					AND A.ReceiptType = 'U'
					AND A.ReceiptID =  #{deptID}
					AND A.DataState != 'D'
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS DeptTCInfoList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	    `Date` BETWEEN #{startDate} AND #{endDate}
		  	 </if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND `Date` <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND `Date` <![CDATA[<=]]> #{viewEndDate}
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
			 	<if test="searchGroupType == 'Date'">
			 		DeptTCInfoList.`Date`
			 	</if>
		 	    <if test="searchGroupType == 'FormPrefix' or searchGroupType == 'FormName'">
		 	    	DeptTCInfoList.FormPrefix
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	DeptTCInfoList.InitiatorID
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID' or searchGroupType == 'InitiatorUnitName'">
			     	DeptTCInfoList.InitiatorUnitID
			    </if>
			     <if test="searchGroupType == 'SubKind'">
			     	DeptTCInfoList.SubKind
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	fieldName ASC
			</if>
		</trim>
	</select>

	<!-- 참조/회람함 엑셀 데이터 조회 -->
	<select id="selectStoreDeptTCInfoListExcel" parameterType="cmap" resultType="cmap">
			SELECT DeptTCInfoList.* FROM (
				SELECT  A.CirculationBoxID
				    , A.ProcessID
				    , A.CirculationBoxDescriptionID
				    , A.FormInstID
				    , A.ReceiptID
				    , A.ReceiptType
				    , A.ReceiptName
				    , A.ReceiptDate
				    , A.Kind AS SubKind
				    , A.State
				    , A.ReadDate
				    , A.SenderID
				    , A.SenderName
				    , A.Subject
				    , A.Comment
				    , A.DataState
				    , A.RegID
				    , DATE_FORMAT(A.RegDate,'%Y-%m-%d %H:%i:%s') AS RegDate
				    , A.ModID
				    , A.ModDate
					, B.InitiatorID
					, B.InitiatorName
					, B.InitiatorUnitID
					, B.InitiatorUnitName
					, B.InitiatedDate
					, B.BodyContextOrg
					, B.DocNo
					, C.FormID AS FormID
					, C.FormPrefix
					, C.FormName
					, C.FormSubject
					, C.IsSecureDoc
					, C.IsFile
					, C.FileExt
					, C.IsComment
					, C.ApproverCode
					, C.ApproverName
					, C.ApprovalStep
					, C.ApproverSIPAddress
					, C.IsReserved
					, C.ReservedGubun
					, C.ReservedTime
					, C.Priority
					, C.IsModify
					, C.Reserved1
					, C.Reserved2
				FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
				INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
				<choose>
					<when test="DBName == 'COVI_APPROVAL4J_STORE'">
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processdescriptionarchive AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J_STORE.jwf_processarchive AS P ON D.ProcessDescriptionArchiveID = P.ProcessDescriptionArchiveID AND P.ParentProcessID = 0
					</when>
					<otherwise>
						INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
						INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = '288'
					</otherwise>
				</choose>
				WHERE A.State = 'C'
				AND B.DeletedDate IS NULL
				AND A.ReceiptType = 'U'
				AND A.ReceiptID =  #{deptID}
				AND A.DataState != 'D'
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (D.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR D.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND D.BusinessData1 = #{businessData1}
					</when>
				</choose>
				
				<!-- Store는 Union ALL X -->
				<if test="DBName != 'COVI_APPROVAL4J_STORE'">
					UNION ALL
					
					SELECT  A.CirculationBoxID
					   , A.ProcessID
					   , A.CirculationBoxDescriptionID
					   , A.FormInstID
					   , A.ReceiptID
					   , A.ReceiptType
					   , A.ReceiptName
					   , A.ReceiptDate
					   , A.Kind AS SubKind
					   , A.State
					   , A.ReadDate
					   , A.SenderID
					   , A.SenderName
					   , A.Subject
					   , A.Comment
					   , A.DataState
					   , A.RegID
					   , A.RegDate
					   , A.ModID
					   , A.ModDate
						, B.InitiatorID
						, B.InitiatorName
						, B.InitiatorUnitID
						, B.InitiatorUnitName
						, B.InitiatedDate
						, B.BodyContextOrg
						, C.FormID AS FormID
						, C.FormPrefix
						, C.FormName
						, C.FormSubject
						, C.IsSecureDoc
						, C.IsFile
						, C.FileExt
						, C.IsComment
						, C.ApproverCode
						, C.ApproverName
						, C.ApprovalStep
						, C.ApproverSIPAddress
						, C.IsReserved
						, C.ReservedGubun
						, C.ReservedTime
						, C.Priority
						, C.IsModify
						, C.Reserved1
						, C.Reserved2
					FROM COVI_APPROVAL4J_STORE.JWF_CirculationBox AS A
					INNER JOIN COVI_APPROVAL4J_STORE.JWF_FormInstance AS B ON A.FormInstID = B.FormInstID
					INNER JOIN COVI_APPROVAL4J_STORE.JWF_CirculationBoxDescription AS C ON A.CirculationBoxDescriptionID = C.CirculationBoxDescriptionID
					INNER JOIN COVI_APPROVAL4J.jwf_processdescription AS D ON B.FormInstID = D.FormInstID
					INNER JOIN COVI_APPROVAL4J.jwf_process AS P ON D.ProcessDescriptionID = P.ProcessDescriptionID AND P.ParentProcessID = 0 AND P.ProcessState = 528
					WHERE A.State = 'C'
					AND B.DeletedDate IS NULL
					AND A.ReceiptType = 'U'
					AND A.ReceiptID =  #{deptID}
					AND A.DataState != 'D'
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (D.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR D.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND D.BusinessData1 = #{businessData1}
						</when>
					</choose>
				</if>
			) AS DeptTCInfoList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
		  	<if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
		  	   RegDate BETWEEN #{startDate} AND TIMESTAMPADD(Day,1,#{endDate})
		  	</if>
		  	<if test="viewStartDate != null and viewStartDate != '' ">
				AND RegDate <![CDATA[>=]]> #{viewStartDate}
			</if>
			<if test="viewEndDate != null and viewEndDate != '' ">
				AND RegDate <![CDATA[<=]]> TIMESTAMPADD(Day,1,#{viewEndDate})
			</if>
			<if test="searchType != null and searchType !='' and searchType != 'all' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND 
				<choose>
					<when test='searchType.equalsIgnoreCase("FormSubject")'>FormSubject </when>
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName </when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName </when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName </when>
					<when test='searchType.equalsIgnoreCase("DocNo")'>DocNo </when>
					<when test='searchType.equalsIgnoreCase("BodyContextOrg")'>BodyContextOrg </when>
					<when test='searchType.equalsIgnoreCase("Subject")'>Subject </when>					
				</choose> 
				LIKE CONCAT('%',#{searchWord},'%')
			</if>
			<if test="searchType == 'all'  and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				AND (
					FormSubject LIKE CONCAT('%',#{searchWord},'%') 			OR <!-- 제목 -->
					InitiatorUnitName LIKE CONCAT('%',#{searchWord},'%') 	OR <!-- 기안부서 -->
					InitiatorName LIKE CONCAT('%',#{searchWord},'%')		   <!-- 기안자 -->
				)
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			   <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND RegDate BETWEEN #{searchGroupWord} AND TIMESTAMPADD(Day,1,#{searchGroupWord})
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID </when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID </when>
							<when test='searchGroupType.equalsIgnoreCase("SubKind")'>SubKind </when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
			<if test="userNm != null and userNm !=''">
				AND InitiatorName LIKE CONCAT('%',#{userNm},'%')
			</if>
			<if test="titleNm != null and titleNm !=''">
				AND FormSubject LIKE CONCAT('%',#{titleNm},'%')
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		  	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , RegDate Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("EndDate")'>EndDate</when>
					<when test='sortColumn.equalsIgnoreCase("RegDate")'>RegDate</when>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>
</mapper>
