<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user.jobFunctionList">

    <!-- 특정 사용자의 담당업무 개수 조회  -->
    <select id="selectJobFunctionCount" parameterType="cmap" resultType="java.lang.Long">
		SELECT COUNT(*) AS CNT
		FROM jwf_jobfunction jf
		INNER JOIN jwf_jobfunctionmember jfm ON jf.JobFunctionID = jfm.JobFunctionID
		WHERE jfm.UserCode = #{userCode}
		AND jf.IsUse = 'Y'
		AND jf.JobFunctionType = #{JobFunctionType}
		<choose>
            <when test='isSaaS == "Y"'>
                AND jf.EntCode = #{entCode}
            </when>
            <otherwise>
				AND jf.EntCode IN ('ORGROOT', #{entCode})
            </otherwise>
        </choose>
	</select>

     <!-- 특정 사용자의 담당업무 목록 조회  -->
    <select id="selectJobFunctionList" parameterType="cmap" resultType="cmap">
        SELECT 
        	jf.JobFunctionCode AS "JobFunctionCode"
        	, jf.JobFunctionName AS "JobFunctionName"
        	, jfm.JobFunctionMemberID AS "JobFunctionMemberID"
        	, jfm.UserCode AS "UserCode"
        FROM jwf_jobfunction jf
		INNER JOIN jwf_jobfunctionmember jfm ON jf.JobFunctionID = jfm.JobFunctionID
		WHERE jfm.UserCode = #{userCode}
		AND jf.IsUse = 'Y'
		AND jf.JobFunctionType = #{JobFunctionType}
		<choose>
            <when test='isSaaS == "Y"'>
                AND jf.EntCode = #{entCode}
            </when>
            <otherwise>
				AND jf.EntCode IN ('ORGROOT', #{entCode})
            </otherwise>
        </choose>
    </select>

    <!-- 미결함 목록 조회 -->
    <select id="selectJobFunctionApprovalList" parameterType="cmap" resultType="cmap">
        <include refid="oracle.include.pagingHeader"/>
	       SELECT
		       	ProcessID AS "ProcessID"
				, WorkItemID AS "WorkItemID"
				, PerformerID AS "PerformerID"
				, TaskID AS "TaskID"
				, InitiatorID AS "InitiatorID"
				, InitiatorName AS "InitiatorName"
				, InitiatorUnitID AS "InitiatorUnitID"
				, InitiatorUnitName AS "InitiatorUnitName"
				, UserCode "AS UserCode"
				, UserName AS "UserName"
				, SubKind AS "SubKind"
				, FormSubKind AS "FormSubKind"
				, ProcessDescriptionID AS "ProcessDescriptionID"
				, FormInstID AS "FormInstID"
				, FormID AS "FormID"
				, FormPrefix AS "FormPrefix"
				, FormName AS "FormName"
				, FormSubject AS "FormSubject"
				, IsSecureDoc AS "IsSecureDoc"
				, IsFile AS "IsFile"
				, FileExt AS "FileExt"
				, IsComment AS "IsComment"
				, ApproverCode AS "ApproverCode"
				, ApproverName AS "ApproverName"
				, ApprovalStep AS "ApprovalStep"
				, ApproverSIPAddress AS "ApproverSIPAddress"
				, IsReserved AS "IsReserved"
				, ReservedGubun AS "ReservedGubun"
				, ReservedTime AS "ReservedTime"
				, Priority AS "Priority"
				, IsModify AS "IsModify"
				, Reserved1 AS "Reserved1"
				, Reserved2 AS "Reserved2"
				, Created AS "Created"
				, ExtInfo AS "ExtInfo"
				, PhotoPath AS "PhotoPath"
				, BusinessData1  AS "BusinessData1"
				, BusinessData2  AS "BusinessData2"
				, BusinessData3  AS "BusinessData3"
				, BusinessData4  AS "BusinessData4"
				, BusinessData5  AS "BusinessData5"
				, BusinessData6  AS "BusinessData6"
				, BusinessData7  AS "BusinessData7"
				, BusinessData8  AS "BusinessData8"
				, BusinessData9  AS "BusinessData9"
				, BusinessData10  AS "BusinessData10"
				, SchemaContext AS "SchemaContext"
	       FROM (
		        SELECT PRO.ProcessID
					, W.WorkItemID
					, PER.PerformerID
					, W.TaskID
					, PRO.InitiatorID
					, PRO.InitiatorName
					, PRO.InitiatorUnitID
					, PRO.InitiatorUnitName
					, PER.UserCode
					, PER.UserName
					, PER.SubKind
					, PER.SubKind AS FormSubKind
					, PD.*
					, TO_CHAR(W.Created, 'YYYY-MM-DD HH24:MI:SS') AS Created
					, F.ExtInfo
					, U.PhotoPath
					, NVL(JF.SchemaContext, '') as SchemaContext
				FROM JWF_Process PRO
				INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
				INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
				INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
				LEFT OUTER JOIN JWF_Forms F ON PD.FormID = F.FormID
				LEFT OUTER JOIN jwf_formsschema JF ON F.SchemaID = JF.SchemaID
				LEFT OUTER JOIN sys_object_user U ON U.UserCode = PRO.InitiatorID
				WHERE PER.UserCode = #{jobFunctionCode}
				AND PER.SubKind = 'T008'
				AND PER.State = 1
				AND W.State = 288
				AND PRO.ProcessState = 288
				AND PRO.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PD.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PD.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PD.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
		   ) ApprovalList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'				
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
	            <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				<choose>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
					<otherwise>, FormSubject</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>			 	
			</if>
		</trim>
	   	<include refid="oracle.include.pagingFooter"/>
    </select>

    <!-- 미결함 목록 개수 -->
    <select id="selectJobFunctionApprovalListCnt" parameterType="cmap" resultType="java.lang.Long">
        SELECT COUNT(*) FROM (
        	SELECT ApprovalList.* FROM (
		        SELECT PRO.ProcessID
					, W.WorkItemID
					, PER.PerformerID
					, W.TaskID
					, PRO.InitiatorID
					, PRO.InitiatorName
					, PRO.InitiatorUnitID
					, PRO.InitiatorUnitName
					, PER.UserCode
					, PER.UserName
					, PER.SubKind
					, PER.SubKind AS FormSubKind
					, PD.*
					, TO_CHAR(W.Created, 'YYYY-MM-DD HH24:MI:SS') AS Created
				FROM JWF_Process PRO
				INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
				INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
				INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
				WHERE PER.UserCode = #{jobFunctionCode}
				AND PER.SubKind = 'T008'
				AND PER.State = 1
				AND W.State = 288
				AND PRO.ProcessState = 288
				AND PRO.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PD.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PD.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PD.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
		   ) ApprovalList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
	            <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS') 
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						 = #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
		) A
    </select>

    <!-- 미결함 그룹별 목록 조회 -->
    <select id="selectJobFunctionApprovalGroupList" parameterType="cmap" resultType="cmap">
		SELECT 
		<if test="searchGroupType == 'Date'">
			ApprovalList."Date" AS "fieldID"
			, COUNT(ApprovalList."Date") AS "fieldCnt"
	        , ApprovalList."Date" AS "fieldName"
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	ApprovalList.FormPrefix AS "fieldID"
	    	, COUNT(ApprovalList.FormPrefix) AS "fieldCnt"
	        , ApprovalList.FormName AS "fieldName"
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	ApprovalList.InitiatorID AS "fieldID"
	     	, COUNT(ApprovalList.InitiatorID) AS "fieldCnt"
	        , ApprovalList.InitiatorName AS "fieldName"
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	ApprovalList.InitiatorUnitID AS "fieldID"
	     	, COUNT(ApprovalList.InitiatorUnitID) AS "fieldCnt"
	        , ApprovalList.InitiatorUnitName AS "fieldName"
	    </if>	
	       FROM (
		        SELECT PRO.ProcessID
					, W.WorkItemID
					, PER.PerformerID
					, PRO.InitiatorID
					, PRO.InitiatorName
					, PRO.InitiatorUnitID
					, PRO.InitiatorUnitName
					, PER.UserCode
					, PER.UserName
					, PER.SubKind
					, PD.*
					, TO_CHAR(W.Created, 'YYYY-MM-DD HH24:MI:SS') AS Created
					<choose>
						<when test="searchGroupType == 'Date'">
							, TO_CHAR(TO_DATE(Fn_ComURTimeZoneTrans_S(#{userCode}, W.Created), 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD') AS "Date"
						</when>
						<otherwise>
							, TO_CHAR(W.Created,'YYYY-MM-DD') AS "Date"
						</otherwise>
					</choose>
				FROM JWF_Process PRO
				INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
				INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
				INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
				WHERE PER.UserCode = #{jobFunctionCode}
				AND PER.SubKind = 'T008'
				AND PER.State = 1
				AND W.State = 288
				AND PRO.ProcessState = 288
				AND PRO.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PD.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PD.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PD.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
		   ) ApprovalList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
		  	    <if test="searchGroupType == 'Date'">
			 		ApprovalList."Date"
			 	</if>
		 		<if test="searchGroupType == 'FormPrefix'">
		 			ApprovalList.FormPrefix
			        , ApprovalList.FormName
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	ApprovalList.InitiatorID
			        , ApprovalList.InitiatorName
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	ApprovalList.InitiatorUnitID
			        , ApprovalList.InitiatorUnitName
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	"fieldName" ASC
			</if>
		</trim>
    </select>


     <!-- 미결함 엑셀 데이터 조회 -->
    <select id="selectJobFunctionApprovalListExcel" parameterType="cmap" resultType="cmap">
        <![CDATA[
        	SELECT
        		SubKind AS "SubKind"
	       		, FormSubject AS "FormSubject"
	       		, InitiatorUnitName AS "InitiatorUnitName"
	       		, InitiatorName AS "InitiatorName"
	       		, Created AS "Created"
	       		, FormName AS "FormName"
				, SubUserName as "SubUserName"
	       FROM (
		        SELECT PRO.ProcessID
					, W.WorkItemID
					, PER.PerformerID
					, PRO.InitiatorID
					, PRO.InitiatorName
					, PRO.InitiatorUnitID
					, PRO.InitiatorUnitName
					, PER.UserCode
					, PER.UserName
					, PER.SubKind
					, PD.*
					, TO_CHAR(W.Created, 'YYYY-MM-DD HH24:MI:SS') AS Created
					, Fn_SplitString_r(PD.businessdata5, '^^^', 2) as SubUserName
				FROM JWF_Process PRO
				INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
				INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
				INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
				WHERE PER.UserCode = #{jobFunctionCode}
				AND PER.SubKind = 'T008'
				AND PER.State = 1
				AND W.State = 288
				AND PRO.ProcessState = 288
				AND PRO.DeleteDate IS NULL
        ]]>
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PD.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PD.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PD.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
		   ) ApprovalList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS') 
	                </when>
	                <otherwise>
	                    AND 
						<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
					<otherwise>, FormSubject</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
    </select>

    <!-- 진행함 목록 조회 -->
    <select id="selectJobFunctionProcessList" parameterType="cmap" resultType="cmap">
        <include refid="oracle.include.pagingHeader"/>
			SELECT
				ProcessList.ProcessID AS "ProcessID"
				, ProcessList.WorkItemID AS "WorkItemID"
				, ProcessList.PerformerID AS "PerformerID"
				, ProcessList.InitiatorID AS "InitiatorID"
				, ProcessList.InitiatorName AS "InitiatorName"
				, ProcessList.InitiatorUnitID AS "InitiatorUnitID"
				, ProcessList.InitiatorUnitName AS "InitiatorUnitName"
				, ProcessList.UserCode AS "UserCode"
				, ProcessList.UserName AS "UserName"
				, ProcessList.SubKind AS "SubKind"
				, ProcessList.FormSubKind AS "FormSubKind"
				, ProcessList.ProcessDescriptionID AS "ProcessDescriptionID"
				, ProcessList.FormInstID AS "FormInstID"
				, ProcessList.FormID AS "FormID"
				, ProcessList.FormPrefix AS "FormPrefix"
				, ProcessList.FormName AS "FormName"
				, ProcessList.FormSubject AS "FormSubject"
				, ProcessList.IsSecureDoc AS "IsSecureDoc"
				, ProcessList.IsFile AS "IsFile"
				, ProcessList.FileExt AS "FileExt"
				, ProcessList.IsComment AS "IsComment"
				, ProcessList.ApproverCode AS "ApproverCode"
				, ProcessList.ApproverName AS "ApproverName"
				, ProcessList.ApprovalStep AS "ApprovalStep"
				, ProcessList.ApproverSIPAddress AS "ApproverSIPAddress"
				, ProcessList.IsReserved AS "IsReserved"
				, ProcessList.ReservedGubun AS "ReservedGubun"
				, ProcessList.ReservedTime AS "ReservedTime"
				, ProcessList.Priority AS "Priority"
				, ProcessList.IsModify AS "IsModify"
				, ProcessList.Reserved1 AS "Reserved1"
				, ProcessList.Reserved2 AS "Reserved2"
				, ProcessList.Created AS "Created"
				, ProcessList.PhotoPath AS "PhotoPath"
				, ProcessList.BusinessData1  AS "BusinessData1"
				, ProcessList.BusinessData2  AS "BusinessData2"
				, ProcessList.BusinessData3  AS "BusinessData3"
				, ProcessList.BusinessData4  AS "BusinessData4"
				, ProcessList.BusinessData5  AS "BusinessData5"
				, ProcessList.BusinessData6  AS "BusinessData6"
				, ProcessList.BusinessData7  AS "BusinessData7"
				, ProcessList.BusinessData8  AS "BusinessData8"
				, ProcessList.BusinessData9  AS "BusinessData9"
				, ProcessList.BusinessData10  AS "BusinessData10"
				, JD.DomainDataContext  AS "DomainDataContext"
			FROM (
		        SELECT PRO.ProcessID
					, W.WorkItemID
					, PER.PerformerID
					, PRO.InitiatorID
					, PRO.InitiatorName
					, PRO.InitiatorUnitID
					, PRO.InitiatorUnitName
					, PER.UserCode
					, PER.UserName
					, PER.SubKind
					, PER.SubKind AS FormSubKind
					, PD.*
					, TO_CHAR(W.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Created
					, U.PhotoPath
				FROM JWF_Process PRO
				INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
				INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
				INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
				LEFT OUTER JOIN sys_object_user U ON U.UserCode = PRO.InitiatorID
				WHERE PER.UserCode = #{jobFunctionCode}
				AND PER.SubKind = 'T008'
				AND PER.State = 1
				AND W.State = 528
				AND PRO.ProcessState = 288
				AND PRO.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PD.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PD.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PD.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
		) ProcessList
		INNER JOIN jwf_domaindata JD ON ProcessList.ProcessID = JD.ProcessID
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						 = #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY"  prefixOverrides =",">
			<if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
					<otherwise>, FormSubject</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
		<include refid="oracle.include.pagingFooter"/>
	</select>

    <!-- 진행함 목록 개수 조회 -->
     <select id="selectJobFunctionProcessListCnt" parameterType="cmap" resultType="java.lang.Long">
         SELECT COUNT(*) FROM (
         	SELECT ProcessList.* FROM (
		        SELECT PRO.ProcessID
					, W.WorkItemID
					, PER.PerformerID
					, PRO.InitiatorID
					, PRO.InitiatorName
					, PRO.InitiatorUnitID
					, PRO.InitiatorUnitName
					, PER.UserCode
					, PER.UserName
					, PER.SubKind
					, PER.SubKind AS FormSubKind
					, PD.*
					, TO_CHAR(W.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Created
				FROM JWF_Process PRO
				INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
				INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
				INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
				WHERE PER.UserCode = #{jobFunctionCode}
				AND PER.SubKind = 'T008'
				AND PER.State = 1
				AND W.State = 528
				AND PRO.ProcessState = 288
				AND PRO.DeleteDate IS NULL
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PD.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PD.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PD.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
		) ProcessList
	    <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
				 <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						 = #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
		) A
	</select>

    <!-- 진행함 그룹별 목록 조회 -->
      <select id="selectJobFunctionProcessGroupList" parameterType="cmap" resultType="cmap">
			SELECT 
			<if test="searchGroupType == 'Date'">
				ProcessList."Date" AS "fieldID"
				, COUNT(ProcessList."Date") AS "fieldCnt"
		        , ProcessList."Date" AS "fieldName"
		    </if>
		    <if test="searchGroupType == 'FormPrefix'">
		    	ProcessList.FormPrefix AS "fieldID"
		    	, COUNT(ProcessList.FormPrefix) AS "fieldCnt"
		        , ProcessList.FormName AS "fieldName"
		    </if>
		     <if test="searchGroupType == 'InitiatorID'">
		     	ProcessList.InitiatorID AS "fieldID"
		     	, COUNT(ProcessList.InitiatorID) AS "fieldCnt"
		        , ProcessList.InitiatorName AS "fieldName"
		    </if>
		     <if test="searchGroupType == 'InitiatorUnitID'">
		     	ProcessList.InitiatorUnitID AS "fieldID"
		     	, COUNT(ProcessList.InitiatorUnitID) AS "fieldCnt"
		        , ProcessList.InitiatorUnitName AS "fieldName"
		    </if>		    
			FROM (
			        SELECT PRO.ProcessID
						, W.WorkItemID
						, PER.PerformerID
						, PRO.InitiatorID
						, PRO.InitiatorName
						, PRO.InitiatorUnitID
						, PRO.InitiatorUnitName
						, PER.UserCode
						, PER.UserName
						, PER.SubKind
						, PD.*
						, TO_CHAR(W.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Created
						<choose>
							<when test="searchGroupType == 'Date'">
								, TO_CHAR(TO_DATE(Fn_ComURTimeZoneTrans_S(#{userCode}, W.Finished), 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD') AS "Date"
							</when>
							<otherwise>
								, TO_CHAR(W.Finished,'YYYY-MM-DD') AS "Date"
							</otherwise>
						</choose>
					FROM JWF_Process PRO
					INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
					INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
					INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
					INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
					WHERE PER.UserCode = #{jobFunctionCode}
					AND PER.SubKind = 'T008'
					AND PER.State = 1
					AND W.State = 528
					AND PRO.ProcessState = 288
					AND PRO.DeleteDate IS NULL
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (PD.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR PD.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND PD.BusinessData1 = #{businessData1}
						</when>
					</choose>
					<choose>
			            <when test='isSaaS == "Y"'>
			                AND FI.EntCode = #{entCode}
			            </when>
			            <otherwise>
							AND FI.EntCode IN ('ORGROOT', #{entCode})
			            </otherwise>
			        </choose>
			) ProcessList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
		</trim>

		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
		  	    <if test="searchGroupType == 'Date'">
			 		ProcessList."Date"
			 	</if>
		 		<if test="searchGroupType == 'FormPrefix'">
		 			ProcessList.FormPrefix
			        , ProcessList.FormName
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	ProcessList.InitiatorID
			        , ProcessList.InitiatorName
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	ProcessList.InitiatorUnitID
			        , ProcessList.InitiatorUnitName
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	"fieldName" ASC
			</if>
		</trim>
	</select>

    <!-- 진행함 엑셀 데이터 조회 -->
	 <select id="selectJobFunctionProcessListExcel" parameterType="cmap" resultType="cmap">
			SELECT
				SubKind AS "SubKind"
				, FormSubject AS "FormSubject"
				, InitiatorUnitName AS "InitiatorUnitName"
				, InitiatorName AS "InitiatorName"
				, Created AS "Created"
				, FormName AS "FormName"
				, SubUserName AS "SubUserName"
			FROM (
			        SELECT PRO.ProcessID
						, W.WorkItemID
						, PER.PerformerID
						, PRO.InitiatorID
						, PRO.InitiatorName
						, PRO.InitiatorUnitID
						, PRO.InitiatorUnitName
						, PER.UserCode
						, PER.UserName
						, PER.SubKind
						, PD.*
						, TO_CHAR(W.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Created
						,Fn_SplitString_r(PD.businessdata5, '^^^', 2) as SubUserName
					FROM JWF_Process PRO
					INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
					INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
					INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
					INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
					WHERE PER.UserCode = #{jobFunctionCode}
					AND PER.SubKind = 'T008'
					AND PER.State = 1
					AND W.State = 528
					AND PRO.ProcessState = 288
					AND PRO.DeleteDate IS NULL
					<choose>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
							AND (PD.BusinessData1 IS NULL
								<if test='bizDataList != null'>
									OR PD.BusinessData1 IN 
									<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
										#{item}
									</foreach>
								</if>
							)
						</when>
						<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
							AND PD.BusinessData1 = #{businessData1}
						</when>
					</choose>
					<choose>
			            <when test='isSaaS == "Y"'>
			                AND FI.EntCode = #{entCode}
			            </when>
			            <otherwise>
							AND FI.EntCode IN ('ORGROOT', #{entCode})
			            </otherwise>
			        </choose>
			) ProcessList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '% || #{searchWord} || '%'
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Created BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						 = #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
			<if test = "sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
				, Priority DESC 
		    </if>
		    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Created Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
					<otherwise>, FormSubject</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>


	<!-- 완료함 목록 조회 -->
    <select id="selectJobFunctionCompleteList" parameterType="cmap" resultType="cmap">
        <include refid="oracle.include.pagingHeader"/>
			SELECT
				ProcessArchiveID AS "ProcessArchiveID"
				, WorkItemArchiveID AS "WorkItemArchiveID"
				, PerformerID AS "PerformerID"
				, InitiatorID AS "InitiatorID"
				, InitiatorName AS "InitiatorName"
				, InitiatorUnitID AS "InitiatorUnitID"
				, InitiatorUnitName AS "InitiatorUnitName"
				, UserCode AS "UserCode"
				, UserName AS "UserName"
				, SubKind AS "SubKind"
				, FormSubKind AS "FormSubKind"
				, ProcessDescriptionArchiveID AS "ProcessDescriptionArchiveID"
				, FormInstID AS "FormInstID"
				, FormID AS "FormID"
				, FormName AS "FormName"
				, FormSubject AS "FormSubject"
				, IsSecureDoc AS "IsSecureDoc"
				, IsFile AS "IsFile"
				, FileExt AS "FileExt"
				, IsComment AS "IsComment"
				, DocNo AS "DocNo"
				, ApproverCode AS "ApproverCode"
				, ApproverName AS "ApproverName"
				, ApprovalStep AS "ApprovalStep"
				, ApproverSIPAddress AS "ApproverSIPAddress"
				, IsReserved AS "IsReserved"
				, ReservedGubun AS "ReservedGubun"
				, ReservedTime AS "ReservedTime"
				, Priority AS "Priority"
				, IsModify AS "IsModify"
				, Reserved1 AS "Reserved1"
				, Reserved2 AS "Reserved2"
				, Finished AS "Finished"
				, BusinessData1  AS "BusinessData1"
				, BusinessData2  AS "BusinessData2"
				, BusinessData3  AS "BusinessData3"
				, BusinessData4  AS "BusinessData4"
				, BusinessData5  AS "BusinessData5"
				, BusinessData6  AS "BusinessData6"
				, BusinessData7  AS "BusinessData7"
				, BusinessData8  AS "BusinessData8"
				, BusinessData9  AS "BusinessData9"
				, BusinessData10  AS "BusinessData10"
				, FormPrefix AS "FormPrefix"
			FROM (
		        SELECT PROA.ProcessID AS ProcessArchiveID
					, WA.WorkitemID AS WorkItemArchiveID
					, WA.PerformerID
					, PROA.InitiatorID
					, PROA.InitiatorName
					, PROA.InitiatorUnitID
					, PROA.InitiatorUnitName
					, WA.UserCode
					, WA.UserName
					, WA.SubKind
					, WA.SubKind AS FormSubKind
					, PDA.*
					, PDA.ProcessDescriptionID AS ProcessDescriptionArchiveID 
					, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
				FROM JWF_Process PROA
				INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
				INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
				WHERE WA.UserCode = #{jobFunctionCode}
				AND WA.SubKind = 'T008'
				AND WA.PIBusinessState = '02_01'
				AND WA.Deleted IS NULL
				AND WA.PIDeleted IS NULL
				AND	PROA.ProcessState = 528
				AND	WA.State = 528
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PDA.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PDA.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PDA.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
			) CompleteList
		    <!-- 검색 데이터 Where 절 -->
		    <trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
					<choose> 
						<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
						<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
						<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
						<otherwise>FormSubject</otherwise>
					</choose> 
					LIKE '%' || #{searchWord} || '%' 
				</if>
				<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
					<choose>
		                <when test="searchGroupType == 'Date' ">
	                    	AND Finished BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
		                </when>
		                <otherwise>
		                    AND 
		                    <choose>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
								<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							</choose> 
							 = #{searchGroupWord}
		                </otherwise>
		            </choose>		
				</if>
			</trim>
		    <!-- Order by 절 -->
			<trim prefix="ORDER BY" prefixOverrides =",">
				<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
			        , Finished Desc
			    </if>
			  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				 	<choose>
						<when test='sortColumn.equalsIgnoreCase("SubKind")'>, SubKind</when>
						<when test='sortColumn.equalsIgnoreCase("FormSubject")'>, FormSubject</when>
						<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>, InitiatorUnitName</when>
						<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
						<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
						<when test='sortColumn.equalsIgnoreCase("FormName")'>, FormName</when>
						<when test='sortColumn.equalsIgnoreCase("DocNo")'>, DocNo</when>
						<when test='sortColumn.equalsIgnoreCase("IsComment")'>, IsComment</when>
						<when test='sortColumn.equalsIgnoreCase("IsModify")'>, IsModify</when>
						<otherwise>, Finished</otherwise>
					</choose>
					<choose>
						<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
						<otherwise> DESC</otherwise>
					</choose>
				</if>
			</trim>
		<include refid="oracle.include.pagingFooter"/>
	</select>

    <!-- 완료함 목록 개수 -->
    <select id="selectJobFunctionCompleteListCnt" parameterType="cmap" resultType="java.lang.Long">
        SELECT COUNT(*) FROM (
			SELECT CompleteList.ProcessArchiveID FROM (
		        SELECT PROA.ProcessID AS ProcessArchiveID
					, WA.WorkitemID AS WorkItemArchiveID
					, WA.PerformerID
					, PROA.InitiatorID
					, PROA.InitiatorName
					, PROA.InitiatorUnitID
					, PROA.InitiatorUnitName
					, WA.UserCode
					, WA.UserName
					, WA.SubKind
					, WA.SubKind AS FormSubKind
					, PDA.*
					, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
				FROM JWF_Process PROA
				INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
				INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
				WHERE WA.UserCode = #{jobFunctionCode}
				AND WA.SubKind = 'T008'
				AND WA.PIBusinessState = '02_01'
				AND WA.Deleted IS NULL
				AND WA.PIDeleted IS NULL
				AND	PROA.ProcessState = 528
				AND	WA.State = 528
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PDA.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PDA.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PDA.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
			) CompleteList
		    <!-- 검색 데이터 Where 절 -->
		    <trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
					<choose> 
						<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
						<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
						<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
						<otherwise>FormSubject</otherwise>
					</choose> 
					LIKE '%' || #{searchWord} || '%'
				</if>
				<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
					<choose>
		                <when test="searchGroupType == 'Date' ">
	                    	AND Finished BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
		                </when>
		                <otherwise>
		                    AND 
		                  	<choose>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
								<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							</choose>
							 = #{searchGroupWord}
		                </otherwise>
		            </choose>		
				</if>
			</trim>
		) A
	</select>

	<!-- 완료함 그룹별 목록 조회 -->
    <select id="selectJobFunctionCompleteGroupList" parameterType="cmap" resultType="cmap">
		SELECT 
		<if test="searchGroupType == 'Date'">
			CompleteList."Date" AS "fieldID"
			, COUNT(CompleteList."Date") AS "fieldCnt"
	        , CompleteList."Date" AS "fieldName"
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	CompleteList.FormPrefix AS "fieldID"
	    	, COUNT(CompleteList.FormPrefix) AS "fieldCnt"
	        , CompleteList.FormName AS "fieldName"
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	CompleteList.InitiatorID AS "fieldID"
	     	, COUNT(CompleteList.InitiatorID) AS "fieldCnt"
	        , CompleteList.InitiatorName AS "fieldName"
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	CompleteList.InitiatorUnitID AS "fieldID"
	     	, COUNT(CompleteList.InitiatorUnitID) AS "fieldCnt"
	        , CompleteList.InitiatorUnitName AS "fieldName"
	    </if>
		FROM (
	        SELECT PROA.ProcessID AS ProcessArchiveID
				, WA.WorkitemID AS WorkItemArchiveID
				, WA.PerformerID
				, PROA.InitiatorID
				, PROA.InitiatorName
				, PROA.InitiatorUnitID
				, PROA.InitiatorUnitName
				, WA.UserCode
				, WA.UserName
				, WA.SubKind
				, PDA.*
				, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
				<choose>
					<when test="searchGroupType == 'Date'">
						, TO_CHAR(TO_DATE(Fn_ComURTimeZoneTrans_S(#{userCode}, WA.Finished), 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD') AS "Date"
					</when>
					<otherwise>
						, TO_CHAR(WA.Finished,'YYYY-MM-DD') AS "Date"
					</otherwise>
				</choose>
			FROM JWF_Process PROA
			INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
			INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
			INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
			WHERE WA.UserCode = #{jobFunctionCode}
			AND WA.SubKind = 'T008'
			AND WA.PIBusinessState = '02_01'
			AND WA.Deleted IS NULL
			AND WA.PIDeleted IS NULL
			AND	PROA.ProcessState = 528
			AND	WA.State = 528
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (PDA.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR PDA.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND PDA.BusinessData1 = #{businessData1}
				</when>
			</choose>
			<choose>
	            <when test='isSaaS == "Y"'>
	                AND FI.EntCode = #{entCode}
	            </when>
	            <otherwise>
					AND FI.EntCode IN ('ORGROOT', #{entCode})
	            </otherwise>
	        </choose>
		) CompleteList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
		  	    <if test="searchGroupType == 'Date'">
			 		CompleteList."Date"
			 	</if>
		 		<if test="searchGroupType == 'FormPrefix'">
		 			CompleteList.FormPrefix
			        , CompleteList.FormName
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	CompleteList.InitiatorID
			        , CompleteList.InitiatorName
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
					CompleteList.InitiatorUnitID				     
			        , CompleteList.InitiatorUnitName
			    </if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	"fieldName" ASC
			</if>
		</trim>
	</select>

    <!-- 완료함 엑셀 목록 조회 -->
    <select id="selectJobFunctionCompleteListExcel" parameterType="cmap" resultType="cmap">
		SELECT
			SubKind AS "SubKind"
			, FormSubject AS "FormSubject"
			, InitiatorUnitName AS "InitiatorUnitName"
			, InitiatorName AS "InitiatorName"
			, IsFile AS "IsFile"
			, FormName AS "FormName"
			, DocNo AS "DocNo"
			, Finished AS "Finished"
			, IsComment AS "IsComment"
			, IsModify AS "IsModify"
			, SubUserName AS "SubUserName"
		FROM (
	        SELECT PROA.ProcessID AS ProcessArchiveID
				, WA.WorkitemID AS WorkItemArchiveID
				, WA.PerformerID
				, PROA.InitiatorID
				, PROA.InitiatorName
				, PROA.InitiatorUnitID
				, PROA.InitiatorUnitName
				, WA.UserCode
				, WA.UserName
				, WA.SubKind
				, PDA.*
				, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
				,Fn_SplitString_r(PDA.businessdata5, '^^^', 2) as SubUserName				
			FROM JWF_Process PROA
			INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
			INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
			INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
			WHERE WA.UserCode = #{jobFunctionCode}
			AND WA.SubKind = 'T008'
			AND WA.PIBusinessState = '02_01'
			AND WA.Deleted IS NULL
			AND WA.PIDeleted IS NULL
			AND	PROA.ProcessState = 528
			AND	WA.State = 528
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (PDA.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR PDA.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND PDA.BusinessData1 = #{businessData1}
				</when>
			</choose>
			<choose>
	            <when test='isSaaS == "Y"'>
	                AND FI.EntCode = #{entCode}
	            </when>
	            <otherwise>
					AND FI.EntCode IN ('ORGROOT', #{entCode})
	            </otherwise>
	        </choose>
		) CompleteList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Finished BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
	                </when>
	                <otherwise>
	                    AND 
	                    <choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		  	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Finished Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>, SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>, FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>, InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>, FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>, DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>, IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>, IsModify</when>
					<otherwise>, Finished</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

    <!-- 반려함 목록 조회 -->
    <select id="selectJobFunctionRejectList" parameterType="cmap" resultType="cmap">
        <include refid="oracle.include.pagingHeader"/>
        	SELECT
	      		ProcessArchiveID AS "ProcessArchiveID"
	      		, WorkItemArchiveID AS "WorkItemArchiveID"
	      		, PerformerID AS "PerformerID"
	      		, InitiatorID AS "InitiatorID"
				, InitiatorName AS "InitiatorName"
				, InitiatorUnitID AS "InitiatorUnitID"
				, InitiatorUnitName AS "InitiatorUnitName"
				, UserCode AS "UserCode"
				, UserName AS "UserName"
				, SubKind AS "SubKind"
				, FormSubKind AS "FormSubKind"
				, ProcessDescriptionArchiveID AS "ProcessDescriptionArchiveID"
				, FormInstID AS "FormInstID"
				, FormID AS "FormID"
				, FormName AS "FormName"
				, FormSubject AS "FormSubject"
				, IsSecureDoc AS "IsSecureDoc"
				, IsFile AS "IsFile"
				, FileExt AS "FileExt"
				, IsComment AS "IsComment"
				, DocNo AS "DocNo"
				, ApproverCode AS "ApproverCode"
				, ApproverName AS "ApproverName"
				, ApprovalStep AS "ApprovalStep"
				, ApproverSIPAddress AS "ApproverSIPAddress"
				, IsReserved AS "IsReserved"
				, ReservedGubun AS "ReservedGubun"
				, ReservedTime AS "ReservedTime"
				, Priority AS "Priority"
				, IsModify AS "IsModify"
				, Reserved1 AS "Reserved1"
				, Reserved2 AS "Reserved2"
				, Finished AS "Finished"
				, BusinessData1  AS "BusinessData1"
				, BusinessData2  AS "BusinessData2"
				, BusinessData3  AS "BusinessData3"
				, BusinessData4  AS "BusinessData4"
				, BusinessData5  AS "BusinessData5"
				, BusinessData6  AS "BusinessData6"
				, BusinessData7  AS "BusinessData7"
				, BusinessData8  AS "BusinessData8"
				, BusinessData9  AS "BusinessData9"
				, BusinessData10  AS "BusinessData10"
				, FormPrefix AS "FromPrefix"
			FROM (
				SELECT PROA.ProcessID AS ProcessArchiveID
					, WA.WorkitemID AS WorkItemArchiveID
					, WA.PerformerID
					, PROA.InitiatorID
					, PROA.InitiatorName
					, PROA.InitiatorUnitID
					, PROA.InitiatorUnitName
					, WA.UserCode
					, WA.UserName
					, WA.SubKind
					, WA.SubKind AS FormSubKind
					, PDA.*
					, PDA.ProcessDescriptionID AS ProcessDescriptionArchiveID
					, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
				FROM JWF_Process PROA
				INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
				INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
				WHERE WA.UserCode = #{jobFunctionCode}
				AND WA.SubKind = 'T008'
				AND WA.PIBusinessState = '02_02'
				AND WA.Deleted IS NULL
				AND WA.PIDeleted IS NULL
				AND	PROA.ProcessState = 528
				AND	WA.State = 528
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PDA.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PDA.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PDA.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
			) RejectList
		    <trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
					<choose> 
						<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
						<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
						<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
						<otherwise>FormSubject</otherwise> 
					</choose> 
					LIKE '%' || #{searchWord} || '%' 
				</if>
				<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
					<choose>
		                <when test="searchGroupType == 'Date' ">
	                    	AND Finished BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
		                </when>
		                <otherwise>
		                    AND 
		                    <choose>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
								<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							</choose> 
							= #{searchGroupWord}
		                </otherwise>
		            </choose>
				</if>
			</trim>
		    <!-- Order by 절 -->
			<trim prefix="ORDER BY" prefixOverrides =",">
			    <if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
			        , Finished Desc
			    </if>
			  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
				 	<choose>
						<when test='sortColumn.equalsIgnoreCase("SubKind")'>, SubKind</when>
						<when test='sortColumn.equalsIgnoreCase("FormSubject")'>, FormSubject</when>
						<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>, InitiatorUnitName</when>
						<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
						<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
						<when test='sortColumn.equalsIgnoreCase("FormName")'>, FormName</when>
						<when test='sortColumn.equalsIgnoreCase("DocNo")'>, DocNo</when>
						<when test='sortColumn.equalsIgnoreCase("IsComment")'>, IsComment</when>
						<when test='sortColumn.equalsIgnoreCase("IsModify")'>, IsModify</when>
						<otherwise>, Finished</otherwise>
					</choose>
					<choose>
						<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
						<otherwise> DESC</otherwise>
					</choose>
				</if>
			</trim>
		<include refid="oracle.include.pagingFooter"/>
	</select>

    <!-- 반려함 목록 개수  -->
    <select id="selectJobFunctionRejectListCnt" parameterType="cmap" resultType="java.lang.Long">
       	SELECT COUNT(*) FROM (
        	SELECT RejectList.ProcessArchiveID FROM (
		      SELECT PROA.ProcessID AS ProcessArchiveID
					, WA.WorkitemID AS WorkItemArchiveID
					, WA.PerformerID
					, PROA.InitiatorID
					, PROA.InitiatorName
					, PROA.InitiatorUnitID
					, PROA.InitiatorUnitName
					, WA.UserCode
					, WA.UserName
					, WA.SubKind
					, WA.SubKind AS FormSubKind
					, PDA.*
					, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished			
				FROM JWF_Process PROA
				INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
				INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
				WHERE WA.UserCode = #{jobFunctionCode}
				AND WA.SubKind = 'T008'
				AND WA.PIBusinessState = '02_02'
				AND WA.Deleted IS NULL
				AND WA.PIDeleted IS NULL
				AND	PROA.ProcessState = 528
				AND	WA.State = 528
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PDA.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PDA.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PDA.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
			) RejectList
		    <trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
					<choose> 
						<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
						<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
						<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
						<otherwise>FormSubject</otherwise>
					</choose> 
					LIKE '%' || #{searchWord} || '%'
				</if>
				<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
					<choose>
		                <when test="searchGroupType == 'Date' ">
	                    	AND Finished BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
		                </when>
		                <otherwise>
		                    AND 
		                    <choose>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
								<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
								<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
							</choose> 
							 = #{searchGroupWord}
		                </otherwise>
		            </choose>
				</if>
			</trim>
		) A
	</select>

     <!-- 반려함 그룹별 목록 조회 -->
    <select id="selectJobFunctionRejectGroupList" parameterType="cmap" resultType="cmap">
		SELECT 
		<if test="searchGroupType == 'Date'">
			RejectList."Date" AS "fieldID"
			, COUNT(RejectList."Date") AS "fieldCnt"
	        , RejectList."Date" as "fieldName"
	    </if>
	    <if test="searchGroupType == 'FormPrefix'">
	    	RejectList.FormPrefix AS "fieldID"
	    	, COUNT(RejectList.FormPrefix) AS "fieldCnt"
	        , RejectList.FormName as "fieldName"
	    </if>
	     <if test="searchGroupType == 'InitiatorID'">
	     	RejectList.InitiatorID AS "fieldID"
	     	, COUNT(RejectList.InitiatorID) AS "fieldCnt"
	        , RejectList.InitiatorName as "fieldName"
	    </if>
	     <if test="searchGroupType == 'InitiatorUnitID'">
	     	RejectList.InitiatorUnitID AS "fieldID"
	     	, COUNT(RejectList.InitiatorUnitID) AS "fieldCnt"
	        , RejectList.InitiatorUnitName as "fieldName"
	    </if>
	      FROM (
		      SELECT PROA.ProcessID AS ProcessArchiveID
					, WA.WorkitemID AS WorkItemArchiveID
					, WA.PerformerID
					, PROA.InitiatorID
					, PROA.InitiatorName
					, PROA.InitiatorUnitID
					, PROA.InitiatorUnitName
					, WA.UserCode
					, WA.UserName
					, WA.SubKind
					, PDA.*
					, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
					<choose>
						<when test="searchGroupType == 'Date'">
							, TO_CHAR(TO_DATE(Fn_ComURTimeZoneTrans_S(#{userCode}, WA.Finished), 'YYYY-MM-DD HH24:MI:SS'),'YYYY-MM-DD') AS "Date"
						</when>
						<otherwise>
							, TO_CHAR(WA.Finished,'YYYY-MM-DD') AS "Date"
						</otherwise>
					</choose>
				FROM JWF_Process PROA
				INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
				INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
				INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
				WHERE WA.UserCode = #{jobFunctionCode}
				AND WA.SubKind = 'T008'
				AND WA.PIBusinessState = '02_02'
				AND WA.Deleted IS NULL
				AND WA.PIDeleted IS NULL
				AND	PROA.ProcessState = 528
				AND	WA.State = 528
				<choose>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
						AND (PDA.BusinessData1 IS NULL
							<if test='bizDataList != null'>
								OR PDA.BusinessData1 IN 
								<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
									#{item}
								</foreach>
							</if>
						)
					</when>
					<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
						AND PDA.BusinessData1 = #{businessData1}
					</when>
				</choose>
				<choose>
		            <when test='isSaaS == "Y"'>
		                AND FI.EntCode = #{entCode}
		            </when>
		            <otherwise>
						AND FI.EntCode IN ('ORGROOT', #{entCode})
		            </otherwise>
		        </choose>
			) RejectList
	    <!-- 검색 Where 절  -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				 LIKE '%' || #{searchWord} || '%'
			</if>
		</trim>
		<!-- Group By 절 -->
		<trim prefix="GROUP BY">
		  	<if test="searchGroupType != null and searchGroupType != '' ">
		  	    <if test="searchGroupType == 'Date'">
			 		RejectList."Date"
			 	</if>
		 		<if test="searchGroupType == 'FormPrefix'">
		 			RejectList.FormPrefix
			        , RejectList.FormName
			    </if>
			     <if test="searchGroupType == 'InitiatorID'">
			     	RejectList.InitiatorID
			        , RejectList.InitiatorName
			    </if>
			     <if test="searchGroupType == 'InitiatorUnitID'">
			     	RejectList.InitiatorUnitID
			        , RejectList.InitiatorUnitName
			 	</if>
			</if>
		</trim>
		<!-- Order by 절 -->
		<trim prefix="ORDER BY">
		  	<if test="searchGroupType != null ">
			 	"fieldName" ASC
			</if>
		</trim>
	</select>


    <!-- 반려함 엑셀 목록 조회 -->
    <select id="selectJobFunctionRejectListExcel" parameterType="cmap" resultType="cmap">
      SELECT
      	SubKind AS "SubKind"
      	, FormSubject AS "FormSubject"
      	, InitiatorUnitName AS "InitiatorUnitName"
      	, InitiatorName AS "InitiatorName"
      	, IsFile AS "IsFile"
      	, FormName AS "FormName"
      	, DocNo AS "DocNo"
      	, Finished AS "Finished"
      	, IsComment AS "IsComment"
      	, IsModify AS "IsModify"
      	, SubUserName AS "SubUserName"
      FROM (
	      SELECT PROA.ProcessID AS ProcessArchiveID
				, WA.WorkitemID AS WorkItemArchiveID
				, WA.PerformerID
				, PROA.InitiatorID
				, PROA.InitiatorName
				, PROA.InitiatorUnitID
				, PROA.InitiatorUnitName
				, WA.UserCode
				, WA.UserName
				, WA.SubKind
				, PDA.*
				, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
				,Fn_SplitString_r(PDA.businessdata5, '^^^', 2) as SubUserName
			FROM JWF_Process PROA
			INNER JOIN JWF_FormInstance FI ON PROA.FormInstID = FI.FormInstID
			INNER JOIN JWF_Workitem WA ON PROA.ProcessID = WA.ProcessID
			INNER JOIN JWF_ProcessDescription PDA ON PROA.ProcessDescriptionID = PDA.ProcessDescriptionID
			WHERE WA.UserCode = #{jobFunctionCode}
			AND WA.SubKind = 'T008'
			AND WA.PIBusinessState = '02_02'
			AND WA.Deleted IS NULL
			AND WA.PIDeleted IS NULL
			AND	PROA.ProcessState = 528
			AND	WA.State = 528
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (PDA.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR PDA.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND PDA.BusinessData1 = #{businessData1}
				</when>
			</choose>
			<choose>
	            <when test='isSaaS == "Y"'>
	                AND FI.EntCode = #{entCode}
	            </when>
	            <otherwise>
					AND FI.EntCode IN ('ORGROOT', #{entCode})
	            </otherwise>
	        </choose>
		) RejectList
	     <!-- 검색 데이터 Where 절 -->
	    <trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchType != null and searchType !='' and searchWord != null and searchWord != '' and searchWord.length() gt 0">
				<choose> 
					<when test='searchType.equalsIgnoreCase("InitiatorUnitName")'>InitiatorUnitName</when>
					<when test='searchType.equalsIgnoreCase("InitiatorName")'>InitiatorName</when>
					<when test='searchType.equalsIgnoreCase("FormName")'>FormName</when>
					<otherwise>FormSubject</otherwise>
				</choose> 
				LIKE '%' || #{searchWord} || '%'
			</if>
			<if test="searchGroupType != null and searchGroupType !='' and searchGroupWord != null and searchGroupWord != '' and searchGroupWord.length() gt 0">
			    <choose>
	                <when test="searchGroupType == 'Date' ">
	                    AND Finished BETWEEN #{searchGroupWord} AND TO_CHAR(TO_DATE(#{searchGroupWord}, 'YYYY-MM-DD HH24:MI:SS') + 1, 'YYYY-MM-DD HH24:MI:SS')
	                </when>
	                <otherwise>
	                    AND 
						<choose>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorID")'>InitiatorID</when>
							<when test='searchGroupType.equalsIgnoreCase("InitiatorUnitID")'>InitiatorUnitID</when>
							<when test='searchGroupType.equalsIgnoreCase("FormPrefix")'>FormPrefix</when>
						</choose> 
						= #{searchGroupWord}
	                </otherwise>
	            </choose>
			</if>
		</trim>
	    <!-- Order by 절 -->
		<trim prefix="ORDER BY" prefixOverrides =",">
		  	<if test="sortColumn == '' or sortColumn == null or sortDirection == '' or sortDirection == null">
		        , Finished Desc
		    </if>
		  	<if test="sortColumn != null and sortColumn != '' and sortDirection != null and sortDirection !='' ">
			 	<choose>
					<when test='sortColumn.equalsIgnoreCase("SubKind")'>, SubKind</when>
					<when test='sortColumn.equalsIgnoreCase("FormSubject")'>, FormSubject</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorUnitName")'>, InitiatorUnitName</when>
					<when test='sortColumn.equalsIgnoreCase("InitiatorName")'>, InitiatorName</when>
					<when test='sortColumn.equalsIgnoreCase("IsFile")'>, IsFile</when>
					<when test='sortColumn.equalsIgnoreCase("FormName")'>, FormName</when>
					<when test='sortColumn.equalsIgnoreCase("DocNo")'>, DocNo</when>
					<when test='sortColumn.equalsIgnoreCase("IsComment")'>, IsComment</when>
					<when test='sortColumn.equalsIgnoreCase("IsModify")'>, IsModify</when>
					<otherwise>, Finished</otherwise>
				</choose>
				<choose>
					<when test='sortDirection.equalsIgnoreCase("ASC")'> ASC</when>
					<otherwise> DESC</otherwise>
				</choose>
			</if>
		</trim>
	</select>

    <select id="selectJobFunctionApprovalNotDocReadCnt" resultType="java.lang.Long">
		SELECT COUNT(ApprovalList.FormInstID) FROM (
	        SELECT PRO.ProcessID
				, W.WorkItemID
				, PER.PerformerID
				, PRO.InitiatorID
				, PRO.InitiatorName
				, PRO.InitiatorUnitID
				, PRO.InitiatorUnitName
				, PER.UserCode
				, PER.UserName
				, PER.SubKind
				, PD.*
				, TO_CHAR(WA.Finished, 'YYYY-MM-DD HH24:MI:SS') AS Finished
			FROM JWF_Process PRO
			INNER JOIN JWF_FormInstance FI ON PRO.FormInstID = FI.FormInstID
			INNER JOIN JWF_Workitem W ON PRO.ProcessID = W.ProcessID
			INNER JOIN JWF_Performer PER ON W.WorkItemID = PER.WorkItemID
			INNER JOIN JWF_ProcessDescription PD ON PRO.ProcessDescriptionID = PD.ProcessDescriptionID
			WHERE PER.UserCode = #{jobFunctionCode}
			AND PER.SubKind = 'T008'
			AND PER.State = 1
			AND W.State = 288
			AND PRO.ProcessState = 288
			AND PRO.DeleteDate IS NULL
			<choose>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('Y')">
					AND (PD.BusinessData1 IS NULL
						<if test='bizDataList != null'>
							OR PD.BusinessData1 IN 
							<foreach collection="bizDataList" item="item" index="index" separator="," open="(" close=")">
								#{item}
							</foreach>
						</if>
					)
				</when>
				<when test="isApprovalList != null and isApprovalList.equalsIgnoreCase('N')">
					AND PD.BusinessData1 = #{businessData1}
				</when>
			</choose>
			<choose>
	            <when test='isSaaS == "Y"'>
	                AND FI.EntCode = #{entCode}
	            </when>
	            <otherwise>
					AND FI.EntCode IN ('ORGROOT', #{entCode})
	            </otherwise>
	        </choose>
		) ApprovalList
		WHERE NOT EXISTS (
			SELECT
					DISTINCT R.FormInstID
			FROM
					jwf_docreadhistory R
					INNER JOIN jwf_forminstance FI ON R.FormInstID = FI.FormInstID
			WHERE AdminYN = 'N'
			AND UserID = #{userID}
			AND ApprovalList.FormInstID = R.FormInstID
		)
	</select>
	<select id="selectJobfunctionAuth" parameterType="cmap" resultType="java.lang.Long">
		SELECT COUNT(*) 
        FROM jwf_jobfunction jf
		INNER JOIN jwf_jobfunctionmember jfm ON jf.JobFunctionID = jfm.JobFunctionID
		WHERE jf.JOBFUNCTIONCODE = #{jobFunctionCode}
		AND jf.EntCode = #{entCode}
		AND jfm.USERCODE = #{userID}
	</select>    
</mapper>

